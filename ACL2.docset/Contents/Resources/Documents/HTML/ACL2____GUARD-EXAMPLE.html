<html>
<head>
<meta charset="UTF-8">
<title>Guard-example</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____GUARD-EXAMPLE">Click for Guard-example in the Full Manual</a></h3>

<p>A brief transcript illustrating <a href="ACL2____GUARD.html">guard</a>s in ACL2</p><p>This note addresses the question: what is the use of <a href="ACL2____GUARD.html">guard</a>s 
 in ACL2?  Although we recommend that beginners try to avoid <a href="ACL2____GUARD.html">guard</a>s for 
 a while, we hope that the summary here is reasonably self-contained and will 
 provide a reasonable introduction to guards in ACL2.  For a more systematic 
 discussion, see <a href="ACL2____GUARD.html">guard</a>.  For a summary of that topic, see <a href="ACL2____GUARD-QUICK-REFERENCE.html">guard-quick-reference</a>.</p> 
 
 <p>Before we get into the issue of <a href="ACL2____GUARD.html">guard</a>s, let us note that there are 
 two important ``modes'':</p> 
 
 <p><a href="ACL2____DEFUN-MODE.html">defun-mode</a>  ``Does this <a href="COMMON-LISP____DEFUN.html">defun</a> add an axiom (`:logic 
 mode') or not (`:program mode')?''  (See <a href="ACL2____DEFUN-MODE.html">defun-mode</a>.)  Only 
 <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode functions can have their ``<a href="ACL2____GUARD.html">guard</a>s verified'' 
 via mechanized proof; see <a href="ACL2____VERIFY-GUARDS.html">verify-guards</a>.</p> 
 
 <p><span class="tt"><a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a></span>  ``Should runtime <a href="ACL2____GUARD.html">guard</a> violations 
 signal an error (<span class="v">:all</span>, and usually with <span class="v">t</span> or <span class="v">:nowarn</span>) or go 
 undetected (<span class="v">nil</span>, <span class="v">:none</span>)?  Equivalently, are expressions evaluated in 
 Common Lisp or in the logic?''  (See <a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a>.)</p> 
 
 <p><i>Prompt examples</i></p> 
 
 <p>Here some examples of the relation between the ACL2 <a href="ACL2____PROMPT.html">prompt</a> and the 
 ``modes'' discussed above.  Also see <a href="ACL2____DEFAULT-PRINT-PROMPT.html">default-print-prompt</a>.  The first 
 examples all have <span class="v">ld-skip-proofsp nil</span>; that is, proofs are <i>not</i> 
 skipped.</p> 
 
 <pre class="code">ACL2 !&gt;    ; logic mode with guard checking on
ACL2 &gt;     ; logic mode with guard checking off
ACL2 p!&gt;   ; program mode with guard checking on
ACL2 p&gt;    ; program mode with guard checking off</pre> 
 
 <p>Here are some examples with <span class="tt"><a href="ACL2____DEFAULT-DEFUN-MODE.html">default-defun-mode</a></span> of <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span>.</p> 
 
 <pre class="code">ACL2 &gt;     ; guard checking off, ld-skip-proofsp nil
ACL2 s&gt;    ; guard checking off, ld-skip-proofsp t
ACL2 !&gt;    ; guard checking on, ld-skip-proofsp nil
ACL2 !s&gt;   ; guard checking on, ld-skip-proofsp t</pre> 
 
 <p><i>Sample session</i></p> 
 
 <pre class="code">ACL2 !&gt;(<a href="COMMON-LISP_____B2.html">+</a> 'abc 3)

ACL2 Error in TOP-LEVEL: The guard for the function symbol
BINARY-+, which is (<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____ACL2-NUMBERP.html">ACL2-NUMBERP</a> X) (<a href="ACL2____ACL2-NUMBERP.html">ACL2-NUMBERP</a> Y)),
is violated by the arguments in the call (<a href="COMMON-LISP_____B2.html">+</a> 'ABC 3).

ACL2 !&gt;:set-guard-checking nil
;;;; verbose output omitted here
ACL2 &gt;(<a href="COMMON-LISP_____B2.html">+</a> 'abc 3)
3
ACL2 &gt;(<a href="COMMON-LISP_____C3.html">&lt;</a> 'abc 3)
T
ACL2 &gt;(<a href="COMMON-LISP_____C3.html">&lt;</a> 3 'abc)
NIL
ACL2 &gt;(<a href="COMMON-LISP_____C3.html">&lt;</a> -3 'abc)
T
ACL2 &gt;:set-guard-checking t

Turning guard checking on, value T.

ACL2 !&gt;(<a href="COMMON-LISP____DEFUN.html">defun</a> sum-list (x)
        (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="ACL2____INTEGER-LISTP.html">integer-listp</a> x)
                        :verify-guards nil))
        (<a href="COMMON-LISP____COND.html">cond</a> ((<a href="COMMON-LISP____ENDP.html">endp</a> x) 0)
              (t (<a href="COMMON-LISP_____B2.html">+</a> (<a href="COMMON-LISP____CAR.html">car</a> x) (sum-list (<a href="COMMON-LISP____CDR.html">cdr</a> x))))))

The admission of SUM-LIST is trivial, using the relation
O&lt; (which is known to be well-founded on the domain
recognized by O-P) and the measure (<a href="ACL2____ACL2-COUNT.html">ACL2-COUNT</a> X).
We observe that the type of SUM-LIST is described by the
theorem (<a href="ACL2____ACL2-NUMBERP.html">ACL2-NUMBERP</a> (SUM-LIST X)).  We used primitive type
reasoning.

Summary
Form:  ( DEFUN SUM-LIST ...)
Rules: ((:FAKE-RUNE-FOR-TYPE-SET NIL))
Warnings:  None
Time:  0.03 seconds
   (prove: 0.00, print: 0.00, proof tree: 0.00, other: 0.03)
 SUM-LIST
ACL2 !&gt;(sum-list '(1 2 3))

ACL2 Warning [Guards] in TOP-LEVEL:  Guard-checking will be inhibited
on recursive calls of the executable-counterpart (i.e., in the ACL2
logic) of SUM-LIST.  To check guards on all recursive calls:
  (<a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> :all)
To leave behavior unchanged except for inhibiting this message:
  (<a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> :nowarn)

6
ACL2 !&gt;(sum-list '(1 2 abc 3))

ACL2 Error in TOP-LEVEL: The guard for the function symbol
BINARY-+, which is (<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____ACL2-NUMBERP.html">ACL2-NUMBERP</a> X) (<a href="ACL2____ACL2-NUMBERP.html">ACL2-NUMBERP</a> Y)),
is violated by the arguments in the call (<a href="COMMON-LISP_____B2.html">+</a> 'ABC 3).

ACL2 !&gt;:set-guard-checking nil
;;;; verbose output omitted here
ACL2 &gt;(sum-list '(1 2 abc 3))
6
ACL2 &gt;(<a href="ACL2____DEFTHM.html">defthm</a> sum-list-append
       (<a href="COMMON-LISP____EQUAL.html">equal</a> (sum-list (<a href="COMMON-LISP____APPEND.html">append</a> a b))
              (<a href="COMMON-LISP_____B2.html">+</a> (sum-list a) (sum-list b))))

&lt;&lt; Starting proof tree logging &gt;&gt;

Name the formula above *1.

Perhaps we can prove *1 by induction.  Three induction
schemes are suggested by this conjecture.  Subsumption
reduces that number to two.  However, one of these is flawed
and so we are left with one viable candidate.

...

That completes the proof of *1.

Q.E.D.</pre> 
 
 <p><i>Guard verification vs. defun</i></p> 
 
 <pre class="code">      Declare Form                        Guards Verified?

  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :program ...))          no
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard g))                    yes
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard g :verify-guards nil)) no
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> ...&lt;no :guard&gt;...))           no

ACL2 &gt;:pe sum-list
 l        8  (<a href="COMMON-LISP____DEFUN.html">DEFUN</a> SUM-LIST (X)
              (<a href="COMMON-LISP____DECLARE.html">DECLARE</a> (<a href="ACL2____XARGS.html">XARGS</a> :GUARD (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> X)
                              :VERIFY-GUARDS NIL))
              (<a href="COMMON-LISP____COND.html">COND</a> ((<a href="COMMON-LISP____ENDP.html">ENDP</a> X) 0)
                    (T (<a href="COMMON-LISP_____B2.html">+</a> (<a href="COMMON-LISP____CAR.html">CAR</a> X) (SUM-LIST (<a href="COMMON-LISP____CDR.html">CDR</a> X))))))
ACL2 &gt;(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> sum-list)
The non-trivial part of the guard conjecture for SUM-LIST,
given the :type-prescription rule SUM-LIST, is

Goal
(<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____IMPLIES.html">IMPLIES</a> (<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> X) (<a href="COMMON-LISP____NOT.html">NOT</a> (<a href="COMMON-LISP____CONSP.html">CONSP</a> X)))
              (<a href="COMMON-LISP____EQUAL.html">EQUAL</a> X NIL))
     (<a href="ACL2____IMPLIES.html">IMPLIES</a> (<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> X) (<a href="COMMON-LISP____NOT.html">NOT</a> (<a href="COMMON-LISP____ENDP.html">ENDP</a> X)))
              (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> (<a href="COMMON-LISP____CDR.html">CDR</a> X)))
     (<a href="ACL2____IMPLIES.html">IMPLIES</a> (<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> X) (<a href="COMMON-LISP____NOT.html">NOT</a> (<a href="COMMON-LISP____ENDP.html">ENDP</a> X)))
              (<a href="ACL2____ACL2-NUMBERP.html">ACL2-NUMBERP</a> (<a href="COMMON-LISP____CAR.html">CAR</a> X)))).

...

ACL2 &gt;:pe sum-list
 lv       8  (<a href="COMMON-LISP____DEFUN.html">DEFUN</a> SUM-LIST (X)
              (<a href="COMMON-LISP____DECLARE.html">DECLARE</a> (<a href="ACL2____XARGS.html">XARGS</a> :GUARD (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> X)
                              :VERIFY-GUARDS NIL))
ACL2 &gt;:set-guard-checking t

Turning guard checking on, value T.

ACL2 !&gt;(sum-list '(1 2 abc 3))

ACL2 Error in TOP-LEVEL: The guard for the function symbol
SUM-LIST, which is (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> X), is violated by the
arguments in the call (SUM-LIST '(1 2 ABC ...)).  See :DOC trace for a useful
debugging utility.  See :DOC set-guard-checking for information about
suppressing this check with (<a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> :none), as recommended for
new users.

ACL2 !&gt;:set-guard-checking nil
;;;; verbose output omitted here
ACL2 &gt;(sum-list '(1 2 abc 3))
6
ACL2 &gt;:comp sum-list
Compiling gazonk0.lsp.
End of Pass 1.
End of Pass 2.
Finished compiling gazonk0.lsp.
Loading gazonk0.o
start address -T 1bbf0b4 Finished loading gazonk0.o
Compiling gazonk0.lsp.
End of Pass 1.
End of Pass 2.
Finished compiling gazonk0.lsp.
Loading gazonk0.o
start address -T 1bc4408 Finished loading gazonk0.o
 SUM-LIST
ACL2 &gt;:q

Exiting the ACL2 read-eval-print loop.
ACL2&gt;(<a href="COMMON-LISP____TRACE.html">trace</a> sum-list)
(SUM-LIST)

ACL2&gt;(<a href="ACL2____LP.html">lp</a>)

ACL2 Version 1.8.  Level 1.  Cbd "/slocal/src/acl2/v1-9/".
Type :help for help.
ACL2 &gt;(sum-list '(1 2 abc 3))
6
ACL2 &gt;(sum-list '(1 2 3))
  1&gt; (SUM-LIST (1 2 3))&gt;
    2&gt; (SUM-LIST (2 3))&gt;
      3&gt; (SUM-LIST (3))&gt;
        4&gt; (SUM-LIST NIL)&gt;
        &lt;4 (SUM-LIST 0)&gt;
      &lt;3 (SUM-LIST 3)&gt;
    &lt;2 (SUM-LIST 5)&gt;
  &lt;1 (SUM-LIST 6)&gt;
6
ACL2 &gt;:pe sum-list-append
          9  (<a href="ACL2____DEFTHM.html">DEFTHM</a> SUM-LIST-APPEND
                     (<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (SUM-LIST (<a href="COMMON-LISP____APPEND.html">APPEND</a> A B))
                            (<a href="COMMON-LISP_____B2.html">+</a> (SUM-LIST A) (SUM-LIST B))))
ACL2 &gt;(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> sum-list-append)

The non-trivial part of the guard conjecture for
SUM-LIST-APPEND, given the :type-prescription rule SUM-LIST,
is

Goal
(<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____TRUE-LISTP.html">TRUE-LISTP</a> A)
     (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> (<a href="COMMON-LISP____APPEND.html">APPEND</a> A B))
     (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> A)
     (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> B)).

...

****** FAILED ******* See :DOC failure ****** FAILED ******
ACL2 &gt;(<a href="ACL2____DEFTHM.html">defthm</a> common-lisp-sum-list-append
         (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____INTEGER-LISTP.html">integer-listp</a> a)
                  (<a href="ACL2____INTEGER-LISTP.html">integer-listp</a> b))
             (<a href="COMMON-LISP____EQUAL.html">equal</a> (sum-list (<a href="COMMON-LISP____APPEND.html">append</a> a b))
                    (<a href="COMMON-LISP_____B2.html">+</a> (sum-list a) (sum-list b)))
             t)
         :rule-classes nil)

&lt;&lt; Starting proof tree logging &gt;&gt;

By the simple :rewrite rule SUM-LIST-APPEND we reduce the
conjecture to

Goal'
(<a href="ACL2____IMPLIES.html">IMPLIES</a> (<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> A)
              (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> B))
         (<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (<a href="COMMON-LISP_____B2.html">+</a> (SUM-LIST A) (SUM-LIST B))
                (<a href="COMMON-LISP_____B2.html">+</a> (SUM-LIST A) (SUM-LIST B)))).

But we reduce the conjecture to T, by primitive type
reasoning.

Q.E.D.
;;;; summary omitted here
ACL2 &gt;(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> common-lisp-sum-list-append)

The non-trivial part of the guard conjecture for
COMMON-LISP-SUM-LIST-APPEND, given the :type-prescription
rule SUM-LIST, is

Goal
(<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____IMPLIES.html">IMPLIES</a> (<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> A)
                   (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> B))
              (<a href="ACL2____TRUE-LISTP.html">TRUE-LISTP</a> A))
     (<a href="ACL2____IMPLIES.html">IMPLIES</a> (<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> A)
                   (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> B))
              (<a href="ACL2____INTEGER-LISTP.html">INTEGER-LISTP</a> (<a href="COMMON-LISP____APPEND.html">APPEND</a> A B)))).

...

Q.E.D.

That completes the proof of the guard theorem for
COMMON-LISP-SUM-LIST-APPEND.  COMMON-LISP-SUM-LIST-APPEND
is compliant with Common Lisp.
;;;; Summary omitted here.
ACL2 &gt;(<a href="ACL2____DEFTHM.html">defthm</a> foo (<a href="COMMON-LISP____CONSP.html">consp</a> (<a href="ACL2____MV.html">mv</a> x y)))

...

Q.E.D.</pre> 
 
 <pre class="code">ACL2 &gt;(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> foo)

ACL2 Error in (<a href="ACL2____VERIFY-GUARDS.html">VERIFY-GUARDS</a> FOO): The number of values we
need to return is 1 but the number of values returned by the
call (<a href="ACL2____MV.html">MV</a> X Y) is 2.

&gt; (<a href="COMMON-LISP____CONSP.html">CONSP</a> (<a href="ACL2____MV.html">MV</a> X Y))

ACL2 Error in (<a href="ACL2____VERIFY-GUARDS.html">VERIFY-GUARDS</a> FOO): The guards for FOO cannot
be verified because the theorem has the wrong syntactic
form.  See :DOC verify-guards.</pre>
</body>
</html>
