<html>
<head>
<meta charset="UTF-8">
<title>Signature</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____SIGNATURE">Click for Signature in the Full Manual</a></h3>

<p>How to specify the arity of a constrained function</p><p>We start with a gentle introduction to signatures, where we pretend 
 that there are no single-threaded objects (more on that below â€” for now, 
 if you don't know anything about single-threaded objects, that's fine!).  Here 
 are some simple examples of signatures.</p> 
 
 <pre class="code">((hd *) =&gt; *)
((pair * *) =&gt; *)
((foo * *) =&gt; (<a href="ACL2____MV.html">mv</a> * * *))</pre> 
 
 <p>The first of these says that <span class="v">hd</span> is a function of one argument, while 
 the other two say that <span class="v">pair</span> and <span class="v">foo</span> are functions that each take two 
 arguments.  The first two say that <span class="v">hd</span> and <span class="v">pair</span> return a single 
 value.  The third says that <span class="v">foo</span> returns three values, much as the 
 following definition returns three values:</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> bar (x y)
  (<a href="ACL2____MV.html">mv</a> y x (<a href="COMMON-LISP____CONS.html">cons</a> x y)))</pre> 
 
 <p>Corresponding ``old style'' signatures are as follows.  In each case, a 
 function symbol is followed by a list of formal parameters and then either 
 <span class="v">t</span>, to denote a single value return, or <span class="v">(<a href="ACL2____MV.html">mv</a> t t t)</span>, to denote a 
 multiple value return (in this case, returning three values).</p> 
 
 <pre class="code">(hd (x) t)
(pair (x y) t)
(foo (x y) (<a href="ACL2____MV.html">mv</a> t t t))</pre> 
 
 <p>That concludes our gentle introduction.  The documentation below is more 
 general, for example covering single-threaded objects and keyword values such 
 as <span class="v">:guard</span>.  When reading what follows below, it is sufficient to know 
 about single-threaded objects (or ``stobjs'') that each has a unique symbolic 
 name and that <span class="tt"><a href="ACL2____STATE.html">state</a></span> is the name of the only built-in single-threaded 
 object.  All other stobjs are introduced by the user via <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span> or 
 <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span>.  An object that is not a single-threaded object is said 
 to be ``ordinary.''  For a discussion of single-threaded objects, see <a href="ACL2____STOBJ.html">stobj</a>.</p> 
 
 <pre class="code">Examples:
((hd *) =&gt; *)
((hd *) =&gt; * :formals (x) :guard (<a href="COMMON-LISP____CONSP.html">consp</a> x))
((printer * state) =&gt; (<a href="ACL2____MV.html">mv</a> * * state))
((mach * mach-state * state) =&gt; (<a href="ACL2____MV.html">mv</a> * mach-state))

General Form:
((fn ...) =&gt; *)
((fn ...) =&gt; stobj)
or
((fn ...) =&gt; (<a href="ACL2____MV.html">mv</a> ...))
or for part1 and part2 as above,
(part1 =&gt; part2 :kwd1 val1 ... :kwdn valn)</pre> 
 
 <p>where <span class="v">fn</span> is the constrained function symbol, <span class="v">...</span> is a list of 
 asterisks and/or the names of single-threaded objects, <span class="v">stobj</span> is a 
 single-threaded object name, and the optional <span class="v">:kwdi</span> and <span class="v">vali</span> are as 
 described below.  ACL2 also supports an older style of signature, described 
 below after we describe the preferred style.</p> 
 
 <p>Signatures specify three syntactic aspects of a function symbol: (1) the 
 ``arity'' or how many arguments the function takes, (2) the ``multiplicity'' 
 or how many results it returns via <span class="v">MV</span>, and (3) which of those arguments 
 and results are single-threaded objects and which objects they are.</p> 
 
 <p>A signature typically has the form <span class="v">((fn x1 ... xn) =&gt; val)</span>.  Such a 
 signature has two parts, separated by the symbol ``=&gt;''.  The first part, 
 <span class="v">(fn x1 ... xn)</span>, is suggestive of a call of the constrained function.  The 
 number of ``arguments,'' <span class="v">n</span>, indicates the arity of <span class="v">fn</span>.  Each <span class="v">xi</span> 
 must be a symbol.  If a given <span class="v">xi</span> is the symbol ``*'' then the 
 corresponding argument must be ordinary.  If a given <span class="v">xi</span> is any other 
 symbol, that symbol must be the name of a single-threaded object and the 
 corresponding argument must be that object.  No stobj name may occur twice 
 among the <span class="v">xi</span>.</p> 
 
 <p>The second part, <span class="v">val</span>, of a signature is suggestive of a term and 
 indicates the ``shape'' of the output of <span class="v">fn</span>.  If <span class="v">val</span> is a symbol 
 then it must be either the symbol ``*'' or the name of a single-threaded 
 object.  In either case, the multiplicity of <span class="v">fn</span> is 1 and <span class="v">val</span> 
 indicates whether the result is ordinary or a stobj.  Otherwise, <span class="v">val</span> is 
 of the form <span class="v">(<a href="ACL2____MV.html">mv</a> y1 ... yk)</span>, where <span class="v">k</span> &gt; 1.  Each <span class="v">yi</span> must be 
 either the symbol ``*'' or the name of a stobj.  Such a <span class="v">val</span> indicates 
 that <span class="v">fn</span> has multiplicity <span class="v">k</span> and the <span class="v">yi</span> indicate which results 
 are ordinary and which are stobjs.  No stobj name may occur twice among the 
 <span class="v">yi</span>, and a stobj name may appear in <span class="v">val</span> only if appears among the 
 <span class="v">xi</span>.</p> 
 
 <p>A signature may have the form <span class="v">((fn x1 ... xn) =&gt; val . k)</span>, where 
 <span class="v">k</span> is a <span class="tt"><a href="ACL2____KEYWORD-VALUE-LISTP.html">keyword-value-listp</a></span>, i.e., an alternating list of keywords 
 and values starting with a keyword.  In this case <span class="v">((fn x1 ... xn) =&gt; val)</span> 
 must be a legal signature as described above.  The legal keywords in <span class="v">k</span> 
 are normally <span class="v">:GUARD</span> and <span class="v">:FORMALS</span> (but see remarks at the end of this 
 topic regarding <span class="v">:GLOBAL-STOBJS</span> and, for ACL2(r), <span class="v">:CLASSICALP</span>).  The 
 value following <span class="v">:FORMALS</span> is to be the list of formal parameters of 
 <span class="v">fn</span>, which must be consistent with the parameters specified in <span class="v">(fn x1
 ... xn)</span>: they must both specify the same arity (number of formal parameters) 
 and the same <a href="ACL2____STOBJ.html">stobj</a> inputs.  The value following <span class="v">:GUARD</span> is a term 
 that is to be the <a href="ACL2____GUARD.html">guard</a> of <span class="v">fn</span>.  Note that this guard is never 
 actually evaluated, and is not subject to the guard verification performed on 
 functions introduced by <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> (see <a href="ACL2____VERIFY-GUARDS.html">verify-guards</a>).  Said 
 differently: this guard need not itself have a guard of <span class="v">t</span>.  Indeed, the 
 guard is only used for attachments; see <a href="ACL2____DEFATTACH.html">defattach</a>.  Note that if 
 <span class="v">:GUARD</span> is supplied, then <span class="v">:FORMALS</span> must also be supplied as a list of 
 distinct variables that includes all variables occurring free in the specified 
 guard.  One final observation about guards: if the <span class="v">:GUARD</span> keyword is 
 omitted, then the guard defaults to <span class="v">T</span>.</p> 
 
 <p>Before ACL2 supported user-declared single-threaded objects there was only 
 one single-threaded object: ACL2's built-in notion of <span class="tt"><a href="ACL2____STATE.html">state</a></span>.  The 
 notion of signature supported then gave a special role to the symbol 
 <span class="v">state</span> and all other symbols were considered to denote ordinary objects. 
 ACL2 still supports the old form of signature, but it is limited to functions 
 that operate on ordinary objects or ordinary objects and <span class="v">state</span>.</p> 
 
 <pre class="code">Old Style General Form:
(fn formals result . k)</pre> 
 
 <p>where <span class="v">fn</span> is the constrained function symbol, <span class="v">formals</span> is a 
 suitable list of formal parameters for it, <span class="v">k</span> is an optional <span class="tt"><a href="ACL2____KEYWORD-VALUE-LISTP.html">keyword-value-listp</a></span> (see below), and <span class="v">result</span> is either a symbol denoting 
 that the function returns one result or else <span class="v">result</span> is an <span class="tt"><a href="ACL2____MV.html">mv</a></span> 
 expression, <span class="v">(<a href="ACL2____MV.html">mv</a> s1 ... sn)</span>, where <span class="v">n&gt;1</span>, each <span class="v">si</span> is a symbol, 
 indicating that the function returns <span class="v">n</span> results.  At most one of the 
 formals may be the symbol <span class="v">STATE</span>, indicating that the corresponding 
 argument must be ACL2's built-in <span class="tt"><a href="ACL2____STATE.html">state</a></span>.  If <span class="v">state</span> appears in 
 <span class="v">formals</span> then <span class="v">state</span> may appear once in <span class="v">result</span>.  All ``variable 
 symbols'' other than <span class="v">state</span> in old style signatures denote ordinary 
 objects, regardless of whether the symbol has been defined to be a 
 single-threaded object name!</p> 
 
 <p>The optional <span class="v">k</span> is as described above for newer-style signatures, 
 except that the user is also allowed to declare which symbols (besides 
 <span class="v">state</span>) are to be considered single-threaded object names.  Thus 
 <span class="v">:STOBJS</span> is also a legal keyword.  The form</p> 
 
 <pre class="code">(fn formals result ... :stobjs names ...)</pre> 
 
 <p>specifies that <span class="v">names</span> is either the name of a single-threaded object or 
 else is a list of such names.  Every name in <span class="v">names</span> must have been 
 previously defined as a stobj via <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span> or <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span>.</p> 
 
 <p>As promised above, we conclude with a remark about additional keywords. 
 The keyword <span class="v">:GLOBAL-STOBJS</span> specifies the use of the macro, 
 <span class="v">with-global-stobj</span>, in attachments (see <a href="ACL2____DEFATTACH.html">defattach</a>); see <span class="tt"><a href="ACL2____WITH-GLOBAL-STOBJ.html">with-global-stobj</a></span> for explanation of this keyword.  The keyword 
 <span class="v">:CLASSICALP</span> is legal for ACL2(r) only (see <a href="COMMON-LISP____REAL.html">real</a>).  The value of 
 this keyword must be <span class="v">t</span> (the default) or <span class="v">nil</span>, indicating respectively 
 whether <span class="v">fn</span> is classical or not.</p>
</body>
</html>
