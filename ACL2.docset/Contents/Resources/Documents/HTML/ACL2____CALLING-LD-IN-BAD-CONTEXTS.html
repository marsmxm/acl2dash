<html>
<head>
<meta charset="UTF-8">
<title>Calling-ld-in-bad-contexts</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____CALLING-LD-IN-BAD-CONTEXTS">Click for Calling-ld-in-bad-contexts in the Full Manual</a></h3>

<p>Errors caused by calling <span class="tt"><a href="ACL2____LD.html">ld</a></span> in inappropriate contexts</p><p>The macro <span class="tt"><a href="ACL2____LD.html">ld</a></span> was designed to be called directly in the 
 top-level ACL2 loop, although there may be a few occasions for calling it from 
 functions.  ACL2 cannot cope with invocations of <span class="tt"><a href="ACL2____LD.html">ld</a></span> during the process 
 of loading a compiled file for a book, so that is an error.</p> 
 
 <p>Specifically: ACL2 will cause an error in the following two 
 circumstances:</p> 
 
 <ul> 
 
 <li>when calling <span class="tt"><a href="ACL2____LD.html">ld</a></span> inside <span class="tt"><a href="ACL2____PROGN_12.html">progn!</a></span> unless state global 
 <span class="v">ld-okp</span> is first set to <span class="v">t</span>, e.g., using <span class="v">(<a href="ACL2____ASSIGN.html">assign</a> ld-okp t)</span>; 
 also,</li> 
 
 <li>when calling <span class="v">ld</span> while inside raw Lisp, e.g., when loading a compiled 
 file during an invocation of <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>.</li> 
 
 </ul> 
 
 <p>Consider for example the following book, where file <span class="v">const.lsp</span> contains 
 the single form <span class="v">(<a href="ACL2____DEFCONST.html">defconst</a> *foo* '(a b))</span> after its initial <span class="tt"><a href="COMMON-LISP____IN-PACKAGE.html">in-package</a></span> form.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "ACL2")
(<a href="ACL2____DEFTTAG.html">defttag</a> t)
(<a href="ACL2____PROGN_12.html">progn!</a> (<a href="ACL2____LD.html">ld</a> "const.lsp"))</pre> 
 
 <p>An attempt to certify this book as follows</p> 
 
 <pre class="code">(<a href="ACL2____CERTIFY-BOOK.html">certify-book</a> "const-wrapper" 0 t :ttags :all)</pre> 
 
 <p>will cause an error:</p> 
 
 <pre class="code">ACL2 Error in LD:  It is illegal to call LD in this context.  See :DOC
calling-ld-in-bad-contexts.</pre> 
 
 <p>However, that error can be avoided by expanding the <span class="tt"><a href="ACL2____PROGN_12.html">progn!</a></span> call as 
 follows.</p> 
 
 <pre class="code">(<a href="ACL2____PROGN_12.html">progn!</a> (<a href="ACL2____ASSIGN.html">assign</a> ld-okp t)
        (<a href="ACL2____LD.html">ld</a> "const.lsp"))</pre> 
 
 <p>Now certification succeeds; however, any subsequent call of <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> will fail to load the compiled file for the book.  Again, that 
 is necessary because of how ACL2 is designed; in this case, the <span class="tt"><a href="ACL2____LD.html">ld</a></span> 
 call would interfere with tracking of constant definitions when loading the 
 compiled file for the book.  To avoid warnings about loading compiled files, 
 either certify the book without creating a compiled file or else include the 
 book without loading the compiled file; see <a href="ACL2____CERTIFY-BOOK.html">certify-book</a> and <a href="ACL2____INCLUDE-BOOK.html">include-book</a>.</p> 
 
 <p>Note that it is legal to put a definition such as the following into a 
 book, where <span class="v">ld</span> is called in the body of a function; the two conditions 
 above do not prohibit this.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (<a href="ACL2____STATE.html">state</a>)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t :stobjs state :mode :program))
  (<a href="ACL2____LD.html">ld</a> '((<a href="COMMON-LISP____DEFUN.html">defun</a> h (x) x)) :ld-user-stobjs-modified-warning t))</pre> 
 
 <p>One can then include the book, evaluate <span class="v">(foo state)</span>, and then evaluate 
 calls of <span class="v">h</span>.</p>
</body>
</html>
