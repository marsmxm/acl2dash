<html>
<head>
<meta charset="UTF-8">
<title>Oops</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____OOPS">Click for Oops in the Full Manual</a></h3>

<p>Undo a <span class="v">:u</span> or <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span></p><p>The keyword <a href="ACL2____COMMAND.html">command</a> <span class="v">:oops</span> will undo the most recent 
 <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> (or <span class="v">:u</span>, which we here consider just another 
 <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span>).  A second <span class="v">:oops</span> will undo the next most recent 
 <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span>, a third will undo the <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> before that one, 
 and a fourth <span class="v">:oops</span> will return the logical <a href="ACL2____WORLD.html">world</a> to its 
 configuration before the first <span class="v">:oops</span>.</p> 
 
 <p>Consider the logical world (see <a href="ACL2____WORLD.html">world</a>) that represents the current 
 extension of the logic and ACL2's rules for dealing with it.  The <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> and <span class="v">:u</span> <a href="ACL2____COMMAND.html">command</a>s ``roll back'' to some previous <a href="ACL2____WORLD.html">world</a> 
 (see <a href="ACL2____UBT.html">ubt</a>).  Sometimes these <a href="ACL2____COMMAND.html">command</a>s are used to inadvertently 
 undo useful work and user's wish they could ``undo the last undo.''  That is 
 the function provided by <span class="v">:oops</span>.</p> 
 
 <p><span class="v">:Oops</span> is best described in terms of an implementation.  Imagine a ring 
 of four <a href="ACL2____WORLD.html">world</a>s and a marker (<span class="v">*</span>) indicating the current ACL2 <a href="ACL2____WORLD.html">world</a>:</p> 
 
 <pre class="code">      *
    w0
  /    \
w3      w1
  \    /
    w2</pre> 
 
 <p>This is called the ``kill ring'' and it is maintained as follows.  When you 
 execute an event the current <a href="ACL2____WORLD.html">world</a> is extended and the kill ring is not 
 otherwise affected.  When you execute <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> or <span class="v">:u</span>, the 
 current <a href="ACL2____WORLD.html">world</a> marker is moved one step counterclockwise and that <a href="ACL2____WORLD.html">world</a> in the ring is replaced by the result, say <span class="v">w0'</span>, of the 
 <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> or <span class="v">:u</span>.</p> 
 
 <pre class="code">     w0
   /    \
*w0'     w1
   \    /
     w2</pre> 
 
 <p>If you were to execute <a href="ACL2____EVENTS.html">events</a> at this point, <span class="v">w0'</span> would be 
 extended and no other changes would occur in the kill ring.</p> 
 
 <p>When you execute <span class="v">:oops</span>, the marker is moved one step clockwise.  Thus 
 the kill ring becomes</p> 
 
 <pre class="code">      *
    w0
  /    \
w0'     w1
  \    /
    w2</pre> 
 
 <p>and the current ACL2 <a href="ACL2____WORLD.html">world</a> is <span class="v">w0</span> once again.  That is, 
 <span class="v">:oops</span> ``undoes'' the <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> that produced <span class="v">w0'</span> from 
 <span class="v">w0</span>.  Similarly, a second <span class="v">:oops</span> will move the marker to <span class="v">w1</span>, 
 undoing the undo that produced <span class="v">w0</span> from <span class="v">w1</span>.  A third <span class="v">:oops</span> makes 
 <span class="v">w2</span> the current <a href="ACL2____WORLD.html">world</a>.  Note however that a fourth <span class="v">:oops</span> 
 restores us to the configuration previously displayed above in which <span class="v">w0'</span> 
 has the marker.</p> 
 
 <p>In general, the kill ring contains the current <a href="ACL2____WORLD.html">world</a> and the three 
 most recent <a href="ACL2____WORLD.html">world</a>s in which a <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> or <span class="v">:u</span> were 
 done.</p> 
 
 <p>While <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> may appear to discard the information in the <a href="ACL2____EVENTS.html">events</a> undone, we can see that the <a href="ACL2____WORLD.html">world</a> in which the <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> occurred is still available.  No information has been lost about that 
 <a href="ACL2____WORLD.html">world</a>.  But <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> does discard information!  <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">Ubt</a></span> discards the information necessary to recover from the third most recent 
 <span class="tt"><a href="ACL2____UBT.html">ubt</a></span>!  An <span class="v">:oops</span>, on the other hand, discards no information, it 
 just selects the next available <a href="ACL2____WORLD.html">world</a> on the kill ring and doing enough 
 <span class="v">:oops</span>es will return you to your starting point.</p> 
 
 <p>We can put this another way.  You can freely type <span class="v">:oops</span> and inspect 
 the <a href="ACL2____WORLD.html">world</a> that you thus obtain with <span class="v">:</span><span class="tt"><a href="ACL2____PE.html">pe</a></span>, <span class="v">:</span><span class="tt"><a href="ACL2____PC.html">pc</a></span>, 
 and other <a href="ACL2____HISTORY.html">history</a> <a href="ACL2____COMMAND.html">command</a>s.  You can repeat this as often as you 
 wish without risking the permanent loss of any information.  But you must be 
 more careful typing <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> or <span class="v">:u</span>.  While <span class="v">:oops</span> makes 
 <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> seem ``safe'' because the most recent <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> can 
 always be undone, information is lost when you execute <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span>.</p> 
 
 <p>We note that <span class="v">:ubt</span> and <span class="v">:u</span> may remove compiled definitions (but 
 note that in some Lisps, including CCL (OpenMCL) and SBCL, functions are 
 always compiled).  When the original world is restored using <span class="v">:oops</span>, 
 restored functions will not generally be compiled (except for Lisps as above), 
 though the user can remedy this situation; see <a href="ACL2____COMP.html">comp</a>.</p> 
 
 <p>Finally, we note that our implementation of <span class="v">oops</span> can use a significant 
 amount of memory, because of the saving of old logical <a href="ACL2____WORLD.html">world</a>s.  Most 
 users are unlikely to experience a memory problem, but if you do, then you may 
 want to disable <span class="v">oops</span> by evaluating <span class="v">(<a href="ACL2____RESET-KILL-RING.html">reset-kill-ring</a> 0 state)</span>; see 
 <a href="ACL2____RESET-KILL-RING.html">reset-kill-ring</a>.</p>
</body>
</html>
