<html>
<head>
<meta charset="UTF-8">
<title>Resolving-multiple-drivers</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=VL2014____RESOLVING-MULTIPLE-DRIVERS">Click for Resolving-multiple-drivers in the Full Manual</a></h3>

<p>How we replace multiply driven wires with explicit resolution 
modules.</p><p>We want every wire in our E modules to have at most one driver, but 
the list of occurrences we get from <a href="VL2014____VL-MODINSTLIST-TO-EOCCS.html">vl-modinstlist-to-eoccs</a> could easily 
have multiple occurrences all driving the same wire.  We now introduce a 
transform to simplify a list of E occurrences, eliminating multiply driven 
wires by inserting explicit resolution modules.</p> 
 
<p><b>Note:</b> In this transform we assume that the module's primary inputs 
are not driven by any occurrence.  This is something we explicitly check for in 
<a href="VL2014____VL-MODULE-MAKE-ESIM.html">vl-module-make-esim</a>; see the warning about <span class="v">:vl-backflow</span> there.</p> 
 
<p>Given this assumption, we basically need to do three things:</p> 
 
<ol> 
 
<li>Identify when a wire <span class="v">W</span> has multiple occurrences driving it. 
Fortunately, this is completely trivial: 
 
<pre class="code">(duplicated-members (collect-signal-list :o occs))</pre> 
 
</li> 
 
<li>Rewrite each occurrence driving <span class="v">W</span> so that it instead drives some new, 
unique, freshly generated wire (say <span class="v">W_1</span>, <span class="v">W_2</span>, ...).  We also need to 
remember the names we used for each wire, for step 3.  We do this with the 
function <a href="VL2014____VL-RES-REWRITE-OCCS.html">vl-res-rewrite-occs</a>.</li> 
 
<li>Insert new occurrences that drive <span class="v">W</span> with the <span class="v">(RES W_1 W_2 ...)</span>. 
This is done with <a href="VL2014____VL-MAKE-RES-OCCS.html">vl-make-res-occs</a>.</li> 
 
</ol> 
 
<p>The top-level function is <a href="VL2014____VL-ADD-RES-MODULES.html">vl-add-res-modules</a>, and it just stitches 
these steps together.</p>
</body>
</html>
