<html>
<head>
<meta charset="UTF-8">
<title>Defun-mode-lambdas</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____DEFUN-MODE-LAMBDAS">Click for Defun-mode-lambdas in the Full Manual</a></h3>

<p>:program mode functions in <span class="tt"><a href="COMMON-LISP____LAMBDA.html">lambda</a></span> objects</p><p>A rough rule-of-thumb is that all functions mentioned in a 
  <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> must themselves be in <span class="v">:logic</span> 
  mode.  If <span class="v">prgm</span> is a <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode function then <span class="v">(<a href="COMMON-LISP____DEFUN.html">defun</a>
  fn (x) (prgm x))</span> is illegal.  But there are situations (always involving 
  <span class="tt"><a href="ACL2____APPLY_42.html">apply$</a></span>) in which <span class="v">:program</span> mode function symbols are allowed to 
  be mentioned in <span class="v">:logic</span> mode <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>s.  We explain here.</p> 
 
  <p>Here are two example terms that mention the badged (see <span class="tt"><a href="ACL2____DEFBADGE.html">defbadge</a></span>) 
  <span class="v">:program</span> mode symbol <span class="v">prgm</span>.</p> 
 
  <pre class="code">(<a href="ACL2____APPLY_42.html">apply$</a> (<a href="ACL2____LAMBDA_42.html">lambda$</a> (e) (prgm e)) (<a href="COMMON-LISP____LIST.html">list</a> x))

(<a href="ACL2____LOOP_42.html">loop$</a> for e in lst collect (prgm e))</pre> 
 
  <p>Are such terms permitted in the <span class="v">defun</span> of a <span class="v">:logic</span> mode function? 
  The answer is complicated because it depends on whether the <span class="v">defun</span> is 
  <span class="tt"><a href="ACL2____LOOP_42.html">loop$</a></span> recursive and whether the <span class="v">defun</span> will also try to verify 
  the <span class="tt"><a href="ACL2____GUARD.html">guard</a></span>s of <span class="v">fn</span>.</p> 
 
  <p>First, a <span class="v">:logic</span> mode function may <span class="v">apply$</span> a quoted <span class="v">:program</span> 
  mode symbol, whether guards are being verified or not.  For example, 
  <span class="v">(<a href="ACL2____APPLY_42.html">apply$</a> 'prgm args)</span> is legal.  Here <span class="v">prgm</span> is just a quoted symbol. 
  Since <span class="v">prgm</span> is a <span class="v">:program</span> mode symbol, there are no axioms about it, 
  so during proofs such a call of <span class="v">apply$</span> is not evaluated or expanded.  If 
  this form is evaluated at the top-level -- where <span class="v">:program</span> mode functions 
  are evaluable -- <span class="v">apply$</span> checks the guards of <span class="v">prgm</span> just as it would 
  before any <span class="v">:program</span> mode function is called.</p> 
 
  <p>The situation is more complicated for use of <span class="v">:program</span> mode functions 
  in forms like <span class="tt"><a href="ACL2____LAMBDA_42.html">lambda$</a></span>, well-formed quoted <span class="tt"><a href="COMMON-LISP____LAMBDA.html">lambda</a></span> objects, and 
  <span class="tt"><a href="ACL2____LOOP_42.html">loop$</a></span>.  The reason is that in guard-verified code, these forms are 
  generally executed via compiled code and that requires that the <span class="v">loop$</span> 
  and <span class="v">lambda</span> objects be Common Lisp compliant, which in turn implies they 
  must be analyzable by the prover.  Since formally <span class="v">loop$</span>s are understood 
  as calls of <a href="ACL2____SCION.html">scion</a>s on <span class="v">lambda$</span> expressions it suffices for us to 
  discuss the <span class="v">lambda$</span> case alone.  Well-formed quoted <span class="v">LAMBDA</span> objects 
  are treated the same way.</p> 
 
  <p>So again, suppose you're defining a <span class="v">:logic</span> mode function <span class="v">fn</span>. 
  Suppose <span class="v">fn</span> is not <span class="v">loop$</span> recursive and guards are not being verified 
  during the <span class="v">defun</span>.  Then badged <span class="v">:program</span> mode symbols may be used 
  <span class="v">lambda$</span> forms in the definition of <span class="v">fn</span>.</p> 
 
  <p>If <span class="v">fn</span> is <span class="v">loop$</span> recursive, i.e., <span class="v">:</span><span class="tt"><a href="ACL2____LOOP_42-RECURSION.html">loop$-recursion</a></span> 
  <span class="v">t</span> is declared, then all symbols used as functions in <span class="v">lambda$</span> forms 
  must be in <span class="v">:logic</span> mode.  The reason is that the measure conjectures 
  generated must be in <span class="v">:logic</span> mode to be provable.</p> 
 
  <p>If <span class="v">fn</span> is to be guard-verified, then all symbols used as functions in 
  <span class="v">lambda$</span> forms must be in <span class="v">:logic</span> mode.  The reason is that the guard 
  conjectures must be in <span class="v">:logic</span> mode to be provable.</p> 
 
  <p>When a <span class="v">:program</span> function is permitted in a <span class="v">:logic</span> mode definition 
  the system will print a warning to alert you to the possibility that proofs 
  will fail.  For example, the following events are legal</p> 
 
  <pre class="code">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "projects/apply/top" :dir :system)

(<a href="COMMON-LISP____DEFUN.html">defun</a> prgm (x)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :program))
  (<a href="COMMON-LISP____LIST.html">list</a> 'hi x))

(<a href="ACL2____DEFBADGE.html">defbadge</a> prgm)

(<a href="COMMON-LISP____DEFUN.html">defun</a> fn1 (x)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :logic))
  (<a href="ACL2____APPLY_42.html">apply$</a> 'prgm (<a href="COMMON-LISP____LIST.html">list</a> x)))</pre> 
 
  <p>but the last event will print:</p> 
 
  <pre class="code">ACL2 Warning [Problematic-quoted-fns] in ( DEFUN FN1 ...): The definition of
FN1 is in :LOGIC mode but mentions the :PROGRAM mode function HELLO in one or
more :FN or :EXPR slots.  Conjectures about FN1 may not be provable until
this program is converted to :LOGIC mode and warranted!  See :DOC
verify-termination and defwarrant.</pre> 
 
  <p>Uses of <span class="v">prgm</span> in quoted well-formed <span class="v">LAMBDA</span> objects, <span class="v">lambda$</span> 
  forms, and <span class="v">loop$</span> forms will cause similar warning messages to be 
  printed.</p>
</body>
</html>
