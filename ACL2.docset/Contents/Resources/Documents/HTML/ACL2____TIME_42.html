<html>
<head>
<meta charset="UTF-8">
<title>Time$</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____TIME_42">Click for Time$ in the Full Manual</a></h3>

<p>Time an evaluation</p><p>Semantically, <span class="v">(<a href="ACL2____TIME_42.html">time$</a> x ...)</span> equals <span class="v">x</span>.  However, its 
 evaluation writes timing output to the trace output (which is usually the 
 terminal), as explained further below.</p> 
 
 <p>Note: Some of the functionality below is available only for certain host 
 Common Lisp implementations.</p> 
 
 <pre class="code">Examples:

; Basic examples:

(<a href="ACL2____TIME_42.html">time$</a> (foo 3 4))
(<a href="ACL2____TIME_42.html">time$</a> (mini-proveall))
(<a href="COMMON-LISP____DEFUN.html">defun</a> bar (x) (<a href="ACL2____TIME_42.html">time$</a> (f x)))

; Custom examples, which use a custom timing message rather than a built-in
; message from Lisp:

; Report only if real time is at least 1/2 second (two equivalent forms).
(<a href="ACL2____TIME_42.html">time$</a> (foo) :mintime 1/2)
(<a href="ACL2____TIME_42.html">time$</a> (foo) :real-mintime 1/2)

; Report only if allocation is at least 1000 bytes (<a href="COMMON-LISP____AND.html">and</a> if the Lisp supports
; :minalloc).
(<a href="ACL2____TIME_42.html">time$</a> (foo) :minalloc 1000)

; Report only if real time is at least 1/2 second and (<a href="COMMON-LISP____IF.html">if</a> the Lisp supports
; :minalloc) allocation is at least 931 bytes.
(<a href="ACL2____TIME_42.html">time$</a> (foo) :real-mintime 1/2 :minalloc 931)

; Print "Hello Moon, Goodbye World" instead of any timing data.
(<a href="ACL2____TIME_42.html">time$</a> (foo)
       :msg "Hello ~s0, ~s1 World."
       :args (<a href="COMMON-LISP____LIST.html">list</a> "Moon" "Goodbye"))

; Print default custom timing message (same as omitting :mintime 0):
(<a href="ACL2____TIME_42.html">time$</a> (foo)
       :mintime 0)

; Print supplied custom timing message.
(<a href="COMMON-LISP____LET.html">let</a> ((bar ...))
  (<a href="ACL2____TIME_42.html">time$</a> (foo)
         :msg "The execution of ~xf took ~st seconds of real ~
               time and ~sc seconds of run time (cpu time), and ~
               allocated ~sa bytes.  In an unrelated note, bar ~
               currently has the value ~x0.~%"
         :args (<a href="COMMON-LISP____LIST.html">list</a> bar)))

General Forms:
(<a href="ACL2____TIME_42.html">time$</a> form)
(<a href="ACL2____TIME_42.html">time$</a> form ; arguments below are optional
       :real-mintime  &lt;rational number of seconds&gt;
       :run-mintime   &lt;rational number of seconds&gt;
       :minalloc      &lt;number of bytes&gt;
       :msg           &lt;fmt string&gt;
       :args          &lt;list of arguments for msg&gt;
       )
; Note: :real-mintime can be replaced by :mintime</pre> 
 
 <p>where <span class="v">form</span> is processed as usual except that the host Common Lisp 
 times its evaluation.</p> 
 
 <p>The simplest form is <span class="v">(<a href="ACL2____TIME_42.html">time$</a> x)</span>, which will call the <span class="v">time</span> utility 
 in the underlying Lisp, and will print a small default message.  If you want 
 to see a message printed by the host Lisp, use <span class="v">(<a href="ACL2____TIME_42.html">time$</a> x :mintime nil)</span> 
 instead, which may provide detailed, implementation-specific data such as the 
 amounts of time spent in user and system mode, the gc time, the number of page 
 faults encountered, and so on.  Of you can create a custom message, configured 
 using the <span class="v">:msg</span> and <span class="v">:args</span> parameters.  <span class="v">Time$</span> can also be made to 
 report timing information only conditionally: the <span class="v">:real-mintime</span> (or 
 equivalently, <span class="v">:mintime</span>), <span class="v">:run-mintime</span>, and <span class="v">:minalloc</span> arguments 
 can be used to avoid reporting timing information for computations that take a 
 small amount of time (perhaps as might be expected in ordinary cases), but to 
 draw the user's attention to computations that take longer or allocate more 
 memory than expected.</p> 
 
 <p>We next document the keyword arguments in some detail.</p> 
 
 <blockquote>
<p>Keyword arguments <span class="v">:real-mintime</span> (or <span class="v">:mintime</span>) and 
 <span class="v">:run-mintime</span> can be used to specify a minimum time threshold for time 
 reporting.  That is, no timing information will be printed if the execution of 
 <span class="v">form</span> takes less than the specified number of seconds of real (total) time 
 or run (cpu) time, respectively.  Note that rational numbers like 1/2 may be 
 used to specify a fractional amount of seconds.  It is an error to specify 
 both <span class="v">:real-mintime</span> and its synonym, <span class="v">:mintime</span>.</p> 
 
 <p>Keyword argument <span class="v">:minalloc</span> is not supported on all Lisps.  When it is 
 not supported, it is ignored.  But on supported Lisps, <span class="v">:minalloc</span> can be 
 used to specify a minimum memory allocation threshold.  If <span class="v">form</span> results 
 in fewer than this many bytes being allocated, then no timing information will 
 be reported.</p> 
 
 <p>Keyword argument <span class="v">:msg</span>, when provided, should be a string accepted by 
 the <span class="v">fmt</span> family of functions (see <a href="ACL2____FMT.html">fmt</a>), and it may refer to the 
 elements of <span class="v">:args</span> by their positions, just as for <span class="v">cw</span> (see <a href="ACL2____CW.html">cw</a>).</p>
</blockquote> 
 
 <p>The following directives allow you to report timing information using the 
 <span class="v">:msg</span> string.  The examples at the top of this documentation topic 
 illustrate the use of these directives.</p> 
 
 <blockquote>
<p><span class="v">~xf</span> — the form that was executed</p> 
 
 <p><span class="v">~sa</span> — the amount of memory allocated, in bytes (in supported 
 Lisps)</p> 
 
 <p><span class="v">~st</span> — the real time taken, in seconds</p> 
 
 <p><span class="v">~sc</span> — the run time (cpu time) taken, in seconds</p> 
 
 <p>The following apply only when the host Lisp is GCL.  The two system times 
 will likely be <span class="v">nil</span> unless the GCL version is 2.6.10 or later.  Note the 
 upper-case characters for child times.</p> 
 
 <p><span class="v">~sC</span> — the child run time (cpu time) taken, in seconds</p> 
 
 <p><span class="v">~ss</span> — the system time taken, in seconds</p> 
 
 <p><span class="v">~sS</span> — the child system time taken, in seconds</p>
</blockquote> 
 
 <p>We turn now to an example that illustrates how <span class="v">time$</span> can be called in 
 function bodies.  Consider the following definition of the Fibonacci function, 
 followed by the definition of a function that times <span class="v">k</span> calls of this 
 function.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> fib (n)
  (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____ZP.html">zp</a> n)
      1
    (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP_____D3.html">=</a> n 1)
        1
      (<a href="COMMON-LISP_____B2.html">+</a> (fib (<a href="COMMON-LISP____-.html">-</a> n 1))
         (fib (<a href="COMMON-LISP____-.html">-</a> n 2))))))

(<a href="COMMON-LISP____DEFUN.html">defun</a> time-fib (k)
  (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____ZP.html">zp</a> k)
      nil
    (<a href="ACL2____PROG2_42.html">prog2$</a>
     (<a href="ACL2____TIME_42.html">time$</a> (fib k)
            :mintime 1/2
            :msg "(fib ~x0) took ~st seconds, ~sa bytes allocated.~%"
            :args (<a href="COMMON-LISP____LIST.html">list</a> k))
     (time-fib (<a href="COMMON-LISP____1-.html">1-</a> k)))))</pre> 
 
 <p>The following log shows a sample execution of the function defined just 
 above.</p> 
 
 <pre class="code">ACL2 !&gt;(time-fib 36)
(fib 36) took 3.19 seconds, 1280 bytes allocated.
(fib 35) took 1.97 seconds, 1280 bytes allocated.
(fib 34) took 1.21 seconds, 1280 bytes allocated.
(fib 33) took 0.75 seconds, 1280 bytes allocated.
NIL
ACL2 !&gt;</pre> 
 
 <p>Notes:</p> 
 
 <p>(1) Common Lisp specifies that the <span class="v">time</span> utility prints to ``trace 
 output'', and <span class="v">time$</span> follows this convention.  Thus, if you have opened a 
 <a href="COMMON-LISP____TRACE.html">trace</a> file (see <a href="ACL2____OPEN-TRACE-FILE.html">open-trace-file</a>), then you can expect to find 
 the <span class="v">time$</span> output there.</p> 
 
 <p>(2) Unless the <span class="v">:msg</span> argument is supplied, an explicit call of 
 <span class="v">time$</span> in the top-level loop will show that the form being timed is a call 
 of the ACL2 evaluator function <span class="v">ev-rec</span>.  This is normal; the curious are 
 invited, at their own risk, to see <a href="ACL2____RETURN-LAST.html">return-last</a> for an 
 explanation.</p>
</body>
</html>
