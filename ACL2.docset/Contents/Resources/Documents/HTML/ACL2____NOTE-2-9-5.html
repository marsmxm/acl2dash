<html>
<head>
<meta charset="UTF-8">
<title>Note-2-9-5</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____NOTE-2-9-5">Click for Note-2-9-5 in the Full Manual</a></h3>

<p>Changes in Version  3.0 since Version  2.9.4</p><p>Fixed a bug in <span class="tt"><a href="ACL2____CW-GSTACK.html">cw-gstack</a></span> that was causing a hard error when 
 attempting to report on a forced assumption.  Thanks to Jared Davis for 
 pointing this out and sending an example that helped us to determine a 
 fix.</p> 
 
 <p>Added <span class="tt"><a href="ACL2____SET-BACKCHAIN-LIMIT.html">set-backchain-limit</a></span> to the set of legal <a href="ACL2____EVENTS.html">events</a> that 
 can be placed in <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> forms and <a href="ACL2____BOOKS.html">books</a>.  Thanks to John 
 Cowles for bringing this issue to our attention.</p> 
 
 <p>Fixed a bug that broke <span class="v">wet</span>.  Thanks to David Rager for bringing this 
 bug to our attention.</p> 
 
 <p>Guard verification now evaluates ground subexpressions (those with no free 
 variables) when computing the guard conjecture for the body of a function. 
 Thanks to Jared Davis for useful conversations leading to this change.  See 
 <a href="ACL2____VERIFY-GUARDS.html">verify-guards</a>, in particular its ``Note on computation of guard 
 conjectures and evaluation'' near the end of that topic, for more details.</p> 
 
 <p>Added a warning when a <span class="tt"><a href="ACL2____THEORY-INVARIANT.html">theory-invariant</a></span> is redefined.  Thanks to 
 Jared Davis for suggesting a warning in this case and providing an informative 
 example.  Also, <span class="tt"><a href="ACL2____THEORY-INVARIANT.html">theory-invariant</a></span>s are now maintained more completely, 
 as they are checked at the end of every event except for events executed on 
 behalf of an <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> or the second pass of an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span>.</p> 
 
 <p>Fixed the handling of runic designators to match their specification (see 
 <a href="ACL2____THEORIES.html">theories</a>), so that disabling the name of a <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> event <span class="tt"><a href="ACL2____DISABLE.html">disable</a></span>s all rules generated for that event.</p> 
 
 <p>(For those who do numerous builds using feature <span class="v">:acl2-mv-as-values</span>, 
 currently only OpenMCL and multi-threaded SBCL by default:) You can speed up 
 builds by adding the following parameter to `make', under conditions described 
 in <span class="v">GNUmakefile</span>: <span class="v">USE_ACL2_PROCLAIMS=:REUSE</span>.</p> 
 
 <p>Arranged that traced functions (see <a href="ACL2____TRACE_42.html">trace$</a>) are automatically 
 untraced when events are undone (for example see <a href="ACL2____UBT.html">ubt</a>), at least for 
 most underlying Common Lisp implementations.</p> 
 
 <p>The macro <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> now creates non-executable functions, which 
 allows <span class="tt"><a href="ACL2____STOBJ.html">stobj</a></span>s to be used where they had previously been prohibited. 
 More generally, the user now has control over <span class="tt"><a href="COMMON-LISP____DECLARE.html">declare</a></span> forms to be used 
 by the underlying <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>'d function; see <a href="ACL2____DEFUN-SK.html">defun-sk</a>.  Thanks to 
 Sandip Ray for pointing out the need for such a modification.</p> 
 
 <p><span class="v">:</span><span class="tt"><a href="ACL2____DEFINITION.html">Definition</a></span> rules are now treated, at least by default, as 
 truly first-class definitions.  In particular, <span class="v">:expand</span> <a href="ACL2____HINTS.html">hints</a> use 
 the latest <span class="v">:</span><span class="tt"><a href="ACL2____DEFINITION.html">definition</a></span> rule by default.  You may specify 
 <span class="v">:install-body nil</span> to get the previous behavior of <span class="v">:definition</span> rules; 
 See <a href="ACL2____DEFINITION.html">definition</a>, and you may choose a previously-installed 
 <span class="v">:definition</span> rule to provide the current body; see <a href="ACL2____SET-BODY.html">set-body</a>.  Also 
 see <a href="ACL2____RULE-CLASSES.html">rule-classes</a> for details of the <span class="v">:install-body</span> field, and see 
 <a href="ACL2____HINTS.html">hints</a> to see a new <span class="v">:with</span> directive for controlling expansion.  The 
 <span class="v">:with</span> directive for <span class="v">:expand</span> hints can even direct the use of a 
 <span class="v">:</span><span class="tt"><a href="ACL2____REWRITE.html">rewrite</a></span> rule for expansion!  Thanks to various people, including 
 Sandip Ray and Rob Sumners, for discussions on the issue of the applicability 
 of <span class="v">:definition</span> rules for <span class="v">:expand</span> <a href="ACL2____HINTS.html">hints</a>.</p> 
 
 <p><a href="ACL2____CONSTRAINT.html">Constraint</a>s for functional instantiation now use the original 
 definition rather than a simplified (``normalized'') version of it.</p> 
 
 <p>Fixed a bug that caused the prompt to stay the same when guard-checking is 
 off (see <a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a>) and raw-mode is changed (see <a href="ACL2____SET-RAW-MODE.html">set-raw-mode</a>).</p> 
 
 <p>Lemma names in directory <span class="v">books/ordinals</span> have been changed by replacing 
 <span class="v">/\</span> with <span class="v">&amp;</span> and replacing <span class="v">\/</span> with <span class="v">V</span>.  We made this change 
 because backslash is an escape character and hence disappears unless it is 
 itself escaped.</p> 
 
 <p>Fixed <a href="ACL2____PROOF-TREE.html">proof-tree</a> output so that failed non-proof events do not cause 
 the proof-tree to be re-printed.  Thus for example, if you have already 
 advanced the checkpoint marker, it will not be reset by subsequent failed 
 non-proof events.  Thanks to Pete Manolios and Peter Dillinger for bringing 
 this bug to our attention.</p> 
 
 <p>Fixed a bug that was preventing the printing of <a href="ACL2____STOBJ.html">stobj</a> fields as 
 constants instead of numbers in certain cases.  (Note that this bug only 
 affected printing, not soundness.) Thanks to Eric Smith for bringing this 
 problem to our attention and providing the following example (which now works 
 fine).</p> 
 
 <pre class="code">(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st fld1 fld2)
(<a href="ACL2____IN-THEORY.html">in-theory</a> (<a href="ACL2____DISABLE.html">disable</a> update-nth))
(<a href="ACL2____DEFUND.html">defund</a> run (st)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs (st))) ;adding this didn't seem to help..
  st)

;works great; *fld1* prints as  *fld1*
(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ACL2____UPDATE-NTH.html">update-nth</a> *fld1* 'abc st)
            (<a href="COMMON-LISP____CAR.html">car</a> (<a href="COMMON-LISP____CONS.html">cons</a> x y))))

;*fld1* gets printed as 0, presumably because the call to run intervenes.
(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ACL2____UPDATE-NTH.html">update-nth</a> *fld1* 'abc (run st))
            (<a href="COMMON-LISP____CAR.html">car</a> (<a href="COMMON-LISP____CONS.html">cons</a> x y))))</pre> 
 
 <p>The macro <span class="tt"><a href="COMMON-LISP____PROGN.html">progn</a></span> now allows the use of macros defined within its 
 bodies even when at the event level, as illustrated by the following 
 example.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____PROGN.html">progn</a> (<a href="COMMON-LISP____DEFMACRO.html">defmacro</a> my-defun (<a href="COMMON-LISP_____62REST.html">&amp;rest</a> args)
         `(<a href="COMMON-LISP____DEFUN.html">defun</a> ,@args))
       (my-defun g (x) x))</pre> 
 
 <p>Thanks to Anna Slobodova for bringing this issue to our attention.  A 
 related change is that all arguments of <span class="tt"><a href="COMMON-LISP____PROGN.html">progn</a></span> must now be embedded 
 event forms (see <a href="ACL2____EMBEDDED-EVENT-FORM.html">embedded-event-form</a>), so use <span class="tt"><a href="ACL2____ER-PROGN.html">er-progn</a></span> instead 
 if this is not the case.</p> 
 
 <p>The change to <span class="tt"><a href="COMMON-LISP____PROGN.html">progn</a></span> mentioned above also fixes a bug in handling 
 <a href="ACL2____LOCAL.html">local</a> events inside a <span class="tt"><a href="COMMON-LISP____PROGN.html">progn</a></span> that is inside an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> or in a book.  For example, the following form formerly caused an 
 error.</p> 
 
 <pre class="code">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a>
 ()
 (<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x) x)
 (<a href="COMMON-LISP____PROGN.html">progn</a> (<a href="ACL2____LOCAL.html">local</a> (<a href="COMMON-LISP____DEFUN.html">defun</a> bar (x) x))
        (<a href="COMMON-LISP____DEFUN.html">defun</a> abc (x) x)))</pre> 
 
 <p>We fixed two bugs in <span class="v">:</span><span class="tt"><a href="ACL2____PUFF.html">puff</a></span> and <span class="v">:</span><span class="tt"><a href="ACL2____PUFF_A2.html">puff*</a></span>.  The 
 first, brought to our attention by Eric Smith (who we thank), caused a cryptic 
 error message when puffing a command with no subsidiary stored events; try, 
 for example, <span class="v">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a> () (<a href="ACL2____VALUE-TRIPLE.html">value-triple</a> 3))</span>.  The second was due to a 
 failure to restore the <span class="tt"><a href="ACL2____ACL2-DEFAULTS-TABLE.html">ACL2-defaults-table</a></span>.  Suppose for example that 
 we have certified the book <span class="v">foo.lisp</span>, which contains <span class="v">(</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span><span class="v">)</span> followed by some definitions and/or theorems.  Now suppose we 
 start ACL2 and execute the following.</p> 
 
 <pre class="code">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "foo")
(<a href="ACL2____DEFTHM.html">defthm</a> test-thm
  (<a href="COMMON-LISP____EQUAL.html">equal</a> x x)
  :rule-classes nil)</pre> 
 
 <p>If we now execute <span class="v">:</span><span class="tt"><a href="ACL2____PUFF.html">puff</a></span><span class="v"> 1</span>, ACL2 will roll back the world 
 to before the <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>; then ``puff'' the include-book, which will 
 leave us in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode; and finally skip re-execution of the 
 <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> because such <a href="ACL2____EVENTS.html">events</a> are skipped in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> 
 mode.  The fix is to re-install the <span class="tt"><a href="ACL2____ACL2-DEFAULTS-TABLE.html">ACL2-defaults-table</a></span> immediately 
 after the <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> to its pre-<span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> value.</p> 
 
 <p>A new event, <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span>, provides something like macros that take 
 state.  For example, one can use it to put tests into certified books, do 
 proof search, and generate new function names.  Many examples appear in 
 directory <span class="v">books/make-event/</span>.  See <a href="ACL2____MAKE-EVENT.html">make-event</a>.  Thanks to Bob Boyer 
 and Jared Davis for useful feedback and to Warren Hunt, David Rager, and 
 Sandip Ray for helpful discussions leading to some of the examples in 
 directory <span class="v">books/make-event/</span>.</p> 
 
 <p>In support of <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span>, which is described in the preceding 
 paragraph, <span class="v">certify-book</span> has a new keyword argument, <span class="v">:save-expansion</span>, 
 that controls whether the result of expanding <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> forms is 
 written out to a file.  See <a href="ACL2____CERTIFY-BOOK.html">certify-book</a>; and for a discussion of book 
 expansion files, see <a href="ACL2____MAKE-EVENT.html">make-event</a>.</p> 
 
 <p>We fixed a soundness bug that did not correctly detect <span class="tt"><a href="ACL2____LOCAL.html">local</a></span> 
 events.  For example, the following event was admitted.</p> 
 
 <pre class="code">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a>
 ()
 (<a href="ACL2____LOCAL.html">local</a>
  (<a href="ACL2____ENCAPSULATE.html">encapsulate</a>
   ()
   (<a href="ACL2____LOCAL.html">local</a> (<a href="COMMON-LISP____PROGN.html">progn</a> (<a href="ACL2____PROGRAM.html">program</a>))) ; or, (<a href="ACL2____LOCAL.html">local</a> (<a href="ACL2____WITH-OUTPUT.html">with-output</a> :off summary (<a href="ACL2____PROGRAM.html">program</a>)))
   (<a href="ACL2____SET-IRRELEVANT-FORMALS-OK.html">set-irrelevant-formals-ok</a> t)
   (<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x)
     (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :measure (<a href="ACL2____ACL2-COUNT.html">acl2-count</a> x)))
     (<a href="COMMON-LISP____1_B2.html">1+</a> (foo x)))))
 (<a href="ACL2____DEFTHM.html">defthm</a> inconsistent
   nil
   :hints (("Goal" :use foo))
   :rule-classes nil))</pre> 
 
 <p>A new value for <a href="ACL2____GUARD.html">guard</a> checking, <span class="v">:none</span>, is now allowed.  If you 
 execute <span class="v">:</span><span class="tt"><a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a></span><span class="v"> :none</span>, then no guard checking 
 will take place (but raw Lisp code will not be executed in this case).  As a 
 result, you should never see a guard violation, even for calls of 
 <span class="v">:</span><span class="v">program</span> mode functions.  We thank Pete Manolios, who has long 
 wanted this feature, and also Peter Dillinger, for asking for it.  New 
 documentation explains the interaction between the <a href="ACL2____DEFUN-MODE.html">defun-mode</a> and the 
 value supplied to <span class="v">:</span><span class="tt"><a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a></span>.  See <a href="ACL2____GUARD-EVALUATION-TABLE.html">guard-evaluation-table</a>, see <a href="ACL2____GUARD-EVALUATION-EXAMPLES-SCRIPT.html">guard-evaluation-examples-script</a>, and see 
 <a href="ACL2____GUARD-EVALUATION-EXAMPLES-LOG.html">guard-evaluation-examples-log</a>.</p> 
 
 <p>In the course of adding the <a href="ACL2____GUARD.html">guard</a>-checking value <span class="v">:none</span> 
 described in the paragraph above, we eliminated an optimization that 
 eliminated guard checking for some recursive calls of <span class="v">:</span><a href="ACL2____LOGIC.html">logic</a> mode 
 mutually-recursive functions that have not had their guards verified.  But we 
 doubt that this change will be noticed by any users!)</p> 
 
 <p>The ACL2 hyper-card has been enhanced, thanks to David Rager, with a 
 listing of ``Useful EMACS Commands'' to match comments in 
 <span class="v">emacs/emacs-acl2.el</span>.</p> 
 
 <p>Users contributed books following the <span class="v">Readme.lsp</span> methodology: 
 <span class="v">data-structures/memories</span> and <span class="v">unicode</span> (Jared Davis), <span class="v">proofstyles</span> 
 (Sandip Ray and J Moore).</p> 
 
 <p>Made some improvements to <span class="v">books/Makefile-generic</span> (a file discussed 
 elsewhere; see <a href="ACL2____BOOKS-CERTIFICATION-CLASSIC.html">books-certification-classic</a>).  In particular, improved 
 handling of <span class="v">.acl2</span> files for <span class="v">dependencies</span> target.</p> 
 
 <p>(Only OpenMCL and, with feature <span class="v">:acl2-mv-as-values</span>, GCL) Fixed a bug 
 that was causing proclaiming to fail when definitions are submitted 
 interactively.</p> 
 
 <p>The default stack size has been increased for several lisps.</p> 
 
 <p>(Very technical) A restriction has been weakened on the use of <span class="tt"><a href="ACL2____LOCAL.html">local</a></span> <a href="ACL2____STOBJ.html">stobj</a>s under a call of an ACL2 evaluator (<span class="v">trans-eval</span> or 
 <span class="v">simple-translate-and-eval</span>).  Now, the error can only take place for 
 <span class="tt"><a href="ACL2____STOBJ.html">stobj</a></span> names that occur in the term being evaluated.  Thanks to Erik 
 Reeber for bringing this issue to our attention.</p> 
 
 <p>The notion of ``ancestor'' has been changed slightly.  This notion is used 
 by extended metafunctions and <a href="ACL2____BREAK-REWRITE.html">break-rewrite</a> (see <a href="ACL2____EXTENDED-METAFUNCTIONS.html">extended-metafunctions</a> and see <a href="ACL2____BRR_04.html">brr@</a>), and also with backchain limits 
 (see <a href="ACL2____BACKCHAIN-LIMIT.html">backchain-limit</a> and see <a href="ACL2____SET-BACKCHAIN-LIMIT.html">set-backchain-limit</a>).  Basically, 
 each time a hypothesis is encountered during application of a <a href="ACL2____REWRITE.html">rewrite</a> 
 rule, that hypothesis is pushed (after instantiating and negating) onto the 
 current list of ancestors before it is rewritten.  However, hypotheses of the 
 form <span class="v">(<a href="COMMON-LISP____EQUAL.html">equal</a> var term)</span>, where <span class="v">var</span> is free (see <a href="ACL2____FREE-VARIABLES.html">free-variables</a>), had not been included in the ancestors (similarly for 
 <span class="v">(equiv var (<a href="ACL2____DOUBLE-REWRITE.html">double-rewrite</a> term))</span> where <span class="v">equiv</span> is a known <a href="ACL2____EQUIVALENCE.html">equivalence</a> relation).  Now such ``binding hypotheses'' are included in a 
 special way in ancestors data structures.  In particular, <span class="v">(<a href="COMMON-LISP____NULL.html">null</a>
 (<a href="ACL2____MFC-ANCESTORS.html">mfc-ancestors</a> mfc))</span> will now be true if and only if the term being 
 rewritten is part of the current goal as opposed to a hypothesis from a rule 
 encountered during backchaining, even if that hypothesis is a binding 
 hypothesis.  Thanks to Dave Greve for bringing this issue to our 
 attention.</p> 
 
 <p>Termination and induction analysis now continue through both arguments of 
 <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span>, not just the second.  (Normally, the gathering up of <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span> tests stops at function calls; but it continued through the second 
 argument of <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span>, and now it will continue through both arguments.) 
 Thanks to Sol Swords for discussion leading to this change.</p> 
 
 <p>The ACL2 distribution is now kept on the http server rather than the ftp 
 server (but the home page has not been moved).  Thanks to Robert Krug for 
 letting us know that some ACL2 users have found it inconvenient to fetch ACL2 
 using ftp.</p> 
 
 <p>The file <span class="v">books/README.html</span> has been renamed to <span class="v">books/Readme.html</span>, 
 since some browsers don't show the former in the directory listing.</p>
</body>
</html>
