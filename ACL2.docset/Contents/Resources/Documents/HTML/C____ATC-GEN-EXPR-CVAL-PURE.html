<html>
<head>
<meta charset="UTF-8">
<title>Atc-gen-expr-cval-pure</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=C____ATC-GEN-EXPR-CVAL-PURE">Click for Atc-gen-expr-cval-pure in the Full Manual</a></h3>

<p>Generate a C expression from an ACL2 term 
            that must be a pure expression term returning a C value.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(atc-gen-expr-cval-pure term inscope fn ctx state) 
  → 
(mv erp val state)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">term</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> term)</span>.</font>
</dd> 
  <dd>
<span class="tt">inscope</span> — <font color="#606060">Guard <span class="v">(<a href="C____ATC-SYMBOL-TYPE-ALIST-LISTP.html">atc-symbol-type-alist-listp</a> inscope)</span>.</font>
</dd> 
  <dd>
<span class="tt">fn</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn)</span>.</font>
</dd> 
  <dd>
<span class="tt">ctx</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____CTXP.html">ctxp</a> ctx)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">val</span> — <font color="#606060">Type <span class="v">(tuple (<a href="C____EXPR.html">expr</a> exprp) (<a href="C____TYPE.html">type</a> typep) val)</span>.</font>
</dd> 
 
</dl></div> 
<p>At the same time, 
       we check that the term is a pure expression term returning a C value, 
       as described in the user documentation.</p><p>We also return the C type of the expression.</p><p>An ACL2 variable is translated to a C variable. 
       Its type is looked up in the symbol table passed as input.</p><p>If the term fits the pattern of an integer constant 
       we translate it to a C integer constant.</p><p>If the term fits the pattern of a unary or binary operation, 
       we translate it to the application of the operator 
       to the recursively generated expressions. 
       The type is the result type of the operator.</p><p>If the term fits the pattern of a conversion, 
       we translate it to a cast of 
       the recursively generated subexpression. 
       The type is the one of the cast. 
       (Future versions of ATC will avoid the cast 
       when the conversion happens automatically in C.)</p><p>If the terms fits the pattern of an array read, 
       we translate it to an array subscripting expression 
       on the recursively generated expressions. 
       The type is the array's element type.</p><p>If the term is a call of <span class="tt"><a href="C____SINT-FROM-BOOLEAN.html">sint-from-boolean</a></span>, 
       we call the mutually recursive ACL2 function 
       that translates the argument 
       (which must be an expression term returning a boolean) 
       to an expression, which we return. 
       The type of this expression is always <span class="v">int</span>.</p><p>If the term is an <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span> call, 
       we call the mutually recursive ACL2 function on the test, 
       we call this ACL2 function on the branches, 
       and we construct a conditional expression. 
       We ensure that the two branches have the same type.</p><p>In all other cases, we fail with an error. 
       The term is not a pure expression term returning a C value. 
       We could extend this code to provide 
       more information to the user at some point.</p><p>As we generate the code, we ensure that the ACL2 terms 
       are well-typed according to the C types. 
       This is subsumed by guard verification for all the code, 
       except for any code that is dead (i.e. unreachable) under the guard: 
       the dead code passes guard verification 
       (under a hypothesis of <span class="v">nil</span>, i.e. false, essentially), 
       but the resulting C code may not compile. 
       The additional type checking we do here should ensure that 
       all the code satisfies the C static semantics.</p> 
 

</body>
</html>
