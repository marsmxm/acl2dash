<html>
<head>
<meta charset="UTF-8">
<title>Vl-flatten-blocks</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=VL2014____VL-FLATTEN-BLOCKS">Click for Vl-flatten-blocks in the Full Manual</a></h3>

<p>Collapse nested <span class="v">begin/end</span> and <span class="v">fork/join</span> blocks.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(vl-flatten-blocks sequentialp stmts)  new-stmts</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">sequentialp</span>  are we working with a sequential (begin/end) or 
                          parallel (fork/join) block.<br><font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> sequentialp)</span>.</font>
</dd> 
  <dd>
<span class="tt">stmts</span>  <font color="#606060">Guard <span class="v">(<a href="VL2014____VL-STMTLIST-P.html">vl-stmtlist-p</a> stmts)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">new-stmts</span>  <font color="#606060">Type <span class="v">(<a href="VL2014____VL-STMTLIST-P.html">vl-stmtlist-p</a> new-stmts)</span>, given the <a href="ACL2____GUARD.html">guard</a>.</font>
</dd> 
 
</dl></div> 
<p>This function carries out rewrites such as:</p> 
 
<pre class="code">begin               begin
  foo = a;    --&gt;     foo = a;
  begin               bar = b;
    bar = b;          baz = c;
    baz = c;          goo = d;
  end               end
  goo = d;
end</pre> 
 
<p>It can similarly collapse fork/join blocks with inner fork/join blocks.</p> 
 
<p>We don't try to merge blocks that have their own scopes (i.e., names/decls). 
Handling them correctly seems very tricky because of hierarchical identifiers, 
etc.</p> 
 
<p>BOZO.  We recursively flatten sub-blocks.  I'm not sure if we need to do 
this, given the way that <a href="VL2014____VL-STMT-REWRITE.html">vl-stmt-rewrite</a> works.  Well, it's probably 
just some useless computation if it's not necessary.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>vl-flatten-blocks</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 vl-flatten-blocks (sequentialp stmts)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____BOOLEANP.html">booleanp</a> sequentialp)
                             (<a href="VL2014____VL-STMTLIST-P.html">vl-stmtlist-p</a> stmts))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'vl-flatten-blocks))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a> ((stmts (<a href="VL2014____VL-STMTLIST-FIX.html">vl-stmtlist-fix</a> stmts))
       ((when (<a href="COMMON-LISP____ATOM.html">atom</a> stmts)) nil)
       ((unless (<a href="COMMON-LISP____AND.html">and</a> (<a href="VL2014____VL-BLOCKSTMT-P.html">vl-blockstmt-p</a> (<a href="COMMON-LISP____CAR.html">car</a> stmts))
                     (<a href="COMMON-LISP____EQ.html">eq</a> (<a href="VL2014____VL-BLOCKSTMT-_E3SEQUENTIALP.html">vl-blockstmt-&gt;sequentialp</a> (<a href="COMMON-LISP____CAR.html">car</a> stmts))
                         sequentialp)
                     (<a href="COMMON-LISP____NOT.html">not</a> (<a href="VL2014____VL-BLOCKSTMT-_E3NAME.html">vl-blockstmt-&gt;name</a> (<a href="COMMON-LISP____CAR.html">car</a> stmts)))
                     (<a href="COMMON-LISP____ATOM.html">atom</a> (<a href="VL2014____VL-BLOCKSTMT-_E3VARDECLS.html">vl-blockstmt-&gt;vardecls</a> (<a href="COMMON-LISP____CAR.html">car</a> stmts)))
                     (<a href="COMMON-LISP____ATOM.html">atom</a> (<a href="VL2014____VL-BLOCKSTMT-_E3PARAMDECLS.html">vl-blockstmt-&gt;paramdecls</a> (<a href="COMMON-LISP____CAR.html">car</a> stmts)))))
        (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CAR.html">car</a> stmts)
              (<a href="VL2014____VL-FLATTEN-BLOCKS.html">vl-flatten-blocks</a> sequentialp (<a href="COMMON-LISP____CDR.html">cdr</a> stmts))))
       (merged-stmts
            (<a href="ACL2____APPEND-WITHOUT-GUARD.html">append-without-guard</a> (<a href="VL2014____VL-BLOCKSTMT-_E3STMTS.html">vl-blockstmt-&gt;stmts</a> (<a href="COMMON-LISP____CAR.html">car</a> stmts))
                                  (<a href="COMMON-LISP____CDR.html">cdr</a> stmts))))
      (<a href="VL2014____VL-FLATTEN-BLOCKS.html">vl-flatten-blocks</a> sequentialp merged-stmts))))</pre> 
<p><b>Theorem: </b>vl-stmtlist-p-of-vl-flatten-blocks</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
    vl-stmtlist-p-of-vl-flatten-blocks
    (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____FORCE.html">force</a> (<a href="ACL2____BOOLEANP.html">booleanp</a> sequentialp))
                  (<a href="ACL2____FORCE.html">force</a> (<a href="VL2014____VL-STMTLIST-P.html">vl-stmtlist-p</a> stmts)))
             (<a href="ACL2____B_A2.html">b*</a> ((new-stmts (<a href="VL2014____VL-FLATTEN-BLOCKS.html">vl-flatten-blocks</a> sequentialp stmts)))
                 (<a href="VL2014____VL-STMTLIST-P.html">vl-stmtlist-p</a> new-stmts)))
    :rule-classes :rewrite)</pre> 

</body>
</html>
