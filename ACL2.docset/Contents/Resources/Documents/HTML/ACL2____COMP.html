<html>
<head>
<meta charset="UTF-8">
<title>Comp</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____COMP">Click for Comp in the Full Manual</a></h3>

<p>Compile some ACL2 functions</p><p>NOTE: <span class="v">Comp</span> is a no-op if explicit compilation is suppressed; 
 see <a href="ACL2____COMPILATION.html">compilation</a>.  The documentation here assumes that this is not the 
 case.  See <a href="ACL2____EVALUATION.html">evaluation</a> for background on executable-counterpart and 
 submitted functions.</p> 
 
 <pre class="code">Examples:
:comp t          ; compile all uncompiled ACL2 functions
(<a href="ACL2____COMP.html">comp</a> t)         ; same as above, but can be put into a book
(<a href="ACL2____COMP.html">comp</a> :exec)     ; compile all uncompiled executable-counterpart definitions
:comp foo        ; compile the defined function foo (both its submitted and
                 ; executable-counterpart functions)
:comp (:raw foo) ; compile the submitted function for the defined function foo
                 ; but not the corresponding executable-counterpart
:comp (foo bar)  ; compile the defined functions foo and bar
:comp (foo (:raw bar))  ; compile the defined functions foo and bar, but for
                        ; bar do not compile the executable-counterpart

General Form:
:comp specifier
where specifier is one of the following:

  t                     compile all user-defined ACL2 functions that are
                          currently uncompiled (redefined built-in functions
                          are not recompiled)
  :exec                 same as t, except that only executable-counterparts
                          are compiled (see below), not submitted definitions
  :raw                  same as t, except that only submitted definitions are
                          compiled, not executable-counterparts
  (name-1 ... name-k)   a non-empty list of names of functions defined by
                          DEFUN in ACL2, except that each name-i can be of
                          the form (:raw sym) or (:exec sym), where sym is
                        the name of such a function
  name                  same as (<a href="ACL2____NAME.html">name</a>)</pre> 
 
 <p>When you define a function in ACL2, you are really causing two definitions 
 to be made ``under the hood'' in Common Lisp: the definition is submitted 
 explicitly to raw Lisp, but so is a corresponding executable-counterpart; see 
 <a href="ACL2____EVALUATION.html">evaluation</a>.  If guards have not been verified, then only the 
 executable-counterpart will be evaluated; see <a href="ACL2____EVALUATION.html">evaluation</a> and see <a href="ACL2____GUARDS-AND-EVALUATION.html">guards-and-evaluation</a>, in particular the section titled ``Guards and 
 evaluation V: efficiency issues''.</p> 
 
 <p>Thus, if you are not verifying <a href="ACL2____GUARD.html">guard</a>s and you want the benefit of 
 Lisp compilation for speed and space efficiency, then you may want to place 
 the form <span class="v">(<a href="ACL2____COMP.html">comp</a> :exec)</span> in your <a href="ACL2____BOOKS.html">books</a>.</p> 
 
 <p>Generally it is not necessary to place the form <span class="v">(<a href="ACL2____COMP.html">comp</a> t)</span>, or the form 
 <span class="v">(<a href="ACL2____COMP.html">comp</a> :raw)</span>, in a book, because <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> compiles the raw 
 Lisp definitions anyhow, by default.  But you may wish to put <span class="v">(<a href="ACL2____COMP.html">comp</a> t)</span> or 
 <span class="v">(<a href="ACL2____COMP.html">comp</a> fn1 fn2 ... fnk)</span> in a book when such a form precedes expensive 
 calls of functions, for example for proofs involving calls of functions on 
 large constants, or to support computationally expensive macroexpansion.</p> 
 
 <p>As suggested by the examples above, if a function specifier is of the form 
 <span class="v">(:raw fn)</span>, then <span class="v">fn</span> will be compiled in raw Common Lisp but its 
 corresponding executable-counterpart definition will not be compiled; and for 
 <span class="v">(:exec fn)</span>, it's the other way around.</p> 
 
 <p>The use of <span class="v">:comp</span> may create various files whose names start with 
 ``<span class="v">TMP*</span>'', but it then deletes them.  If you want to save these files, 
 evaluate <span class="v">(<a href="ACL2____ASSIGN.html">assign</a> keep-tmp-files t)</span>.</p> 
 
 <p>Also see <a href="ACL2____SET-COMPILE-FNS.html">set-compile-fns</a> for a way to compile each function as it is 
 defined.  But note that <span class="v">set-compile-fns</span> is ignored during <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>.</p> 
 
 <p>Note that if functions are traced (see <a href="ACL2____TRACE_42.html">trace$</a>), then <span class="v">comp</span> will 
 first untrace the functions that are to be compiled, then will do the 
 compile(s), and finally will re-trace the functions that it untraced (using 
 their original trace specs).  In particular, if you have traced a function and 
 then you compile it using <span class="v">:comp</span>, the resulting traced function will be 
 compiled as well unless you specified <span class="v">:compile nil</span> in your trace spec; 
 and after you untrace the function it will definitely run compiled.</p> 
 
 <p>We conclude with a technical remark only for those who use trust tags to 
 write raw Lisp code.  <span class="v">:Comp</span> generally creates files to compile unless it 
 is given a single function to compile.  Those files contain the ACL2 
 definitions of all functions to compile, omitting those in the lists obtained 
 by evaluating the forms <span class="v">(<a href="ACL2_____04.html">@</a> logic-fns-with-raw-code)</span> and <span class="v">(<a href="ACL2_____04.html">@</a>
 program-fns-with-raw-code)</span>.  <span class="v">:Comp</span> skips compilation for functions that 
 are already compiled, as is typically the case when you redefine functions in 
 raw Lisp using <a href="ACL2____INCLUDE-RAW.html">include-raw</a>.  But if you define interpreted (as opposed 
 to compiled) functions with raw Lisp code, say by using trust tags (see <a href="ACL2____DEFTTAG.html">defttag</a>) and <span class="tt"><a href="ACL2____PROGN_12.html">progn!</a></span>, then you are advised to add all such symbols to 
 one of the lists stored in the two <a href="ACL2____STATE.html">state</a> globals above: to 
 <span class="v">logic-fns-with-raw-code</span> if the function symbol is in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> 
 mode, else to <span class="v">program-fns-with-raw-code</span>.  Then, instead of the 
 corresponding ACL2 definition (without raw Lisp code) being written to a file, 
 the function symbol will be passed directly to the Lisp <span class="v">compile</span> function. 
 Note that the above two state globals are both untouchable, so you may need to 
 deal with that before modifying them, for example as follows (also see <a href="ACL2____REMOVE-UNTOUCHABLE.html">remove-untouchable</a>).</p> 
 
 <pre class="code">(<a href="ACL2____DEFTTAG.html">defttag</a> t)
(<a href="ACL2____PROGN_12.html">progn!</a>
 :state-global-bindings
 ((acl2::temp-touchable-vars t acl2::set-temp-touchable-vars))
 (<a href="ACL2____F-PUT-GLOBAL.html">f-put-global</a> 'acl2::logic-fns-with-raw-code
               (<a href="COMMON-LISP____CONS.html">cons</a> 'my-fn (<a href="ACL2_____04.html">@</a> acl2::logic-fns-with-raw-code))
               state))</pre>
</body>
</html>
