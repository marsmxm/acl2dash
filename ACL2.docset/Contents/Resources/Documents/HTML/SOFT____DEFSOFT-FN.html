<html>
<head>
<meta charset="UTF-8">
<title>Defsoft-fn</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=SOFT____DEFSOFT-FN">Click for Defsoft-fn in the Full Manual</a></h3>

<p>Generate the event submitted by <span class="tt"><a href="SOFT____DEFSOFT.html">defsoft</a></span>.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(defsoft-fn fn ctx state) â†’ (mv erp event state)</pre></dt> 
</dl></div> 
<p>The <span class="tt"><a href="SOFT____DEFSOFT.html">defsoft</a></span> macro records an ACL2 function 
     as a (SOFT) second-order function. 
     This macro will become the primary one 
     to introduce second-order functions, 
     and <span class="tt"><a href="SOFT____DEFUN2.html">defun2</a></span>, <span class="tt"><a href="SOFT____DEFCHOOSE2.html">defchoose2</a></span>, and <span class="tt"><a href="SOFT____DEFUN-SK2.html">defun-sk2</a></span> 
     will be redefined as <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>, <span class="tt"><a href="ACL2____DEFCHOOSE.html">defchoose</a></span>, and <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> 
     followed by <span class="tt"><a href="SOFT____DEFSOFT.html">defsoft</a></span>.</p><p>The input <span class="v">fn</span> must be a symbol that denotes an existing function 
     that is introduced by <span class="tt"><a href="ACL2____DEFCHOOSE.html">defchoose</a></span>, 
     or otherwise is introduced by <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span>, 
     or otherwise has an unnormalized body 
     (which implies that is is introduced by <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>). 
     Note that <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> functions 
     are internally introduced by <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>, 
     so it is important to check for <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> first. 
     Functions introduced by <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> but without an unnormalized body 
     (such as the built-in program-mode functions) 
     are disallowed because we cannot calculate 
     the function variables that such functions depend on. 
     For the same reason, 
     constrained functions introduced by <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> are disallowed.</p><p>We collect the function variables that the function depends on, 
     directly or indirecty; there must be at least one. 
     If the function is introduced by <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span>, 
     we also ensure that the associated rewrite rule 
     does not depend on additional function variables. 
     If the function is recursive, 
     we also ensure that the well-founded relation is <span class="tt"><a href="ACL2____O_C3.html">o&lt;</a></span>.</p><p>We print on screen an observation about the function being recorded 
     and which function variables it depends on. 
     This can be suppressed 
     (e.g. when generating <span class="tt"><a href="SOFT____DEFSOFT.html">defsoft</a></span> events programmatically) 
     via <span class="v">(<a href="ACL2____WITH-OUTPUT.html">with-output</a> :off observation ...)</span>.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>defsoft-fn</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 defsoft-fn (fn ctx state)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs (<a href="ACL2____STATE.html">state</a>)))
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'defsoft-fn))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   ((wrld (<a href="ACL2____W.html">w</a> state))
    ((unless (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn))
     (<a href="ACL2____ER-SOFT_B2.html">er-soft+</a> ctx t nil
               "The input must be a symbol, but it is ~x0 instead."
               fn))
    ((unless (<a href="ACL2____FUNCTION-SYMBOLP.html">function-symbolp</a> fn wrld))
     (<a href="ACL2____ER-SOFT_B2.html">er-soft+</a>
      ctx t nil
      "The symbol ~x0 must be a function symbol, ~
                   but it is not."
      fn))
    ((unless (<a href="COMMON-LISP____OR.html">or</a> (<a href="ACL2____DEFCHOOSEP.html">defchoosep</a> fn wrld)
                 (<a href="ACL2____DEFUN-SK-P.html">defun-sk-p</a> fn wrld)
                 (<a href="ACL2____UBODY.html">ubody</a> fn wrld)))
     (<a href="ACL2____ER-SOFT_B2.html">er-soft+</a>
      ctx t nil
      "The function ~x0 must ~
                   be introduced by DEFCHOOSE, ~
                   be introduced by DEFUN-SK, ~
                   or have a non-NIL unnormalized body."
      fn))
    (funvars (<a href="COMMON-LISP____COND.html">cond</a> ((<a href="ACL2____DEFCHOOSEP.html">defchoosep</a> fn wrld)
                    (<a href="SOFT____FUNVARS-OF-CHOICE-FN.html">funvars-of-choice-fn</a> fn wrld))
                   ((<a href="ACL2____DEFUN-SK-P.html">defun-sk-p</a> fn wrld)
                    (<a href="SOFT____FUNVARS-OF-QUANTIFIER-FN.html">funvars-of-quantifier-fn</a> fn wrld))
                   (t (<a href="SOFT____FUNVARS-OF-PLAIN-FN.html">funvars-of-plain-fn</a> fn wrld))))
    (funvars (<a href="ACL2____REMOVE-DUPLICATES-EQ.html">remove-duplicates-eq</a> funvars))
    ((unless (<a href="COMMON-LISP____CONSP.html">consp</a> funvars))
     (<a href="ACL2____ER-SOFT_B2.html">er-soft+</a>
      ctx t nil
      "The function ~x0 is not second-order:
                   it depends on no function variables, directly or indirectly."
      fn))
    (table-event
         (<a href="COMMON-LISP____CONS.html">cons</a> 'table
               (<a href="COMMON-LISP____CONS.html">cons</a> 'second-order-functions
                     (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'quote (<a href="COMMON-LISP____CONS.html">cons</a> fn 'nil))
                           (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'quote (<a href="COMMON-LISP____CONS.html">cons</a> funvars 'nil))
                                 'nil)))))
    ((<a href="ACL2____ER.html">er</a> &amp;) (<a href="SOFT____ENSURE-WFREL-O_C3.html">ensure-wfrel-o&lt;</a> fn ctx state))
    ((<a href="ACL2____ER.html">er</a> &amp;)
     (<a href="SOFT____ENSURE-DEFUN-SK-RULE-SAME-FUNVARS.html">ensure-defun-sk-rule-same-funvars</a> fn ctx state))
    (<a href="ACL2____STATE.html">state</a>
     (<a href="ACL2____IO_F3.html">acl2::io?</a>
      observation nil state (fn funvars)
      (<a href="ACL2____FMS.html">fms</a>
       "SOFT: ~
                               recorded ~x0 as a second-order function ~
                               that depends on the function variables ~x1.~%"
       (<a href="COMMON-LISP____LIST.html">list</a> (<a href="COMMON-LISP____CONS.html">cons</a> #\0 fn)
             (<a href="COMMON-LISP____CONS.html">cons</a> #\1 (acl2::sort-symbol-listp funvars)))
       *standard-co* state nil))))
   (<a href="ACL2____VALUE.html">value</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'progn
                (<a href="COMMON-LISP____CONS.html">cons</a> table-event
                      (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'value-triple
                                  (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'quote (<a href="COMMON-LISP____CONS.html">cons</a> fn 'nil))
                                        'nil))
                            'nil)))))))</pre> 

</body>
</html>
