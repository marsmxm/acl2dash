<html>
<head>
<meta charset="UTF-8">
<title>Check-product-update-expression</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION">Click for Check-product-update-expression in the Full Manual</a></h3>

<p>Check if a product update expression is statically well-formed.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(check-product-update-expression tname target target-result 
                                 fields fields-result expr ctxt) 
 
  → 
result</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">tname</span> — <font color="#606060">Guard <span class="v">(<a href="SYNTHETO____IDENTIFIERP.html">identifierp</a> tname)</span>.</font>
</dd> 
  <dd>
<span class="tt">target</span> — <font color="#606060">Guard <span class="v">(<a href="SYNTHETO____EXPRESSIONP.html">expressionp</a> target)</span>.</font>
</dd> 
  <dd>
<span class="tt">target-result</span> — <font color="#606060">Guard <span class="v">(<a href="SYNTHETO____TYPE-RESULTP.html">type-resultp</a> target-result)</span>.</font>
</dd> 
  <dd>
<span class="tt">fields</span> — <font color="#606060">Guard <span class="v">(<a href="SYNTHETO____INITIALIZER-LISTP.html">initializer-listp</a> fields)</span>.</font>
</dd> 
  <dd>
<span class="tt">fields-result</span> — <font color="#606060">Guard <span class="v">(<a href="SYNTHETO____TYPE-RESULTP.html">type-resultp</a> fields-result)</span>.</font>
</dd> 
  <dd>
<span class="tt">expr</span> — <font color="#606060">Guard <span class="v">(<a href="SYNTHETO____EXPRESSIONP.html">expressionp</a> expr)</span>.</font>
</dd> 
  <dd>
<span class="tt">ctxt</span> — <font color="#606060">Guard <span class="v">(<a href="SYNTHETO____CONTEXTP.html">contextp</a> ctxt)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">result</span> — <font color="#606060">Type <span class="v">(<a href="SYNTHETO____TYPE-RESULTP.html">type-resultp</a> result)</span>.</font>
</dd> 
 
</dl></div> 
<p>The type of the target expression must be a deined product type, 
     or a subtype of a defined product type: 
     we calculate the maximal supertype of the expression's type, 
     and ensure that it is a defined product type; 
     since product types are not subtypes, 
     calculating the maximal supertype cannot ``skip'' a product type.</p><p>We match the initializers to the fields of the product type, 
     returning an error if there is any mismatch. 
     Unlike a product construction expression, there may be unmatched fields: 
     in general, a product update expression changes only some of the fields.</p><p>If the product type has an invariant, we generate a proof obligation 
     saying that the new product type value satisfies the invariant. 
     This formula is obtained by substituting, in the invariant, 
     the updated field names with the updating expressions, 
     and the non-updated field names with 
     corresponding product field expressions.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>check-product-update-expression</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 check-product-update-expression
 (tname target target-result
        fields fields-result expr ctxt)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="SYNTHETO____IDENTIFIERP.html">identifierp</a> tname)
                             (<a href="SYNTHETO____EXPRESSIONP.html">expressionp</a> target)
                             (<a href="SYNTHETO____TYPE-RESULTP.html">type-resultp</a> target-result)
                             (<a href="SYNTHETO____INITIALIZER-LISTP.html">initializer-listp</a> fields)
                             (<a href="SYNTHETO____TYPE-RESULTP.html">type-resultp</a> fields-result)
                             (<a href="SYNTHETO____EXPRESSIONP.html">expressionp</a> expr)
                             (<a href="SYNTHETO____CONTEXTP.html">contextp</a> ctxt))))
 (<a href="COMMON-LISP____DECLARE.html">declare</a>
    (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="SYNTHETO____TYPE-RESULT-CASE.html">type-result-case</a> fields-result
                                    :err t
                                    :ok (<a href="COMMON-LISP_____D3.html">=</a> (<a href="ACL2____LEN.html">len</a> fields-result.types)
                                           (<a href="ACL2____LEN.html">len</a> fields)))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'check-product-update-expression))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="SYNTHETO____TYPE-RESULT-CASE.html">type-result-case</a>
   target-result
   :err (<a href="SYNTHETO____TYPE-RESULT-ERR.html">type-result-err</a> target-result.info)
   :ok
   (<a href="SYNTHETO____TYPE-RESULT-CASE.html">type-result-case</a>
    fields-result
    :err (<a href="SYNTHETO____TYPE-RESULT-ERR.html">type-result-err</a> fields-result.info)
    :ok
    (<a href="ACL2____B_A2.html">b*</a>
     ((<a href="SYNTHETO____TYPE.html">type</a> (<a href="SYNTHETO____ENSURE-SINGLE-TYPE.html">ensure-single-type</a> target-result.types))
      ((when (<a href="COMMON-LISP____NOT.html">not</a> type))
       (<a href="SYNTHETO____TYPE-RESULT-ERR.html">type-result-err</a> (<a href="COMMON-LISP____LIST.html">list</a> :multi-valued-field-target
                              (<a href="SYNTHETO____EXPRESSION-FIX.html">expression-fix</a> target)
                              target-result.types)))
      (<a href="SYNTHETO____TYPE.html">type</a> (<a href="SYNTHETO____MAX-SUPERTYPE.html">max-supertype</a> type (<a href="SYNTHETO____CONTEXT-_E3TOPS.html">context-&gt;tops</a> ctxt)))
      ((when (<a href="COMMON-LISP____NOT.html">not</a> type))
       (<a href="SYNTHETO____TYPE-RESULT-ERR.html">type-result-err</a> (<a href="COMMON-LISP____LIST.html">list</a> :no-max-supertype type)))
      (tprod (<a href="SYNTHETO____GET-TYPE-PRODUCT.html">get-type-product</a> type (<a href="SYNTHETO____CONTEXT-_E3TOPS.html">context-&gt;tops</a> ctxt)))
      ((when (<a href="COMMON-LISP____NOT.html">not</a> tprod))
       (<a href="SYNTHETO____TYPE-RESULT-ERR.html">type-result-err</a> (<a href="COMMON-LISP____LIST.html">list</a> :product-update-type-mismatch type)))
      (target-fields (<a href="SYNTHETO____TYPE-PRODUCT-_E3FIELDS.html">type-product-&gt;fields</a> tprod))
      ((<a href="ACL2____MV.html">mv</a> okp obligs unmatched-fields)
       (<a href="SYNTHETO____MATCH-FIELD-LIST.html">match-field-list</a> fields
                         fields-result.types target-fields ctxt))
      ((when (<a href="COMMON-LISP____NOT.html">not</a> okp))
       (<a href="SYNTHETO____TYPE-RESULT-ERR.html">type-result-err</a> (<a href="COMMON-LISP____LIST.html">list</a> :field-type-mismatch
                              type (<a href="SYNTHETO____INITIALIZER-LIST-FIX.html">initializer-list-fix</a> fields)
                              unmatched-fields)))
      (inv (<a href="SYNTHETO____TYPE-PRODUCT-_E3INVARIANT.html">type-product-&gt;invariant</a> tprod))
      (inv-oblig?
       (<a href="COMMON-LISP____IF.html">if</a>
        inv
        (<a href="ACL2____B_A2.html">b*</a>
         ((subst-new (<a href="SYNTHETO____INITIALIZERS-TO-VARIABLE-SUBSTITUTION.html">initializers-to-variable-substitution</a> fields))
          (names (<a href="SYNTHETO____FIELD-LIST-_E3NAME-LIST.html">field-list-&gt;name-list</a> unmatched-fields))
          (subst-old
           (<a href="OMAP____FROM-LISTS.html">omap::from-lists</a>
                names
                (<a href="SYNTHETO____EXPRESSION-PRODUCT-FIELD-LIST.html">expression-product-field-list</a> tname target names)))
          (<a href="COMMON-LISP____SUBST.html">subst</a> (<a href="OMAP____UPDATE_A2.html">omap::update*</a> subst-new subst-old)))
         (<a href="SYNTHETO____NON-TRIVIAL-PROOF-OBLIGATION.html">non-trivial-proof-obligation</a>
              (<a href="SYNTHETO____CONTEXT-_E3OBLIGATION-VARS.html">context-&gt;obligation-vars</a> ctxt)
              (<a href="SYNTHETO____CONTEXT-_E3OBLIGATION-HYPS.html">context-&gt;obligation-hyps</a> ctxt)
              (<a href="SYNTHETO____SUBST-EXPRESSION.html">subst-expression</a> subst inv)
              expr))
        nil)))
     (<a href="SYNTHETO____MAKE-TYPE-RESULT-OK.html">make-type-result-ok</a>
          :types (<a href="COMMON-LISP____LIST.html">list</a> type)
          :obligations (<a href="COMMON-LISP____APPEND.html">append</a> fields-result.obligations
                               obligs inv-oblig?)))))))</pre> 
<p><b>Theorem: </b>type-resultp-of-check-product-update-expression</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> type-resultp-of-check-product-update-expression
        (<a href="ACL2____B_A2.html">b*</a> ((result (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
                          tname target target-result
                          fields fields-result expr ctxt)))
            (<a href="SYNTHETO____TYPE-RESULTP.html">type-resultp</a> result))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>check-product-update-expression-of-identifier-fix-tname</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-of-identifier-fix-tname
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> (<a href="SYNTHETO____IDENTIFIER-FIX.html">identifier-fix</a> tname)
                                   target target-result
                                   fields fields-result expr ctxt)
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                   fields fields-result expr ctxt)))</pre> 
<p><b>Theorem: </b>check-product-update-expression-identifier-equiv-congruence-on-tname</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-identifier-equiv-congruence-on-tname
 (<a href="ACL2____IMPLIES.html">implies</a>
  (<a href="SYNTHETO____IDENTIFIER-EQUIV.html">identifier-equiv</a> tname tname-equiv)
  (<a href="COMMON-LISP____EQUAL.html">equal</a>
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                     fields fields-result expr ctxt)
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
         tname-equiv target target-result
         fields fields-result expr ctxt)))
 :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>check-product-update-expression-of-expression-fix-target</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-of-expression-fix-target
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname (<a href="SYNTHETO____EXPRESSION-FIX.html">expression-fix</a> target)
                                   target-result
                                   fields fields-result expr ctxt)
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                   fields fields-result expr ctxt)))</pre> 
<p><b>Theorem: </b>check-product-update-expression-expression-equiv-congruence-on-target</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-expression-equiv-congruence-on-target
 (<a href="ACL2____IMPLIES.html">implies</a>
  (<a href="SYNTHETO____EXPRESSION-EQUIV.html">expression-equiv</a> target target-equiv)
  (<a href="COMMON-LISP____EQUAL.html">equal</a>
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                     fields fields-result expr ctxt)
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
         tname target-equiv target-result
         fields fields-result expr ctxt)))
 :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>check-product-update-expression-of-type-result-fix-target-result</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-of-type-result-fix-target-result
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
       tname
       target (<a href="SYNTHETO____TYPE-RESULT-FIX.html">type-result-fix</a> target-result)
       fields fields-result expr ctxt)
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                   fields fields-result expr ctxt)))</pre> 
<p><b>Theorem: </b>check-product-update-expression-type-result-equiv-congruence-on-target-result</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-type-result-equiv-congruence-on-target-result
 (<a href="ACL2____IMPLIES.html">implies</a>
  (<a href="SYNTHETO____TYPE-RESULT-EQUIV.html">type-result-equiv</a> target-result target-result-equiv)
  (<a href="COMMON-LISP____EQUAL.html">equal</a>
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                     fields fields-result expr ctxt)
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
         tname target target-result-equiv
         fields fields-result expr ctxt)))
 :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>check-product-update-expression-of-initializer-list-fix-fields</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-of-initializer-list-fix-fields
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                   (<a href="SYNTHETO____INITIALIZER-LIST-FIX.html">initializer-list-fix</a> fields)
                                   fields-result expr ctxt)
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                   fields fields-result expr ctxt)))</pre> 
<p><b>Theorem: </b>check-product-update-expression-initializer-list-equiv-congruence-on-fields</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-initializer-list-equiv-congruence-on-fields
 (<a href="ACL2____IMPLIES.html">implies</a>
  (<a href="SYNTHETO____INITIALIZER-LIST-EQUIV.html">initializer-list-equiv</a> fields fields-equiv)
  (<a href="COMMON-LISP____EQUAL.html">equal</a>
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                     fields fields-result expr ctxt)
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
         tname target target-result
         fields-equiv fields-result expr ctxt)))
 :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>check-product-update-expression-of-type-result-fix-fields-result</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-of-type-result-fix-fields-result
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
       tname target target-result
       fields (<a href="SYNTHETO____TYPE-RESULT-FIX.html">type-result-fix</a> fields-result)
       expr ctxt)
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                   fields fields-result expr ctxt)))</pre> 
<p><b>Theorem: </b>check-product-update-expression-type-result-equiv-congruence-on-fields-result</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-type-result-equiv-congruence-on-fields-result
 (<a href="ACL2____IMPLIES.html">implies</a>
  (<a href="SYNTHETO____TYPE-RESULT-EQUIV.html">type-result-equiv</a> fields-result fields-result-equiv)
  (<a href="COMMON-LISP____EQUAL.html">equal</a>
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                     fields fields-result expr ctxt)
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
         tname target target-result
         fields fields-result-equiv expr ctxt)))
 :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>check-product-update-expression-of-expression-fix-expr</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-of-expression-fix-expr
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
       tname target target-result fields
       fields-result (<a href="SYNTHETO____EXPRESSION-FIX.html">expression-fix</a> expr)
       ctxt)
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                   fields fields-result expr ctxt)))</pre> 
<p><b>Theorem: </b>check-product-update-expression-expression-equiv-congruence-on-expr</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-expression-equiv-congruence-on-expr
 (<a href="ACL2____IMPLIES.html">implies</a>
  (<a href="SYNTHETO____EXPRESSION-EQUIV.html">expression-equiv</a> expr expr-equiv)
  (<a href="COMMON-LISP____EQUAL.html">equal</a>
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                     fields fields-result expr ctxt)
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
         tname target target-result
         fields fields-result expr-equiv ctxt)))
 :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>check-product-update-expression-of-context-fix-ctxt</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-of-context-fix-ctxt
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
       tname target target-result fields
       fields-result expr (<a href="SYNTHETO____CONTEXT-FIX.html">context-fix</a> ctxt))
  (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                   fields fields-result expr ctxt)))</pre> 
<p><b>Theorem: </b>check-product-update-expression-context-equiv-congruence-on-ctxt</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 check-product-update-expression-context-equiv-congruence-on-ctxt
 (<a href="ACL2____IMPLIES.html">implies</a>
  (<a href="SYNTHETO____CONTEXT-EQUIV.html">context-equiv</a> ctxt ctxt-equiv)
  (<a href="COMMON-LISP____EQUAL.html">equal</a>
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a> tname target target-result
                                     fields fields-result expr ctxt)
    (<a href="SYNTHETO____CHECK-PRODUCT-UPDATE-EXPRESSION.html">check-product-update-expression</a>
         tname target target-result
         fields fields-result expr ctxt-equiv)))
 :rule-classes :congruence)</pre> 

</body>
</html>
