<html>
<head>
<meta charset="UTF-8">
<title>Declare-stobjs</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____DECLARE-STOBJS">Click for Declare-stobjs in the Full Manual</a></h3>

<p>Declaring a formal parameter name to be a single-threaded object</p><p>When a <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> uses one of its formals as a single-threaded 
 object (<a href="ACL2____STOBJ.html">stobj</a>), the <span class="v">defun</span> <i>must</i> include a declaration that 
 the formal is to be so used.  An exception is the formal ``<span class="tt"><a href="ACL2____STATE.html">state</a></span>,'' 
 which if not declared as explained below, may still be used provided an 
 appropriate global ``declaration'' is issued: see <a href="ACL2____SET-STATE-OK.html">set-state-ok</a>.</p> 
 
 <p>If the formal in question is <span class="v">counters</span> then an appropriate declaration 
 is</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs counters))</pre> 
 
 <p>or, more generally,</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs (... counters ...)))</pre> 
 
 <p>where all the single-threaded formals are listed.</p> 
 
 <p>For such a declaration to be legal it must be the case that all the names 
 have previously been defined as single-threaded objects with <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span>.</p> 
 
 <p>When an argument is declared to be single-threaded the guard of the 
 function is augmented by conjoining to it the condition that the argument 
 satisfy the recognizer for the single-threaded object.  Furthermore, the 
 syntactic checks done to enforce the legal use of single-threaded objects are 
 also sufficient to allow these guard conjuncts to be automatically proved.</p> 
 
 <p>The obvious question arises: Why does ACL2 insist that you declare stobj 
 names before using them in <span class="v">defun</span>s if you can only declare names that have 
 already been defined with <span class="v">defstobj</span>?  What would go wrong if a formal were 
 treated as a single-threaded object if and only if it had already been so 
 defined?</p> 
 
 <p>Suppose that one user, say Jones, creates a book in which <span class="v">counters</span> is 
 defined as a single-threaded object.  Suppose another user, Smith, creates a 
 book in which <span class="v">counters</span> is used as an ordinary formal parameter.  Finally, 
 suppose a third user, Brown, wishes to use both books.  If Brown includes 
 Jones' book first and then Smith's, then Smith's function treats <span class="v">counters</span> 
 as single-threaded.  But if Brown includes Smith's book first, the argument is 
 treated as ordinary.</p> 
 
 <p>ACL2 insists on the declaration to ensure that the definition is processed 
 the same way no matter what the context.</p>
</body>
</html>
