<html>
<head>
<meta charset="UTF-8">
<title>Defun-nx</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____DEFUN-NX">Click for Defun-nx in the Full Manual</a></h3>

<p>Define a non-executable function symbol</p><pre class="code">Example:

(<a href="ACL2____DEFUN-NX.html">defun-nx</a> foo (x state)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t))
  (<a href="ACL2____MV-LET.html">mv-let</a> (a b c)
          (<a href="COMMON-LISP____CONS.html">cons</a> x state)
          (<a href="COMMON-LISP____LIST.html">list</a> a b c b a)))
; Note ``ill-formed'' call of foo just below.
(<a href="COMMON-LISP____DEFUN.html">defun</a> bar (<a href="ACL2____STATE.html">state</a> y)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs state))
  (foo state y))</pre> 
 
 <p>The macro <span class="v">defun-nx</span> introduces definitions using the <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> 
 macro, always in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode, such that the calls of the 
 resulting function cannot be evaluated.  Such a definition is admitted without 
 enforcing syntactic restrictions for executability, in particular for 
 single-threadedness (see <a href="ACL2____STOBJ.html">stobj</a>) and multiple-values passing (see <a href="ACL2____MV.html">mv</a> and see <a href="ACL2____MV-LET.html">mv-let</a>).  After such a definition is admitted, the usual 
 syntactic rules for <span class="tt"><a href="ACL2____STATE.html">state</a></span> and user-defined <a href="ACL2____STOBJ.html">stobj</a>s are relaxed 
 for calls of the function it defines.  Also see <a href="ACL2____NON-EXEC.html">non-exec</a> for a way to 
 designate subterms of function bodies, or subterms of code to be executed at 
 the top level, as non-executable.</p> 
 
 <p>The syntax of <span class="v">defun-nx</span> is identical to that of <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>.  A 
 form</p> 
 
 <pre class="code">(<a href="ACL2____DEFUN-NX.html">defun-nx</a> name (x1 ... xk) ... body)</pre> 
 
 <p>generates the following definition.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> name (x1 ... xk)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :non-executable t :mode :logic))
  ...
  (<a href="ACL2____PROG2_42.html">prog2$</a> (throw-nonexec-error 'name (<a href="COMMON-LISP____LIST.html">list</a> x1 ... xk))
          body))</pre> 
 
 <p>But <span class="v">defun-nx</span> does two other things.  Before executing the <span class="v">defun</span> 
 form displayed above, ACL2 arranges that <span class="v">state</span> is allowed as a formal 
 parameter, by first introducing <span class="v">(<a href="ACL2____SET-STATE-OK.html">set-state-ok</a> t)</span> in a way that is <a href="ACL2____LOCAL.html">local</a> to the generated event.  After executing the <span class="v">defun</span>, the <a href="ACL2____EXECUTABLE-COUNTERPART.html">executable-counterpart</a> <a href="ACL2____RUNE.html">rune</a> for <span class="v">name</span> is <a href="ACL2____DISABLE.html">disable</a>d.  You can 
 evaluate <span class="v">:trans1 (<a href="ACL2____DEFUN-NX.html">defun-nx</a> ...)</span> for your <span class="v">defun-nx</span> form to see its 
 single-step macroexpansion.</p> 
 
 <p>Note that because of the insertion of the above call of 
 <span class="v">throw-nonexec-error</span>, no formal is ignored when using <span class="v">defun-nx</span>.</p> 
 
 <p>During proofs, the error is silent; it is ``caught'' by the proof mechanism 
 and generally results in the introduction of a call of <span class="tt"><a href="ACL2____HIDE.html">hide</a></span> during a 
 proof.  If an error message is produced by evaluating a call of the function 
 on a list of arguments that includes <span class="v">state</span> or user-defined <span class="tt"><a href="ACL2____STOBJ.html">stobj</a></span>s, these arguments will be shown as symbols such as <span class="v">|&lt;state&gt;|</span> in 
 the error message.  In the case of a user-defined stobj bound by <span class="tt"><a href="ACL2____WITH-LOCAL-STOBJ.html">with-local-stobj</a></span> or <span class="tt"><a href="ACL2____STOBJ-LET.html">stobj-let</a></span>, the symbol printed will include the 
 suffix <span class="v">{instance}</span>, for example, <span class="v">|&lt;st&gt;{instance}|</span>.</p> 
 
 <p>It is harmless to include <span class="v">:non-executable t</span> in your own <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> 
 <span class="tt"><a href="COMMON-LISP____DECLARE.html">declare</a></span> form; <span class="v">defun-nx</span> will still lay down its own such 
 declaration, but ACL2 can tolerate the duplication.</p> 
 
 <p>Note that <span class="tt"><a href="ACL2____DEFUND-NX.html">defund-nx</a></span> is also available.  It is essentially identical 
 to <span class="v">defun-nx</span> except that as with <span class="tt"><a href="ACL2____DEFUND.html">defund</a></span>, <span class="v">defund-nx</span> leaves the 
 definition <a href="ACL2____RUNE.html">rune</a> disabled for the new function symbol.</p> 
 
 <p>If you use guards (see <a href="ACL2____GUARD.html">guard</a>), please be aware that even though 
 syntactic restrictions are relaxed for <span class="v">defun-nx</span>, guard verification 
 proceeds exactly as for <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>.  If you want ACL2 to skip a form for 
 purposes of generating guard proof obligations, use the macro <span class="tt"><a href="ACL2____NON-EXEC.html">non-exec</a></span>, which generates a call of <span class="v">throw-nonexec-error</span> that differs 
 somewhat from the one displayed above.  See <a href="ACL2____NON-EXEC.html">non-exec</a>.</p> 
 
 <p>See <a href="COMMON-LISP____DEFUN.html">defun</a> for documentation of <span class="v">defun</span>.</p>
</body>
</html>
