<html>
<head>
<meta charset="UTF-8">
<title>Optimizing-build-time</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=BUILD____OPTIMIZING-BUILD-TIME">Click for Optimizing-build-time in the Full Manual</a></h3>

<p>How to use <span class="v">critpath.pl</span> to profile your build, so that you can 
focus your efforts on speeding up the most critical parts.</p><p>Alongside <span class="v">cert.pl</span> is another script, <span class="v">critpath.pl</span>, that 
can be used to analyze the certification times for your files.  When you are 
dealing with a large collection of ACL2 books, this can be a useful tool for 
seeing where to speed up your build.</p> 
 
<p>Before using <span class="v">critpath.pl</span>, you must tell <span class="v">cert.pl</span> that you want it 
to record certification times.  This is done by setting the <span class="v">$TIME_CERT</span> 
environment variable.  For instance, you might add the following to your 
<span class="v">.bashrc</span> or equivalent:</p> 
 
<pre class="code">export TIME_CERT=yes</pre> 
 
<p>After setting this variable, you will need to recertify your books.</p> 
 
<p>When <span class="v">cert.pl</span> sees that <span class="v">$TIME_CERT</span> is set, it writes out additional 
<span class="v">.cert.time</span> files that record how long each book took to certify.  The 
<span class="v">critpath.pl</span> script then correlates these files with the dependencies among 
your books to give you a report.</p> 
 
<p>For instance, here is a report for the <span class="v">arithmetic-5/top</span> book, circa 
October 2013.</p> 
 
<pre class="code">$ cd arithmetic-5
$ critpath.pl top.cert
Critical Path

File                            Cumulative       Time    Speedup     Remove
top.cert                           2.0 min    2.0 sec    2.0 sec    2.0 min
floor-mod/top.cert                 2.0 min    1.8 sec    1.8 sec    1.7 min
floor-mod/logand.cert              1.9 min   33.7 sec   33.7 sec   37.0 sec
floor-mod/logand-helper.cert       1.4 min    7.1 sec    7.1 sec    7.1 sec
floor-mod/more-floor-mod.cert      1.2 min   16.7 sec   15.1 sec   15.1 sec
floor-mod/floor-mod.cert          58.1 sec   19.9 sec   19.9 sec   30.8 sec
...</pre> 
 
<p>The critical path is the longest chain of books in an unrealistically ideal 
build environment with infinite CPUs to draw upon.  The report shows what books 
comprise the critical path, and how long each of them takes.  It also shows 
you:</p> 
 
<ul> 
 
<li>The <span class="v">speedup</span> time for each book.  This measures how much the critical 
path could be reduced by speeding up the book, without affecting its 
dependencies.  A book with a large <span class="v">speedup</span> time may be good candidate for 
new hints to make proofs faster.</li> 
 
<li>The <span class="v">remove</span> time for each book.  This measures how much your build 
would speed up if you didn't need to build this book at all.  The <span class="v">remove</span> 
time should always exceed the <span class="v">speedup</span> time.  In some cases, it may be much 
larger, since by removing a book we may also avoid needing to build some of the 
books it depends on.</li> 
 
</ul> 
 
<p>While the very simple usage shown above is often sufficient, the 
<span class="v">critpath.pl</span> script has a number of other options that may occasionally be 
useful.  See <span class="v">critpath.pl --help</span> for details.</p>
</body>
</html>
