<html>
<head>
<meta charset="UTF-8">
<title>Puff</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____PUFF">Click for Puff in the Full Manual</a></h3>

<p>Replace a compound <a href="ACL2____COMMAND.html">command</a> by its immediate subevents</p><pre class="code">Example Forms:
ACL2 !&gt;:puff :max
ACL2 !&gt;:puff :x
ACL2 !&gt;:puff 15
ACL2 !&gt;:puff "book"

General Form:
:puff cd</pre> 
 
 <p>where <span class="v">cd</span> is a <a href="ACL2____COMMAND.html">command</a> descriptor (see <a href="ACL2____COMMAND-DESCRIPTOR.html">command-descriptor</a>) for a ``puffable'' <a href="ACL2____COMMAND.html">command</a> (see below).  <span class="v">Puff</span> 
 replaces the <a href="ACL2____COMMAND.html">command</a> at <span class="v">cd</span> by the immediate subevents of the <a href="ACL2____COMMAND.html">command</a>, executed as <a href="ACL2____COMMAND.html">command</a>s.  <span class="v">Puff</span> then prints, using <span class="tt"><a href="ACL2____PCS.html">pcs</a></span>, the <span class="v">puff</span>ed region.</p> 
 
 <p>We consider <span class="v">puff</span> to be a sort of hack; it is generally robust and 
 sound, but that is not guaranteed.  If any existing ACL2 event resulted from 
 <span class="v">puff</span>, ACL2 considers proofs to have been skipped, and thus <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> is disallowed until such events have been undone (see <a href="ACL2____UBT.html">ubt</a>).</p> 
 
 <p>Other than the few exceptions noted later below, a ``puffable'' <a href="ACL2____COMMAND.html">command</a> is an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span>, <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>, or <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> <a href="ACL2____COMMAND.html">command</a>, or any command other than those consisting of a 
 single primitive event.  For example, since <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> is a primitive 
 event, a <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> command is not puffable.  But a macro form that expands 
 into one or more <a href="ACL2____EVENTS.html">events</a> is puffable.  The only primitive events that 
 are puffable are calls of <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> or <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>.  In 
 this sense, <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> is not considered primitive — that is, it 
 can be puffed — and moreover, an immediate subevent that is a call of 
 <span class="v">make-event</span> is generally replaced by its expansion (see <a href="ACL2____MAKE-EVENT.html">make-event</a>).  A puffable <a href="ACL2____COMMAND.html">command</a> contains (interesting) subevents, 
 namely, the events in the body of the <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span>, in the file of the 
 book included, or in the <a href="ACL2____COMMAND.html">command</a> block.</p> 
 
 <p>The puff <a href="ACL2____COMMAND.html">command</a> ``lifts'' the immediate subevents of the indicated 
 <a href="ACL2____COMMAND.html">command</a> so that they become <a href="ACL2____COMMAND.html">command</a>s themselves.  The <a href="ACL2____COMMAND.html">command</a> <span class="tt"><a href="ACL2____PUFF_A2.html">puff*</a></span> recursively puffs the newly introduced <a href="ACL2____COMMAND.html">command</a>s. 
 See <a href="ACL2____PUFF_A2.html">puff*</a>, which also gives an example illustrating both <span class="v">puff</span> and 
 <span class="tt"><a href="ACL2____PUFF_A2.html">puff*</a></span>.  <span class="v">Puff</span> undoes the <a href="ACL2____COMMAND.html">command</a> at <span class="v">cd</span> and replaces it 
 by its immediate subevents.  Thus, in general the length of the <a href="ACL2____HISTORY.html">history</a> 
 grows when a puff <a href="ACL2____COMMAND.html">command</a> is executed.  If <span class="v">puff</span> causes an error 
 (see below), the logical <a href="ACL2____WORLD.html">world</a> remains unchanged from its initial 
 configuration.</p> 
 
 <p>The intended use of <span class="v">puff</span> is to allow the user access to the <a href="ACL2____EVENTS.html">events</a> ``hidden'' inside compound <a href="ACL2____COMMAND.html">command</a>s.  For example, while trying 
 to prove some theorem, <span class="v">p</span>, about a constrained function, <span class="v">fn</span>, one 
 might find that the <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span>, <span class="v">cd</span>, that introduced <span class="v">fn</span> 
 failed to include an important <a href="ACL2____CONSTRAINT.html">constraint</a>, <span class="v">q</span>.  Without <span class="v">puff</span>, 
 the only way to proceed is to undo back through <span class="v">cd</span>, create a suitable 
 <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> that proves and exports <span class="v">q</span> as well as the old <a href="ACL2____CONSTRAINT.html">constraint</a>s, re-execute the new <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span>, re-execute the <a href="ACL2____EVENTS.html">events</a> since <span class="v">cd</span>, and then try <span class="v">p</span> again.  Unfortunately, it may be 
 hard to prove <span class="v">q</span> and additional <a href="ACL2____EVENTS.html">events</a> may have to be inserted into 
 the <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> to prove it.  It may also be hard to formulate the 
 ``right'' <span class="v">q</span>, i.e., one that is provable in the <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> and 
 provides the appropriate facts for use in the proof of <span class="v">p</span>.</p> 
 
 <p>Using <span class="v">puff</span>, the user can erase the <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> at <span class="v">cd</span>, 
 replacing it by the <a href="ACL2____EVENTS.html">events</a> in its body.  Now the formerly constrained 
 function, <span class="v">fn</span>, is defined as its witness.  The user can experiment with 
 formulations and proofs of <span class="v">q</span> suitable for <span class="v">p</span>.  Of course, to get into 
 the ultimately desired <a href="ACL2____STATE.html">state</a> — where <span class="v">fn</span> is constrained 
 rather than defined and <span class="v">q</span> is exported by an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> at 
 <span class="v">cd</span> — the user must ultimately undo back to <span class="v">cd</span> and carry out 
 the more tedious program described above.  But by using <span class="v">puff</span> it is easier 
 to experiment.</p> 
 
 <p>Similar applications of <span class="v">puff</span> allow the user of a book to expose the 
 top-level <a href="ACL2____EVENTS.html">events</a> in the book as though they had all been typed as <a href="ACL2____COMMAND.html">command</a>s.  The user might then ``partially undo'' the book, keeping only some 
 of the events in it.</p> 
 
 <p><span class="v">Puff</span> operates as follows.  First, it determines the list of immediate 
 subevents of the <a href="ACL2____COMMAND.html">command</a> indicated by <span class="v">cd</span>.  It causes an error if 
 there is only one subevent and that subevent is identical to the <a href="ACL2____COMMAND.html">command</a> — i.e., if the <a href="ACL2____COMMAND.html">command</a> at <span class="v">cd</span> is a primitive.  Next, 
 <span class="v">puff</span> undoes back through the indicated <a href="ACL2____COMMAND.html">command</a>.  This not only 
 erases the <a href="ACL2____COMMAND.html">command</a> at <span class="v">cd</span> but all the <a href="ACL2____COMMAND.html">command</a>s executed 
 after it.  Finally, <span class="v">puff</span> re-executes the subevents of (the now erased) 
 <span class="v">cd</span> followed by all the <a href="ACL2____COMMAND.html">command</a>s that were executed afterwards.</p> 
 
 <p>Observe that the <a href="ACL2____COMMAND.html">command</a>s executed after <span class="v">cd</span> will generally have 
 higher <a href="ACL2____COMMAND.html">command</a> numbers than they did before the puff.  For example, 
 suppose 100 <a href="ACL2____COMMAND.html">command</a>s have been executed and that <span class="v">:puff 80</span> is then 
 executed.  Suppose <a href="ACL2____COMMAND.html">command</a> 80 contains 5 immediate subevents (i.e., is 
 an encapsulation of five <a href="ACL2____EVENTS.html">events</a>).  Then, after puffing, <a href="ACL2____COMMAND.html">command</a> 
 80 is the first event of the puffed <a href="ACL2____COMMAND.html">command</a>, <a href="ACL2____COMMAND.html">command</a> 81 is the 
 second, and so on; 104 <a href="ACL2____COMMAND.html">command</a>s appear to have been executed.</p> 
 
 <p>When puffing an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> or <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>, the <span class="tt"><a href="ACL2____LOCAL.html">local</a></span> <a href="ACL2____COMMAND.html">command</a>s are executed.  Note that this will replace constrained 
 functions by their witnesses.</p> 
 
 <p>Here are some details and a few exceptions.</p> 
 
 <ul> 
 
 <li>An <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> command that generates <a href="ACL2____UNKNOWN-CONSTRAINTS.html">unknown-constraints</a>, 
 such as one generated by the macro <span class="tt"><a href="ACL2____DEFINE-TRUSTED-CLAUSE-PROCESSOR.html">define-trusted-clause-processor</a></span>, is 
 not puffable.</li> 
 
 <li>When an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> has a non-empty <a href="ACL2____SIGNATURE.html">signature</a>, it is not 
 puffable if the `puff' command issued is <span class="v">:</span><span class="tt"><a href="ACL2____PUFF_A2.html">puff*</a></span>, rather than 
 <span class="v">:</span><span class="v">puff</span>.  That is because puffing may fail in this case, as discussed 
 immediately below, and it may be annoying to deal with the failure, for 
 example if <span class="v">:puff*</span> takes a long time to run.</li> 
 
 <li>An attempt to puff may fail for an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> with a non-empty 
 <a href="ACL2____SIGNATURE.html">signature</a> that contains at least one use of <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> and also 
 comes from a certified book.  The reason is that local definitions may be 
 elided.  Here is an example of such a book. 
 
 <pre class="code">(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "ACL2")

(<a href="ACL2____ENCAPSULATE.html">encapsulate</a>
  ((f (x) t))
  (<a href="ACL2____MAKE-EVENT.html">make-event</a> '(<a href="ACL2____LOCAL.html">local</a> (<a href="COMMON-LISP____DEFUN.html">defun</a> f (x) (<a href="COMMON-LISP____CONS.html">cons</a> x x))))
  (<a href="ACL2____DEFTHM.html">defthm</a> f-prop (<a href="COMMON-LISP____CONSP.html">consp</a> (f x))))</pre> 
 
 If we first certify this book, then we include it in a new ACL2 session, and 
 next we issue the command <span class="v">:puff 1</span>, then we can see that the local 
 definition in our <span class="v">encapsulate</span> event has been elided: 
 
 <pre class="code">ACL2 !&gt;:pcb! 1
           1  (<a href="ACL2____ENCAPSULATE.html">ENCAPSULATE</a>
                   ((F (X) T))
                   (RECORD-EXPANSION
                        (<a href="ACL2____MAKE-EVENT.html">MAKE-EVENT</a> '(<a href="ACL2____LOCAL.html">LOCAL</a> (<a href="COMMON-LISP____DEFUN.html">DEFUN</a> F (X) (<a href="COMMON-LISP____CONS.html">CONS</a> X X))))
                        (<a href="ACL2____LOCAL.html">LOCAL</a> (<a href="ACL2____VALUE-TRIPLE.html">VALUE-TRIPLE</a> :ELIDED)))
                   (<a href="ACL2____DEFTHM.html">DEFTHM</a> F-PROP (<a href="COMMON-LISP____CONSP.html">CONSP</a> (F X))))
               (<a href="ACL2____DEFTHM.html">DEFTHM</a> F-PROP (<a href="COMMON-LISP____CONSP.html">CONSP</a> (F X)))
ACL2 !&gt;</pre> 
 
 Now an attempt to execute the command, <span class="v">:puff 1</span>, causes an error because 
 <span class="v">f</span> lacks a definition. 
 
 <pre class="code">ACL2 !&gt;:puff 1


ACL2 Error in ( DEFTHM F-PROP ...):  The symbol F (in package "ACL2")
has neither a function nor macro definition in ACL2.  Please define
it.  See :DOC near-misses.  Note:  this error occurred in the context
(F X).

ACL2 !&gt;</pre>
</li> 
 
 <li>Similarly, a <span class="tt"><a href="ACL2____LOCAL.html">local</a></span> event that involves <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> 
 expansion may be elided when the event is from a book whose <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> form has been puffed.  This will result in an error if the 
 elided event is necessary to support later events in the <span class="v">puff</span> of the 
 command.  Here is an example, where the attempt to puff an <span class="v">include-book</span> 
 for this book will fail, giving an error for <span class="v">( DEFUN G ...)</span> stating that 
 the symbol <span class="v">F</span> has not been defined. 
 
 <pre class="code">(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "ACL2")
(<a href="ACL2____MAKE-EVENT.html">make-event</a> '(<a href="ACL2____LOCAL.html">local</a> (<a href="COMMON-LISP____DEFUN.html">defun</a> f (x) x)))
(<a href="ACL2____LOCAL.html">local</a> (<a href="COMMON-LISP____DEFUN.html">defun</a> g (x) (f x)))</pre>
</li> 
 
 <li>An attempt to <span class="v">puff</span> an <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> command may fail for a 
 book that has been modified, as described later in this documentation 
 topic.</li> 
 
 <li>The <span class="v">puff</span> of an an <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> command for an uncertified 
 book will simply expose the contents of the book.  However, if the book is 
 certified then the <span class="v">puff</span> will replace each event by its <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> 
 expansion.  Also, ACL2 considers that (certified) book to have been included; 
 future attempts to include that book will be considered to be <a href="ACL2____REDUNDANT.html">redundant</a>.</li> 
 
 </ul> 
 
 <p>Finally, we note that it is an error to <span class="v">puff</span> in the presence of <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> <a href="ACL2____EVENTS.html">events</a> for certified books that have been altered since 
 they were included.  (Note that this restriction only applies to <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>, not to <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span>.)  To be specific, suppose 
 <span class="v">"arith"</span> is a certified book that has been included in a session. 
 Suppose that after <span class="v">"arith"</span> was included, the source file is modified. 
 (This might happen if the user of <span class="v">"arith"</span> is not its author and the 
 author happens to be working on a new version of <span class="v">"arith"</span> during the 
 same time period.)  Now suppose the user tries to <span class="v">puff</span> the <a href="ACL2____COMMAND.html">command</a> 
 that included <span class="v">"arith"</span>.  The attempt to obtain the subevents in 
 <span class="v">"arith"</span> will discover that the <a href="ACL2____BOOK-HASH.html">book-hash</a> of <span class="v">"arith"</span> has 
 changed and an error will be caused.  No change is made in the logical <a href="ACL2____WORLD.html">world</a>.  A similar error is caused if, in this same situation, the user tries 
 to puff any command that occurred before the inclusion of <span class="v">"arith"</span>! 
 That is, <span class="v">puff</span> may cause an error and leave the <a href="ACL2____WORLD.html">world</a> unchanged 
 even if the <a href="ACL2____COMMAND.html">command</a> puffed is not one involving the modified book. 
 This happens because in order to reconstruct the <a href="ACL2____WORLD.html">world</a> after the puffed 
 <a href="ACL2____COMMAND.html">command</a>, <span class="v">puff</span> must obtain the <a href="ACL2____EVENTS.html">events</a> in the book and if the 
 book's source file has changed there is no assurance that the reconstructed 
 <a href="ACL2____WORLD.html">world</a> is the one the user intends.</p> 
 
 <p>Warning: We do not detect changes to uncertified <a href="ACL2____BOOKS.html">books</a> that have 
 been included and are then puffed or re-included!  The act of including an 
 uncertified book leaves no trace of the <a href="ACL2____BOOK-HASH.html">book-hash</a> value for the book. 
 Furthermore, the act prints a warning message disclaiming soundness.  In light 
 of this, <span class="v">:puff</span> quietly ``re-''executes the current contents of the 
 book.</p>
</body>
</html>
