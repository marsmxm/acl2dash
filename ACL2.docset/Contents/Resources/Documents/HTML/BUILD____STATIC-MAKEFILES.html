<html>
<head>
<meta charset="UTF-8">
<title>Static-makefiles</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=BUILD____STATIC-MAKEFILES">Click for Static-makefiles in the Full Manual</a></h3>

<p>How to use <span class="v">cert.pl</span> within a larger Makefile that needs to know 
how to build non-ACL2 files (e.g., C libraries) or dynamically generated ACL2 
books.</p><p>For many ACL2 projects, <span class="v">cert.pl</span> may allow you to entirely 
avoid needing to write any Makefiles.  But sometimes it's not enough.  For 
instance:</p> 
 
<ul> 
 
<li>If your project involves dynamically generating new ACL2 books, 
<span class="v">cert.pl</span> has no way to see their dependencies.</li> 
 
<li>If your project has a non-ACL2 component that needs to be built in some 
special way, e.g., say you're linking ACL2 with a C library and you need to 
recompile the library when you change its code, <span class="v">cert.pl</span> has no support for 
building the C library.</li> 
 
</ul> 
 
<p>In these cases, the general approach is to write an ordinary <span class="v">Makefile</span>, 
but use <span class="v">cert.pl</span> to automate the dependency scanning for all of the static 
ACL2 books.</p> 
 
 
<h3>Basic Makefile Generation</h3> 
 
<p>Ordinarily, when you run a command like <span class="v">cert.pl foo</span>, what happens 
is:</p> 
 
<ul> 
 
<li>
<span class="v">cert.pl</span> scans <span class="v">foo</span> for <a href="ACL2____INCLUDE-BOOK.html">include-book</a> commands, etc., to 
figure out the dependencies of <span class="v">foo</span>.</li> 
 
<li>It writes these dependencies into a temporary Makefile named 
<span class="v">Makefile-tmp</span>.</li> 
 
<li>It invokes <span class="v">make</span> on <span class="v">Makefile-tmp</span> to do the actual build.</li> 
 
</ul> 
 
<p>When you use <span class="v">cert.pl</span> as part of your own Makefile, you don't want it to 
run <span class="v">make</span> for you.  Instead, you just want it to do the dependency analysis 
and write out a Makefile that your Makefile can <a href="http://www.gnu.org/software/make/manual/make.html#Include" target="_blank"><nobr>include<img src="../Icon_External_Link.png" title="External link to http://www.gnu.org/software/make/manual/make.html#Include"></nobr></a>.</p> 
 
<p>This is done using the <span class="v">-s</span> switch.  For instance, here's how we could 
create a Makefile for the <span class="v">arithmetic-5</span> library:</p> 
 
<pre class="code">$ cd acl2/books/arithmetic-5
$ cert.pl top.cert -s Makefile-arith5</pre> 
 
<p>The resulting Makefile has all the dependencies for Arithmetic-5:</p> 
 
<pre class="code"># This makefile was generated by running:
# cert.pl top.cert -s Makefile-arith5
...
ACL2_SYSTEM_BOOKS ?= ..                      # Boilerplate stuff
export ACL2_BIN_DIR := ../../cn/e/bin
include $(ACL2_SYSTEM_BOOKS)/build/make_cert

.PHONY: all-cert-pl-certs
# Depends on all certificate files.
all-cert-pl-certs:

CERT_PL_CERTS := 
    lib/basic-ops/arithmetic-theory.cert 
    ... 
    top.cert

all-cert-pl-certs: $(CERT_PL_CERTS)
...

lib/basic-ops/integerp-helper.cert :        # Dependency info
    support/top.cert 
    lib/basic-ops/building-blocks.cert 
    lib/basic-ops/default-hint.cert 
    lib/basic-ops/integerp-helper.lisp
...</pre> 
 
<p>The general idea is then to include the generated <span class="v">Makefile</span> into your 
own Makefile.  For real examples of how to do this, see</p> 
 
<ul> 
 
<li>The <span class="v">books/Makefile</span>; just search for <span class="v">cert.pl</span> to see how it is used 
to build <span class="v">Makefile-books</span>.</li> 
 
<li>The similar use of <span class="v">cert.pl</span> in <span class="v">books/projects/milawa/ACL2/Makefile</span>, 
which may in some ways be simpler to understand.</li> 
 
</ul> 
 
<p>There are various options to control whether to emit the boilerplate 
section, to rename variables like <span class="v">CERT_PL_CERTS</span>, etc.  See <span class="v">cert.pl
--help</span> for a summary.</p>
</body>
</html>
