<html>
<head>
<meta charset="UTF-8">
<title>Note-6-2</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____NOTE-6-2">Click for Note-6-2 in the Full Manual</a></h3>

<p>ACL2 Version  6.2 (June, 2013) Notes</p><p>NOTE!  New users can ignore these release notes, because the <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> has been updated to reflect all changes that are recorded 
 here.</p> 
 
 <p>Below we roughly organize the changes since Version 6.1 into the following 
 categories of changes: existing features, new features, heuristic 
 improvements, bug fixes, changes at the system level, Emacs support, and 
 experimental versions.  Each change is described in just one category, though 
 of course many changes could be placed in more than one category.</p> 
 
 <p><b>CHANGES TO EXISTING FEATURES</b></p> 
 
 <p>The macro <span class="tt"><a href="ACL2____TOP-LEVEL.html">top-level</a></span> has been changed, so that evaluation of a form 
 <span class="v">(<a href="ACL2____TOP-LEVEL.html">top-level</a> x)</span> results in an error when evaluation of <span class="v">x</span> results in an 
 error.  Thanks to Jared Davis for observing that when evaluating a file using 
 <span class="tt"><a href="ACL2____LD.html">ld</a></span>, an interrupt of a call of a <span class="tt"><a href="ACL2____TOP-LEVEL.html">top-level</a></span> call in that file 
 would not prevent evaluation of later forms in the file.</p> 
 
 <p>The macro <span class="tt"><a href="COMMON-LISP____THE.html">the</a></span> no longer causes an error when <a href="ACL2____GUARD.html">guard</a>-checking 
 is <span class="v">:NONE</span>.  For example, it had been the case that evaluation of <span class="v">(<a href="COMMON-LISP____THE.html">the</a>
 integer t)</span> always caused an error; but now, there is no error after 
 executing command <span class="v">:</span><span class="tt"><a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a></span><span class="v"> :NONE</span>.  Thanks to 
 Jared Davis for asking for a way to avoid such errors.</p> 
 
 <p>The error printed when attempting to ``reincarnate'' a package — that 
 is, to define a package that is not part of the ACL2 logical <a href="ACL2____WORLD.html">world</a> but 
 exists in raw Lisp because it was once part of the world — is now much 
 more instructive.  In particular, it shows pathnames for the previous and 
 proposed <span class="tt"><a href="ACL2____DEFPKG.html">defpkg</a></span> events, and it shows the symbols that are imported by 
 one but not the other.  Thanks to Jared Davis for requesting this 
 improvement.</p> 
 
 <p>Functions <span class="tt"><a href="ACL2____OPEN-INPUT-CHANNEL.html">open-input-channel</a></span> and <span class="tt"><a href="ACL2____OPEN-OUTPUT-CHANNEL.html">open-output-channel</a></span> no 
 longer cause an error when failing to open a channel because of a permissions 
 problem, but instead return <span class="v">(<a href="ACL2____MV.html">mv</a> nil state)</span>.  Thanks to Jared Davis for 
 requesting this change.  (Note: this change does not apply if the host Lisp is 
 non-ANSI, i.e., if the host Lisp is non-ANSI GCL.)</p> 
 
 <p>The advanced <a href="ACL2____META-EXTRACT.html">meta-extract</a> mechanisms, provided for using facts from 
 the <a href="ACL2____WORLD.html">world</a> or metafunction context, have been enhanced in the following 
 ways, in collaboration with Sol Swords.  See <a href="ACL2____META-EXTRACT.html">meta-extract</a> for more 
 details.</p> 
 
 <blockquote> 
 
 <p>It is now permissible to use calls of <span class="v">meta-extract-global-fact</span> in 
 hypotheses of <span class="tt"><a href="ACL2____CLAUSE-PROCESSOR.html">clause-processor</a></span> rules, much as they are used in 
 hypotheses of <span class="tt"><a href="ACL2____META.html">meta</a></span> rules.  See <a href="ACL2____META-EXTRACT.html">meta-extract</a>.  Thanks to Sol 
 Swords for requesting this feature.</p> 
 
 <p>The utility <span class="v">meta-extract-global-fact</span> is now a macro, which expands to 
 a corresponding call of the new function, <span class="v">meta-extract-global-fact+</span>. 
 This new function takes an alternate, extra <a href="ACL2____STATE.html">state</a> as an argument; it is 
 not to be executed, and it operates on the alternate state, whose logical 
 <a href="ACL2____WORLD.html">world</a> is intended to be the same as that of the ``live'' (usual) 
 state.</p> 
 
 <p>A new sort of value for the <span class="v">obj</span> argument is supported for 
 <span class="v">meta-extract-global-fact</span> (and <span class="v">meta-extract-global-fact+</span>), which 
 results in a term equating a function application to its result.  See <a href="ACL2____META-EXTRACT.html">meta-extract</a>, in particular the discussion of <span class="v">:fncall</span>.</p>
</blockquote> 
 
 <p>It is now possible for <span class="v">trace$</span> to avoid printing prefixes of the form 
 <span class="v">"n&gt; "</span> and <span class="v">"&lt;n "</span>, while also (optionally) avoiding indentation. 
 See <a href="ACL2____TRACE_42.html">trace$</a>, in particular the discussion of <span class="v">:fmt!</span>.  Thanks to 
 Shilpi Goel for requesting this feature.</p> 
 
 <p>It was possible for the <a href="ACL2____GUARD-DEBUG.html">guard-debug</a> feature to generate duplicate 
 calls of <span class="v">extra-info</span> in hypotheses generated for guard verification.  We 
 have eliminated duplicates of this sort.</p> 
 
 <p>When <span class="tt"><a href="ACL2____IN-THEORY.html">in-theory</a></span> returns without error, it returns a value 
 <span class="v">(:NUMBER-OF-ENABLED-RUNES k)</span>, where <span class="v">k</span> is the length of the new 
 current theory.  (Formerly, <span class="v">k</span> was returned.)  This value is thus printed 
 when an <span class="v">in-theory</span> event is submitted at the top level.  Thanks to Gisela 
 Rossi for feedback that led us to make this change.</p> 
 
 <p>A new keyword parameter for <span class="tt"><a href="ACL2____LD.html">ld</a></span> is <span class="v">:ld-missing-input-ok</span>.  Its 
 default value is <span class="v">nil</span>, which causes an error, as before, upon failure to 
 open a specified file.  Other legal values are <span class="v">t</span> and <span class="v">:WARN</span>; see 
 <a href="ACL2____LD-MISSING-INPUT-OK.html">ld-missing-input-ok</a> and see <a href="ACL2____LD.html">ld</a>.</p> 
 
 <p>Extended <span class="v">*acl2-exports*</span>, in particular adding <span class="v">UNSIGNED-BYTE-P</span> and 
 <span class="v">SIGNED-BYTE-P</span> (thanks to a suggestion by Jared Davis)</p> 
 
 <p>Even if the function <span class="v">f</span> is defined to take one or more <a href="ACL2____STOBJ.html">stobj</a> 
 arguments, the form <span class="v">(<a href="ACL2____EC-CALL.html">ec-call</a> (f ...))</span> is now legal if all arguments of 
 the call of <span class="v">f</span> are non-stobj objects, in any context where only ordinary 
 object return values are expected.</p> 
 
 <p>When the second argument of <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> is a symbol, that symbol 
 formerly needed to be <span class="v">?</span> or <span class="v">t</span>, in the <span class="v">"ACL2"</span> package.  Now, 
 the <a href="ACL2____SYMBOL-PACKAGE-NAME.html">symbol-package-name</a> of the second argument is ignored: any symbol 
 whose <a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a> is <span class="v">"?"</span> or <span class="v">"T"</span> is treated the same in 
 that argument position as the symbol <span class="v">?</span> or <span class="v">t</span> in the <span class="v">"ACL2"</span> 
 package, respectively.  Thanks to Warren Hunt and Nathan Wetzler for 
 suggesting consideration of a more relaxed criterion for that second 
 argument.</p> 
 
 <p>(For system hackers, not standard ACL2 users:) Utilities <span class="tt"><a href="ACL2____INITIALIZE-EVENT-USER.html">initialize-event-user</a></span> and <span class="tt"><a href="ACL2____FINALIZE-EVENT-USER.html">finalize-event-user</a></span> now each take a list of 
 three arguments, <span class="v">(<a href="ACL2____CTX.html">ctx</a> body state)</span>.  Thanks to Harsh Raju Chamarthi for 
 requesting this change.</p> 
 
 <p><b>NEW FEATURES</b></p> 
 
 <p>It is now permissible to specify a <a href="ACL2____STOBJ.html">stobj</a> field that is itself either 
 a stobj or an array of stobjs.  A new primitive, <span class="tt"><a href="ACL2____STOBJ-LET.html">stobj-let</a></span>, is 
 provided in order to access or update such fields; see <a href="ACL2____STOBJ-LET.html">stobj-let</a>. 
 Thanks to Warren Hunt and Sol Swords for requesting the ability to specify 
 nested stobjs.</p> 
 
 <p>New accessor function <span class="v">(<a href="ACL2____MFC-WORLD.html">mfc-world</a> mfc)</span> returns the world component of a 
 metafunction context.  See <a href="ACL2____EXTENDED-METAFUNCTIONS.html">extended-metafunctions</a>.</p> 
 
 <p>A new <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> keyword, <span class="v">:SPLIT-TYPES</span>, can be used to ``split'' 
 the <a href="COMMON-LISP____TYPE.html">type</a> declarations from the <a href="ACL2____GUARD.html">guard</a> in the following sense.  By 
 default, or when <span class="v">:SPLIT-TYPES</span> has value <span class="v">nil</span>, one gets the existing 
 behavior: the terms corresponding to type declarations are conjoined into the 
 guard.  However, if <span class="v">:SPLIT-TYPES t</span> is specified, then that is not the 
 case; instead, guard verification will require that these terms are proved 
 under the hypothesis that the guard holds.  In this way, one can add type 
 declarations to assist the host Lisp compiler without cluttering the 
 function's guard.  See <a href="ACL2____XARGS.html">xargs</a>.  Thanks to Jared Davis for requesting 
 this feature.</p> 
 
 <p>Advanced users may want to see <a href="ACL2____QUICK-AND-DIRTY-SUBSUMPTION-REPLACEMENT-STEP.html">quick-and-dirty-subsumption-replacement-step</a> for a way to turn off a prover 
 heuristic.  Thanks to those who have mentioned to us potential issues with 
 this heuristic, most recently Dave Greve.</p> 
 
 <p><b>HEURISTIC IMPROVEMENTS</b></p> 
 
 <p>We made changes to the ``ancestors check'' heuristic (source function 
 <span class="v">ancestors-check-builtin</span>), as follows.</p> 
 
 <blockquote> 
 
 <p>The heuristic could prevent a <a href="ACL2____REWRITE.html">rewrite</a> rule's hypothesis from being 
 rewritten to true, even when that hypothesis is of the form <span class="v">(<a href="ACL2____FORCE.html">force</a>
 &lt;term&gt;)</span>.  Now, forcing will take place as expected; see <a href="ACL2____FORCE.html">force</a>. 
 Thanks to Robert Krug for bringing this issue to our attention and sending an 
 example, which we include as a comment in the ACL2 source code (see 
 <span class="v">(<a href="ACL2____DEFLABEL.html">deflabel</a> note-6-2 ...)</span>).</p> 
 
 <p>The heuristic is now delayed until after we check whether the hypothesis is 
 already known, using <a href="ACL2____TYPE-SET.html">type-set</a> reasoning alone (in particular, not using 
 rewriting), to be true or to be false.  We believe that this is now the 
 ``right'' order for those two operations.  We saw a slight speed up in the 
 regression tests (about a percent) with this change, but that might be in the 
 noise.</p> 
 
 <p>A technical change makes the heuristic slightly less aggressive in 
 preventing backchaining.  Roughly speaking, ordering checks based on function 
 symbol counts could suffice to permit backchaining, where now variable counts 
 also suffice.  Thanks to Robert Krug for showing us an example where 
 backchaining led to a term with no free variables that was nevertheless 
 subject to the ancestors check, preventing it from being rewritten.</p> 
 
 <p>(For those who use <span class="tt"><a href="ACL2____DEFATTACH.html">defattach</a></span> to attach to <span class="v">ancestors-check</span>) We 
 have used <span class="v">defrec</span> to introduce an `<span class="v">ancestor</span>' data structure.  A new 
 function, <span class="v">strip-ancestor-literals</span>, should be used to obtain the literals 
 from a list of ancestors, although <span class="v">strip-cars</span> will still work at this 
 time.</p>
</blockquote> 
 
 <p>When we rewrite the current literal of the current clause we assume the 
 falsity of the other literals and of the conclusions produced by forward 
 chaining.  We have changed the order in which those assumptions are made, 
 which affects the type-alist used during rewriting.  This has three effects: 
 the new type-alist, which is sometimes stronger than the old one, may allow 
 additional rules to fire, the choice of free vars may be different, and the 
 order of the literals in forced subgoals may be different.  Should ``legacy'' 
 proofs fail under the new type-alist, we recommend looking for rules that are 
 fired in the new proof that were not fired (on that same subgoal) in the old 
 one.  Thanks to Dave Greve for sending us an example that led us to make this 
 change.</p> 
 
 <p><b>BUG FIXES</b></p> 
 
 <p>We fixed a soundness bug that could be exploited by calling system 
 functions <span class="v">acl2-magic-mfc</span> or <span class="v">acl2-magic-canonical-pathname</span>.  Thanks 
 to Sol Swords for bringing this bug to our attention.</p> 
 
 <p>We fixed a soundness bug in the handling of <a href="ACL2____STOBJ.html">stobj</a>s, in which strings 
 were recognized as stobjs in raw Lisp.  Thanks to Jared Davis for sending us a 
 proof of <span class="v">nil</span> that exploited this bug.  We now have a much simpler example 
 of this bug, as follows.</p> 
 
 <pre class="code">(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st fld)
(<a href="ACL2____DEFTHM.html">defthm</a> bad (<a href="ACL2____STP.html">stp</a> "abc") :rule-classes nil)
(<a href="ACL2____DEFTHM.html">defthm</a> contradiction
  nil
  :hints (("Goal" :in-theory (<a href="ACL2____DISABLE.html">disable</a> (<a href="ACL2____STP.html">stp</a>)) :use bad))
  :rule-classes nil)</pre> 
 
 <p>We fixed bugs in extended metafunctions (see <a href="ACL2____EXTENDED-METAFUNCTIONS.html">extended-metafunctions</a>).  The macro <span class="v">mfc-ap</span> no longer takes a 
 <span class="v">:TTREEP</span> keyword argument, because this argument could allow returning a 
 tag tree that does not properly account for forcing.  The remaining 
 <span class="v">mfc-xx</span> macros — <span class="v">mfc-relieve-hyp</span>, <span class="v">mfc-rw+</span>, <span class="v">mfc-rw</span>, 
 and <span class="v">mfc-ts</span> — still take a <span class="v">:TTREEP</span> keyword argument, but the 
 corresponding functions when <span class="v">:TTREEP</span> is <span class="v">t</span> — 
 <span class="v">mfc-relieve-hyp-ttree</span>, <span class="v">mfc-rw+-ttree</span>, <span class="v">mfc-rw-ttree</span>, and 
 <span class="v">mfc-ts-ttree</span> — were introduced with incorrect output signatures.  A 
 complication is that <span class="v">mfc-relieve-hyp-ttree</span> was improperly defined in raw 
 Lisp in a way that actually matched the incorrect signature!  All of these 
 bugs have been fixed.  Perhaps any of them could have made it possible to 
 prove <span class="v">nil</span>, though we have not tried to do so.</p> 
 
 <p>(Windows only) On Windows, it had been possible for ACL2 not to consider 
 two pathnames to name the same file when the only difference is the case of 
 the drive, e.g., `<span class="v">C:</span>' vs. `<span class="v">c:</span>'.  This has been fixed.  Thanks to Sol 
 Swords for reporting this issue.</p> 
 
 <p>Fixed a bug in the storing of rules for the tau system; see <a href="ACL2____TAU-SYSTEM.html">tau-system</a>.  (The error message mentions 
 PARTITION-SIGNATURE-HYPS-INTO-TAU-ALIST-AND-OTHERS.)  Thanks to Sol Swords for 
 reporting this bug and sending a simple example to illustrate it.</p> 
 
 <p>It had been possible to admit the missing <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> events printed by 
 <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span>, and yet get an error when subsequently submitting the 
 same <span class="v">defabsstobj</span> event, stating: ``Note discrepancy with existing 
 formula''.  The problem could occur when an expression of the form <span class="v">(<a href="COMMON-LISP____OR.html">or</a> X
 Y)</span> occurred in one of those missing events, because ACL2 created it from the 
 term <span class="v">(<a href="COMMON-LISP____IF.html">if</a> X 't Y)</span> but then translated <span class="v">(<a href="COMMON-LISP____OR.html">or</a> X Y)</span> to <span class="v">(<a href="COMMON-LISP____IF.html">if</a> X X Y)</span>, 
 resulting in a mismatch.  This has been fixed.  Thanks to Jared Davis for 
 reporting this bug using a simple example.</p> 
 
 <p>A hard Lisp error was possible for certain illegal functional substitutions 
 (see <a href="ACL2____LEMMA-INSTANCE.html">lemma-instance</a>).  Thanks to Sol Swords for reporting this bug.</p> 
 
 <p>We fixed a bug in the case that an exported function of a <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span> event had a <a href="ACL2____GUARD.html">guard</a> of <span class="v">t</span>.  Thanks to Jared Davis for 
 sending a simple example when reporting this bug.</p> 
 
 <p>We now avoid an infinite loop that could occur when attempting to close the 
 standard character output channel (see <a href="ACL2____STANDARD-CO.html">standard-co</a>).  Instead, an error 
 message explains how to accomplish what was probably intended.  Thanks to 
 Shilpi Goel for bringing this issue to our attention.</p> 
 
 <p>(Windows only) Fixed a bug that was causing a hard error on Windows when 
 ACL2 encountered filenames starting with the tilde character (<span class="v">~</span>), for 
 example, <span class="v">(<a href="ACL2____LD.html">ld</a> "~/acl2-customization.lsp")</span>.  Thanks to Sol Swords for 
 bringing this bug to our attention.  Also thanks to Harsh Raju Chamarthi for a 
 useful conversation that led to a better fix than our first one.</p> 
 
 <p><b>CHANGES AT THE SYSTEM LEVEL</b></p> 
 
 <p>ACL2 may now be built on recent versions of a new host Lisp, ANSI Gnu 
 Common Lisp (GCL).  Traditional (non-ANSI) GCL was the original host Lisp 
 underlying ACL2, and we are grateful for GCL support that we received from the 
 late Bill Schelter and, more recently and particularly for ANSI GCL, from Camm 
 Maguire.</p> 
 
 <p>The `make' process suggested for book certification has changed 
 substantially, thanks in large part to contributions from Jared Davis and Sol 
 Swords.  We have seen the new process provide better performance on machines 
 with many cores, and we expect maintenance advantages such as eliminating the 
 need for Makefiles in individual book directories.  The ``classic'' process, 
 which was based on community books file <span class="v">books/Makefile-generic</span>, is still 
 supported (see <a href="ACL2____BOOKS-CERTIFICATION-CLASSIC.html">books-certification-classic</a>) but may disappear in a 
 future release of ACL2.  See <a href="ACL2____BOOKS-CERTIFICATION.html">books-certification</a>.  Most changes should 
 be invisible to the user, other than improved `make'-level parallelism, with 
 the exception of the following.</p> 
 
 <blockquote>
<p>o Variable <span class="v">ACL2_JOBS</span> is no longer supported, nor is it 
 necessary; simply use `make' option `-j' instead.</p> 
 
 <p>o Regressions now use `make' option <span class="v">-k</span> by default, which causes the 
 regression to keep going after errors, rather than <span class="v">-i</span>, which ignores 
 errors.  If you encounter problems because of this change, use 
 <span class="v">ACL2_IGNORE=-i</span> with your `make' command.</p> 
 
 <p>o The `regression' target works for the experimental extension, ACL2(h) 
 (see <a href="ACL2____HONS-AND-MEMOIZATION.html">hons-and-memoization</a>); target `regression-hons' no longer 
 exists.</p>
</blockquote> 
 
 <p>Please let us know if you run into problems with the new infrastructure, as 
 we consider the legacy infrastructure to be deprecated and we will probably 
 eliminate much of it in the future.  In particular, circular dependencies were 
 formerly prohibited at the directory level, but that is no longer the case, 
 and we expect such cycles to occur in the future.</p> 
 
 <p>Although ACL2 users don't typically modify raw Lisp variables, we have 
 arranged to reset Lisp variable <span class="v">*default-pathname-defaults*</span> if necessary 
 at startup so that it will not interfere with ACL2, in particular by messing 
 up the initial connected book directory (see <a href="ACL2____CBD.html">cbd</a>).  Thanks to Jared 
 Davis, Sol Swords, and Raymond Toy for helping us to identify this issue.</p> 
 
 <p><b>EMACS SUPPORT</b></p> 
 
 <p><b>EXPERIMENTAL/ALTERNATE VERSIONS</b></p> 
 
 <p>In ACL2(h), <span class="tt"><a href="ACL2____PRINT-OBJECT_42.html">print-object$</a></span> no longer uses the serialize printer 
 except in system applications as before (e.g., write out <span class="v">.cert</span> files). 
 Thanks to Dave Greve for bringing this issue to our attention.</p> 
 
 <p>Jared Davis contributed changes related to the <span class="tt"><a href="ACL2____MEMOIZE.html">memoize</a></span> utility of 
 ACL2(h), including some low-level changes as well as the following.</p> 
 
 <p>o <span class="tt"><a href="ACL2____NEVER-MEMOIZE.html">Never-memoize</a></span> specifies that a given function should never be 
 memoized.</p> 
 
 <p>o Removed <span class="v">memoize-let</span>, which may never have ever been used.</p> 
 
 <p>o Removed the <span class="v">:inline</span> keyword option to memoize, which was just an 
   alias for the <span class="v">:recursive</span> option.</p> 
 
 <p>For ACL2(p), some anomalous behavior may no longer occur because prover 
 calls (more specifically, trips through the ACL2 ``waterfall'') will return 
 only after all sub-computations (threads) have finished.  Thanks to David 
 Rager for contributing this improvement.</p> 
 
 <p>ACL2(pr), which includes <a href="ACL2____PARALLELISM.html">parallelism</a> (as for ACL2(p)) and 
 non-standard analysis support for the <a href="COMMON-LISP____REAL.html">real</a>s (as for ACL2(r)), now 
 builds and can certify the community <span class="v">nonstd/</span> books.  Thanks to David 
 Rager for his contribution to this capability.</p>
</body>
</html>
