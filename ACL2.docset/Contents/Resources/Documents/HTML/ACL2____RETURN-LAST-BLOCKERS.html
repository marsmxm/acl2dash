<html>
<head>
<meta charset="UTF-8">
<title>ACL2::return-last-blockers</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____RETURN-LAST-BLOCKERS">Click for ACL2::return-last-blockers in the Full Manual</a></h3>

<p>Functions and rules for <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span> and other macros implemented with <span class="tt"><a href="ACL2____RETURN-LAST.html">return-last</a></span>.</p><p><b>Summary</b>.  The theory named <span class="v">return-last-blockers</span>, in the 
 <span class="v">"ACL2"</span> package, contains <a href="ACL2____RUNE.html">ACL2::rune</a>s that can be <a href="ACL2____DISABLE.html">disable</a>d 
 to preserve calls of certain special operators — including <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span>, <span class="tt"><a href="ACL2____MBE.html">mbe</a></span>, <span class="tt"><a href="ACL2____TIME_42.html">time$</a></span>, and others — when invoking the 
 <a href="APT____SIMPLIFY.html">simplify</a> transformation.  Included are the definition runes for 
 corresponding functions <span class="v">acl2::prog2$-fn</span>, <span class="v">acl2::mbe-fn</span>, 
 <span class="v">acl2::time$-fn</span>.  This is all explained further below.</p> 
 
 <p>The ACL2 system makes use of many special macros that are implemented using 
 an operator, <span class="tt"><a href="ACL2____RETURN-LAST.html">return-last</a></span>, that provides special behavior in the 
 underlying Lisp implementation.  These include <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span>, <span class="tt"><a href="ACL2____TIME_42.html">time$</a></span>, 
 <span class="tt"><a href="ACL2____MBE.html">mbe</a></span>, and several others.  Evaluate the form <span class="v">(<a href="ACL2____TABLE.html">table</a>
 return-last-table)</span> to get an idea of what they are, for example as follows 
 (comments added).</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____TABLE.html">table</a> return-last-table)
 ((TIME$1-RAW . TIME$1) ; time$
  (WITH-PROVER-TIME-LIMIT1-RAW . WITH-PROVER-TIME-LIMIT1) ; with-prover-time-limit
  (WITH-FAST-ALIST-RAW . WITH-FAST-ALIST) ; with-fast-alist
  (WITH-STOLEN-ALIST-RAW . WITH-STOLEN-ALIST) ; with-stolen-alist
  (FAST-ALIST-FREE-ON-EXIT-RAW . FAST-ALIST-FREE-ON-EXIT) ; fast-alist-free-on-exit
  (<a href="COMMON-LISP____PROGN.html">PROGN</a> . PROG2$) ; prog2$
  (MBE1-RAW . MBE1) ; mbe
  (EC-CALL1-RAW . EC-CALL1) ; ec-call
  (WITH-GUARD-CHECKING1-RAW . WITH-GUARD-CHECKING1)) ; with-guard-checking
ACL2 !&gt;</pre> 
 
 <p>For each such operator <span class="v">op</span> (those in the comments just above), the 
 <span class="v">"simplify"</span> book defines a ``return-last blocker'' function, <span class="v">op-fn</span>, 
 that is obtained by adding the suffix <span class="v">"-FN"</span> to its name.  For example, 
 corresponding to <span class="v">prog2$</span> is a function, <span class="v">prog2$-fn</span>.  Each such 
 function is defined logically to return the second of its two arguments, and 
 thus it agrees logically with the corresponding macro; for example, 
 <span class="v">(prog2$-fn x y)</span> is provably equal to <span class="v">y</span> and hence also to <span class="v">(<a href="ACL2____PROG2_42.html">prog2$</a>
 x y)</span>.</p> 
 
 <p>The theory named <span class="v">return-last-blockers</span>, in the <span class="v">"ACL2"</span> package, 
 contains three rules for each return-last blocker: its <a href="ACL2____DEFINITION.html">ACL2::definition</a> 
 rule, its <a href="ACL2____EXECUTABLE-COUNTERPART.html">ACL2::executable-counterpart</a> rule, and its <a href="ACL2____TYPE-PRESCRIPTION.html">ACL2::type-prescription</a> rule.  These rules are all <a href="ACL2____ENABLE.html">enable</a>d by 
 default.</p> 
 
 <p><span class="tt"><a href="ACL2____RETURN-LAST.html">Return-last</a></span> is in a class of operators, <a href="ACL2____GUARD-HOLDERS.html">ACL2::guard-holders</a>, 
 whose calls are typically expanded before a rule or a ``<a href="ACL2____NORMALIZE.html">ACL2::normalize</a>d'' definition body is stored.  This can be unfortunate for 
 simplification if one intends to preserve the special behavior afforded by the 
 operator, such as <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span> or <span class="tt"><a href="ACL2____TIME_42.html">time$</a></span>, that generated that use of 
 <span class="v">return-last</span>.  The following edited log shows that by disabling blockers 
 one can get the desired result in such cases.</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (n) (<a href="ACL2____TIME_42.html">time$</a> (<a href="COMMON-LISP____REVERSE.html">reverse</a> (<a href="COMMON-LISP____MAKE-LIST.html">make-list</a> n))))
[[.. output elided ..]]
 FOO
ACL2 !&gt;(<a href="APT____SIMPLIFY.html">simplify</a> foo)
; Notice that the time$ call has been eliminated!
(<a href="COMMON-LISP____DEFUN.html">DEFUN</a> FOO$1 (N)
       (<a href="COMMON-LISP____DECLARE.html">DECLARE</a> (<a href="ACL2____XARGS.html">XARGS</a> :GUARD T :VERIFY-GUARDS NIL))
       (<a href="ACL2____REPEAT.html">REPEAT</a> N NIL))
(<a href="ACL2____DEFTHM.html">DEFTHM</a> FOO-BECOMES-FOO$1 (<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (FOO N) (FOO$1 N)))
ACL2 !&gt;:u ; Undo and try again, this time to preserve the time$ call.
 L         3:x(<a href="COMMON-LISP____DEFUN.html">DEFUN</a> FOO (N) ...)
ACL2 !&gt;(<a href="APT____SIMPLIFY.html">simplify</a> foo

; Disable time$-fn to preserve the time$ call.  It might be good to disabled
; associated runes (:e time$-fn) and (:t time$-fn) as well, but in this case,
; at least, that wasn't necessary.

                 :disable (time$-fn))
(<a href="COMMON-LISP____DEFUN.html">DEFUN</a> FOO$1 (N)
       (<a href="COMMON-LISP____DECLARE.html">DECLARE</a> (<a href="ACL2____XARGS.html">XARGS</a> :GUARD T :VERIFY-GUARDS NIL))
       (<a href="ACL2____TIME_42.html">TIME$</a> (<a href="ACL2____REPEAT.html">REPEAT</a> N NIL)))
(<a href="ACL2____DEFTHM.html">DEFTHM</a> FOO-BECOMES-FOO$1 (<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (FOO N) (FOO$1 N)))
ACL2 !&gt;</pre>
</body>
</html>
