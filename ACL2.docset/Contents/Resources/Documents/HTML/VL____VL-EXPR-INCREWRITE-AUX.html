<html>
<head>
<meta charset="UTF-8">
<title>Vl-expr-increwrite-aux</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=VL____VL-EXPR-INCREWRITE-AUX">Click for Vl-expr-increwrite-aux in the Full Manual</a></h3>

<p>Core routine for eliminating increment, decrement, and assignment 
            expressions.  Doesn't try to defend against ambiguities.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(vl-expr-increwrite-aux x pre post loc) → (mv new-x pre post)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">x</span> — Expression to rewrite.  May contain increments, decrements, or 
            assignment expressions.<br>    <font color="#606060">Guard <span class="v">(<a href="VL____VL-EXPR-P.html">vl-expr-p</a> x)</span>.</font>
</dd> 
  <dd>
<span class="tt">pre</span> — Accumulator.  List of assignment statements that should be done 
            "before" the rewritten expression.  Backwards from the order 
            in which they should occur.  This is subtle, see below.<br>    <font color="#606060">Guard <span class="v">(<a href="VL____VL-STMTLIST-P.html">vl-stmtlist-p</a> pre)</span>.</font>
</dd> 
  <dd>
<span class="tt">post</span> — Accumulator.  List of assignment statements that should be done 
            "after" the rewritten expression.  Order is probably not 
            important assuming no ambiguities.<br>    <font color="#606060">Guard <span class="v">(<a href="VL____VL-STMTLIST-P.html">vl-stmtlist-p</a> post)</span>.</font>
</dd> 
  <dd>
<span class="tt">loc</span> — Location to use for new assignments.<br>    <font color="#606060">Guard <span class="v">(<a href="VL____VL-LOCATION-P.html">vl-location-p</a> loc)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">new-x</span> — Rewritten version of <span class="v">x</span>, free of increment, decrement, and 
                assignment operators.  Equivalent to <span class="v">x</span> assuming that: 
                (1) the pre-increment stuff is done first, (2) the 
                post-increment stuff is done afterwards, and (3) there are no 
                ambiguities.<br>    <font color="#606060">Type <span class="v">(<a href="VL____VL-EXPR-P.html">vl-expr-p</a> new-x)</span>.</font>
</dd> 
<dd>
<span class="tt">pre</span> — <font color="#606060">Type <span class="v">(<a href="VL____VL-STMTLIST-P.html">vl-stmtlist-p</a> pre)</span>.</font>
</dd> 
<dd>
<span class="tt">post</span> — <font color="#606060">Type <span class="v">(<a href="VL____VL-STMTLIST-P.html">vl-stmtlist-p</a> post)</span>.</font>
</dd> 
 
</dl></div> 
<p>Note that the ordering of pre/post is subtle.  These are true 
           accumulators.  They need to be reversed and then processed in the 
           resulting order.  This is important to correctly handle things 
           like:</p> 
 
           <pre class="code">lhs1 = (a=(b=(c=0)));</pre> 
 
           <p>In particular, we first recur down all the way to the <span class="v">(c=0)</span> 
           term and cons that assignment onto PRE.  Then as we unwind we cons 
           <span class="v">(b=c)</span> onto PRE, and then finally <span class="v">(a=b)</span>. So, the resulting 
           PRE assignments we produce are in backwards order, and they need to 
           be reversed before we use them.</p> 
 
           <p>Note that all fancy assignment-expression operators like <span class="v">+=</span>, 
           <span class="v">*=</span>, etc., as well as the ordinary <span class="v">=</span> operator and act like 
           pre-increment operators, i.e., they act like <span class="v">++a</span> instead of 
           <span class="v">a++</span>, and hence contribute to the list of PRE assignments.  So 
           the situation for</p> 
 
           <pre class="code">lhs2 = (a += (b *= (c = 0))) ;</pre> 
 
           <p>is much like the above: we push onto PRE first <span class="v">c=0</span>, then 
           <span class="v">b=b*c</span>, then finally <span class="v">a=a+b</span>, and it is critical that these 
           be processed in the correct order.</p> 
 
           <p>The only post operators are <span class="v">a++</span> and <span class="v">a--</span>.  These can't 
           be chained together in the same way as the pre-operators, so it 
           seems unlikely that the order really matters.  For instance, if we 
           have an expression like:</p> 
 
           <pre class="code">lhs3 = a++ * b++ * c++;</pre> 
 
           <p>then it's fine to do the post-increments in any order.</p> 
 

</body>
</html>
