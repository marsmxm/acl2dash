<html>
<head>
<meta charset="UTF-8">
<title>Atj-gen-shallow-fndef-method</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=JAVA____ATJ-GEN-SHALLOW-FNDEF-METHOD">Click for Atj-gen-shallow-fndef-method in the Full Manual</a></h3>

<p>Generate a Java method with the given types 
          for an ACL2 function definition.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(atj-gen-shallow-fndef-method 
     fn fns-that-may-throw 
     fn-type formals body method-name 
     qconsts pkg-class-names fn-method-names 
     curr-pkg mv-typess guards$ wrld) 
 
  → 
(mv method new-qconsts new-mv-typess)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">fn</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn)</span>.</font>
</dd> 
  <dd>
<span class="tt">fns-that-may-throw</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> fns-that-may-throw)</span>.</font>
</dd> 
  <dd>
<span class="tt">fn-type</span> — <font color="#606060">Guard <span class="v">(<a href="JAVA____ATJ-FUNCTION-TYPE-P.html">atj-function-type-p</a> fn-type)</span>.</font>
</dd> 
  <dd>
<span class="tt">formals</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> formals)</span>.</font>
</dd> 
  <dd>
<span class="tt">body</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> body)</span>.</font>
</dd> 
  <dd>
<span class="tt">method-name</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____STRINGP.html">stringp</a> method-name)</span>.</font>
</dd> 
  <dd>
<span class="tt">qconsts</span> — <font color="#606060">Guard <span class="v">(<a href="JAVA____ATJ-QCONSTANTS-P.html">atj-qconstants-p</a> qconsts)</span>.</font>
</dd> 
  <dd>
<span class="tt">pkg-class-names</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____STRING-STRING-ALISTP.html">string-string-alistp</a> pkg-class-names)</span>.</font>
</dd> 
  <dd>
<span class="tt">fn-method-names</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____SYMBOL-STRING-ALISTP.html">symbol-string-alistp</a> fn-method-names)</span>.</font>
</dd> 
  <dd>
<span class="tt">curr-pkg</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____STRINGP.html">stringp</a> curr-pkg)</span>.</font>
</dd> 
  <dd>
<span class="tt">mv-typess</span> — <font color="#606060">Guard <span class="v">(<a href="JAVA____ATJ-TYPE-LIST-LISTP.html">atj-type-list-listp</a> mv-typess)</span>.</font>
</dd> 
  <dd>
<span class="tt">guards$</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> guards$)</span>.</font>
</dd> 
  <dd>
<span class="tt">wrld</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PLIST-WORLDP.html">plist-worldp</a> wrld)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">method</span> — <font color="#606060">Type <span class="v">(<a href="JAVA____JMETHODP.html">jmethodp</a> method)</span>.</font>
</dd> 
<dd>
<span class="tt">new-qconsts</span> — <font color="#606060">Type <span class="v">(<a href="JAVA____ATJ-QCONSTANTS-P.html">atj-qconstants-p</a> new-qconsts)</span>, given <span class="v">(<a href="JAVA____ATJ-QCONSTANTS-P.html">atj-qconstants-p</a> qconsts)</span>.</font>
</dd> 
<dd>
<span class="tt">new-mv-typess</span> — <font color="#606060">Type <span class="v">(<a href="COMMON-LISP____AND.html">and</a> (<a href="JAVA____ATJ-TYPE-LIST-LISTP.html">atj-type-list-listp</a> new-mv-typess) (<a href="ACL2____CONS-LISTP.html">cons-listp</a> new-mv-typess))</span>.</font>
</dd> 
 
</dl></div> 
<p>In the shallow embedding approach, 
     each ACL2 function definition is turned into a Java method. 
     This is a public static method 
     with the same number of parameters as the ACL2 function. 
     More precisely, we generate an overloaded method 
     for each primary and secondary function type associated to the function 
     via <span class="tt"><a href="JAVA____ATJ-MAIN-FUNCTION-TYPE.html">atj-main-function-type</a></span> 
     and <span class="tt"><a href="JAVA____ATJ-OTHER-FUNCTION-TYPE.html">atj-other-function-type</a></span>.</p><p>This function generates one such method, 
     based on the (primary or secondary) function type passed as input. 
     First, we pre-translate the function. 
     Then, we translate the pre-translated function to a Java method. 
     Finally, we post-translate the Java method.</p><p>We also collect all the quoted constants 
     in the pre-translated function body, 
     and add it to the collection that it threaded through.</p><p>The formals and body of the function, as well as the method name, 
     are the same for all the overloaded methods, 
     so they are calculated once and passed to this function. 
     However, the generation of the Java method 
     (pre-translation, translation, and post-translation) 
     must be done afresh for each overloaded methods, 
     because it is affected by the function types, 
     which are turned into the method's argument and result types: 
     with different types, 
     there may be different type annotations, 
     and in particular different type conversions. 
     In fact, it is expected that, with narrower types, 
     there will be fewer type conversions. 
     The pre-translation steps before the type annotation step 
     could be actually factored out and done once, 
     but for greater implementation simplicity here we repeat them 
     for every overloaded method.</p><p>We collect all the <span class="tt"><a href="ACL2____MV.html">mv</a></span> types in the body 
     for which we will need to generate <span class="tt"><a href="ACL2____MV.html">mv</a></span> classes.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>atj-gen-shallow-fndef-method</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 atj-gen-shallow-fndef-method
 (fn fns-that-may-throw
     fn-type formals body method-name
     qconsts pkg-class-names fn-method-names
     curr-pkg mv-typess guards$ wrld)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn)
                             (<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> fns-that-may-throw)
                             (<a href="JAVA____ATJ-FUNCTION-TYPE-P.html">atj-function-type-p</a> fn-type)
                             (<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> formals)
                             (<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> body)
                             (<a href="COMMON-LISP____STRINGP.html">stringp</a> method-name)
                             (<a href="JAVA____ATJ-QCONSTANTS-P.html">atj-qconstants-p</a> qconsts)
                             (<a href="ACL2____STRING-STRING-ALISTP.html">string-string-alistp</a> pkg-class-names)
                             (<a href="ACL2____SYMBOL-STRING-ALISTP.html">symbol-string-alistp</a> fn-method-names)
                             (<a href="COMMON-LISP____STRINGP.html">stringp</a> curr-pkg)
                             (<a href="JAVA____ATJ-TYPE-LIST-LISTP.html">atj-type-list-listp</a> mv-typess)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> guards$)
                             (<a href="ACL2____PLIST-WORLDP.html">plist-worldp</a> wrld))))
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____NOT.html">not</a> (<a href="JAVA____AIJ-NATIVEP.html">aij-nativep</a> fn))
                             (<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> curr-pkg ""))
                             (<a href="ACL2____CONS-LISTP.html">cons-listp</a> mv-typess))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'atj-gen-shallow-fndef-method))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   ((in-types (<a href="JAVA____ATJ-FUNCTION-TYPE-_E3INPUTS.html">atj-function-type-&gt;inputs</a> fn-type))
    (out-types (<a href="JAVA____ATJ-FUNCTION-TYPE-_E3OUTPUTS.html">atj-function-type-&gt;outputs</a> fn-type))
    (out-arrays (<a href="JAVA____ATJ-FUNCTION-TYPE-_E3ARRAYS.html">atj-function-type-&gt;arrays</a> fn-type))
    ((unless (<a href="COMMON-LISP_____D3.html">=</a> (<a href="ACL2____LEN.html">len</a> in-types) (<a href="ACL2____LEN.html">len</a> formals)))
     (<a href="ACL2____RAISE.html">raise</a>
      "Internal error: ~
                the number ~x0 of parameters of ~x1 ~
                does not match the number ~x2 of input types of ~x1."
      (<a href="ACL2____LEN.html">len</a> formals)
      fn (<a href="ACL2____LEN.html">len</a> in-types))
     (<a href="ACL2____MV.html">mv</a> (<a href="ACL2____EC-CALL.html">ec-call</a> (<a href="JAVA____JMETHOD-FIX.html">jmethod-fix</a> :irrelevant))
         qconsts nil))
    ((unless (<a href="COMMON-LISP____CONSP.html">consp</a> out-types))
     (<a href="ACL2____RAISE.html">raise</a> "Internal error: no output types ~x0 for ~x1."
            out-types fn)
     (<a href="ACL2____MV.html">mv</a> (<a href="ACL2____EC-CALL.html">ec-call</a> (<a href="JAVA____JMETHOD-FIX.html">jmethod-fix</a> :irrelevant))
         qconsts nil))
    ((<a href="ACL2____MV.html">mv</a> formals body mv-typess)
     (<a href="JAVA____ATJ-PRE-TRANSLATE.html">atj-pre-translate</a> fn formals body in-types out-types
                        out-arrays mv-typess nil guards$ wrld))
    (qconsts (<a href="JAVA____ATJ-ADD-QCONSTANTS-IN-TERM.html">atj-add-qconstants-in-term</a> body qconsts))
    ((<a href="ACL2____MV.html">mv</a> formals &amp;)
     (<a href="JAVA____ATJ-UNMARK-VARS.html">atj-unmark-vars</a> formals))
    (<a href="ACL2____FORMALS.html">formals</a> (<a href="JAVA____ATJ-TYPE-UNANNOTATE-VARS.html">atj-type-unannotate-vars</a> formals))
    (method-params
        (<a href="JAVA____ATJ-GEN-PARAMLIST.html">atj-gen-paramlist</a> (<a href="ACL2____SYMBOL-NAME-LST.html">symbol-name-lst</a> formals)
                           (<a href="JAVA____ATJ-TYPE-LIST-TO-JITYPE-LIST.html">atj-type-list-to-jitype-list</a> in-types)))
    ((<a href="ACL2____MV.html">mv</a> body-block body-expr &amp;)
     (<a href="JAVA____ATJ-GEN-SHALLOW-TERM.html">atj-gen-shallow-term</a> body
                           "$tmp" 1 pkg-class-names fn-method-names
                           curr-pkg (<a href="JAVA____ATJ-QCONSTANTS-_E3PAIRS.html">atj-qconstants-&gt;pairs</a> qconsts)
                           guards$ wrld))
    (method-body (<a href="COMMON-LISP____APPEND.html">append</a> body-block (<a href="JAVA____JBLOCK-RETURN.html">jblock-return</a> body-expr)))
    (tailrecp (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____LOGICP.html">logicp</a> fn wrld)
                   (<a href="COMMON-LISP_____D3.html">=</a> 1 (<a href="ACL2____LEN.html">len</a> (<a href="ACL2____IRECURSIVEP.html">irecursivep</a> fn wrld)))
                   (<a href="ACL2____TAIL-RECURSIVE-P.html">tail-recursive-p</a> fn wrld)))
    (method-body
         (<a href="JAVA____ATJ-POST-TRANSLATE.html">atj-post-translate</a> method-name
                             method-params method-body tailrecp))
    ((unless (<a href="COMMON-LISP____CONSP.html">consp</a> out-types))
     (<a href="ACL2____RAISE.html">raise</a>
      "Internal error: ~
                the function ~x0 has no output types ~x1."
      fn out-types)
     (<a href="ACL2____MV.html">mv</a> (<a href="ACL2____EC-CALL.html">ec-call</a> (<a href="JAVA____JMETHOD-FIX.html">jmethod-fix</a> :irrelevant))
         qconsts nil))
    (out-jtype (<a href="JAVA____ATJ-GEN-SHALLOW-JTYPE.html">atj-gen-shallow-jtype</a> out-types))
    (throws (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____MEMBER-EQ.html">member-eq</a> fn fns-that-may-throw)
                 (<a href="COMMON-LISP____LIST.html">list</a> *aij-class-undef-pkg-exc*)))
    (method (<a href="JAVA____MAKE-JMETHOD.html">make-jmethod</a> :access (<a href="JAVA____JACCESS-PUBLIC.html">jaccess-public</a>)
                          :abstract? nil
                          :static? t
                          :final? nil
                          :synchronized? nil
                          :native? nil
                          :strictfp? nil
                          :result (<a href="JAVA____JRESULT-TYPE.html">jresult-type</a> out-jtype)
                          :name method-name
                          :params method-params
                          :throws throws
                          :body method-body)))
   (<a href="ACL2____MV.html">mv</a> method qconsts mv-typess))))</pre> 
<p><b>Theorem: </b>jmethodp-of-atj-gen-shallow-fndef-method.method</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> jmethodp-of-atj-gen-shallow-fndef-method.method
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> common-lisp::?method
                  ?new-qconsts ?new-mv-typess)
              (<a href="JAVA____ATJ-GEN-SHALLOW-FNDEF-METHOD.html">atj-gen-shallow-fndef-method</a>
                   fn fns-that-may-throw
                   fn-type formals body method-name
                   qconsts pkg-class-names fn-method-names
                   curr-pkg mv-typess guards$ wrld)))
            (<a href="JAVA____JMETHODP.html">jmethodp</a> method))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>atj-qconstants-p-of-atj-gen-shallow-fndef-method.new-qconsts</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> atj-qconstants-p-of-atj-gen-shallow-fndef-method.new-qconsts
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="JAVA____ATJ-QCONSTANTS-P.html">atj-qconstants-p</a> qconsts)
                 (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> common-lisp::?method
                           ?new-qconsts ?new-mv-typess)
                       (<a href="JAVA____ATJ-GEN-SHALLOW-FNDEF-METHOD.html">atj-gen-shallow-fndef-method</a>
                            fn fns-that-may-throw
                            fn-type formals body method-name
                            qconsts pkg-class-names fn-method-names
                            curr-pkg mv-typess guards$ wrld)))
                     (<a href="JAVA____ATJ-QCONSTANTS-P.html">atj-qconstants-p</a> new-qconsts)))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>return-type-of-atj-gen-shallow-fndef-method.new-mv-typess</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> return-type-of-atj-gen-shallow-fndef-method.new-mv-typess
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> common-lisp::?method
                  ?new-qconsts ?new-mv-typess)
              (<a href="JAVA____ATJ-GEN-SHALLOW-FNDEF-METHOD.html">atj-gen-shallow-fndef-method</a>
                   fn fns-that-may-throw
                   fn-type formals body method-name
                   qconsts pkg-class-names fn-method-names
                   curr-pkg mv-typess guards$ wrld)))
            (<a href="COMMON-LISP____AND.html">and</a> (<a href="JAVA____ATJ-TYPE-LIST-LISTP.html">atj-type-list-listp</a> new-mv-typess)
                 (<a href="ACL2____CONS-LISTP.html">cons-listp</a> new-mv-typess)))
        :rule-classes :rewrite)</pre> 

</body>
</html>
