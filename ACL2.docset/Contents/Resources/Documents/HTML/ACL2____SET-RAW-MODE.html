<html>
<head>
<meta charset="UTF-8">
<title>Set-raw-mode</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____SET-RAW-MODE">Click for Set-raw-mode in the Full Manual</a></h3>

<p>Enter or exit ``raw mode,'' a raw Lisp environment</p><p>Below we discuss raw-mode.  In brief: The simplest way to turn 
 raw-mode on is <span class="v">:SET-RAW-MODE-ON!</span>, and to turn it off, <span class="v">:SET-RAW-MODE
 NIL</span>.  Also see <a href="ACL2____SET-RAW-MODE-ON_12.html">set-raw-mode-on!</a>.</p> 
 
 <p>ACL2 users often find its careful syntax checking to be helpful during code 
 development.  Sometimes it is even useful to do code development in 
 <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode, where ACL2 can be used to check termination of 
 (mutually) recursive functions, verify guards, or even prove properties of the 
 functions.</p> 
 
 <p>However, loading code using <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> is much slower than using 
 Common Lisp <span class="v">load</span> in raw Lisp, and in this sense ACL2 can get in the way 
 of efficient execution.  Unfortunately, it is error-prone to use ACL2 sources 
 (or their compilations) in raw Lisp, primarily because a number of ACL2 
 primitives will not let you do so.  Perhaps you have seen this error message 
 when trying to do so:</p> 
 
 <pre class="code">HARD ACL2 ERROR in ACL2-UNWIND-PROTECT:  Apparently you have tried
to execute a form in raw Lisp that is only intended to be executed
inside the ACL2 loop.</pre> 
 
 <p>Even without this problem it is important to enter the ACL2 loop (see <a href="ACL2____LP.html">lp</a>), for example in order to set the <span class="tt"><a href="ACL2____CBD.html">cbd</a></span> and (to get more technical) 
 the readtable.</p> 
 
 <p>ACL2 provides a ``raw mode'' for execution of raw Lisp forms.  In this 
 mode, <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> reduces essentially to a Common Lisp <span class="v">load</span>. 
 More generally, the ACL2 logical <span class="tt"><a href="ACL2____WORLD.html">world</a></span> is not routinely extended in 
 raw mode (some sneaky tricks are probably required to make that happen).  To 
 turn raw mode off or on:</p> 
 
 <pre class="code">:set-raw-mode t   ; turn raw mode on
:set-raw-mode-on! ; same as above, but no trust tag required
:set-raw-mode nil ; turn raw mode off</pre> 
 
 <p>The way you can tell that you are in raw mode is by looking at the prompt 
 (see <a href="ACL2____DEFAULT-PRINT-PROMPT.html">default-print-prompt</a>), which uses a capital ``<span class="v">P</span>'' (suggesting 
 something like <a href="ACL2____PROGRAM.html">program</a> mode, but even further from <a href="ACL2____LOGIC.html">logic</a> 
 mode).</p> 
 
 <pre class="code">ACL2 P&gt;</pre> 
 
 <p>Typical benefits of raw mode are fast loading of source and compiled files 
 and the capability to hack arbitrary Common Lisp code in an environment with 
 the ACL2 sources loaded (and hence with ACL2 primitives available).  In 
 addition, ACL2 hard errors will put you into the Lisp debugger, rather than 
 returning you to the ACL2 loop, and this may be helpful for debugging; see 
 <a href="ACL2____HARD-ERROR.html">hard-error</a> and see <a href="ACL2____ILLEGAL.html">illegal</a>, but also see <a href="ACL2____BREAK-ON-ERROR.html">break-on-error</a> 
 and <a href="ACL2____BREAK_42.html">break$</a>.  However, it probably is generally best to avoid raw mode 
 unless these advantages seem important.  We expect the main benefit of raw 
 mode to be in deployment of applications, where raw Lisp code may be useful, 
 and where load time is much faster than the time required for a full-blown 
 <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>  but not that the fast loading of books and 
 treatment of hard errors discussed above may be useful during development.</p> 
 
 <p>Raw mode is also useful for those who want to build extensions of ACL2. 
 For example, the following form can be put into a certifiable book to load an 
 arbitrary Common Lisp source or compiled file.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____PROGN.html">progn</a> (<a href="ACL2____DEFTTAG.html">defttag</a> my-application)
       (<a href="ACL2____PROGN_12.html">progn!</a> (<a href="ACL2____SET-RAW-MODE.html">set-raw-mode</a> t)
               (load "some-file")))</pre> 
 
 <p>Also see <a href="ACL2____INCLUDE-RAW.html">include-raw</a> <a href="ACL2____WITH-RAW-MODE.html">with-raw-mode</a>, <a href="ACL2____DEFTTAG.html">defttag</a>, and <a href="ACL2____PROGN_12.html">progn!</a>.</p> 
 
 <p>Below are several disadvantages to using raw mode.  These should discourage 
 users from using it for general code development, as <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> 
 mode is generally preferable.</p> 
 
 <ul> 
 <li>Forms are in essence executed in raw Lisp.  Hence: 
     <ul> 
     <li>Syntax checking is turned off; and</li> 
     <li>Guard checking is completely disabled.</li> 
     </ul>
</li> 
 <li>Table events, including <span class="tt"><a href="ACL2____LOGIC.html">logic</a></span>, are ignored, as are many 
     other <span class="tt"><a href="ACL2____EVENTS.html">events</a></span>, including <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> and <span class="tt"><a href="ACL2____COMP.html">comp</a></span>.</li> 
 <li>Soundness claims are weakened for any ACL2 session in which raw 
     mode was ever entered; see <a href="ACL2____DEFTTAG.html">defttag</a>.</li> 
 <li>The normal undoing mechanism (see <a href="ACL2____UBT.html">ubt</a>) is not supported.</li> 
 <li>Unexpected behavior may occur when you return from raw-mode. 
    For example, if you redefine a :logic mode function whose guards 
    have not been verified, you will not see the change inside the 
    ACL2 loop because there, the raw Common Lisp definition is only 
    executed after guards have been verified; see <a href="ACL2____GUARDS-AND-EVALUATION.html">guards-and-evaluation</a> 
    and see <a href="ACL2____GUARD-EVALUATION-TABLE.html">guard-evaluation-table</a>.</li> 
 </ul> 
 
 <p>We conclude with some details.</p> 
 
 <p><i>Printing results</i>.  The rules for printing results are mostly 
 unchanged for raw mode, even to the point of attempting appropriate printing 
 for state and stobjs (though this is merely heuristic when the top-level 
 function is defined in raw mode), for example as follows.</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st fld)

Summary
Form:  ( DEFSTOBJ ST ...)
Rules: NIL
Time:  0.02 seconds (prove: 0.00, print: 0.00, other: 0.02)
 ST
ACL2 !&gt;(<a href="ACL2____SET-RAW-MODE-ON_12.html">set-raw-mode-on!</a>)

TTAG NOTE: Adding ttag :RAW-MODE-HACK from the top level loop.
ACL2 P&gt;(<a href="COMMON-LISP____DEFUN.html">defun</a> f (st) st)
F
ACL2 P&gt;(f st)
&lt;st&gt;
ACL2 P&gt;(<a href="COMMON-LISP____DEFUN.html">defun</a> g (st state) (<a href="ACL2____MV.html">mv</a> 3 st state))
G
ACL2 P&gt;(<a href="ACL2____G.html">g</a> st state)
(3 &lt;st&gt; &lt;state&gt;)
ACL2 P&gt;(<a href="COMMON-LISP____DEFUN.html">defun</a> h (<a href="ACL2____STATE.html">state</a>) (<a href="ACL2____MV.html">mv</a> nil 17 state))
H
ACL2 P&gt;(h state) ; notice the leading space; see below
 17
ACL2 P&gt;</pre> 
 
 <p>There is however one major exception.  If the value to be printed contains 
 any Lisp object that is not a legal ACL2 object, then the <span class="v">print</span> routine 
 is used from the host Lisp, rather than the usual ACL2 printing routine.  The 
 following example illustrates the printing used when an illegal ACL2 object 
 needs to be printed.  Notice how that ``command conventions'' are observed, as 
 indicated in the ``leading space'' comment above; see <a href="ACL2____LD-POST-EVAL-PRINT.html">ld-post-eval-print</a>.  In particular, the ``<span class="v">[Note</span>'' occurs one space over 
 in the second example, and no result is printed in the third example.</p> 
 
 <pre class="code">ACL2 P&gt;(find-package "ACL2")
[Note:  Printing non-ACL2 result.]
#&lt;The ACL2 package&gt;
ACL2 P&gt;(<a href="ACL2____MV.html">mv</a> nil (find-package "ACL2") state)
 [Note:  Printing non-ACL2 result.]
#&lt;The ACL2 package&gt;
ACL2 P&gt;(<a href="ACL2____MV.html">mv</a> t (find-package "ACL2") state)
ACL2 P&gt;(<a href="ACL2____MV.html">mv</a> 3 (find-package "ACL2"))
[Note:  Printing non-ACL2 result.]
(3 #&lt;The ACL2 package&gt;)
ACL2 P&gt;</pre> 
 
 <p>If you have trouble with large structures being printed out, you might want 
 to execute appropriate Common Lisp forms in raw mode, for example, <span class="v">(setq
 *print-length* 5)</span> and <span class="v">(setq *print-level* 5)</span>.</p> 
 
 <p>Evaluation in raw mode attempts to maintain global <a href="ACL2____STOBJS.html">stobjs</a>, but may 
 not accommodate arbitrary raw Lisp hacks that hide the stobj returned by ACL2. 
 This can happen in two cases: when array resizing is used on the 
 unique (array) field of a stobj, and when <span class="tt"><a href="ACL2____SWAP-STOBJS.html">swap-stobjs</a></span> is used. 
 Consider for example the following log.  Evaluation behaves nicely for all 
 forms except the last, where resizing seems not to have taken effect as 
 explained after the log, below.</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st fld)

Summary
Form:  ( DEFSTOBJ ST ...)
Rules: NIL
Time:  0.02 seconds (prove: 0.00, print: 0.00, other: 0.02)
 ST
ACL2 !&gt;(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st2 (ar :type (<a href="COMMON-LISP____ARRAY.html">array</a> t (8)) :resizable t))

Summary
Form:  ( DEFSTOBJ ST2 ...)
Rules: NIL
Time:  0.02 seconds (prove: 0.00, print: 0.00, other: 0.02)
 ST2
ACL2 !&gt;(<a href="ACL2____SET-RAW-MODE-ON_12.html">set-raw-mode-on!</a>)

TTAG NOTE: Adding ttag :RAW-MODE-HACK from the top level loop.
ACL2 P&gt;(<a href="COMMON-LISP____PROGN.html">progn</a> (update-fld 3 st) 17)
17
ACL2 P&gt;(resize-ar 20 st2)
&lt;st2&gt;
ACL2 P&gt;(ar-length st2)
20
ACL2 P&gt;(<a href="COMMON-LISP____PROGN.html">progn</a> (resize-ar 30 st2) 17)
17
ACL2 P&gt;(ar-length st2) ; Should be 30, but it's not!
20
ACL2 P&gt;</pre> 
 
 <p>The reason for the last form's ``wrong'' result (and the other ``correct'' 
 results) is technical.  A stobj with a single array field is exactly that 
 array in raw Lisp (except in some cases where that may be an array of 
 characters), in which case resizing completely replaces the stobj in the 
 global structure that stores the global stobj values.  The use of raw-Lisp 
 <span class="v">progn</span> hides the evidence of stobj modification, which is based on the 
 stobjs returned by the form (but this <span class="v">progn</span> form returns 17).  Such 
 evidence is available in the earlier call of <span class="v">resize-ar</span> above, since ACL2 
 knows that <span class="v">resize-ar</span> returns a <span class="v">st2</span> stobj.  The <span class="v">update-fld</span> call 
 does not provide such evidence for <span class="v">st1</span>, again because of the <span class="v">progn</span> 
 around the call; but <span class="v">update-fld</span> actually modifies the stobj in place, 
 rather than replacing it in the aforementioned global structure.</p> 
 
 <p><i>Include-book</i>.  The <a href="ACL2____EVENTS.html">events</a> <span class="tt"><a href="ACL2____ADD-INCLUDE-BOOK-DIR.html">add-include-book-dir</a></span>, 
 <span class="tt"><a href="ACL2____ADD-INCLUDE-BOOK-DIR_12.html">add-include-book-dir!</a></span>, <span class="tt"><a href="ACL2____DELETE-INCLUDE-BOOK-DIR.html">delete-include-book-dir</a></span>, and <span class="tt"><a href="ACL2____DELETE-INCLUDE-BOOK-DIR_12.html">delete-include-book-dir!</a></span> have been designed to work with raw mode.  However, 
 if you enter raw mode and then evaluate such forms, then the effects of these 
 forms will disappear when you exit raw mode, in which case you can expect to 
 see a suitable warning.  Regarding <i>include-book</i> itself: it should work 
 in raw mode as you might expect, at least if a compiled file or expansion file 
 was created when the book was certified; see <a href="ACL2____CERTIFY-BOOK.html">certify-book</a>.</p>
</body>
</html>
