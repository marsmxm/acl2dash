<html>
<head>
<meta charset="UTF-8">
<title>Set-guard-checking</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____SET-GUARD-CHECKING">Click for Set-guard-checking in the Full Manual</a></h3>

<p>Control checking <a href="ACL2____GUARD.html">guard</a>s during execution of top-level forms</p><p>Detailed comments about the arguments of this function may be found 
 elsewhere: see <a href="ACL2____GUARD-EVALUATION-TABLE.html">guard-evaluation-table</a>.  Here we provide an introduction 
 to the use of <span class="v">set-guard-checking</span>.</p> 
 
 <p>New users are encouraged to execute one of the following forms in order to 
 avoid evaluation errors due to <a href="ACL2____GUARD.html">guard</a>s:</p> 
 
 <pre class="code">(<a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> :none)
(<a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> nil)</pre> 
 
 <p>The former avoids all guard-checking on user-defined functions and should 
 generally work fine for new users, the only drawback being efficiency loss on 
 compute-intensive problems.  All settings other than <span class="v">:none</span> check guards, 
 but a value of <span class="v">nil</span> allows evaluation to continue in the logic when guards 
 fail (avoiding the raw Lisp definition in that case).</p> 
 
 <p>You may put one of the above forms in the <span class="v">"acl2-customization.lsp"</span> 
 file in your current directory (see <a href="ACL2____CBD.html">cbd</a>) or your home directory; see 
 <a href="ACL2____ACL2-CUSTOMIZATION.html">ACL2-customization</a>.</p> 
 
 <p>Note that <a href="ACL2____GUARD.html">guard</a>s are not part of the ACL2 logic, and hence new users 
 can completely ignore the notion of <a href="ACL2____GUARD.html">guard</a> (and the rest of this 
 documentation section after this paragraph!).  For example, <span class="v">(<a href="COMMON-LISP____CAR.html">car</a> 3)</span> and 
 <span class="v">nil</span> can be proved equal in the ACL2 logic, as follows, even though the 
 <a href="ACL2____GUARD.html">guard</a> on <span class="tt"><a href="COMMON-LISP____CAR.html">car</a></span> requires its first argument to be a <span class="tt"><a href="COMMON-LISP____CONS.html">cons</a></span> 
 pair or <span class="v">nil</span>.</p> 
 
 <pre class="code">(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____CAR.html">car</a> 3) nil))</pre> 
 
 <p>Moreover, unless your functions or top-level forms call built-in ACL2 
 functions that are defined in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode, the following 
 property will hold.</p> 
 
 <blockquote><p>Evaluation of <span class="v">(<a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> :none)</span> will allow 
 evaluation of forms such as <span class="v">(<a href="COMMON-LISP____CAR.html">car</a> 3)</span> to take place without error in the 
 top level loop, not only when proving theorems.</p></blockquote> 
 
 <p>If you feel bold, then you may wish to read the rest of this documentation 
 topic; also see <a href="ACL2____GUARD.html">guard</a>.</p> 
 
 <p>See <a href="ACL2____GUARD-EVALUATION-TABLE.html">guard-evaluation-table</a> for a succinct table, with associated 
 discussion, that covers in detail the material presented in the rest of the 
 present topic.</p> 
 
 <p>The top-level ACL2 loop has a variable which controls which sense of 
 execution is provided.  To turn ``<a href="ACL2____GUARD.html">guard</a> checking on,'' by which we mean 
 that <a href="ACL2____GUARD.html">guard</a>s are checked at runtime, execute the top-level form 
 <span class="v">:set-guard-checking t</span>.  To allow guard violations, do 
 <span class="v">:set-guard-checking nil</span>, or do <span class="v">:set-guard-checking :none</span> to turn off 
 all guard-checking, so that raw Lisp definitions of user-defined functions are 
 avoided unless their <a href="ACL2____GUARD.html">guard</a> is <span class="v">t</span>. The status of guard-checking is 
 reflected in the <a href="ACL2____PROMPT.html">prompt</a>.</p> 
 
 <pre class="code">ACL2 !&gt;</pre> 
 
 <p>means <a href="ACL2____GUARD.html">guard</a> checking is on and</p> 
 
 <pre class="code">ACL2 &gt;</pre> 
 
 <p>means <a href="ACL2____GUARD.html">guard</a> checking is off.  The exclamation mark can be thought of 
 as ``barring'' certain computations.  The absence of the mark suggests the 
 absence of error messages or unbarred access to the logical axioms.  Thus, for 
 example</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="COMMON-LISP____CAR.html">car</a> 'abc)</pre> 
 
 <p>will signal an error, while</p> 
 
 <pre class="code">ACL2 &gt;(<a href="COMMON-LISP____CAR.html">car</a> 'abc)</pre> 
 
 <p>will return <span class="v">nil</span>.</p> 
 
 <p>We will return at the end of this documentation topic to discuss two other 
 values, <span class="v">:all</span> and <span class="v">:nowarn</span>, for <span class="v">:set-guard-checking</span>.  We also 
 note that evaluation of built-in <span class="v">:program</span> mode functions always takes 
 place in raw Lisp.</p> 
 
 <p>Whether <a href="ACL2____GUARD.html">guard</a>s are checked during evaluation is independent of the 
 <span class="tt"><a href="ACL2____DEFAULT-DEFUN-MODE.html">default-defun-mode</a></span>.  We note this simply because it is easy to confuse 
 ``<span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode'' with ``evaluation in Common Lisp'' and thus 
 with ``<a href="ACL2____GUARD.html">guard</a> checking on;'' and it is easy to confuse ``<span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode'' with ``evaluation in the logic'' and with ``<a href="ACL2____GUARD.html">guard</a> 
 checking off.''  But the <span class="tt"><a href="ACL2____DEFAULT-DEFUN-MODE.html">default-defun-mode</a></span> determines whether newly 
 submitted definitions introduce programs or add logical axioms.  That mode is 
 independent of whether evaluation checks <a href="ACL2____GUARD.html">guard</a>s or not.  You can 
 operate in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode with runtime <a href="ACL2____GUARD.html">guard</a> checking on or 
 off.  Analogously, you can operate in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode with runtime 
 <a href="ACL2____GUARD.html">guard</a> checking on or off.</p> 
 
 <p>For further discussion on evaluation and guards see <a href="ACL2____GUARDS-AND-EVALUATION.html">guards-and-evaluation</a>, in particular the exception for safe-mode in the 
 ``Aside'' there.  See <a href="ACL2____GUARD.html">guard</a> for a general discussion of <a href="ACL2____GUARD.html">guard</a>s.</p> 
 
 <p>Now we fulfill our promise above to discuss two other values for 
 <span class="v">:set-guard-checking</span>:</p> 
 
 <pre class="code">:set-guard-checking :nowarn
:set-guard-checking :all</pre> 
 
 <p>The meaning of these values is perhaps best described by the following 
 example provided by David Rager.</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="COMMON-LISP____DEFUN.html">defun</a> my-test (expr)
         (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="ACL2____TRUE-LISTP.html">true-listp</a> expr)
                         :verify-guards nil))
         (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____ATOM.html">atom</a> expr)
             expr
           (<a href="COMMON-LISP____CONS.html">cons</a> (my-test (<a href="COMMON-LISP____CAR.html">car</a> expr))
                 (my-test (<a href="COMMON-LISP____CDR.html">cdr</a> expr)))))

The admission of MY-TEST is trivial, using the relation O&lt; (which is
known to be well-founded on the domain recognized by O-P) and the measure
(<a href="ACL2____ACL2-COUNT.html">ACL2-COUNT</a> EXPR).  We could deduce no constraints on the type of MY-
TEST.  However, in normalizing the definition we used primitive type
reasoning.

Summary
Form:  ( DEFUN MY-TEST ...)
Rules: ((:FAKE-RUNE-FOR-TYPE-SET NIL))
Warnings:  None
Time:  0.01 seconds (prove: 0.00, print: 0.00, other: 0.01)
 MY-TEST
ACL2 !&gt;(my-test '(a b c))

ACL2 Warning [Guards] in TOP-LEVEL:  Guard-checking will be inhibited
on recursive calls of the executable-counterpart (i.e., in the ACL2
logic) of MY-TEST.  To check guards on all recursive calls:
  (<a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> :all)
To leave behavior unchanged except for inhibiting this message:
  (<a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> :nowarn)

(A B C)
ACL2 !&gt;</pre> 
 
 <p>If you think about evaluation of <span class="v">(my-test '(a b c))</span>, you will see that 
 it leads to the recursive call <span class="v">(my-test 'a)</span>, which one might expect to 
 cause a guard violation since the symbol <span class="v">a</span> is not a <span class="tt"><a href="ACL2____TRUE-LISTP.html">true-listp</a></span>. 
 However, as the warning above explains, we do not by default check guards on 
 recursive calls.  The reason is efficiency — imagine a simple definition 
 with a guard that is slow to evaluate.  The values <span class="v">:nowarn</span> and <span class="v">:all</span> 
 for <span class="v">:set-guard-checking</span> have been introduced as ways of dealing with the 
 above warning.  The value <span class="v">:nowarn</span> simply turns off the warning above. 
 The value <span class="v">:all</span> causes all guards to be checked, even on recursive calls 
 and even on all calls of non-built-in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode functions 
 — unless, of course, a call is made of a function whose guard has been 
 verified (see <a href="ACL2____VERIFY-GUARDS.html">verify-guards</a>), where the arguments satisfy the guard, in 
 which case the corresponding call is made in raw Lisp without subsidiary 
 guard-checking.  We still say that ``guard-checking is on'' after 
 <span class="v">:set-guard-checking</span> is invoked with values <span class="v">t</span>, <span class="v">:nowarn</span>, and 
 <span class="v">:all</span>, otherwise (after value <span class="v">nil</span>) we say ``guard-checking is 
 off.</p> 
 
 <p>For technical reasons, <span class="v">:all</span> does not have its advertised effect in the 
 case of built-in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span>-mode functions.  If you are interested 
 in this technical detail, see the comment ``In the boot-strap world...'' in 
 source function <span class="v">oneify-cltl-code</span>.</p> 
 
 <p>We conclude with a remark about the use of <span class="v">:set-guard-checking</span> for 
 experimenting with ACL2 as a logic or as a programming language.  If one views 
 ACL2 as a logic, one may wish to use <span class="v">:set-guard-checking :none</span>, while if 
 instead one views ACL2 as a functional programming language, one may wish to 
 use <span class="v">:set-guard-checking :all</span>.  The following transcript illustrates this 
 distinction by way of example.  Specifically, <span class="v">(<a href="COMMON-LISP____CAR.html">car</a> 3)</span> is equal to 
 <span class="v">nil</span> in the ACL2 logic, but may be viewed as a programming error.  The 
 default of <span class="v">:set-guard-checking t</span> is problematic for learning ACL2 using 
 <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode functions, since one can get raw Lisp errors.  In 
 the example below, the raw Lisp error occurs because <span class="v">foo</span> implicitly has a 
 <a href="ACL2____GUARD.html">guard</a> of <span class="v">t</span>, hence <span class="v">(foo 3)</span> is evaluated in raw Lisp, which 
 leads to a raw Lisp call of c[(car 3)].</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x)
         (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :program))
         (<a href="COMMON-LISP____CAR.html">car</a> x))

Summary
Form:  ( DEFUN FOO ...)
Rules: NIL
Warnings:  None
Time:  0.01 seconds (prove: 0.00, print: 0.00, other: 0.01)
 FOO
ACL2 !&gt;(foo 3)
Error: Attempt to take the car of 3 which is not listp.
  [condition type: TYPE-ERROR]

Restart actions (select using :continue):
 0: Abort entirely from this (lisp) process.
[Current process: Initial Lisp Listener]
[1] ACL2(1): [RAW LISP] :pop
ACL2 !&gt;:set-guard-checking :none

Turning off guard checking entirely.  To allow execution in raw Lisp
for functions with guards other than T, while continuing to mask guard
violations, :SET-GUARD-CHECKING NIL.  See :DOC set-guard-checking.

ACL2 &gt;(foo 3)
NIL
ACL2 &gt;:set-guard-checking :all

Turning guard checking on, value :ALL.

ACL2 !&gt;(foo 3)

ACL2 Error in TOP-LEVEL:  The guard for the function symbol CAR, which
is (<a href="COMMON-LISP____OR.html">OR</a> (<a href="COMMON-LISP____CONSP.html">CONSP</a> X) (<a href="COMMON-LISP____EQUAL.html">EQUAL</a> X NIL)), is violated by the arguments in the
call (<a href="COMMON-LISP____CAR.html">CAR</a> 3).  See :DOC trace for a useful debugging utility.  See :DOC
set-guard-checking for information about suppressing this check with
(<a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> :none), as recommended for new users.

ACL2 !&gt;</pre>
</body>
</html>
