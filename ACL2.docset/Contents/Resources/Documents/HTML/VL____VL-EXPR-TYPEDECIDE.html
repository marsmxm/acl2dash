<html>
<head>
<meta charset="UTF-8">
<title>Vl-expr-typedecide</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=VL____VL-EXPR-TYPEDECIDE">Click for Vl-expr-typedecide in the Full Manual</a></h3>

<p>Determine the arithmetic class (signed or unsigned integer, shortreal 
or real, or something else) of an top-level or self-determined expression.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(vl-expr-typedecide x ss scopes) → (mv warnings class)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">x</span> — <font color="#606060">Guard <span class="v">(<a href="VL____VL-EXPR-P.html">vl-expr-p</a> x)</span>.</font>
</dd> 
  <dd>
<span class="tt">ss</span> — <font color="#606060">Guard <span class="v">(<a href="VL____VL-SCOPESTACK-P.html">vl-scopestack-p</a> ss)</span>.</font>
</dd> 
  <dd>
<span class="tt">scopes</span> — <font color="#606060">Guard <span class="v">(<a href="VL____VL-ELABSCOPES-P.html">vl-elabscopes-p</a> scopes)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">warnings</span> — <font color="#606060">Type <span class="v">(<a href="VL____VL-WARNINGLIST-P.html">vl-warninglist-p</a> warnings)</span>.</font>
</dd> 
<dd>
<span class="tt">class</span> — <font color="#606060">Type <span class="v">(<a href="VL____VL-ARITHCLASS-P.html">vl-arithclass-p</a> class)</span>.</font>
</dd> 
 
</dl></div> 
<p>This function must <b>only</b> be used on "top-level" and 
self-determined portions of expressions.  That is, consider an assignment 
like:</p> 
 
<pre class="code">assign w = {foo + bar, a + b} | (baz + 1) ;</pre> 
 
<p>Here, it is legitimate to call <span class="v">vl-expr-typedecide</span> to determine the 
arithmetic class of:</p> 
 
<ul> 
 <li>
<span class="v">foo + bar</span>, because it is self-determined,</li> 
 <li>
<span class="v">a + b</span>, because it is self-determined, and</li> 
 <li>
<span class="v">{foo + bar, a + b} | (baz + 1)</span>, because it is top-level.</li> 
</ul> 
 
<p>But it is <b>not</b> legitimate to try to decide the class of, <span class="v">baz + 1</span> 
in isolation, and doing so could yield an nonsensical result.  For instance, if 
<span class="v">baz</span> is signed then, by itself, <span class="v">baz + 1</span> looks like a signed addition. 
But concatenations are always unsigned, so in the larger context we can see 
that this addition is in fact unsigned.</p> 
 
<p>The <span class="v">class</span> we return is only a <a href="VL____VL-ARITHCLASS-P.html">vl-arithclass-p</a>.  We might return 
an error class if there is some kind of actual error with the module or the 
expression, e.g., the use of a wire which is not declared; in these cases we 
add fatal <a href="VL____WARNINGS.html">warnings</a>.  But we may also encounter expressions whose type we 
do not know how to compute (e.g., perhaps the expression is an unsupported 
system call).  In such cases we just return an error class without adding any 
warnings.</p> 
 
<p>See <a href="VL2014____EXPRESSION-SIZING-MINUTIA.html">vl2014::expression-sizing-minutia</a> for many relevant notes on 
expression signedness.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>vl-expr-typedecide</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 vl-expr-typedecide (x ss scopes)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="VL____VL-EXPR-P.html">vl-expr-p</a> x)
                             (<a href="VL____VL-SCOPESTACK-P.html">vl-scopestack-p</a> ss)
                             (<a href="VL____VL-ELABSCOPES-P.html">vl-elabscopes-p</a> scopes))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'vl-expr-typedecide))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   ((x (<a href="VL____VL-EXPR-FIX.html">vl-expr-fix</a> x)) (<a href="VL____WARNINGS.html">warnings</a> nil))
   (<a href="VL____VL-EXPR-CASE.html">vl-expr-case</a>
    x
    :vl-special (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-other-class)
    :vl-literal (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) (<a href="VL____VL-VALUE-TYPEDECIDE.html">vl-value-typedecide</a> x.val))
    :vl-index (<a href="VL____VL-INDEX-TYPEDECIDE.html">vl-index-typedecide</a> x ss scopes)
    :vl-unary (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> warnings arg-class)
                    (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x.arg ss scopes))
                   ((wmv warnings ans)
                    (<a href="VL____VL-UNARYOP-TYPEDECIDE.html">vl-unaryop-typedecide</a> x arg-class)))
                  (<a href="ACL2____MV.html">mv</a> warnings ans))
    :vl-binary
    (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> warnings left-class)
          (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x.left ss scopes))
         ((wmv warnings right-class)
          (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x.right ss scopes))
         ((wmv warnings ans)
          (<a href="VL____VL-BINARYOP-TYPEDECIDE.html">vl-binaryop-typedecide</a> x left-class right-class)))
        (<a href="ACL2____MV.html">mv</a> warnings ans))
    :vl-qmark (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> warnings then-class)
                    (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x.then ss scopes))
                   ((wmv warnings else-class)
                    (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x.else ss scopes)))
                  (<a href="ACL2____MV.html">mv</a> warnings
                      (<a href="VL____VL-ARITHCLASS-MAX.html">vl-arithclass-max</a> then-class else-class)))
    :vl-mintypmax (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-other-class)
    :vl-concat (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-unsigned-int-class)
    :vl-multiconcat (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-unsigned-int-class)
    :vl-stream (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-other-class)
    :vl-call (<a href="COMMON-LISP____IF.html">if</a> x.systemp (<a href="VL____VL-SYSCALL-TYPEDECIDE.html">vl-syscall-typedecide</a> x)
                 (<a href="VL____VL-FUNCALL-TYPEDECIDE.html">vl-funcall-typedecide</a> x ss scopes))
    :vl-cast
    (<a href="VL____VL-CASTTYPE-CASE.html">vl-casttype-case</a>
     x.to
     :type
     (<a href="ACL2____B_A2.html">b*</a>
      (((<a href="ACL2____MV.html">mv</a> err to-type)
        (vl-datatype-usertype-resolve x.to.type ss))
       ((when err)
        (<a href="ACL2____MV.html">mv</a>
         (<a href="VL____FATAL.html">fatal</a>
          :type :vl-typedecide-fail
          :msg
          "Failed to resolve usertypes for ~
                                          cast expression ~a0: ~@1."
          :args (<a href="COMMON-LISP____LIST.html">list</a> x err))
         :vl-error-class))
       ((unless (<a href="VL____VL-DATATYPE-PACKEDP.html">vl-datatype-packedp</a> to-type))
        (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-other-class))
       ((<a href="ACL2____MV.html">mv</a> ?caveat class)
        (<a href="VL____VL-DATATYPE-ARITHCLASS.html">vl-datatype-arithclass</a> to-type)))
      (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) class))
     :signedness
     (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>)
         (<a href="COMMON-LISP____IF.html">if</a> x.to.signedp
             :vl-signed-int-class :vl-unsigned-int-class))
     :otherwise (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x.expr ss scopes))
    :vl-inside (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-unsigned-int-class)
    :vl-tagged (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-other-class)
    :vl-pattern
    (<a href="ACL2____B_A2.html">b*</a>
     (((unless x.pattype)
       (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-other-class))
      ((<a href="ACL2____MV.html">mv</a> err pattype)
       (vl-datatype-usertype-resolve x.pattype ss))
      ((when err)
       (<a href="ACL2____MV.html">mv</a>
        (<a href="VL____FATAL.html">fatal</a>
         :type :vl-selfsize-fail
         :msg
         "Failed to resolve usertypes for ~
                                        pattern expression ~a0: ~@1"
         :args (<a href="COMMON-LISP____LIST.html">list</a> x err))
        :vl-error-class))
      ((unless (<a href="VL____VL-DATATYPE-PACKEDP.html">vl-datatype-packedp</a> pattype))
       (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-other-class))
      ((<a href="ACL2____MV.html">mv</a> ?caveat class)
       (<a href="VL____VL-DATATYPE-ARITHCLASS.html">vl-datatype-arithclass</a> pattype)))
     (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) class))
    :vl-eventexpr (<a href="ACL2____MV.html">mv</a> (<a href="VL____OK.html">ok</a>) :vl-other-class)))))</pre> 
<p><b>Theorem: </b>vl-warninglist-p-of-vl-expr-typedecide.warnings</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-warninglist-p-of-vl-expr-typedecide.warnings
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?warnings common-lisp::?class)
              (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss scopes)))
            (<a href="VL____VL-WARNINGLIST-P.html">vl-warninglist-p</a> warnings))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>vl-arithclass-p-of-vl-expr-typedecide.class</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-arithclass-p-of-vl-expr-typedecide.class
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?warnings common-lisp::?class)
              (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss scopes)))
            (<a href="VL____VL-ARITHCLASS-P.html">vl-arithclass-p</a> class))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>vl-expr-typedecide-of-vl-expr-fix-x</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-expr-typedecide-of-vl-expr-fix-x
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> (<a href="VL____VL-EXPR-FIX.html">vl-expr-fix</a> x)
                                   ss scopes)
               (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss scopes)))</pre> 
<p><b>Theorem: </b>vl-expr-typedecide-vl-expr-equiv-congruence-on-x</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-expr-typedecide-vl-expr-equiv-congruence-on-x
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="VL____VL-EXPR-EQUIV.html">vl-expr-equiv</a> x x-equiv)
                 (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss scopes)
                        (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x-equiv ss scopes)))
        :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>vl-expr-typedecide-of-vl-scopestack-fix-ss</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-expr-typedecide-of-vl-scopestack-fix-ss
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x (<a href="VL____VL-SCOPESTACK-FIX.html">vl-scopestack-fix</a> ss)
                                   scopes)
               (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss scopes)))</pre> 
<p><b>Theorem: </b>vl-expr-typedecide-vl-scopestack-equiv-congruence-on-ss</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-expr-typedecide-vl-scopestack-equiv-congruence-on-ss
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="VL____VL-SCOPESTACK-EQUIV.html">vl-scopestack-equiv</a> ss ss-equiv)
                 (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss scopes)
                        (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss-equiv scopes)))
        :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>vl-expr-typedecide-of-vl-elabscopes-fix-scopes</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-expr-typedecide-of-vl-elabscopes-fix-scopes
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss (<a href="VL____VL-ELABSCOPES-FIX.html">vl-elabscopes-fix</a> scopes))
               (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss scopes)))</pre> 
<p><b>Theorem: </b>vl-expr-typedecide-vl-elabscopes-equiv-congruence-on-scopes</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-expr-typedecide-vl-elabscopes-equiv-congruence-on-scopes
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="VL____VL-ELABSCOPES-EQUIV.html">vl-elabscopes-equiv</a> scopes scopes-equiv)
                 (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss scopes)
                        (<a href="VL____VL-EXPR-TYPEDECIDE.html">vl-expr-typedecide</a> x ss scopes-equiv)))
        :rule-classes :congruence)</pre> 

</body>
</html>
