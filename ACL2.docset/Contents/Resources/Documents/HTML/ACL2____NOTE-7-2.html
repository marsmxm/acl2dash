<html>
<head>
<meta charset="UTF-8">
<title>Note-7-2</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____NOTE-7-2">Click for Note-7-2 in the Full Manual</a></h3>

<p>ACL2 Version  7.2 (January, 2016) Notes</p><p>NOTE!  New users can ignore these release notes, because the <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> has been updated to reflect all changes that are recorded 
 here.</p> 
 
 <p>Below we roughly organize the changes to ACL2 since Version 7.1 into the 
 following categories of changes: existing features, new features, heuristic 
 and efficiency improvements, bug fixes, changes at the system level, Emacs 
 support, and experimental versions.  Each change is described in just one 
 category, though of course many changes could be placed in more than one 
 category.</p> 
 
 <p>See also <a href="ACL2____NOTE-7-2-BOOKS.html">note-7-2-books</a> for a summary of changes made to the ACL2 
 Community Books since ACL2 7.1, including the build system.</p> 
 
 <h3>Changes to Existing Features</h3> 
 
 <p>The utility <span class="tt"><a href="ACL2____WITH-GUARD-CHECKING.html">with-guard-checking</a></span> is now limited to forms that do not 
 reference the ACL2 <a href="ACL2____STATE.html">state</a>.  A related new utility, <span class="tt"><a href="ACL2____WITH-GUARD-CHECKING-ERROR-TRIPLE.html">with-guard-checking-error-triple</a></span>, may be used for forms that evaluate to 
 <a href="ACL2____ERROR-TRIPLE.html">error-triple</a>s.  For an example showing a bug when 
 <span class="v">with-guard-checking</span> was applied to forms that access <a href="ACL2____STATE.html">state</a>, see 
 the comment about ``with-guard-checking'' in Community Books file 
 <span class="tt">system/doc/acl2-doc.lisp</span>, in the form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-7-2 ...)</span>. 
 We thank Jared Davis for sending us an example showing that our preliminary 
 fix was not adequate; for details, and for how a trust tag can avoid the new 
 restriction (at the potential cost of unsoundness), see the remark for 
 advanced users in the documentation for <a href="ACL2____WITH-GUARD-CHECKING.html">with-guard-checking</a>.</p> 
 
 <p>Several built-in functions are now in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode with <a href="ACL2____GUARD.html">guard</a>s verified: <span class="tt"><a href="ACL2____TERM-ORDER.html">term-order</a></span>, <span class="v">merge-sort-term-order</span>, <span class="tt"><a href="ACL2____ARITY.html">arity</a></span>, <span class="tt"><a href="ACL2____TERMP.html">termp</a></span>, <span class="tt"><a href="ACL2____TERM-LISTP.html">term-listp</a></span>, and <span class="tt"><a href="ACL2____TERM-LIST-LISTP.html">term-list-listp</a></span> â€” 
 new functions <span class="v">arities-okp</span> and <span class="v">plist-worldp-with-formals</span>; and (thanks 
 to Eric Smith for the suggestions) <span class="v">collect-by-position</span>, 
 <span class="v">make-lambda-application</span>, <span class="v">&gt;=-len</span>, <span class="v">all-&gt;=-len</span>, <span class="v">strip-cadrs</span>, 
 and <span class="v">alist-to-doublets</span>.  (Technical note: This enhancement followed the 
 usual process: adding or extending community books in directory 
 <span class="v">books/system/</span>, including any new such books in 
 <span class="v">books/system/top.lisp</span>, and updating source constant 
 <span class="v">*system-verify-guards-alist*</span>.)</p> 
 
 <p>Deprecated utilities <span class="v">clear-hash-tables</span> and <span class="v">wash-memory</span> have been 
 eliminated.  For <span class="v">clear-hash-tables</span>, you can get the same effect by first 
 invoking <span class="tt"><a href="ACL2____CLEAR-MEMOIZE-TABLES.html">clear-memoize-tables</a></span>, and then invoking either <span class="v">(<a href="ACL2____HONS-CLEAR.html">hons-clear</a>
 t)</span> or instead, if your executable uses static honsing, <span class="v">(<a href="ACL2____HONS-WASH.html">hons-wash</a>)</span>. 
 For <span class="v">wash-memory</span> you can invoke <span class="v">(<a href="ACL2____CLEAR-MEMOIZE-TABLES.html">clear-memoize-tables</a>)</span> and then 
 <span class="v">(<a href="ACL2____HONS-WASH.html">hons-wash</a>)</span>.  Thanks to Jared Davis for helpful discussions.</p> 
 
 <p>The <a href="ACL2____COMMAND.html">command</a>s <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> and <span class="v">:</span><span class="tt"><a href="ACL2____UBU.html">ubu</a></span> have been 
 changed.  Their previous functionality is available with the commands 
 <span class="v">:</span><span class="tt"><a href="ACL2____UBT_F3.html">ubt?</a></span> and <span class="v">:</span><span class="tt"><a href="ACL2____UBU_F3.html">ubu?</a></span>, respectively.  Now, <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> and <span class="v">:</span><span class="tt"><a href="ACL2____UBU.html">ubu</a></span> behave much more like <span class="v">:</span><span class="tt"><a href="ACL2____UBT_12.html">ubt!</a></span> and 
 <span class="v">:</span><span class="tt"><a href="ACL2____UBU_12.html">ubu!</a></span> (which have not been changed), in that they do not cause 
 queries; however, unlike <span class="v">:</span><span class="tt"><a href="ACL2____UBT_12.html">ubt!</a></span> and <span class="v">:</span><span class="tt"><a href="ACL2____UBU_12.html">ubu!</a></span>, the <a href="ACL2____COMMAND.html">command</a>s <span class="v">:</span><span class="tt"><a href="ACL2____UBT.html">ubt</a></span> and <span class="v">:</span><span class="tt"><a href="ACL2____UBU.html">ubu</a></span> do report errors.  Thanks to 
 Eric Smith for requesting this change.</p> 
 
 <p>Now, <span class="v">:</span><span class="tt"><a href="ACL2____PUFF_A2.html">puff*</a></span> has an optional argument that can avoid rollback 
 of the world when there is an error.  See <a href="ACL2____PUFF_A2.html">puff*</a>.</p> 
 
 <p>After invoking <span class="v">:</span><span class="tt"><a href="ACL2____REDEF.html">redef</a></span> and redefining functions in a <span class="tt"><a href="ACL2____MUTUAL-RECURSION.html">mutual-recursion</a></span> event, it was necessary to answer <span class="v">Y</span> repeatedly in order 
 to complete the redefinitions.  A new option, <span class="v">Y!</span>, will complete the 
 remaining such redefinitions without further query.  Thanks to Eric Smith for 
 requesting this feature.</p> 
 
 <p>A harmless but somewhat annoying superfluous declaration <span class="v">(<a href="COMMON-LISP____DECLARE.html">DECLARE</a> (<a href="ACL2____XARGS.html">XARGS</a>
 :NON-EXECUTABLE T))</span> was, by default, included in the generated <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> 
 for a <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> event.  This has been fixed.  Thanks to Eric Smith for 
 bringing this issue to our attention.</p> 
 
 <p>The <a href="ACL2____PROOF-BUILDER.html">proof-builder</a> command <span class="v">show-rewrites</span> (or <span class="v">sr</span>; see <a href="ACL2-PC____SHOW-REWRITES.html">ACL2-pc::show-rewrites</a>) now shows additional bindings of free variables that 
 would be generated when a third argument of <span class="v">t</span> is supplied for the 
 <span class="v">rewrite</span> (or <span class="v">r</span>; see <a href="ACL2-PC____REWRITE.html">ACL2-pc::rewrite</a>) command.  Thanks to Ben 
 Selfridge for noting that this information was missing.  Note that we also 
 made a few trivial formatting changes for <span class="v">sr</span>.</p> 
 
 <p>The redundancy check for <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> <a href="ACL2____EVENTS.html">events</a> has changed in 
 two small ways.  One change is described below (see ``Redundancy checking for 
 <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span>'').  The other change is the redundancy check now properly 
 identifies a previous subsidiary <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> form with its expansion, 
 ignoring the <span class="v">record-expansion</span> wrapper.  See the example labeled 
 ``Redundant after Version_7.1 (as of mid-September 2015)'' in community book 
 <span class="v">books/make-event/local-elided.lisp</span>.</p> 
 
 <p>A new mechanism for controlling the checking for <a href="ACL2____INVARIANT-RISK.html">invariant-risk</a> 
 replaces the raw Lisp global variable <span class="v">*ignore-invariant-risk*</span>, which is 
 obsolete.  See <a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a>.  In particular, the default is 
 now to print a (new) warning when encountering potential slowdown due to 
 invariant-risk.  Note that more functions are now subject to the 
 invariant-risk check; see the discussion below in the section on Bug Fixes 
 that pertains to invariant-risk.</p> 
 
 <p>The (undocumented) system utility <span class="v">with-ubt!</span>, which continues to be 
 used in <span class="tt"><a href="ACL2____TRACE_12.html">trace!</a></span> and <span class="tt"><a href="ACL2____DISASSEMBLE_42.html">disassemble$</a></span> and is now also used in <span class="tt"><a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a></span>, now binds <a href="ACL2____LD.html">ld</a> special <span class="tt"><a href="ACL2____LD-PRE-EVAL-PRINT.html">ld-pre-eval-print</a></span> to <span class="v">nil</span>.  Thus, when <span class="v">with-ubt!</span> is invoked, 
 subsidiary forms will not be printed to the screen even when the above LD 
 special is non-nil.</p> 
 
 <p>Formerly, <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span>, <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>, and <span class="tt"><a href="ACL2____PUFF.html">puff</a></span> 
 operated with guard-checking off; technically, with <a href="ACL2____STATE.html">state</a> global 
 <span class="v">guard-checking-on</span> bound to <span class="v">nil</span>.  Now, that value is bound to <span class="v">t</span>, 
 which matches the default value in the top-level loop.  Thanks to Eric Smith 
 for suggesting this change to <span class="v">certify-book</span> and to Jared Davis for a 
 helpful conversation about it.</p> 
 
 <p>For <a href="ACL2____GUARD.html">guard</a> proof obligations, all conjuncts from <a href="ACL2____STOBJ.html">stobj</a> 
 declarations (supplied as <span class="v">:stobjs</span> keywords in <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> declarations) 
 preceded all other conjuncts (i.e., from <span class="tt"><a href="COMMON-LISP____TYPE.html">type</a></span> declarations or <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> <span class="v">:guard</span> declarations).  Previously, this was only true within a 
 given <span class="tt"><a href="COMMON-LISP____DECLARE.html">declare</a></span> form.  Thanks to Dave Greve for bringing this issue to 
 our attention.</p> 
 
 <p>A new runic abbreviation has been added: <span class="v">:r</span>, which abbreviates 
 <span class="v">:rewrite</span>.  For example, you may use <span class="v">(:r app-assoc)</span> in a theory 
 expression to denote the <a href="ACL2____RUNE.html">rune</a> <span class="v">(:rewrite app-assoc)</span>.  See <a href="ACL2____THEORIES.html">theories</a>.</p> 
 
 <p>It is now possible to <a href="ACL2____MONITOR.html">monitor</a> rules by supplying a symbol or other 
 runic designator other than a theory (see <a href="ACL2____THEORIES.html">theories</a>), thus relaxing the 
 previous requirement that a <a href="ACL2____RUNE.html">rune</a> is supplied.  For example, the form 
 <span class="v">:monitor nth t</span> is legal, as is <span class="v">:monitor (:d nth) t</span>, where before the 
 corresponding command would necessarily have been <span class="v">:monitor (:definition
 nth) t</span>.  Thanks to Eric Smith for requesting this enhancement.</p> 
 
 <p>Suitable <a href="ACL2____WARNINGS.html">warnings</a> are now printed when attempting to <a href="ACL2____MONITOR.html">monitor</a> 
 <a href="ACL2____SIMPLE.html">simple</a> rules of class <span class="v">:</span><span class="tt"><a href="ACL2____DEFINITION.html">definition</a></span>.  These had only been 
 printed for simple rules of class <span class="v">:</span><span class="tt"><a href="ACL2____REWRITE.html">rewrite</a></span>, because of potential 
 inefficiency in computing for such warnings in the case of large <span class="tt"><a href="ACL2____MUTUAL-RECURSION.html">mutual-recursion</a></span> <a href="ACL2____EVENTS.html">events</a>, but that problem has been addressed in the 
 ACL2 source code using <a href="ACL2____FAST-ALISTS.html">fast-alists</a>.</p> 
 
 <p>ACL2 sometimes produces smaller <span class="v">.cert</span> files, by avoiding certain 
 macroexpansion.  Formerly, for each macro call encountered in a certification 
 world or <a href="ACL2____MAKE-EVENT.html">make-event</a> expansion, ACL2 performed repeated single-step 
 macroexpansion until an event form was obtained, and replaced the original 
 form with that result.  The reason for this replacement was to modify certain 
 <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> forms involving relative pathnames (though only under 
 specific conditions).  Now, no such replacement is made except when such a 
 modification is made to an <span class="v">include-book</span> call.  This change could result 
 in smaller <a href="ACL2____CERTIFICATE.html">certificate</a> (<span class="v">.cert</span>) files; for example, if a <a href="ACL2____PORTCULLIS.html">portcullis</a> <a href="ACL2____COMMAND.html">command</a> is a macro call, <span class="v">(foo)</span>, that expands into a 
 very large <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> or <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> event, the certificate file will 
 contain <span class="v">(foo)</span> rather than its macroexpansion.  Of course, this change 
 could result in longer times for processing an <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> forms, 
 because now macroexpansion may need to be done when they are processed; but 
 such macroexpansion has always been necessary for all forms <i>within</i> a 
 book, so such behavior is at least more consistent than before.  If you really 
 want a portcullis macro call to be expanded, wrap it in a <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> 
 call, for example, <span class="v">(<a href="ACL2____MAKE-EVENT.html">make-event</a> '(foo))</span> instead of <span class="v">(foo)</span>.</p> 
 
 <p>The macros <span class="tt"><a href="ACL2____DEFUND.html">defund</a></span> and <span class="tt"><a href="ACL2____DEFTHMD.html">defthmd</a></span> now produce less output.  In 
 fact, the output is the same as for <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> and <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span>, 
 respectively, except for the printing of the return value, which (as before) 
 looks like <span class="v">(:DEFUND NAME)</span> or <span class="v">(:DEFTHMD NAME)</span>.  Thanks to Jared Davis 
 for suggesting such a change.</p> 
 
 <p>Remaining traces of legacy documentation have generally been eliminated, 
 including all vestiges of the obsolete command, <span class="v">defdoc</span>.  (<a href="COMMON-LISP____DOCUMENTATION.html">Documentation</a> is now generally provided through the <a href="ACL2____XDOC.html">xdoc</a> system.)  In 
 particular, optional and keyword arguments, <span class="v">doc</span>, have been eliminated for 
 the following macros.</p> 
 
 <ul> 
 <li><span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span></li> 
 <li><span class="tt"><a href="ACL2____DEFABSSTOBJ-MISSING-EVENTS.html">defabsstobj-missing-events</a></span></li> 
 <li><span class="tt"><a href="ACL2____DEFAXIOM.html">defaxiom</a></span></li> 
 <li><span class="tt"><a href="ACL2____DEFCHOOSE.html">defchoose</a></span></li> 
 <li><span class="tt"><a href="ACL2____DEFLABEL.html">deflabel</a></span></li> 
 <li><span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span></li> 
 <li><span class="tt"><a href="ACL2____DEFSTUB.html">defstub</a></span></li> 
 <li><span class="tt"><a href="ACL2____DEFTHEORY.html">deftheory</a></span></li> 
 <li><span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span></li> 
 <li>
<span class="v">defthm-std</span> (defined only in ACL2(r); see <a href="COMMON-LISP____REAL.html">real</a>)</li> 
 <li><span class="tt"><a href="ACL2____DEFTTAG.html">defttag</a></span></li> 
 <li><span class="tt"><a href="ACL2____IN-ARITHMETIC-THEORY.html">in-arithmetic-theory</a></span></li> 
 <li><span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span></li> 
 <li><span class="tt"><a href="ACL2____PUSH-UNTOUCHABLE.html">push-untouchable</a></span></li> 
 <li><span class="tt"><a href="ACL2____REGENERATE-TAU-DATABASE.html">regenerate-tau-database</a></span></li> 
 <li><span class="tt"><a href="ACL2____REMOVE-UNTOUCHABLE.html">remove-untouchable</a></span></li> 
 <li><span class="tt"><a href="ACL2____RESET-PREHISTORY.html">reset-prehistory</a></span></li> 
 <li><span class="tt"><a href="ACL2____THM.html">thm</a></span></li> 
 <li><span class="tt"><a href="ACL2____VERIFY-GUARDS.html">verify-guards</a></span></li> 
 </ul> 
 
 <p>Note that <span class="tt"><a href="ACL2____DEFABBREV.html">defabbrev</a></span>, <span class="tt"><a href="ACL2____DEFCONST.html">defconst</a></span>, <span class="tt"><a href="COMMON-LISP____DEFMACRO.html">defmacro</a></span>, <span class="tt"><a href="ACL2____DEFPKG.html">defpkg</a></span>, and <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> may still be supplied documentation strings, as a 
 nod to Common Lisp.  In particular, for <span class="v">defun</span> and <span class="v">defmacro</span> this can 
 ease the porting of Common Lisp code to ACL2.</p> 
 
 <p>Several source-level definitions have changed, many of them unadvertised. 
 Some are for unadvertised event commands like <span class="v">defthm-fn</span>, which no longer 
 have a <span class="v">doc</span> argument (see ``traces of legacy documentation have generally 
 been eliminated'' above).  Others, like <span class="v">flambda-applicationp</span>, are macros 
 that were formerly defined with <span class="tt"><a href="ACL2____DEFABBREV.html">defabbrev</a></span> but now are defined with 
 <span class="tt"><a href="COMMON-LISP____DEFMACRO.html">defmacro</a></span>; thanks to Eric Smith for suggesting such 
 simplifications.</p> 
 
 <p>In prover output, terms of the form <span class="v">(<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____NOT.html">not</a> expr))</span> had been printed 
 simply as <span class="v">expr</span>.  That could cause confusion; for example, the following 
 form would lead to the checkpoint <span class="v">(<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (<a href="ACL2____ALISTP.html">ALISTP</a> X) (<a href="ACL2____ALISTP.html">ALISTP</a> X))</span>, where 
 actually the checkpoint was <span class="v">(<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (<a href="COMMON-LISP____NOT.html">NOT</a> (<a href="COMMON-LISP____NOT.html">NOT</a> (<a href="ACL2____ALISTP.html">ALISTP</a> X))) (<a href="ACL2____ALISTP.html">ALISTP</a> X))</span>. 
 This ``feature'' has been eliminated.  Thanks to Shilpi Goel for bringing this 
 issue to our attention and supplying an illustrative example.</p> 
 
 <p>A warning was formerly printed when encountering a macro call with 
 duplicate keys, for example <span class="v">(foo 3 :y 4 :y 5)</span> where <span class="v">:y</span> is a keyword 
 argument of the macro, <span class="v">foo</span>.  Now, this is an error by default, in order 
 to make it easier for users to catch bugs due to accidental repetition of a 
 keyword argument.  However, the utility <span class="tt"><a href="ACL2____SET-DUPLICATE-KEYS-ACTION.html">set-duplicate-keys-action</a></span> can 
 be used to allow such duplicate keys, with or without a warning.  Thanks to 
 Jared Davis for requesting these changes.</p> 
 
 <p>Warnings are no longer printed for <span class="v">:use</span> hints applied to functional 
 instances of enabled rules.  Thanks to Eric Smith for suggesting this 
 change.</p> 
 
 <p>The second (optional) argument of <span class="v">show-accumulated-persistence</span> may now 
 have a new value, <span class="v">:list</span>, which causes the results to be displayed as a 
 single list with entries of the form <span class="v">(frames tries xrune)</span>.  Thanks to 
 David Rager for requesting a way to display useless <a href="ACL2____RUNE.html">rune</a>s, sorted in a 
 manner that can help with automating the creation of <span class="v">in-theory</span> forms that 
 <span class="v">disable</span> unnecessary runes; also thanks for his 
 helpful discussions in designing its functionality.  See <a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a>; in particular, <span class="v">(<a href="ACL2____SHOW-ACCUMULATED-PERSISTENCE.html">show-accumulated-persistence</a>
 :useless :list)</span> can display a list of runes to consider disabling.</p> 
 
 <p>The utility <span class="tt"><a href="ACL2____PRINT-GV.html">print-gv</a></span> now takes additional keyword arguments, 
 <span class="v">:conjunct</span> and <span class="v">:substitute</span>, which respectively show a specific 
 conjunct of the <a href="ACL2____GUARD.html">guard</a> evaluation that produced <span class="v">nil</span>, and avoid 
 <span class="tt"><a href="COMMON-LISP____FLET.html">flet</a></span> in favor of substituting actuals (even at the risk of 
 duplication).  See <a href="ACL2____PRINT-GV.html">print-gv</a>, and see <a href="ACL2____SET-PRINT-GV-DEFAULTS.html">set-print-gv-defaults</a> for a 
 utility that sets default values for the keyword arguments.  Thanks to Eric 
 Smith for requesting these enhancements and for helpful discussions.  Note 
 that the system default value for the <span class="v">:evisc-tuple</span> keyword is now the 
 value of the form <span class="v">(print-gv-evisc-tuple)</span>.</p> 
 
 <p><a href="ACL2____STATE.html">State</a> global variable <span class="v">global-enabled-structure</span> is now 
 untouchable (see <a href="ACL2____REMOVE-UNTOUCHABLE.html">remove-untouchable</a>).</p> 
 
 <p>Users may see a change in the order, number, and size of termination proof 
 obligations because of an optimization that removes trivial equality tests 
 generated by <span class="tt"><a href="COMMON-LISP____CASE.html">case</a></span> and <span class="tt"><a href="COMMON-LISP____COND.html">cond</a></span> statements.  (The removal of the 
 tests can affect subsumption, which is how the order and number of proof 
 obligations may change.)</p> 
 
 <p>Once again, all documented constant, function, and macro symbols in the 
 <span class="v">"ACL2"</span> package are included in the constant, <span class="tt"><a href="ACL2_____A2ACL2-EXPORTS_A2.html">*ACL2-exports*</a></span>. 
 Community book <span class="v">books/misc/check-acl2-exports.lisp</span> has been updated for 
 the current documentation system to enforce this invariant in the future. 
 Thanks to Jared Davis for pointing out that the symbol <span class="tt"><a href="ACL2____EXTEND-PE-TABLE.html">extend-pe-table</a></span> 
 was missing from <span class="v">*acl2-exports*</span> and would be a good addition; that led us 
 to this change.  As also suggested by Jared, we added the symbols <span class="tt"><a href="ACL2____EXISTS.html">exists</a></span> and <span class="tt"><a href="ACL2____FORALL.html">forall</a></span> to <span class="v">*acl2-exports*</span>, as well.</p> 
 
 <p>The quantifier <span class="tt"><a href="ACL2____FORALL.html">forall</a></span> or <span class="tt"><a href="ACL2____EXISTS.html">exists</a></span> used in the body of a 
 <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> call must now be in the <span class="v">"ACL2"</span> package.  Many users 
 will not notice this change, since the symbols <span class="v">forall</span> and <span class="v">exists</span> in 
 the <span class="v">"ACL2"</span> package are now in the list <span class="tt"><a href="ACL2_____A2ACL2-EXPORTS_A2.html">*ACL2-exports*</a></span>; see the 
 paragraph just above.  Thanks to Alessandro Coglio for a remark leading to 
 this change.</p> 
 
 <p>Definitions are no longer redundant that have different values specified 
 for their <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> keyword, <span class="v">:normalize</span>.  (See <a href="ACL2____REDUNDANT-EVENTS.html">redundant-events</a>.)  Although we are not aware of a need to make this change, 
 this change eliminates a possible unsoundness.</p> 
 
 <p>It is now the case that <span class="v">open-output-channel</span> and 
 <span class="v">open-output-channel!</span> will attempt to create missing directories as 
 needed.  (This had formerly been observed to be the case in CCL but not other 
 Lisp implementations.)  Thanks to Jared Davis for requesting this 
 enhancement.</p> 
 
 <h3>New Features</h3> 
 
 <p>It is now possible to make ACL2 avoid the well-formedness checks done when 
 metafunctions and clause processors are run.  By default, when a metafunction 
 or clause processor is run, ACL2 calls <span class="tt"><a href="ACL2____TERMP.html">termp</a></span> or <span class="tt"><a href="ACL2____TERM-LIST-LISTP.html">term-list-listp</a></span>, respectively, on the new value to make sure it is 
 well-formed.  Now, if you prove and provide a <span class="v">:</span><span class="tt"><a href="ACL2____WELL-FORMEDNESS-GUARANTEE.html">well-formedness-guarantee</a></span> with the <span class="v">:meta</span> or <span class="v">:clause-processor</span> 
 rule-class, you can skip these checks.  This can speed up the use of 
 metafunctions and clause processors on big terms and formulas.</p> 
 
 <p>It is now possible to ensure the integrity of statistics produced by <span class="tt"><a href="ACL2____MEMSUM.html">memsum</a></span> after functions are <a href="ACL2____MEMOIZE.html">memoize</a>d.  See <a href="ACL2____PROTECT-MEMOIZE-STATISTICS.html">protect-memoize-statistics</a>.  Thanks to Alessandro Coglio for noticing 
 oddities in those statistics and to Jared Davis for providing an 
 implementation of this new feature.</p> 
 
 <p>Function <span class="tt"><a href="ACL2____READ-FILE-INTO-STRING.html">read-file-into-string</a></span> provides an efficient way to return 
 the contents of a file as a string, without returning an ACL2 <a href="ACL2____STATE.html">state</a>. 
 Thanks to Jared Davis for pointing out a logical flaw in the initial 
 implementation.</p> 
 
 <p>A new function, <span class="v">get-skipped-proofs-p</span>, can tell system programmers 
 whether or not a given event name was introduced with proofs skipped, as with 
 <span class="tt"><a href="ACL2____SKIP-PROOFS.html">skip-proofs</a></span> or using <span class="tt"><a href="ACL2____SET-LD-SKIP-PROOFSP.html">set-ld-skip-proofsp</a></span>.  See <a href="ACL2____SYSTEM-UTILITIES.html">system-utilities</a>.  Thanks to Eric Smith for requesting such a capability.</p> 
 
 <p>A new <a href="ACL2____TABLE.html">table</a> permits the association of names with substitute event 
 forms, for use by <a href="ACL2____HISTORY.html">history</a> commands that print event forms, including 
 <span class="v">:</span><span class="tt"><a href="ACL2____PE.html">pe</a></span>, <span class="v">:</span><span class="tt"><a href="ACL2____PC.html">pc</a></span>, <span class="v">:</span><span class="tt"><a href="ACL2____PCB.html">pcb</a></span>, and <span class="v">:</span><span class="tt"><a href="ACL2____PCB_12.html">pcb!</a></span>. 
 See <a href="ACL2____EXTEND-PE-TABLE.html">extend-pe-table</a>.  Thanks to Eric Smith for requesting such a 
 capability.  Note that <span class="v">:</span><span class="tt"><a href="ACL2____PE_12.html">pe!</a></span> now avoids use of this table.</p> 
 
 <p>A new macro, <span class="v">ffn-symb-p</span>, has been introduced and then used in the 
 source code to simplify some definitions.  Thanks to Jared Davis for a remark 
 that led us to define and introduce this macro.  See <a href="ACL2____SYSTEM-UTILITIES.html">system-utilities</a> 
 for a description of this and many other low-level system utilities.</p> 
 
 <p>It is now possible to give <a href="ACL2____HINTS.html">hints</a> that specify the use of termination 
 or <a href="ACL2____GUARD.html">guard</a> theorems for existing function symbols.  See <a href="ACL2____LEMMA-INSTANCE.html">lemma-instance</a>, <a href="ACL2____TERMINATION-THEOREM-EXAMPLE.html">termination-theorem-example</a>, and <a href="ACL2____GUARD-THEOREM-EXAMPLE.html">guard-theorem-example</a>.  Also see <a href="ACL2____GTHM.html">gthm</a> and <a href="ACL2____TTHM.html">tthm</a> for related 
 query utilities.  Thanks to Alessandro Coglio and Eric Smith for requesting 
 these features.</p> 
 
 <p>See <a href="ACL2____SET-PRINT-GV-DEFAULTS.html">set-print-gv-defaults</a> for a new utility for setting default 
 values for the keyword arguments of <span class="tt"><a href="ACL2____PRINT-GV.html">print-gv</a></span>.  Thanks to Eric Smith 
 for requesting this feature and for helpful discussions.</p> 
 
 <p>For <a href="ACL2____HISTORY.html">history</a> commands and the function <span class="tt"><a href="ACL2____DISABLEDP.html">disabledp</a></span>, the notion 
 of ``<a href="ACL2____DISABLE.html">disable</a>d'' is now computed inside the <a href="ACL2____BREAK-REWRITE.html">break-rewrite</a> loop 
 with respect to the <a href="ACL2____ENABLE.html">enable</a>d status at the current point of the current 
 proof attempt, rather than with respect to the global state.  Thanks to David 
 Rager for suggesting this enhancement.  Note that this change only affects 
 <a href="ACL2____HISTORY.html">history</a> commands and <span class="tt"><a href="ACL2____DISABLEDP.html">disabledp</a></span>, not other utilities (for example 
 <span class="tt"><a href="ACL2____TAU-STATUS.html">tau-status</a></span> and <span class="tt"><a href="ACL2____GUARD-OBLIGATION.html">guard-obligation</a></span>).x</p> 
 
 <p>New system utility <span class="tt"><a href="ACL2____GETPROPC.html">getpropc</a></span> is a convenient abbreviation for <span class="tt"><a href="ACL2____GETPROP.html">getprop</a></span>.</p> 
 
 <p>A new utility causes some warnings to be printed in a ``raw'' s-expression 
 format.  See <a href="ACL2____SET-RAW-WARNING-FORMAT.html">set-raw-warning-format</a>.  Thanks to Shilpi Goel for 
 requesting this utility.</p> 
 
 <p>The macro <span class="v">accumulated-persistence-oops</span> undoes the effect of 
 accidentally clearing statistics with <span class="v">(<a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a> t)</span> or 
 <span class="v">(<a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a> :all)</span>.  See <a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a>. 
 Thanks to Jared Davis for requesting this feature.</p> 
 
 <h3>Heuristic and Efficiency Improvements</h3> 
 
 <p>The redundancy check for <span class="tt"><a href="ACL2____DEFCONST.html">defconst</a></span> has been sped up in cases with a 
 very large term, as in the following example.  Thanks to David Rager and Jared 
 Davis for helpful related discussions.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> make-tree (n)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____TYPE.html">type</a> (integer 0 *) n))
  (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____ZP.html">zp</a> n)
      nil
    (<a href="COMMON-LISP____LET.html">let</a> ((x (make-tree (<a href="COMMON-LISP____1-.html">1-</a> n))))
      (<a href="COMMON-LISP____CONS.html">cons</a> x x))))
(<a href="ACL2____MAKE-EVENT.html">make-event</a>
`(<a href="ACL2____DEFCONST.html">defconst</a> *a* (<a href="ACL2____HONS-COPY.html">hons-copy</a> ',(make-tree 50))))
; Redundant, and formerly very slow:
(<a href="ACL2____MAKE-EVENT.html">make-event</a>
`(<a href="ACL2____DEFCONST.html">defconst</a> *a* (<a href="ACL2____HONS-COPY.html">hons-copy</a> ',(make-tree 50))))</pre> 
 
 <p>Processing of <span class="tt"><a href="ACL2____DEFPKG.html">defpkg</a></span> forms may be faster, thanks to a change 
 suggested by Jared Davis (who observed significant speedup in SBCL).</p> 
 
 <p>Optimizations have been made that can speed up <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> 
 for some large books, as follows.  In particular, for the form <span class="v">(<a href="ACL2____TIME_42.html">time$</a>
 (<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "centaur/sv/tutorial/alu" :dir :system))</span> we have seen a 25% 
 reduction (on Mac OS) for the first item below, and an additional 29% 
 reduction (also on Mac OS) for the second item.</p> 
 
 <ul> 
 
 <li>Various optimizations have been made for <a href="ACL2____THEORY.html">theory</a> manipulation, 
 including some to make processing for efficient for <span class="tt"><a href="ACL2____DEFUND.html">defund</a></span> and <span class="tt"><a href="ACL2____DEFTHMD.html">defthmd</a></span>.  Thanks to Sol Swords for bringing this issue to our attention in 
 GitHub Issue #401 and for reporting bugs in our initial implementations.</li> 
 
 <li>Redundancy checking for <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> <a href="ACL2____EVENTS.html">events</a> can be much 
 faster.  The only functional change (with one small exception, described in an 
 item above) is to check for a sub-event of the proposed <span class="v">encapsulate</span> event 
 that is attempting to introduce a new name; if no such name is found, then the 
 redundancy check is skipped, and the proposed <span class="v">encapsulate</span> event is 
 evaluated.  This new check is quite thorough (see <a href="ACL2____REDUNDANT-ENCAPSULATE.html">redundant-encapsulate</a>), so we expect it to be rare that an <span class="v">encapsulate</span> 
 event that was formerly redundant is no longer redundant.</li> 
 
 </ul> 
 
 <p><a href="ACL2____CERTIFY-BOOK.html">Certify-book</a> is faster in some cases; for example, we found the 
 time required to certify a book whose only event is <span class="v">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a>
 "centaur/gl/gl" :dir :system)</span> was reduced from 57 seconds to 10 seconds. 
 (Implementation note: The change was to avoid installing worlds in function 
 <span class="v">defpkg-items</span>.  That had probably been done in order to speed up calls of 
 <span class="v">simple-translate-and-eval</span> in <span class="v">defpkg-items-rec</span>, but that speed-up 
 seems to be dwarfed by the expense of <span class="v">extend-world1</span> in such cases.)</p> 
 
 <p>We tweaked a part of the so-called ``clausify'' process for doing Boolean 
 simplification towards producing subgoals of a given goal, namely, the 
 so-called ``subsumption-replacement-loop'' (specifically, source function 
 <span class="v">find-subsumer-replacement</span>).  Thanks to Jared Davis for helpful 
 discussions that led us to make this change.</p> 
 
 <p><span class="tt"><a href="ACL2____DEFEVALUATOR.html">Defevaluator</a></span> is faster, especially so when many functions are to be 
 interpreted by the new evaluator.  The new version is a refactored version of 
 community book <span class="v">books/tools/defevaulator-fast.lisp</span> used with the 
 permission of its original authors Sol Swords and Jared Davis.  Thanks!</p> 
 
 <p>The Common Lisp code generated for <a href="ACL2____STOBJ.html">stobj</a> accessors and updaters has 
 been improved in the case that the <span class="v">:type</span> is <span class="v">T</span> or of the form 
 <span class="v">(<a href="COMMON-LISP____ARRAY.html">array</a> T ...)</span>.  In particular, we have seen efficiency improvements for 
 host Lisp CCL when the value read from or written to the array is a 
 fixnum (integers that are sufficiently small in absolute value).  Thanks to 
 Bob Boyer and Gary Byers for helpful discussions that led to this 
 improvement.</p> 
 
 <h3>Bug Fixes</h3> 
 
 <p>We fixed a soundness bug pertaining to <a href="ACL2____LOCAL.html">local</a> <span class="tt"><a href="ACL2____DEFPKG.html">defpkg</a></span> <a href="ACL2____EVENTS.html">events</a>.  See community books directory <span class="v">misc/hidden-defpkg-checks/</span> for an 
 example that exploits this bug to prove <span class="v">nil</span> in Version  7.1 and perhaps 
 some other previous ACL2 versions.  Thanks to Sol Swords for helping us set up 
 that test (specifically, suggesting addition of the comment ``<span class="v">; no_port</span>'' 
 after an <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> call that is not to be put into a <span class="v">.port</span> 
 file).</p> 
 
 <p>The use of <span class="tt"><a href="ACL2____SET-DEFERRED-TTAG-NOTES.html">set-deferred-ttag-notes</a></span> during <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> 
 expansion could cause some TTAG NOTE messages never to be printed.  Thanks to 
 Jared Davis for a remark that led us to discover this bug, which could be 
 considered a soundness bug since the TTAG NOTE mechanism is a key part of the 
 soundness story.  With this change, the effects of 
 <span class="v">set-deferred-ttag-notes</span> persist past <span class="v">make-event</span> expansion.</p> 
 
 <p>It was possible to use <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode functions to write past 
 the end of an array, leading to unsoundness.  This has been fixed.  Now, 
 updaters for <a href="ACL2____STOBJ.html">stobj</a> array fields are marked as having so-called 
 ``invariant-risk'', even when the element type of the array is 
 <span class="v">t</span> (unconstrained).  Also marked with invariant-risk are built-in 
 functions <span class="tt"><a href="ACL2____ASET1.html">aset1</a></span> and <span class="tt"><a href="ACL2____ASET2.html">aset2</a></span>.  See <a href="ACL2____PROGRAM-WRAPPER.html">program-wrapper</a>, <a href="ACL2____INVARIANT-RISK.html">invariant-risk</a> and <a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a>, which is discussed above 
 in the section Changes to Existing Features.  Thanks to Jared Davis and Sol 
 Swords for sending an example to illustrate the bug.</p> 
 
 <p>When ACL2 was interrupted while debugging was on (see <a href="ACL2____SET-DEBUGGER-ENABLE.html">set-debugger-enable</a>), it was possible later to get the following error 
 repeatedly:</p> 
 
 <pre class="code">HARD ACL2 ERROR in TIME-TRACKER:  It is illegal to specify :START for
tag :TAU, because tracking for this tag is already in an active state.</pre> 
 
 <p>This problem has been fixed, by defining a new keyword argument for <span class="tt"><a href="ACL2____TIME-TRACKER.html">time-tracker</a></span>, <span class="v">:start!</span>, and using it to track the use of the <a href="ACL2____TAU-SYSTEM.html">tau-system</a>; see <a href="ACL2____TIME-TRACKER.html">time-tracker</a> and <a href="ACL2____TIME-TRACKER-TAU.html">time-tracker-tau</a>.</p> 
 
 <p>ACL2 would cause an error at startup when the value of environment variable 
 <span class="v">ACL2_SYSTEM_BOOKS</span> was a string starting with the tilde 
 character (<span class="v">~</span>).  This has been fixed.  Thanks to Shilpi Goel and Warren 
 Hunt for bringing this bug to our attention.</p> 
 
 <p>(GCL only) It had not been possible to define a <a href="ACL2____STOBJ.html">stobj</a> with more than 
 64 fields in GCL.  We have removed that restriction.  (Technical note: GCL 
 disallows calls of the function, <span class="v">vector</span>, with more than 64 arguments.  So 
 instead we now build a list of stobj fields that is coerced to a vector, 
 rather than calling <span class="v">vector</span> directly.)</p> 
 
 <p>Fixed <span class="tt"><a href="ACL2____DEFTHEORY-STATIC.html">deftheory-static</a></span> by declaring the <a href="ACL2____WORLD.html">world</a> to be 
 <span class="v">ignorable</span>, thus avoiding errors for forms that don't reference the 
 world.  Thanks to Jared Davis for pointing out this bug with the example, 
 <span class="v">(<a href="ACL2____DEFTHEORY-STATIC.html">deftheory-static</a> my-theory '(car-cons))</span>.</p> 
 
 <p>Fixed a bug that was causing the <span class="v">hiding-cars</span> component of the <span class="tt"><a href="ACL2____LD-EVISC-TUPLE.html">ld-evisc-tuple</a></span> to be ignored when printing evaluation results.</p> 
 
 <p>We avoid an error in the case that <span class="tt"><a href="ACL2____SKIP-PROOFS.html">skip-proofs</a></span> is used around a 
 definition with no tests above a recursive call, as in the following 
 example.</p> 
 
 <pre class="code">(<a href="ACL2____SKIP-PROOFS.html">skip-proofs</a> (<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x)
              (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :measure (<a href="ACL2____ACL2-COUNT.html">acl2-count</a> x)))
              (<a href="COMMON-LISP____IDENTITY.html">identity</a>
               (<a href="COMMON-LISP____COND.html">cond</a> ((<a href="ACL2____ZP.html">zp</a> x) 17)
                     (t (foo (<a href="COMMON-LISP____1-.html">1-</a> x)))))))</pre> 
 
 <p>Thanks to Dave Greve for bringing this bug to our attention.  Note that 
 such a definitional event may be unsound (not surprisingly, because of the use 
 of <span class="v">skip-proofs</span>).  For example, the following form succeeds: 
 <span class="v">(<a href="ACL2____THM.html">thm</a> nil :hints (("Goal" :induct (foo x))))</span>.</p> 
 
 <p>Several improvements have been made to avoid errors in the execution of 
 <span class="v">:</span><span class="tt"><a href="ACL2____PUFF.html">puff</a></span> and <span class="v">:</span><span class="tt"><a href="ACL2____PUFF_A2.html">puff*</a></span>.  Thanks to Eric Smith for 
 reporting this issue.  (Technical implementation note: a bug in source 
 function <span class="v">find-longest-common-retraction1-event</span>, used in reverting logical 
 <a href="ACL2____WORLD.html">world</a>s, was fixed in support of this work.)</p> 
 
 <p>When the <span class="tt"><a href="ACL2____DEFAULT-DEFUN-MODE.html">default-defun-mode</a></span> was <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span>, then a <span class="tt"><a href="ACL2____MUTUAL-RECURSION.html">mutual-recursion</a></span> form with <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> declaration of <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> 
 mode, which also had one or more <span class="tt"><a href="ACL2____DEFUND.html">defund</a></span> <a href="ACL2____EVENTS.html">events</a>, would cause a 
 error when attempting to <a href="ACL2____DISABLE.html">disable</a> new function symbols after admitting 
 their definitions.  This has been fixed.  Thanks to Jared Davis for bringing 
 this bug to our attention (GitHub Issue #464).</p> 
 
 <p>We fixed some printing bugs for <span class="v">:</span><span class="tt"><a href="ACL2____PSOF.html">psof</a></span>, <span class="v">:</span><span class="tt"><a href="ACL2____PSO.html">pso</a></span>, and 
 raw proof format (see <a href="ACL2____SET-RAW-PROOF-FORMAT.html">set-raw-proof-format</a>).  Both <span class="v">:</span><span class="tt"><a href="ACL2____PSOF.html">psof</a></span> 
 and <span class="v">:</span><span class="tt"><a href="ACL2____PSO.html">pso</a></span> were printing explicit splitter notes (see <a href="ACL2____SPLITTER.html">splitter</a>) â€” and worse yet, and thanks to David Rager for pointing this 
 out, <span class="v">:</span><span class="tt"><a href="ACL2____PSOF.html">psof</a></span> was printing them to the terminal.  Those explicit 
 splitter notes were not appropriate during proof replay, where instead 
 parenthetical phrases like ``<span class="v">(<a href="ACL2____IF-INTRO.html">if-intro</a>)</span>'' are sufficient; those phrases 
 continue to be printed during proof replay, just as when <a href="ACL2____GAG-MODE.html">gag-mode</a> is 
 off.  Raw proof format had a couple of whitespace bugs, but more important was 
 its failure to indicate any information about splitters; so now it prints the 
 same explicit splitter notes as are printed for gag-mode.</p> 
 
 <p>Insufficient checking has been fixed for <a href="ACL2____SIGNATURE.html">signature</a>s.  Thanks to 
 Jared Davis for sending the example <span class="v">((f * *) =&gt; * :formals (x) :guard (<a href="ACL2____NATP.html">natp</a>
 x))</span>, which was not flagged as illegal by ACL2 even though the specified 
 arity of 2 did not match the length of the specified <span class="v">:formals</span>.  There 
 could also be mismatches between the <a href="ACL2____STOBJ.html">stobj</a>s specified, for example, 
 with <span class="v">(((f * st1) =&gt; * :formals (x st2) :guard (<a href="ACL2____NATP.html">natp</a> x)))</span>, that were not 
 flagged as illegal.</p> 
 
 <p>The inclusion of uncertified books was leading to some incorrect messages 
 about other books that are also uncertified.  This has been fixed (though the 
 messages can still be verbose at times).  Thanks to Eric Smith for sending an 
 example to bring this problem to our attention.</p> 
 
 <p>There were some incorrect error messages produced for bad calls of <span class="tt"><a href="ACL2____EC-CALL.html">ec-call</a></span>; these have been fixed.</p> 
 
 <p>Fixed a bug in <a href="ACL2____MEMOIZATION.html">memoization</a> that could occur when multiprocessing is 
 turned on, as in the call <span class="v">(acl2::mf-multiprocessing t)</span> in community book 
 <span class="v">books/centaur/vl/server/server-raw.lsp</span>.  Thanks to Sol Swords for 
 reporting a bad report from <span class="tt"><a href="ACL2____MEMSUM.html">memsum</a></span> when profiling function 
 <span class="v">include-book-fn</span> before including system book <span class="v">"doc/top"</span>.</p> 
 
 <p><a href="ACL2____GUARD.html">Guard</a> violation error messages printed <span class="v">'ACL2_INVISIBLE::|The
 Live State Itself|</span> where they should have printed <span class="v">STATE</span>; similarly for 
 the utility <span class="tt"><a href="ACL2____PRINT-GV.html">print-gv</a></span>, which also failed to print entirely in 
 user-level ``untranslated'' syntax.  These problems have been fixed.  Thanks 
 to Eric Smith for bringing the ``<span class="v">STATE</span>'' bug to our attention.</p> 
 
 <p>Infinite loops occurred for calls of <span class="v">(<a href="ACL2____CLOSE-OUTPUT-CHANNEL.html">close-output-channel</a> *standard-co*
 state)</span> after redirecting standard output using <span class="v">set-standard-co</span>.  A 
 clean error now occurs instead.</p> 
 
 <p>We fixed a bug in <span class="tt"><a href="ACL2____STATE-GLOBAL-LET_A2.html">state-global-let*</a></span> â€” actually, in its 
 supporting system utility <span class="v">acl2-unwind-protect</span> â€” that allowed 
 capture of a lexical variable, <span class="v">temp</span>, to produce bad results, for example 
 as follows.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (temp state)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs state :mode :program))
  (<a href="ACL2____STATE-GLOBAL-LET_A2.html">state-global-let*</a>
   ((x 3))
   (<a href="ACL2____PPROGN.html">pprogn</a>
    (<a href="ACL2____FMS.html">fms</a> "TEMP = ~x0~%X = ~x1~%" (<a href="COMMON-LISP____LIST.html">list</a> (<a href="COMMON-LISP____CONS.html">cons</a> #0 temp) (<a href="COMMON-LISP____CONS.html">cons</a> #1 (<a href="ACL2_____04.html">@</a> x)))
         *standard-co* state nil)
    (<a href="ACL2____VALUE.html">value</a> nil))))
(foo 17 state) ; should show TEMP = 17 and X = 3, but caused Lisp error</pre> 
 
 <p>ACL2 no longer prints a message for a failed <span class="v">:induct</span> hint (in the case 
 that <a href="ACL2____GAG-MODE.html">gag-mode</a> is off), saying that a definition is <a href="ACL2____DISABLE.html">disable</a>d when 
 that is not the case.</p> 
 
 <p>(CCL only, probably only 32-bit CCL) We fixed a bug manifested with an 
 error, ``is not of the expected type (UNSIGNED-BYTE 32).''  (Technical note: 
 Function <span class="v">ccl::set-lisp-heap-gc-threshold</span> requires a fixnum, but was 
 passed a bignum.)  Thanks to Harsh Raju Chamarthi for sending us a log that 
 exhibited this bug, namely 
 <span class="v">books/oracle/stv-invariant-extraction-pitfall/alu.lisp</span>, which seems to 
 have evoked the bug by using an unusually large amount of memory.</p> 
 
 <p>One might reasonably expect that for a <a href="ACL2____REWRITE.html">rewrite</a> or <a href="ACL2____LINEAR.html">linear</a> rule 
 with a hypothesis of the form <span class="v">(<a href="ACL2____FORCE.html">force</a> ...)</span> or <span class="v">(<a href="ACL2____CASE-SPLIT.html">case-split</a> ...)</span>, an 
 attempt to relieve that hypothesis should be successful when forcing is 
 enabled.  The situation is a bit tricky if the hypothesis has free variables, 
 but even then, one would expect success if the <span class="v">:match-free</span> value is the 
 default, <span class="v">:all</span>, or if no suitable bindings are found.  Such attempts had 
 however not always been successful; but they are now, and the relevant 
 documentation on <a href="ACL2____FREE-VARIABLES.html">free-variables</a> has been clarified.  For an example 
 exhibiting the bug, see the comment about ``free variables'' in Community 
 Books file <span class="tt">system/doc/acl2-doc.lisp</span>, in the form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-7-2
 ...)</span>.</p> 
 
 <p>An inappropriate warning has been eliminated for some <a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a> rules, for example the following.</p> 
 
 <pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> foo
  (<a href="ACL2____IMPLIES.html">implies</a> (<a href="ACL2____ALISTP.html">alistp</a> mem)
           (<a href="COMMON-LISP____OR.html">or</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____ASSOC.html">assoc</a> loc mem) nil)
               (<a href="COMMON-LISP____CONSP.html">consp</a> (<a href="COMMON-LISP____ASSOC.html">assoc</a> loc mem))))
  :rule-classes :type-prescription)</pre> 
 
 <p>The warning had claimed that the rule ``may be weaker than you expect'' 
 because the theorem itself ``is not provable using type-set reasoning''.  But 
 the theorem is provable when <a href="ACL2____GUARD-HOLDERS.html">guard-holders</a> are removed, as could 
 generally be expected; so now, the check is applied after removing 
 guard-holders from the theorem.</p> 
 
 <p>The <a href="ACL2____GUARD.html">guard</a>s stored for <a href="ACL2____MACROS.html">macros</a> now include <a href="COMMON-LISP____TYPE.html">type</a> 
 declarations.  Formerly the guards stored for macros were based only on the 
 <span class="v">:</span><span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> <span class="v">:guard</span> keyword.  Consider for example the following 
 definition.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFMACRO.html">defmacro</a> foo (x)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____TYPE.html">type</a> integer x))
  x)

(<a href="COMMON-LISP____DEFUN.html">defun</a> bar (y)
  (foo y))</pre> 
 
 <p>Formerly, no error occurred when processing the definition of <span class="v">bar</span>, 
 because the guard stored for <span class="v">foo</span> was <span class="v">t</span>.  Now, the guard stored for 
 <span class="v">foo</span> is <span class="v">(<a href="COMMON-LISP____INTEGERP.html">integerp</a> x)</span>; since the variable <span class="v">y</span> is not an integer (it 
 is a symbol), the attempted <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> for <span class="v">bar</span> causes an error.</p> 
 
 <h3>Changes at the System Level</h3> 
 
 <p>ACL2 is now defined to incorporate its <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> features.  We 
 formerly supported building ACL2 without these features, resulting in 
 so-called Classic ACL2, also called ``ACL2(c)''.  Such builds are no longer 
 supported: although it is still technically possible to build ACL2(c), we do 
 not stand behind such builds; in particular, we do not test them, and we have 
 removed the <span class="v">GNUmakefile</span> target, <span class="v">saved_acl2c</span>.</p> 
 
 <p>(CCL only) Starting with CCL Version 16384, EGC (the ephemeral garbage 
 collector) is enabled in ACL2 by default, in place of a ``<span class="v">start-sol-gc</span>'' 
 memory management scheme, but with some of the delay in full garbage 
 collection that had been provided by that scheme.  That scheme is still 
 available to users, under a different name and inside the ACL2 loop; see <a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a>.  (Note that both <span class="v">set-gc-strategy</span> and <span class="v">gc-strategy</span> 
 have been added to <span class="tt"><a href="ACL2_____A2ACL2-EXPORTS_A2.html">*ACL2-exports*</a></span>.)  Thanks to Gary Byers for CCL 
 improvements leading to this change, and to him, Bob Boyer, Jared Davis, and 
 Sol Swords for helpful discussions.  The default behavior can be restored to 
 the previous behavior at ACL2 build time, by setting <span class="v">Make</span> variable 
 <span class="v">ACL2_EGC_ON=nil</span> when building an ACL2 executable.</p> 
 
 <p>A new mechanism allows importing of theorems into the ACL2 source code, 
 thus extending the existing mechanism for importing termination and guard 
 verification for system functions (see the item above about <span class="tt"><a href="ACL2____TERM-ORDER.html">term-order</a></span>, <span class="v">merge-sort-term-order</span>, and so on).  Using this mechanism, 
 some theorems have been imported from a new community book, 
 <span class="v">books/system/termp.lisp</span>.  (For an example of how ACL2 developers use this 
 mechanism, see the call of <span class="v">system-events</span> in ACL2 source file 
 <span class="v">boot-strap-pass-2.lisp</span>.)</p> 
 
 <p>File <span class="v">GNUmakefile</span> in the (top-level) ACL2 sources directory now sets 
 environment variable <span class="v">TIME_CERT</span> so that regressions will generate timing 
 information.</p> 
 
 <p>(SBCL only) The <span class="v">--control-stack-size</span> argument for ACL2 executables 
 saved for SBCL is now 64 (formerly 16).  Thanks to Jared Davis for requesting 
 this increase.</p> 
 
 <p>The existing utility <span class="tt"><a href="ACL2____GET-EVENT-DATA.html">get-event-data</a></span> is now documented.  Moreover, 
 it can be used for determining whether an interrupt (Control-C) occurred 
 during execution of an event.  (This capability is used in a new utility, 
 <span class="tt"><a href="ACL2____REMOVABLE-RUNES.html">removable-runes</a></span>.)  See <a href="ACL2____GET-EVENT-DATA.html">get-event-data</a>.</p> 
 
 <p>The startup banner now shows the git commit hash for development 
 snapshots.  Thanks to Bob Boyer for suggesting such a modification and to 
 Jared Davis for bringing to our attention the appropriate git command for 
 retrieving the hash.</p> 
 
 <p>(CMUCL only) It is now the case for CMUCL that <span class="tt"><a href="ACL2____SETENV_42.html">setenv$</a></span> modifies the 
 environment of the underlying Lisp process.  Thanks to Jared Davis for this 
 suggestion, and for pointing out that CCL and SBCL [at least] already have 
 this behavior.</p> 
 
 <p>A new optimize declaration for <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>, <span class="v">(:stack-access 3)</span>, can 
 result in some speed up for evaluations done when the host Lisp is CCL (but is 
 likely to be a no-op in other host Lisps).  Thus, you may write: <span class="v">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 foo (x) (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____OPTIMIZE.html">optimize</a> (:stack-access 3))) ...)</span>.  Thanks to Gary Byers 
 and the CCL team for their excellent compiler work, including the new 
 <span class="v">stack-access</span> feature, and to Bob Boyer and Warren Hunt for helpful 
 discussions.  To build ACL2 on CCL with this feature, add the variable setting 
 <span class="v">ACL2_STACK_ACCESS=3</span> to the <span class="v">make</span> command that you invoke to build 
 ACL2.  NOTE: The use of ACL2_STACK_ACCESS relies on recognition by CCL of the 
 <span class="v">:stack-access</span> keyword for optimize expressions, hence will only have 
 effect for CCL versions starting with 16678.</p> 
 
 <p>(CMUCL only) Updated saved_acl2 for CMUCL to use maximum heap for CMU 
 Common Lisp snapshot-2016-01 and beyond.  Thanks to Raymond Toy for updating 
 CMUCL such that one can specify with <span class="v">-dynamic-space-size 0</span> that the 
 maximum heap is used.</p> 
 
 <h3>EMACS Support</h3> 
 
 <p>We made several improvements in the <a href="ACL2____ACL2-DOC.html">ACL2-doc</a> browser.</p> 
 
 <ul> 
 
 <li>A bug has been fixed in the <span class="v">S</span> command (<span class="v">acl2-doc-re-search</span>).</li> 
 
 <li>The help message is displayed more often (but only, we think, when 
 appropriate) in the echo area (i.e., below the mode line).</li> 
 
 <li>The <span class="v">q</span> command (<span class="v">acl2-doc-quit</span>) now can be run from any buffer in 
 <span class="v">acl2-doc</span> mode, for example after typing the <span class="v">H</span> command.  Moreover, 
 all such buffers will be buried after <span class="v">q</span>; formerly, if you quit from the 
 main <span class="v">acl2-doc</span> buffer you could have been left in the 
 <span class="v">acl2-doc-history</span> buffer.</li> 
 
 </ul> 
 
 <p><span class="tt"><a href="ACL2____VERIFY-TERMINATION.html">Verify-termination</a></span> calls are now indented like <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> calls. 
 Thanks to Alessandro Coglio for suggesting this change to 
 <span class="v">emacs/emacs-acl2.el</span>.</p> 
 
 <p>The <a href="ACL2____ACL2-DOC.html">ACL2-doc</a> Emacs browser now allows handling of topics with square 
 brackets.  This fix was necessary because a new topic, <span class="tt">SV::4VEC-[=</span>, 
 broke acl2-doc; it wouldn't initialize.  The fix simply replaces characters 
 <span class="v">#\[</span> and <span class="v">#\]</span> with <span class="v">#\&lt;</span> and <span class="v">#\&gt;</span>, respectively.  It's not 
 a perfect fix, but it seems awkward to try to escape <span class="v">#\[</span> (which Emacs 
 Lisp thinks starts a vector).  See community book 
 <span class="v">system/doc/render-doc-base.lisp</span>.</p> 
 
 <h3>Experimental Versions</h3> 
 
 <p>Fixed some interleaved output that could appear with <a href="ACL2____WATERFALL-PARALLELISM.html">waterfall-parallelism</a> enabled.  Thanks to Eric Smith for reporting this 
 problem and to David Rager for a helpful chat.</p> 
 
 
</body>
</html>
