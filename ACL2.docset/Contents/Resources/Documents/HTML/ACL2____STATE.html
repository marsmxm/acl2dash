<html>
<head>
<meta charset="UTF-8">
<title>State</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____STATE">Click for State in the Full Manual</a></h3>

<p>The von Neumannesque ACL2 state object</p><p>Note: If you are interested in programming with state, see <a href="ACL2____PROGRAMMING-WITH-STATE.html">programming-with-state</a> after reading the information below.</p> 
 
 <p>The ACL2 state object is used extensively in programming the ACL2 system, 
 and has been used in other ACL2 programs as well.  However, most users, 
 especially those interested in specification and verification (as opposed to 
 programming <i>per se</i>), need not be aware of the role of the state object 
 in ACL2, and will not write functions that use it explicitly.  We say more 
 about this point at the end of this documentation topic.</p> 
 
 <p>The ACL2 state object is an example of a single-threaded object or <a href="ACL2____STOBJ.html">stobj</a>.  ACL2 allows the user to define new single-threaded objects. 
 Generally, ACL2 may need to access the ACL2 state but should not (cannot) 
 change it except via a certain set of approved functions such as <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> 
 and <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span>.  If you need a state-like object to which you have 
 complete rights, you may want a <a href="ACL2____STOBJ.html">stobj</a>.</p> 
 
 <p>Key to the idea of our <span class="v">state</span> is the notion of single-threadedness. 
 For an explanation, see <a href="ACL2____STOBJ.html">stobj</a>.  The upshot of it is that <span class="v">state</span> is 
 a variable symbol with severe restrictions on its use, so that it can be 
 passed into only certain functions in certain slots, and must be returned by 
 those functions that ``modify'' it.  Henceforth, we do not discuss 
 single-threaded objects in general (which the user can introduce with <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span> and <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span>) but one in particular, namely ACL2's 
 <span class="v">state</span> object.</p> 
 
 <p>The <i>global table</i> is perhaps the most visible portion of the state 
 object.  Using the interface functions <span class="v">@</span> and <span class="v">assign</span>, a user may bind 
 global variables to the results of function evaluations (much as an Nqthm user 
 exploits the Nqthm utility <span class="v">r-loop</span>).  See <a href="ACL2_____04.html">@</a>, and see <a href="ACL2____ASSIGN.html">assign</a>. 
 A particularly interesting global is <span class="v">'current-acl2-world</span>, whose value is 
 the ACL2 logical <a href="ACL2____WORLD.html">world</a>.</p> 
 
 <p>ACL2 supports several facilities of a truly von Neumannesque state machine 
 character, including file <a href="ACL2____IO.html">io</a> and global variables.  Logically speaking, 
 the state is a true list of the 14 components described below.  There is a 
 ``current'' state object at the top-level of the ACL2 <a href="ACL2____COMMAND.html">command</a> loop. 
 This object is understood to be the value of what would otherwise be the free 
 variable <span class="v">state</span> appearing in top-level input.  When any <a href="ACL2____COMMAND.html">command</a> 
 returns a state object as one of its values, that object becomes the new 
 current state.  But ACL2 provides von Neumann style speed for state operations 
 by maintaining only one physical (as opposed to logical) state object. 
 Operations on the state are in fact destructive.  This implementation does not 
 violate the applicative semantics because we enforce certain draconian 
 syntactic rules regarding the use of state objects.  For example, one cannot 
 ``hold on'' to an old state, access the components of a state arbitrarily, or 
 ``modify'' a state object without passing it on to subsequent state-sensitive 
 functions.</p> 
 
 <p>Every routine that uses the state facilities (e.g. does <a href="ACL2____IO.html">io</a>, or calls 
 a routine that does <a href="ACL2____IO.html">io</a>), must be passed a ``state object.'' And a 
 routine must return a state object if the routine modifies the state in any 
 way.  Rigid syntactic rules governing the use of state objects are enforced by 
 the function <span class="v">translate</span>, through which all ACL2 user input first passes. 
 State objects can only be ``held'' in the formal parameter <span class="v">state</span>, never 
 in any other formal parameter and never in any structure (excepting a 
 multiple-value return list field which is always a state object).  State 
 objects can only be accessed with the primitives we specifically permit. 
 Thus, for example, one cannot ask, in code to be executed, for the length of 
 <span class="v">state</span> or the <span class="tt"><a href="COMMON-LISP____CAR.html">car</a></span> of <span class="v">state</span>.  In the statement and proof of 
 theorems, there are no syntactic rules prohibiting arbitrary treatment of 
 state objects.</p> 
 
 <p>Logically speaking, a state object is a true list whose members are as 
 follows:</p> 
 
 <blockquote> 
 
 <p><span class="v">Open-input-channels</span>, an alist with keys that are symbols in package 
 <span class="v">"ACL2-INPUT-CHANNEL"</span>.  The value (<span class="tt"><a href="COMMON-LISP____CDR.html">cdr</a></span>) of each pair has the 
 form <span class="v">((:header type file-name open-time) . elements)</span>, where <span class="v">type</span> is 
 one of <span class="v">:character</span>, <span class="v">:byte</span>, or <span class="v">:object</span> and <span class="v">elements</span> is a 
 list of things of the corresponding <span class="v">type</span>, i.e. characters, integers of 
 type <span class="v">(<a href="COMMON-LISP____MOD.html">mod</a> 255)</span>, or lisp objects in our theory.  <span class="v">File-name</span> is a 
 string.  <span class="v">Open-time</span> is an integer.  See <a href="ACL2____IO.html">io</a>.</p> 
 
 <p><span class="v">Open-output-channels</span>, an alist with keys that are symbols in package 
 <span class="v">"ACL2-OUTPUT-CHANNEL"</span>.  The value of a pair has the form <span class="v">((:header
 type file-name open-time) .  current-contents)</span>.  See <a href="ACL2____IO.html">io</a>.</p> 
 
 <p><span class="v">Global-table</span>, an alist associating symbols (to be used as ``global 
 variables'') with values.  See <a href="ACL2_____04.html">@</a>, and see <a href="ACL2____ASSIGN.html">assign</a>.</p> 
 
 <p><span class="v">T-stack</span>, a list of arbitrary objects accessed and changed by the 
 functions <span class="v">aref-t-stack</span> and <span class="v">aset-t-stack</span>.</p> 
 
 <p><span class="v">32-bit-integer-stack</span>, a list of arbitrary 32-bit-integers accessed and 
 changed by the functions <span class="v">aref-32-bit-integer-stack</span> and 
 <span class="v">aset-32-bit-integer-stack</span>.</p> 
 
 <p><span class="v">Big-clock-entry</span>, an integer, that is used logically to bound the 
 amount of effort spent to evaluate a quoted form.</p> 
 
 <p><span class="v">Idates</span>, a list of dates and times, used to implement the function 
 <span class="v">print-current-idate</span>, which prints the date and time.</p> 
 
 <p><span class="v">Acl2-oracle</span>, a list of objects, used for example to implement the 
 functions that let ACL2 report how much time was used, but inaccessible to the 
 user.  See <span class="tt"><a href="ACL2____READ-ACL2-ORACLE.html">read-ACL2-oracle</a></span> and also see <span class="tt"><a href="ACL2____WITH-PROVER-TIME-LIMIT.html">with-prover-time-limit</a></span>.</p> 
 
 <p><span class="v">File-clock</span>, an integer that is increased on every file opening and 
 closing, and is used to maintain the consistency of the <span class="tt"><a href="ACL2____IO.html">io</a></span> 
 primitives.</p> 
 
 <p><span class="v">Readable-files</span>, an alist whose keys have the form <span class="v">(<a href="COMMON-LISP____STRING.html">string</a> type
 time)</span>, where <span class="tt"><a href="COMMON-LISP____STRING.html">string</a></span> is a file name and <span class="v">time</span> is an integer.  The 
 value associated with such a key is a list of characters, bytes, or objects, 
 according to <span class="v">type</span>.  The <span class="v">time</span> field is used in the following way: 
 when it comes time to open a file for input, we will only look for a file of 
 the specified name and <span class="v">type</span> whose time field is that of <span class="v">file-clock</span>. 
 This permits us to have a ``probe-file'' aspect to <span class="v">open-file</span>: one can ask 
 for a file, find it does not exist, but come back later and find that it does 
 now exist.</p> 
 
 <p><span class="v">Written-files</span>, an alist whose keys have the form <span class="v">(<a href="COMMON-LISP____STRING.html">string</a> type time1
 time2)</span>, where <span class="tt"><a href="COMMON-LISP____STRING.html">string</a></span> is a file name, <span class="v">type</span> is one of 
 <span class="v">:character</span>, <span class="v">:byte</span> or <span class="v">:object</span>, and <span class="v">time1</span> and <span class="v">time2</span> are 
 integers.  <span class="v">Time1</span> and <span class="v">time2</span> correspond to the <span class="v">file-clock</span> time at 
 which the channel for the file was opened and closed.  This field is 
 write-only; the only operation that affects this field is 
 <span class="v">close-output-channel</span>, which <span class="tt"><a href="COMMON-LISP____CONS.html">cons</a></span>es a new entry on the front.</p> 
 
 <p><span class="v">Read-files</span>, a list of the form <span class="v">(<a href="COMMON-LISP____STRING.html">string</a> type time1 time2)</span>, where 
 <span class="tt"><a href="COMMON-LISP____STRING.html">string</a></span> is a file name and <span class="v">time1</span> and <span class="v">time2</span> were the times at 
 which the file was opened for reading and closed.  This field is write 
 only.</p> 
 
 <p><span class="v">Writeable-files</span>, an alist whose keys have the form <span class="v">(<a href="COMMON-LISP____STRING.html">string</a> type
 time)</span>.  To open a file for output, we require that the name, type, and time 
 be on this list.</p> 
 
 <p><span class="v">List-all-package-names-lst</span>, a list of <span class="v">true-listps</span>.  Roughly 
 speaking, the <span class="tt"><a href="COMMON-LISP____CAR.html">car</a></span> of this list is the list of all package names known 
 to this Common Lisp right now and the <span class="tt"><a href="COMMON-LISP____CDR.html">cdr</a></span> of this list is the value of 
 this <span class="v">state</span> variable after you look at its <span class="tt"><a href="COMMON-LISP____CAR.html">car</a></span>.  The function, 
 <span class="v">list-all-package-names</span>, which takes the state as an argument, returns the 
 <span class="tt"><a href="COMMON-LISP____CAR.html">car</a></span> and <span class="tt"><a href="COMMON-LISP____CDR.html">cdr</a></span>s the list (returning a new state too).  This 
 essentially gives ACL2 access to what is provided by CLTL's 
 <span class="v">list-all-packages</span>.  <span class="tt"><a href="ACL2____DEFPKG.html">Defpkg</a></span> uses this feature to ensure that the 
 about-to-be-created package is new in this lisp.  Thus, for example, in 
 <span class="v">akcl</span> it is impossible to create the package <span class="v">"COMPILER"</span> with <span class="tt"><a href="ACL2____DEFPKG.html">defpkg</a></span> because it is on the list, while in Lucid that package name is not 
 initially on the list.</p> 
 
 <p><span class="v">User-stobj-alist</span>, an alist which associates user-defined 
 single-threaded objects (see <a href="ACL2____STOBJ.html">stobj</a>) with their values.</p>
</blockquote> 
 
 <p>We recommend avoiding the use of the state object when writing ACL2 code 
 intended to be used as a formal model of some system, for several reasons. 
 First, the state object is complicated and contains many components that are 
 oriented toward implementation and are likely to be irrelevant to the model in 
 question.  Second, there is currently not much support for reasoning about 
 ACL2 functions that manipulate the state object, beyond their logical 
 definitions.  Third, the documentation about state is not as complete as one 
 might wish.</p> 
 
 <p>User-defined single-threaded objects offer the speed of <span class="v">state</span> while 
 giving the user complete access to all the fields.  See <a href="ACL2____STOBJ.html">stobj</a>.</p> 
 
 <p>Again, if you are interested in programming with state see <a href="ACL2____PROGRAMMING-WITH-STATE.html">programming-with-state</a>.</p>
</body>
</html>
