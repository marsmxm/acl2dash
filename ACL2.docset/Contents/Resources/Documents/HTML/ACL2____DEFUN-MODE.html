<html>
<head>
<meta charset="UTF-8">
<title>Defun-mode</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____DEFUN-MODE">Click for Defun-mode in the Full Manual</a></h3>

<p>Determines whether a function definition is a logical act</p><p>Two ``<a href="ACL2____DEFUN-MODE.html">defun-mode</a>s'' are supported, <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> and 
 <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span>.  Roughly speaking, <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode allows you 
 to prototype a function for execution without any proof burdens, while 
 <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode allows you to add a new definitional axiom to the 
 logic.  The system comes up in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode.  Execution of 
 functions whose <a href="ACL2____DEFUN-MODE.html">defun-mode</a> is <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> may render ACL2 
 unsound!  See <a href="ACL2____DEFUN-MODE-CAVEAT.html">defun-mode-caveat</a>.</p> 
 
 <p>Note that calls of <span class="tt"><a href="ACL2____LOCAL.html">local</a></span> and of many <a href="ACL2____EVENTS.html">events</a> are skipped in 
 <span class="v">:program</span> mode; see <a href="ACL2____PROGRAM.html">program</a>.</p> 
 
 <p>When you define a function in the ACL2 logic, that function can be run on 
 concrete data.  But it is also possible to reason deductively about the 
 function because each definition extends the underlying logic with a 
 definitional axiom.  To ensure that the logic is sound after the addition of 
 this axiom, certain restrictions have to be met.  One restriction is that 
 every function called by the newly defined one must be in <span class="v">:logic</span> mode. 
 (However, see <a href="ACL2____DEFUN-MODE-LAMBDAS.html">defun-mode-lambdas</a> for some clarification concerning 
 <span class="tt"><a href="ACL2____APPLY_42.html">apply$</a></span>.)  But the most challenging restriction is that the system must 
 prove that the recursion in the new definition terminates.</p> 
 
 <p>Because ACL2 is a <a href="ACL2____PROGRAMMING.html">programming</a> language, you often may wish simply to 
 program in ACL2.  For example, you may wish to define your system and test it, 
 without any logical burden.  Or, you may wish to define ``utility'' functions 
 — functions that are executed to help manage the task of building your 
 system but functions whose logical properties are of no immediate concern. 
 Such functions might be used to generate test data or help interpret the 
 results of tests.  They might create files or explore the ACL2 database.  The 
 termination arguments for such functions are an unnecessary burden provided no 
 axioms about the functions are ever used in deductions.</p> 
 
 <p>Thus, ACL2 introduces the idea of the ``<a href="ACL2____DEFUN-MODE.html">defun-mode</a>'' of a function. 
 The <span class="v">:mode</span> keyword of <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>'s <span class="tt"><a href="COMMON-LISP____DECLARE.html">declare</a></span> <span class="v">xarg</span> allows you 
 to specify the <a href="ACL2____DEFUN-MODE.html">defun-mode</a> of a given definition.  If no <span class="v">:mode</span> 
 keyword is supplied, the default <a href="ACL2____DEFUN-MODE.html">defun-mode</a> is used; see <a href="ACL2____DEFAULT-DEFUN-MODE.html">default-defun-mode</a>.</p> 
 
 <p>There are two <a href="ACL2____DEFUN-MODE.html">defun-mode</a>s, each of which is written as a 
 keyword:</p> 
 
 <p><span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> — logically undefined but executable outside 
 deductive contexts.</p> 
 
 <p><span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> — axiomatically defined as per the ACL2 
 definitional principle.</p> 
 
 <p>It is possible to change the <a href="ACL2____DEFUN-MODE.html">defun-mode</a> of a function from 
 <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> to <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span>.  We discuss this below.</p> 
 
 <p>We think of functions having <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode as ``dangerous'' 
 functions, while functions having <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode are ``safe.''  The 
 only requirement enforced on <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode functions is the 
 syntactic one: each definition must be well-formed ACL2.  Naively speaking, if 
 a <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode function fails to terminate then no harm is done 
 because no axiom is added (so inconsistency is avoided) and some invocations 
 of the function may simply never return.  This simplistic justification of 
 <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode execution is faulty because it ignores the damage 
 that might be caused by ``mis-guarded'' functions.  See <a href="ACL2____DEFUN-MODE-CAVEAT.html">defun-mode-caveat</a>.</p> 
 
 <p>We therefore implicitly describe an imagined implementation of <a href="ACL2____DEFUN-MODE.html">defun-mode</a>s that is safe and, we think, effective.  But please see <a href="ACL2____DEFUN-MODE-CAVEAT.html">defun-mode-caveat</a>.</p> 
 
 <p>The default <a href="ACL2____DEFUN-MODE.html">defun-mode</a> is <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span>.  This means that when 
 you <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> a function the system will try to prove termination.  If you 
 wish to introduce a function of a different <a href="ACL2____DEFUN-MODE.html">defun-mode</a> use the 
 <span class="v">:mode</span> <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> keyword.  Below we show <span class="v">fact</span> introduced as a 
 function in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> fact (n)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :program))
  (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____OR.html">or</a> (<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____INTEGERP.html">integerp</a> n)) (<a href="COMMON-LISP_____D3.html">=</a> n 0))
      1
    (<a href="COMMON-LISP_____A2.html">*</a> n (fact (<a href="COMMON-LISP____1-.html">1-</a> n)))))</pre> 
 
 <p>No axiom is added to the logic as a result of this definition.  By 
 introducing <span class="v">fact</span> in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode we avoid the burden of a 
 termination proof, while still having the option of executing the function. 
 For example, you can type</p> 
 
 <pre class="code">ACL2 !&gt;(fact 3)</pre> 
 
 <p>and get the answer <span class="v">6</span>.  If you type <span class="v">(fact -1)</span> you will get a hard 
 lisp error due to ``infinite recursion.''</p> 
 
 <p>However, the ACL2 theorem prover knows no axioms about <span class="v">fact</span>.  In 
 particular, if the term <span class="v">(fact 3)</span> arises in a proof, the theorem prover is 
 unable to deduce that it is <span class="v">6</span>.  From the perspective of the theorem 
 prover it is as though <span class="v">fact</span> were an undefined function symbol of arity 
 <span class="v">1</span>.  Thus, modulo certain important issues (see <a href="ACL2____DEFUN-MODE-CAVEAT.html">defun-mode-caveat</a>), 
 the introduction of this function in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode does not 
 imperil the soundness of the system — despite the fact that the 
 termination argument for <span class="v">fact</span> was omitted — because nothing of 
 interest can be proved about <span class="v">fact</span>.  Indeed, we do not allow <span class="v">fact</span> to 
 be used in logical contexts such as conjectures submitted for proof.</p> 
 
 <p>It is possible to convert a function from <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode to 
 <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode at the cost of proving that it is admissible.  This 
 can be done by invoking</p> 
 
 <pre class="code">(<a href="ACL2____VERIFY-TERMINATION.html">verify-termination</a> fact)</pre> 
 
 <p>which is equivalent to submitting the <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> of <span class="v">fact</span>, again, 
 but in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> fact (n)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :logic))
  (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____OR.html">or</a> (<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____INTEGERP.html">integerp</a> n)) (<a href="COMMON-LISP_____D3.html">=</a> n 0))
      1
    (<a href="COMMON-LISP_____A2.html">*</a> n (fact (<a href="COMMON-LISP____1-.html">1-</a> n)))))</pre> 
 
 <p>This particular event will fail because the termination argument requires 
 that <span class="v">n</span> be nonnegative.  A repaired <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>, for example with <span class="tt"><a href="COMMON-LISP_____D3.html">=</a></span> replaced by <span class="tt"><a href="COMMON-LISP_____C3_D3.html">&lt;=</a></span>, will succeed, and an axiom about <span class="v">fact</span> will 
 henceforth be available.</p> 
 
 <p>Technically, <span class="tt"><a href="ACL2____VERIFY-TERMINATION.html">verify-termination</a></span> submits a redefinition of the 
 <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode function.  This is permitted, even when <span class="tt"><a href="ACL2____LD-REDEFINITION-ACTION.html">ld-redefinition-action</a></span> is <span class="v">nil</span>, because the new definition is identical 
 to the old (except for its <span class="v">:mode</span> and, possibly, other non-logical 
 properties).</p> 
 
 <p>See <a href="ACL2____GUARD.html">guard</a> for a discussion of how to restrict the execution of 
 functions.  <a href="ACL2____GUARD.html">Guard</a>s may be ``verified'' for functions in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode; see <a href="ACL2____VERIFY-GUARDS.html">verify-guards</a>.</p>
</body>
</html>
