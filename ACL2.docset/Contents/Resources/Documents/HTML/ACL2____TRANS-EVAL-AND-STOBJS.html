<html>
<head>
<meta charset="UTF-8">
<title>Trans-eval-and-stobjs</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____TRANS-EVAL-AND-STOBJS">Click for Trans-eval-and-stobjs in the Full Manual</a></h3>

<p>How user-defined <a href="ACL2____STOBJ.html">stobj</a>s are handled by <span class="tt"><a href="ACL2____TRANS-EVAL.html">trans-eval</a></span></p><p>See <a href="ACL2____TRANS-EVAL.html">trans-eval</a> for basic background on the relatively 
 advanced system utility, <span class="v">trans-eval</span>.  In this topic we discuss how 
 <span class="v">trans-eval</span> handles user-defined <a href="ACL2____STOBJ.html">stobj</a>s.</p> 
 
 <p>A field of the ACL2 <a href="ACL2____STATE.html">state</a>, the <span class="v">user-stobj-alist</span>, is an 
 association list (alist) that maps each user-defined <a href="ACL2____STOBJ.html">stobj</a> name to its 
 current value.  <span class="v">Trans-eval</span> evaluates with respect to this alist, so that 
 any time a variable (which must be a stobj name) is to be evaluated, its value 
 is looked up in that alist.</p> 
 
 <p>For example, suppose that you evaluate the following forms in the top-level 
 ACL2 loop.</p> 
 
 <pre class="code">(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st fld)
(fld st)</pre> 
 
 <p>To evaluate the expression, <span class="v">(fld st)</span>, ACL2 calls <span class="tt"><a href="ACL2____TRANS-EVAL.html">trans-eval</a></span> 
 — or more accurately its variant, <span class="tt"><a href="ACL2____TRANS-EVAL-DEFAULT-WARNING.html">trans-eval-default-warning</a></span> 
 — on that expression.  (We generally consider all such variants to be 
 the same as <span class="v">trans-eval</span> for purposes of this documentation topic.) 
 Although <span class="v">st</span> has the syntax of a global variable, it is bound in the 
 <span class="v">user-stobj-alist</span>.  Here we see <span class="v">trans-eval</span> in action.</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____TRACE_42.html">trace$</a> trans-eval-default-warning)
 ((<a href="ACL2____TRANS-EVAL-DEFAULT-WARNING.html">TRANS-EVAL-DEFAULT-WARNING</a>))
ACL2 !&gt;(fld st)
1&gt; (<a href="ACL2____TRANS-EVAL-DEFAULT-WARNING.html">TRANS-EVAL-DEFAULT-WARNING</a> (FLD ST)
                               TOP-LEVEL |*the-live-state*| T)
&lt;1 (<a href="ACL2____TRANS-EVAL-DEFAULT-WARNING.html">TRANS-EVAL-DEFAULT-WARNING</a> NIL ((NIL))
                               |*the-live-state*|)
NIL
ACL2 !&gt;</pre> 
 
 <p>This call of <span class="v">trans-eval</span> (or more accurately, 
 <span class="v">trans-eval-default-warning</span>) invokes an ACL2 evaluator <span class="v">(ev form alist
 state ...)</span>, by calling it on the form <span class="v">(fld st)</span> and an alist that binds 
 the variable <span class="v">st</span> to its value in the <span class="v">user-stobj-alist</span> component of 
 the ACL2 <a href="ACL2____STATE.html">state</a>.  We may refer to this value as the ``global value of'' 
 <span class="v">st</span>.</p> 
 
 <p>We can of course update this stobj.</p> 
 
 <pre class="code">ACL2 !&gt;(update-fld 3 st)
1&gt; (<a href="ACL2____TRANS-EVAL-DEFAULT-WARNING.html">TRANS-EVAL-DEFAULT-WARNING</a> (UPDATE-FLD 3 ST)
                               TOP-LEVEL |*the-live-state*| T)
&lt;1 (<a href="ACL2____TRANS-EVAL-DEFAULT-WARNING.html">TRANS-EVAL-DEFAULT-WARNING</a> NIL ((ST) . REPLACED-ST)
                               |*the-live-state*|)
&lt;st&gt;
ACL2 !&gt;(fld st) ; check that the update occurred
1&gt; (<a href="ACL2____TRANS-EVAL-DEFAULT-WARNING.html">TRANS-EVAL-DEFAULT-WARNING</a> (FLD ST)
                               TOP-LEVEL |*the-live-state*| T)
&lt;1 (<a href="ACL2____TRANS-EVAL-DEFAULT-WARNING.html">TRANS-EVAL-DEFAULT-WARNING</a> NIL ((NIL) . 3)
                               |*the-live-state*|)
3
ACL2 !&gt;</pre> 
 
 <p>We see above that the global value of <span class="v">st</span> was indeed updated by 
 evaluating the <span class="v">update-fld</span> call.  That is: the value of <span class="v">st</span> in the 
 <span class="v">user-stobj-alist</span> of the ACL2 <span class="tt"><a href="ACL2____STATE.html">state</a></span> was updated by calling <span class="tt"><a href="ACL2____TRANS-EVAL.html">trans-eval</a></span> on the expression, <span class="v">(update-fld 3 st)</span>.  More generally: as 
 <span class="v">trans-eval</span> returns, it updates the <span class="v">user-stobj-alist</span> of the ACL2 
 <a href="ACL2____STATE.html">state</a> according to all stobj values that have been returned.</p>
</body>
</html>
