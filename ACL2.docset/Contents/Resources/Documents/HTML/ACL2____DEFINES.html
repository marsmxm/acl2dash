<html>
<head>
<meta charset="UTF-8">
<title>Defines</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____DEFINES">Click for Defines in the Full Manual</a></h3>

<p>A very fine alternative to <a href="ACL2____MUTUAL-RECURSION.html">mutual-recursion</a>.</p><p><span class="v">Defines</span> is a sophisticated macro for introducing mutually 
recursive functions using <a href="ACL2____DEFINE.html">define</a>.  It gives you:</p> 
 
<ul> 
 
<li>The usual benefits of <span class="v">define</span>—<a href="STD____EXTENDED-FORMALS.html">extended-formals</a>, concise 
<a href="ACL2____XARGS.html">xargs</a> syntax, <a href="STD____RETURNS-SPECIFIERS.html">returns-specifiers</a>, <a href="ACL2____XDOC.html">xdoc</a> integration, easy 
inlining, and so on.</li> 
 
<li>Automatic <a href="ACL2____MAKE-FLAG.html">ACL2::make-flag</a> integration, so you can easily prove 
inductive theorems about your new definitions.</li> 
 
</ul> 
 
<h3>Examples</h3> 
 
<pre class="code">  (<a href="ACL2____DEFINES.html">defines</a> terms
    :parents (syntax)
    :short "Example of terms in some simple, numeric language."

    (<a href="ACL2____DEFINE.html">define</a> my-termp (x)
      (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____ATOM.html">atom</a> x)
          (<a href="ACL2____NATP.html">natp</a> x)
        (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> (<a href="COMMON-LISP____CAR.html">car</a> x))
             (my-term-listp (<a href="COMMON-LISP____CDR.html">cdr</a> x))))
      ///
      (<a href="ACL2____DEFTHM.html">defthm</a> natp-when-my-termp
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____ATOM.html">atom</a> x)
                 (<a href="COMMON-LISP____EQUAL.html">equal</a> (my-termp x)
                        (<a href="ACL2____NATP.html">natp</a> x))))
      (<a href="ACL2____DEFTHM.html">defthm</a> my-termp-of-cons
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (my-termp (<a href="COMMON-LISP____CONS.html">cons</a> fn args))
               (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn)
                    (my-term-listp args)))))

    (<a href="ACL2____DEFINE.html">define</a> my-term-listp (x)
      (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____ATOM.html">atom</a> x)
          t
        (<a href="COMMON-LISP____AND.html">and</a> (my-termp (<a href="COMMON-LISP____CAR.html">car</a> x))
             (my-term-listp (<a href="COMMON-LISP____CDR.html">cdr</a> x))))
      ///
      (<a href="STD____DEFLIST.html">deflist</a> my-term-listp (x)
        (my-termp x)
        :already-definedp t)))

(<a href="ACL2____DEFINES.html">defines</a> flattening
  :parents (terms)
  :short "Collect up the arguments of terms."

  (<a href="ACL2____DEFINE.html">define</a> my-flatten-term ((x my-termp))
    :flag term
    :returns (numbers true-listp :rule-classes :type-prescription)
    (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____ATOM.html">atom</a> x)
        (<a href="COMMON-LISP____LIST.html">list</a> x)
      (my-flatten-term-list (<a href="COMMON-LISP____CDR.html">cdr</a> x))))

  (<a href="ACL2____DEFINE.html">define</a> my-flatten-term-list ((x my-term-listp))
    :flag list
    :returns (numbers true-listp :rule-classes :type-prescription)
    (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____ATOM.html">atom</a> x)
        nil
      (<a href="COMMON-LISP____APPEND.html">append</a> (my-flatten-term (<a href="COMMON-LISP____CAR.html">car</a> x))
              (my-flatten-term-list (<a href="COMMON-LISP____CDR.html">cdr</a> x)))))
  ///
  (defthm-flattening-flag
    (<a href="ACL2____DEFTHM.html">defthm</a> nat-listp-of-my-flatten-term
      (<a href="ACL2____IMPLIES.html">implies</a> (my-termp x)
               (<a href="ACL2____NAT-LISTP.html">nat-listp</a> (my-flatten-term x)))
      :flag term)
    (<a href="ACL2____DEFTHM.html">defthm</a> nat-listp-of-my-flatten-term-list
      (<a href="ACL2____IMPLIES.html">implies</a> (my-term-listp x)
               (<a href="ACL2____NAT-LISTP.html">nat-listp</a> (my-flatten-term-list x)))
      :flag list)))</pre> 
 
<h3>Usage</h3> 
 
<p>The general form of <a href="ACL2____DEFINES.html">defines</a> is:</p> 
 
<pre class="code">(<a href="ACL2____DEFINES.html">defines</a> clique-name
  [global options]
  (<a href="ACL2____DEFINE.html">define</a> f1 ...)
  ...
  (<a href="ACL2____DEFINE.html">define</a> fN ...)
  [/// other-events])</pre> 
 
<p>The <span class="v">clique-name</span> may be any symbol—we often just use the name of 
the first function in the clique, but this is not required.  The name is used 
for documentation purposes, and also (by default) is used to name the flag 
function that will be introduced by <a href="ACL2____MAKE-FLAG.html">ACL2::make-flag</a>.</p> 
 
<p>The global options each have the form <span class="v">:name value</span>, and we describe 
these options below.  We usually prefer to put these options at the front of 
the <span class="v">defines</span> form, as shown above, but the options can be put anywhere 
until the <span class="v">///</span> form.</p> 
 
<p>There must be at least two <span class="v">define</span> forms.  These can use the usual <a href="ACL2____DEFINE.html">define</a> syntax, and mostly this all works out naturally.  The most significant 
caveats have to do with how we try to prove the theorems for <span class="v">:returns</span> 
specifiers (see below).</p> 
 
<p>The <span class="v">other-events</span> are a structuring device that allow you to associate 
any arbitrary events.  These events are submitted after the definitions, flag 
function, etc., have been processed.  All of the functions in the clique are 
left enabled while processing these events.</p> 
 
<p>Note that individual <span class="v">define</span>s can have their own other-events.  All of 
these individual sections are processed (with their own local scopes) before 
any global <span class="v">other-events</span>.</p> 
 
<h4>Global Options</h4> 
 
<dl> 
 
<dt>:verbosep bool</dt> 
 
<dd>Normally most output is suppressed, but this can make it hard to understand 
failures.  You can enable <span class="v">:verbosep t</span> for better debugging.</dd> 
 
 
<dt>:mode</dt> 
<dt>:guard-hints, :guard-debug, :verify-guards</dt> 
<dt>:well-founded-relation, :measure-debug, :hints, :otf-flg</dt> 
<dt>:ruler-extenders</dt> 
 
<dd>In an ordinary <a href="ACL2____MUTUAL-RECURSION.html">mutual-recursion</a>, each of these <a href="ACL2____XARGS.html">xargs</a> style 
options can be attached to any <span class="v">defun</span> in the clique.  But we usually think 
of these as global options to the whole clique, so we make them available as 
top-level options to the <span class="v">defines</span> form.  In the implementation, we just 
attach these options to the first <span class="v">defun</span> form generated, except for 
<span class="v">:ruler-extenders</span>, which we apply to all of the defuns.</dd> 
 
 
<dt>:prepwork</dt> 
 
<dd>Arbitrary events to be submitted before the definitions.  Typically this 
might include <a href="ACL2____IN-THEORY.html">in-theory</a> calls, one-off supporting lemmas, etc.  Prepwork 
is not automatically <a href="ACL2____LOCAL.html">local</a>, so lemmas and theory changes should usually 
be explicitly made <a href="ACL2____LOCAL.html">local</a>.</dd> 
 
<dd>Note that each individual <span class="v">define</span> may have its own <span class="v">:prepwork</span> 
section.  All of these sections will be appended together in order, with the 
global <span class="v">:prepwork</span> coming first, and submitted before the definitions.</dd> 
 
 
<dt>:returns-hints hints</dt> 
<dt>:returns-no-induct bool</dt> 
 
<dd>You can give hints for the inductive <span class="v">:returns</span> theorem.  Alternately, 
if you know you don't need to prove the returns theorems inductively, you can 
set <span class="v">:returns-no-induct t</span>, which may improve performance.</dd> 
 
 
<dt>:parents, :short, :long</dt> 
 
<dd>These are global <a href="ACL2____XDOC.html">xdoc</a> options that will be associated with the 
<span class="v">clique-name</span> for this <span class="v">defines</span>.</dd> 
 
<dd>Note that each individual <span class="v">define</span> may separately have its own 
documentation and rest-events.  As a convenience, if global documentation is 
provided while individual documentation is not, a basic topic will be created 
whose <span class="v">:parents</span> point at the <span class="v">clique-name</span>.</dd> 
 
<dd>A corner case is when the <span class="v">clique-name</span> agrees with an individual 
function's name.  In this case we try to grab the documentation from 
<i>either</i> the named function or the global options.  To prevent confusion, 
we cause an error if documentation is provided in both places.</dd> 
 
<dt>:ignore-ok val</dt> 
<dt>:irrelevant-formals-ok val</dt> 
<dt>:bogus-ok val</dt> 
 
<dd>Submit <a href="ACL2____SET-IGNORE-OK.html">set-ignore-ok</a>, <a href="ACL2____SET-IRRELEVANT-FORMALS-OK.html">set-irrelevant-formals-ok</a>, and/or 
<a href="ACL2____SET-BOGUS-MUTUAL-RECURSION-OK.html">set-bogus-mutual-recursion-ok</a> forms before the definitions.  These 
options are <a href="ACL2____LOCAL.html">local</a> to the definitions; they do not affect the 
<span class="v">other-events</span> or any later events.</dd> 
 
 
<dt>:flag name</dt> 
 
<dd>You can also use <span class="v">:flag nil</span> to suppress the creation of a flag 
function.  Alternately, you can use this option to customize the name of the 
flag function.  The default is inferred from the <span class="v">clique-name</span>, i.e., it 
will look like <span class="v">&lt;clique-name&gt;-flag</span>.</dd> 
 
<dt>:flag-var var</dt> 
<dt>:flag-defthm-macro name</dt> 
<dt>:flag-hints hints</dt> 
 
<dd>Control the flag variable name, flag macro name, and hints for <a href="ACL2____MAKE-FLAG.html">ACL2::make-flag</a>.</dd> 
 
 
<dt>:flag-local bool</dt> 
 
<dd>By default the flag function is created locally.  This generally improves 
performance when later including your book, and is appropriate when all of your 
flag-based reasoning about the function is done in <span class="v">:returns</span> specifiers and 
in the <span class="v">///</span> section.  If you need the flag function and its macros to exist 
beyond the <span class="v">defines</span> form, set <span class="v">:flag-local nil</span>.</dd> 
 
 
<dt>:progn bool</dt> 
 
<dd>By default everything is submitted in an <span class="v">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a> nil ...)</span>.  If 
you set <span class="v">:progn t</span>, then we will instead submit everything in a <span class="v">progn</span>. 
This mainly affects what <span class="v">local</span> means within the <span class="v">///</span> section.  This 
may slightly improve performance by avoiding the overhead of <a href="ACL2____ENCAPSULATE.html">encapsulate</a>, and is mainly meant as a tool for macro developers.</dd> 
 
 
</dl>
</body>
</html>
