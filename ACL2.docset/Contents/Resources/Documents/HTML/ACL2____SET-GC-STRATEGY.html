<html>
<head>
<meta charset="UTF-8">
<title>Set-gc-strategy</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____SET-GC-STRATEGY">Click for Set-gc-strategy in the Full Manual</a></h3>

<p>Set the garbage collection strategy (CCL only)</p><p>Note: This macro has no effect unless the host Lisp is 
  CCL.</p> 
 
  <pre class="code">General Forms:

(<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> :egc)     ; the default: EGC is on, full GC is not delayed
(<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> :delay)   ; EGC is off, full GC is delayed
(<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> :current) ; same as replacing :current by the latest
                           ; strategy set (:egc or :delay)

(<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> strategy threshold)
                           ; Same as (<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> strategy), but sets
                           ; threshold to the indicated number of bytes
                           ; (see below)</pre> 
 
 <p>Logically, <span class="v">(<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> op)</span> returns <span class="v">op</span>.  But in some host 
 Lisps (currently CCL only), it changes how garbage collection is invoked. 
 Exactly how that is done is best understood by reading the ACL2 source code, 
 starting with <span class="v">set-gc-strategy</span>.  Here we document what most users might 
 want to know about this utility, assuming they are using CCL.  We defer 
 discussion of the optional second argument, <span class="v">threshold</span>, to the end.</p> 
 
 <p>Normally the default garbage collection strategy will probably be fine. 
 That default has the ephemeral garbage collector (EGC) enabled.  But in jobs 
 that stress <span class="tt"><a href="ACL2____HONS.html">hons</a></span>, or perhaps memoization (see <a href="ACL2____MEMOIZE.html">memoize</a>) or <a href="ACL2____FAST-ALISTS.html">fast-alists</a>, it might be useful to switch to a strategy that disables EGC but 
 also significantly delays garbage collection.  To switch to that delaying 
 strategy:</p> 
 
 <pre class="code">(<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> :delay)</pre> 
 
 <p>Then, you can return to the default strategy, re-enabling EGC and no longer 
 causing delays in garbage collection, as follows.</p> 
 
 <pre class="code">(<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> :egc)</pre> 
 
 <p>It is also legal to invoke <span class="v">(<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> :current)</span>, which is 
 equivalent to replacing <span class="v">:current</span> by the current strategy; see <a href="ACL2____GC-STRATEGY.html">gc-strategy</a>.</p> 
 
 <p>If you want to change the gc-strategy during certification of a book, but 
 not when including that book, you can place your call of <span class="v">set-gc-strategy</span> 
 inside <span class="tt"><a href="ACL2____VALUE-TRIPLE.html">value-triple</a></span>, for example as follows.</p> 
 
 <pre class="code">(<a href="ACL2____VALUE-TRIPLE.html">value-triple</a> (<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> :delay))</pre> 
 
 <p>The following variant causes the <a href="ACL2____GC-STRATEGY.html">gc-strategy</a> to be modified when 
 including the book as well.</p> 
 
 <pre class="code">(<a href="ACL2____VALUE-TRIPLE.html">value-triple</a> (<a href="ACL2____SET-GC-STRATEGY.html">set-gc-strategy</a> :delay) :on-skip-proofs t)</pre> 
 
 <p>This capability might be extended to other host Lisps in the future, 
 especially if ACL2 users provide suggestions for how to do so.</p> 
 
 <p>Note that the default behavior can be changed to <span class="v">:delay</span> at ACL2 build 
 time, by setting <span class="v">Make</span> variable <span class="v">ACL2_EGC_ON=nil</span> when building an ACL2 
 executable.</p> 
 
 <h3>The <span class="v">threshold</span> argument</h3> 
 
 <p>When a second argument is supplied in a call of <span class="v">set-gc-strategy</span>, it 
 must be either <span class="v">nil</span>, which is equivalent to supplying no second argument, 
 or else a positive integer.  This positive integer will be the ``GC 
 threshold'' number of bytes CCL will try to ensure are available before the 
 next full garbage collection.  The default (i.e., the value used when the 
 second argument is <span class="v">nil</span> or is omitted) is the minimum of the following two 
 values: 1/2 GB, and 1/32 of physical memory (or 1/32 of 4 GB, if the physical 
 memory cannot be determined).  (Technical note: The GC threshold is stored in 
 raw Lisp variable <span class="v">*gc-min-threshold*</span>.)</p>
</body>
</html>
