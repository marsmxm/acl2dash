<html>
<head>
<meta charset="UTF-8">
<title>Note-4-0</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____NOTE-4-0">Click for Note-4-0 in the Full Manual</a></h3>

<p>ACL2 Version  4.0 (July, 2010) Notes</p><p>NOTE!  New users can ignore these release notes, because the <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> has been updated to reflect all changes that are recorded 
 here.</p> 
 
 <p>Below we roughly organize the changes since Version 3.6.1 into the 
 following categories of changes: existing features, new features, heuristic 
 improvements, bug fixes, distributed books, Emacs support, and experimental 
 versions.  Each change is described in just one category, though of course 
 many changes could be placed in more than one category.  Also see <a href="ACL2____NOTE-3-6-1.html">note-3-6-1</a> for other changes since Version 3.6.</p> 
 
 <p><b>CHANGES TO EXISTING FEATURES</b></p> 
 
 <p>There have been extensive changes to the handling of compiled files for 
 books, which may generally be invisible to most users.  The basic idea is that 
 when compiled files are loaded on behalf of <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>, they are now 
 loaded before events in the book are processed, not afterwards.  This can 
 speed up calls of <span class="v">include-book</span>, especially if the underlying Lisp 
 compiles all definitions on the fly (as is the case for CCL and SBCL).  One 
 functional change is that for keyword argument <span class="v">:load-compiled-file</span> of 
 <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>, the values <span class="v">:comp-raw</span>, <span class="v">:try</span>, and <span class="v">:comp!</span> 
 are no longer legal.  (Note that the handling of <span class="v">:comp-raw</span> was actually 
 broken, so it seems that this value wasn't actually used by anyone; also, the 
 handling of <span class="v">:comp!</span> formerly could cause an error in some Lisp platforms, 
 including SBCL.)  Another change is that if <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> is called 
 with <span class="v">:load-compiled-file t</span>, then each sub-book must have a compiled file 
 or a so-called ``expansion file''; see <a href="ACL2____BOOK-COMPILED-FILE.html">book-compiled-file</a>.  In the 
 unlikely event that this presents a problem, the makefile provides a way to 
 build with compilation disabled; see <a href="ACL2____COMPILATION.html">compilation</a>.  Users of raw mode 
 (see <a href="ACL2____SET-RAW-MODE.html">set-raw-mode</a>) will be happy to know that <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> now 
 works if there an up-to-date compiled file for the book, since <span class="tt"><a href="ACL2____PORTCULLIS.html">portcullis</a></span> commands are now incorporated into that compiled file.  The 
 mechanism for saving expansion files has changed, and the <span class="v">:save-expansion</span> 
 argument of <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> has been eliminated; see <a href="ACL2____CERTIFY-BOOK.html">certify-book</a>. 
 More discussion of ACL2's new handling of book compilation is described in a 
 new documentation topic; see <a href="ACL2____BOOK-COMPILED-FILE.html">book-compiled-file</a>.</p> 
 
 <p>It was possible to get a hard Lisp error when certifying a book with a 
 redundant <span class="tt"><a href="ACL2____DEFCONST.html">defconst</a></span> form whose term is not identical to the existing 
 <span class="tt"><a href="ACL2____DEFCONST.html">defconst</a></span> form for the same name.  The following example illustrates 
 the problem, which has been fixed (as part of the change in handling of 
 compiled files for books, described above).  Imagine that after the initial 
 <span class="v">(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "ACL2")</span> form, file <span class="v">foo.lisp</span> has just the form 
 <span class="v">(<a href="ACL2____DEFCONST.html">defconst</a> *a* (<a href="COMMON-LISP____APPEND.html">append</a> nil nil))</span>.  Then before the fix, we could have:</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____DEFCONST.html">defconst</a> *a* nil)
[[output omitted]]
ACL2 !&gt;(<a href="ACL2____CERTIFY-BOOK.html">certify-book</a> "foo" 1)
[[initial output omitted]
* Step 5:  Compile the functions defined in "/v/joe/foo.lisp".
Compiling /v/joe/foo.lisp.
End of Pass 1.
End of Pass 2.
OPTIMIZE levels: Safety=0 (No runtime error checking), Space=0, Speed=3
Finished compiling /vjoe/foo.lisp.
Loading /v/joe/foo.lisp

Error: Illegal attempt to redeclare the constant *A*.</pre> 
 
 <p>The <span class="tt"><a href="ACL2____WORMHOLE.html">wormhole</a></span> facility has been changed to repair a bug that allowed 
 guard violations to go undetected.  The major change has to do with the 
 treatment of what used to be called the ``pseudo-flag'' argument which has 
 been replaced by a quoted lambda expression.  See <a href="ACL2____NOTE-4-0-WORMHOLE-CHANGES.html">note-4-0-wormhole-changes</a> for help in converting calls of <span class="tt"><a href="ACL2____WORMHOLE.html">wormhole</a></span>. 
 Also see see <a href="ACL2____WORMHOLE.html">wormhole</a> and see <a href="ACL2____WORMHOLE-EVAL.html">wormhole-eval</a>.</p> 
 
 <p>The function <span class="v">assign-wormhole-output</span> has been eliminated but its 
 functionality can be provided by <span class="tt"><a href="ACL2____WORMHOLE-EVAL.html">wormhole-eval</a></span>.</p> 
 
 <p>The ACL2 tutorial has been greatly expanded, for example to include a 
 self-contained discussion of rewriting.  See <a href="ACL2____ACL2-TUTORIAL.html">ACL2-tutorial</a>.</p> 
 
 <p>Formerly, the <span class="tt"><a href="ACL2____MBE.html">mbe</a></span> macro and <span class="tt"><a href="ACL2____MUST-BE-EQUAL.html">must-be-equal</a></span> function were 
 disallowed in any definition within an encapsulate having a non-empty 
 signature.  Now, these are allowed provided the definition has been declared 
 to be non-executable (see <a href="ACL2____DEFUN-NX.html">defun-nx</a>).  As a result, <span class="tt"><a href="ACL2____DEFEVALUATOR.html">defevaluator</a></span> 
 <a href="ACL2____EVENTS.html">events</a> may now include <span class="tt"><a href="ACL2____MUST-BE-EQUAL.html">must-be-equal</a></span> among the function symbols 
 known by the evaluator; this had not previously been allowed.  Thanks to Sol 
 Swords for discussions leading to this relaxation for <span class="tt"><a href="ACL2____DEFEVALUATOR.html">defevaluator</a></span>.</p> 
 
 <p><span class="tt"><a href="ACL2____PRINC_42.html">Princ$</a></span> now prints strings more efficiently.  Thanks to Jared Davis 
 for suggesting the improvements to <span class="v">princ$</span>.</p> 
 
 <p>The use of <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> declaration <span class="v">:non-executable t</span> no longer 
 requires the absence of <span class="tt"><a href="ACL2____STATE.html">state</a></span> or declared <span class="tt"><a href="ACL2____STOBJ.html">stobj</a></span>s among the 
 formal parameters of a function definition.  As before, the use of 
 <span class="v">:non-executable t</span> turns off single-threadedness checking for the body, 
 and also as before, attempts to execute the function will fail.  Thanks to Sol 
 Swords for requesting this relaxation (for automatic generation of so-called 
 ``flag functions'' for definitions using <span class="tt"><a href="ACL2____MUTUAL-RECURSION.html">mutual-recursion</a></span>).</p> 
 
 <p>The <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> has been improved for explaining to advanced users 
 the details of the ACL2 hint mechanism; see <a href="ACL2____HINTS-AND-THE-WATERFALL.html">hints-and-the-waterfall</a>, 
 and see the example about <span class="v">nonlinearp-default-hint</span> in distributed book 
 <span class="v">books/hints/basic-tests.lisp</span>.  Thanks to Robert Krug for useful 
 discussions, in particular suggesting the above example as one to be explained 
 with the documentation.</p> 
 
 <p>The <span class="v">time$</span> macro has been enhanced to allow user control of the timing 
 message that is printed, and of when it is printed.  See <a href="ACL2____TIME_42.html">time$</a>.  Thanks 
 to Jared Davis for providing the essential design, helpful documentation 
 (largely incorporated), and an initial implementation for raw Lisp.</p> 
 
 <p>The <span class="v">:ttags</span> argument to <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> had been required when 
 including a certified book that uses trust tags.  This is no longer the case: 
 essentially, <span class="v">:ttags</span> defaults to <span class="v">:all</span> except that warnings will be 
 printed.  Thanks to Jared Davis for requesting such a relaxation, and to him 
 and Sandip Ray for useful discussions.</p> 
 
 <p>The definition of <span class="tt"><a href="ACL2____MV-LET.html">mv-let</a></span> has been modified so that the single-step 
 macroexpansion (see <a href="ACL2____TRANS1.html">trans1</a>) of its calls can be evaluated.  Thanks to 
 Pete Manolios for bringing this evaluation issue to our attention and ensuing 
 discussions.</p> 
 
 <p>All calls of so-called ``guard-holders'' — <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span>, <span class="tt"><a href="ACL2____MUST-BE-EQUAL.html">must-be-equal</a></span> (from calls of see <a href="ACL2____MBE.html">mbe</a>), <span class="tt"><a href="ACL2____EC-CALL.html">ec-call</a></span>, and <span class="tt"><a href="ACL2____MV-LIST.html">mv-list</a></span> — are now removed before storing hypotheses of rules of class 
 <span class="v">:</span><span class="tt"><a href="ACL2____REWRITE.html">rewrite</a></span> or <span class="v">:</span><span class="tt"><a href="ACL2____LINEAR.html">linear</a></span>.  Thanks to Sol Swords for 
 requesting this enhancement and sending the following example in the case of 
 <a href="ACL2____REWRITE.html">rewrite</a> rules.</p> 
 
 <pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> foo
  (<a href="ACL2____PROG2_42.html">prog2$</a> (<a href="ACL2____CW.html">cw</a> "asdf")
          (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____CAR.html">car</a> (<a href="COMMON-LISP____CONS.html">cons</a> x y)) x)
               (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____CDR.html">cdr</a> (<a href="COMMON-LISP____CONS.html">cons</a> x y)) y))))</pre> 
 
 <p>The handling of <span class="tt"><a href="ACL2____FMT.html">fmt</a></span> directive <span class="v">~s</span> has been modified so that if 
 the argument is a symbol that would normally be printed using vertical bars 
 (<span class="v">|</span>), then that symbol is printed as with <span class="v">~f</span>.  Thanks to Jared Davis 
 for providing the following example showing that treatment of <span class="v">~s</span> was a 
 bit unexpected: <span class="v">(<a href="ACL2____CW.html">cw</a> "~s0.~%" '|fo\|o|)</span>.</p> 
 
 <p>Error messages have been improved for ill-formed terms (in ACL2's so-called 
 ``translation'' routines).  Thanks to Jared Davis for requesting such an 
 enhancement.</p> 
 
 <p>Modified <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> so that it executes in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode. 
 Previously, evaluation of a <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> event in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> 
 mode caused a somewhat inscrutable error, but now, <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode 
 is treated the same as <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode for purposes of <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span>.</p> 
 
 <p>The ``system hacker'' commands <span class="v">(</span><span class="tt"><a href="ACL2____REDEF_B2.html">redef+</a></span><span class="v">)</span> and <span class="v">(</span><span class="tt"><a href="ACL2____REDEF-.html">redef-</a></span><span class="v">)</span> are now embedded event forms (see <a href="ACL2____EMBEDDED-EVENT-FORM.html">embedded-event-form</a>), 
 hence may be used in <a href="ACL2____BOOKS.html">books</a> as well as in <span class="tt"><a href="COMMON-LISP____PROGN.html">progn</a></span> and <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> <a href="ACL2____EVENTS.html">events</a>.  Also, these two commands are now no-ops in raw 
 Lisp.</p> 
 
 <p>The function symbol <span class="v">worldp</span> (in the <span class="v">"ACL2"</span> package) has been 
 renamed to <span class="v">plist-worldp</span>.</p> 
 
 <p>The function <span class="v">gc$-fn</span> (resulting from macroexpansion of <span class="tt"><a href="ACL2____GC_42.html">gc$</a></span>) is 
 now in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode.  Thanks to Jared Davis for requesting this 
 change.</p> 
 
 <p>The user now has control over whether compilation is used, for example 
 whether or not <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> compiles by default, using function 
 <span class="v">set-compiler-enabled</span>.  See <a href="ACL2____COMPILATION.html">compilation</a>.</p> 
 
 <p>Modified the conversion of relative to absolute pathnames in <a href="ACL2____PORTCULLIS.html">portcullis</a> <a href="ACL2____COMMAND.html">command</a>s for book certification.  Now, more pathnames 
 remain as relative pathnames.</p> 
 
 <p>The <span class="v">"Ttags"</span> warning that can be printed by <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> is 
 now given even if <span class="tt"><a href="ACL2____SET-INHIBIT-OUTPUT-LST.html">set-inhibit-output-lst</a></span> has specified `<span class="v">warning</span>'. 
 To suppress it, specify <span class="v">warning!</span> instead, for example, 
 <span class="v">(<a href="ACL2____SET-INHIBIT-OUTPUT-LST.html">set-inhibit-output-lst</a> '(acl2::warning! acl2::proof-tree))</span>.</p> 
 
 <p>On occasion, ACL2 prints the message ``Flushing current installed world'' 
 as it cleans up when certain actions (installing a <a href="ACL2____WORLD.html">world</a>) are 
 interrupted.  This operation has been sped up considerably.  If your session 
 includes many <a href="ACL2____EVENTS.html">events</a>, you can probably speed up any such operation 
 further by invoking <span class="tt"><a href="ACL2____RESET-PREHISTORY.html">reset-prehistory</a></span>.  Thanks to Jared Davis for 
 sending a query that led us to make this improvement.</p> 
 
 <p>Calls of the form <span class="v">(<a href="ACL2____EC-CALL.html">ec-call</a> (<a href="ACL2____MUST-BE-EQUAL.html">must-be-equal</a> logic exec))</span> are no longer 
 allowed, since we do not have confidence that they would be handled 
 correctly.</p> 
 
 <p>The underlying function for <span class="tt"><a href="ACL2____GOOD-BYE.html">good-bye</a></span> (and hence for <span class="tt"><a href="ACL2____EXIT.html">exit</a></span> 
 and <span class="tt"><a href="ACL2____QUIT.html">quit</a></span>) is now in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode.  Thanks to Jared Davis 
 for requesting this enhancement.</p> 
 
 <p>We now require that every function symbol in the <a href="ACL2____SIGNATURE.html">signature</a> of an 
 <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> event have a <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode definition at the 
 end of the first pass, not merely a <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode definition 
 (which formerly was sufficient).  You can still define such a function in 
 <span class="v">:program</span> mode, provided it is followed by a <span class="v">:logic</span> mode definition 
 (where of course both definitions are <a href="ACL2____LOCAL.html">local</a>, since we are discussing 
 functions is introduced in the <a href="ACL2____SIGNATURE.html">signature</a>).  Thanks to Carl Eastlund for 
 bringing this issue to our attention.  (Note: An analogous modification has 
 been made for <span class="v">:</span><span class="tt"><a href="ACL2____BDD.html">bdd</a></span> <a href="ACL2____HINTS.html">hints</a> as well.)</p> 
 
 <p>The following functions now have raw Lisp implementations that may run 
 faster than their ACL2 definitions: <span class="tt"><a href="ACL2____ASSOC-EQ.html">assoc-eq</a></span>, <span class="tt"><a href="ACL2____ASSOC-EQUAL.html">assoc-equal</a></span>, 
 <span class="tt"><a href="ACL2____MEMBER-EQ.html">member-eq</a></span>, <span class="tt"><a href="ACL2____MEMBER-EQUAL.html">member-equal</a></span>, <span class="v">subsetp-eq</span>, <span class="tt"><a href="ACL2____SUBSETP-EQUAL.html">subsetp-equal</a></span>, <span class="tt"><a href="ACL2____REMOVE-EQ.html">remove-eq</a></span>, <span class="tt"><a href="ACL2____REMOVE-EQUAL.html">remove-equal</a></span>, <span class="tt"><a href="ACL2____POSITION-EQ.html">position-eq</a></span>, 
 and <span class="tt"><a href="ACL2____POSITION-EQUAL.html">position-equal</a></span>.  Thanks to Jared Davis for suggesting that we 
 consider such an improvement.</p> 
 
 <p>We now avoid infinite loops caused when tracing functions that implement 
 <span class="tt"><a href="ACL2____TRACE_42.html">trace$</a></span>.  Thanks to Rob Sumners and Eric Smith for useful 
 discussions.</p> 
 
 <p>The implementation of <span class="tt"><a href="ACL2____TRACE_12.html">trace!</a></span> has been modified slightly, to 
 accommodate the fix for ``some holes in the handling of trust tags'' described 
 later, below.</p> 
 
 <p>This item applies unless the host Lisp is GCL.  An interrupt (control-c) 
 will now cause a proof to exit normally in most cases, by simulating a 
 timeout, as though <span class="tt"><a href="ACL2____WITH-PROVER-TIME-LIMIT.html">with-prover-time-limit</a></span> had been called with a 
 time-limit of 0.  If the first interrupt doesn't terminate the proof, a second 
 one should do so (because a different, more ``severe'' mechanism is used after 
 the first attempt).  As a result, <span class="tt"><a href="ACL2____REDO-FLAT.html">redo-flat</a></span> should work as one might 
 expect even if a proof is interrupted.  Thanks to Dave Greve for requesting 
 this enhancement to <span class="tt"><a href="ACL2____REDO-FLAT.html">redo-flat</a></span>.  Technical note: for reasons related to 
 this change, time-limits are no longer checked in evaluator functions 
 (<span class="v">ev-fncall</span>, <span class="v">ev</span>, <span class="v">ev-lst</span>, <span class="v">ev-fncall-w</span>, <span class="v">ev-w</span>, and 
 <span class="v">ev-w-lst</span>).</p> 
 
 <p>It is now legal for <a href="ACL2____PROOF-BUILDER.html">proof-builder</a> <a href="ACL2____MACRO-COMMAND.html">macro-command</a>s to appear in 
 <span class="v">:</span><span class="tt"><a href="ACL2____INSTRUCTIONS.html">instructions</a></span> that are used in place of <span class="v">:</span><span class="tt"><a href="ACL2____HINTS.html">hints</a></span>. 
 Thanks to Sandip Ray for (most recently) requesting this feature.</p> 
 
 <p>The value of <span class="v">:command-conventions</span> for <span class="tt"><a href="ACL2____LD.html">ld</a></span> special variable 
 <span class="v">ld-post-eval-print</span> is now treated as though it were <span class="v">t</span> if the value 
 <span class="tt"><a href="ACL2____LD.html">ld</a></span> special variable <span class="v">ld-error-triples</span> is <span class="v">nil</span>.  The following 
 example illustrates this change.</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____LD-POST-EVAL-PRINT.html">ld-post-eval-print</a> state) ; default
:COMMAND-CONVENTIONS
ACL2 !&gt;(<a href="ACL2____LD-ERROR-TRIPLES.html">ld-error-triples</a> state) ; default
T
ACL2 !&gt;(set-ld-error-triples nil state)
*** Then, before the change:
ACL2 !&gt;(<a href="ACL2____MV.html">mv</a> t 3 state)
 3
*** Instead, after the change:
ACL2 !&gt;(<a href="ACL2____MV.html">mv</a> t 3 state)
(T 3 &lt;state&gt;)</pre> 
 
 <p>The default behavior of <span class="tt"><a href="ACL2____LD.html">ld</a></span> has been changed.  Formerly when an 
 error occurred that halted a subsidiary call of <span class="v">ld</span>, then the parent 
 <span class="v">ld</span> would continue.  That is no longer the case.  Consider the following 
 example.</p> 
 
 <pre class="code">(<a href="ACL2____LD.html">ld</a> '((<a href="ACL2____LD.html">ld</a> '((<a href="COMMON-LISP____DEFUN.html">defun</a> f (x) x)
            (<a href="COMMON-LISP____DEFUN.html">defun</a> bad (x)) ; ERROR -- missing the body
            ))
      (<a href="COMMON-LISP____DEFUN.html">defun</a> g (x) x)))</pre> 
 
 <p>Formerly, <span class="v">g</span> would be defined in the resulting logical <a href="ACL2____WORLD.html">world</a>. 
 Now, the error halts not only the inner <span class="v">ld</span> but also the outer <span class="v">ld</span>. 
 See <a href="ACL2____LD.html">ld</a>, and for details of the new default value for 
 <span class="v">:ld-error-action</span>, <span class="v">:RETURN!</span>, see <a href="ACL2____LD-ERROR-ACTION.html">ld-error-action</a>.  Also see 
 the paragraph below about a new utility, <span class="v">:</span><span class="tt"><a href="ACL2____P_12.html">p!</a></span>.  Thanks to Robert 
 Krug and Sandip Ray for helpful discussions.</p> 
 
 <p>Environment variable <span class="v">ACL2-CUSTOMIZATION</span> has been replaced by 
 <span class="v">ACL2_CUSTOMIZATION</span> — that is, the hyphen has been replaced by an 
 underscore — so that it can be set conveniently in the <span class="v">bash</span> shell. 
 See <a href="ACL2____ACL2-CUSTOMIZATION.html">ACL2-customization</a>.</p> 
 
 <p>The ``<span class="v">Warnings:</span>'' summary is now omitted when there are no warnings, 
 where formerly ``<span class="v">Warnings: None</span>'' was printed.  Thanks to Jared Davis for 
 suggesting this change.</p> 
 
 <p>We have modified the generation of <span class="v">constraint</span>s for <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> 
 <a href="ACL2____EVENTS.html">events</a> in two primary ways, neither of them likely to affect many 
 users.  One change is that the virtual movement of definitions and theorems to 
 in front of an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> event, or of definitions to behind that 
 event, is no longer inhibited in the case of nested encapsulates with 
 non-empty <a href="ACL2____SIGNATURE.html">signature</a>s.  The following example illustrates the other 
 change, as discussed below.</p> 
 
 <pre class="code">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a>
 ((f (x) t))
 (<a href="ACL2____LOCAL.html">local</a> (<a href="COMMON-LISP____DEFUN.html">defun</a> f (x) x))
 (<a href="COMMON-LISP____DEFUN.html">defun</a> g (x) (<a href="COMMON-LISP____CONS.html">cons</a> x (f x)))
 (<a href="COMMON-LISP____DEFUN.html">defun</a> h (x) (<a href="ACL2____G.html">g</a> x))
 (<a href="ACL2____DEFTHM.html">defthm</a> h-is-f (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____CAR.html">car</a> (h x)) x)))</pre> 
 
 <p>Previously, the <a href="ACL2____CONSTRAINT.html">constraint</a> on <span class="v">f</span> and <span class="v">h</span> was essentially the 
 conjunction of the definition of <span class="v">h</span> and the theorem <span class="v">h-is-f</span>.  Now, the 
 definition of <span class="v">g</span> is conjoined as well; moreover, <span class="v">g</span> receives the same 
 <a href="ACL2____CONSTRAINT.html">constraint</a> as do <span class="v">f</span> and <span class="v">h</span>, where previously <span class="v">g</span> was only 
 constrained by its definition.  While we are not aware of a soundness bug 
 caused by the previous approach, the new approach follows more precisely the 
 intended notion of <a href="ACL2____CONSTRAINT.html">constraint</a>.</p> 
 
 <p>The use of <span class="tt"><a href="ACL2____TRACE_42.html">trace$</a></span> (or <span class="tt"><a href="ACL2____TRACE_12.html">trace!</a></span>) option <span class="v">:multiplicity</span> had 
 been required when option <span class="v">:native</span> was supplied.  This is no longer the 
 case.  Also, a bug has been fixed that had prevented <span class="v">:multiplicity</span> from 
 working properly in GCL and Allegro CL.</p> 
 
 <p>Several errors have been eliminated that formerly occurred when the 
 constraints for a function symbol were unknown because it was constrained 
 using a dependent clause-processor (see <a href="ACL2____DEFINE-TRUSTED-CLAUSE-PROCESSOR.html">define-trusted-clause-processor</a>.  Now, it is assumed that the <span class="v">supporters</span> 
 argument in a <span class="tt"><a href="ACL2____DEFINE-TRUSTED-CLAUSE-PROCESSOR.html">define-trusted-clause-processor</a></span> event is such that every 
 ancestor of any function symbol constrained by the ``promised encapsulate'' of 
 that event among, or ancestral in, those <span class="v">supporters</span>.  Thanks to Sol 
 Swords, Sandip Ray, and Jared Davis for helpful discussions.</p> 
 
 <p>The notion of <a href="ACL2____CONSTRAINT.html">constraint</a> for functions introduced by <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> 
 has been modified slightly.  No longer do we remove from the body of the 
 definition calls of so-called ``guard-holders'': <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span>, <span class="tt"><a href="ACL2____MUST-BE-EQUAL.html">must-be-equal</a></span>, <a href="ACL2____EC-CALL.html">ec-call</a>, and <a href="ACL2____MV-LIST.html">mv-list</a>, and uses of <span class="v">the-error</span> 
 generated by <span class="tt"><a href="COMMON-LISP____THE.html">the</a></span>.  Also, we now expand calls of <span class="v">the-error</span> with 
 the same aggressive heuristics applied to a number of other functions 
 (technically, adding it to the list 
 <span class="v">*expandable-boot-strap-non-rec-fns*</span>).</p> 
 
 <p><b>NEW FEATURES</b></p> 
 
 <p>A new event, <span class="tt"><a href="ACL2____DEFATTACH.html">defattach</a></span>, allows evaluation of calls of constrained 
 (<span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span>d) functions.  In particular, users can now, in principle, 
 soundly modify ACL2 source code; please feel free to contact the ACL2 
 implementors if you are interested in doing so.  See <a href="ACL2____DEFATTACH.html">defattach</a>.</p> 
 
 <p>Eric Smith has noticed that if you exit the <a href="ACL2____BREAK-REWRITE.html">break-rewrite</a> loop using 
 <span class="v">:</span><span class="tt"><a href="ACL2____A_12.html">a!</a></span> during an <span class="tt"><a href="ACL2____LD.html">ld</a></span> of a file, then all changes to the 
 logical <a href="ACL2____WORLD.html">world</a> are discarded that were made during that call of <span class="tt"><a href="ACL2____LD.html">ld</a></span>.  A new utility, <span class="v">:</span><span class="tt"><a href="ACL2____P_12.html">p!</a></span>, pops just one level instead, and avoids 
 discarding that work.  (This change is related to an item above, ``The default 
 behavior of <span class="tt"><a href="ACL2____LD.html">ld</a></span> has been changed.'')  Thanks to Eric for pointing out 
 this issue.</p> 
 
 <p>New function <span class="tt"><a href="ACL2____MV-LIST.html">mv-list</a></span> is the identity function logically, but 
 converts multiple values to lists.  The first argument is the number of 
 values, so an example form is as follows, where <span class="v">foo</span> returns three values: 
 <span class="v">(<a href="ACL2____MV-LIST.html">mv-list</a> 3 (foo x y))</span>.  Thanks to Sol Swords for requesting this feature 
 and for reporting a soundness bug in one of our preliminary 
 implementations.</p> 
 
 <p>A new <span class="tt"><a href="ACL2____STATE.html">state</a></span> global variable, <span class="v">host-lisp</span>, has as its value a 
 keyword whose value depends on the underlying Common Lisp implementation.  Use 
 <span class="v">(<a href="ACL2_____04.html">@</a> host-lisp)</span> to see its value.</p> 
 
 <p>It is now possible to write <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> for HTML without error 
 when there are links to nonexistent documentation topics.  See the comments in 
 macro <span class="v">acl2::write-html-file</span> at the end of file 
 <span class="v">doc/write-acl2-html.lisp</span>.  When there are such errors, they should be 
 easier to understand than previously.  Thanks to Alan Dunn for providing the 
 initial modifications.</p> 
 
 <p>It is now possible to inhibit specified parts of the Summary printed at the 
 conclusion of an event.  See <a href="ACL2____SET-INHIBITED-SUMMARY-TYPES.html">set-inhibited-summary-types</a>.  Also see 
 <a href="ACL2____WITH-OUTPUT.html">with-output</a>, in particular the discussion of the new <span class="v">:summary</span> 
 keyword.  Thanks to Sol Swords for requesting more control over the 
 Summary.</p> 
 
 <p>A new <span class="v">:</span><span class="tt"><a href="ACL2____HINTS.html">hints</a></span> keyword, <span class="v">:case-split-limitations</span>, can 
 override the default case-split-limitations settings (see <a href="ACL2____SET-CASE-SPLIT-LIMITATIONS.html">set-case-split-limitations</a>) in the simplifier.  Thanks to Ian Johnson for 
 requesting this addition and providing an initial implementation.</p> 
 
 <p>It is now possible to defer and avoid some ttag-related output; see <a href="ACL2____SET-DEFERRED-TTAG-NOTES.html">set-deferred-ttag-notes</a>.  Thanks to Jared Davis for requesting less verbosity 
 from ttag-related output.</p> 
 
 <p>A new <a href="ACL2____COMMAND.html">command</a>, <span class="v">:</span><span class="tt"><a href="ACL2____PL2.html">pl2</a></span>, allows you to restrict the rewrite 
 rules printed that apply to a given term.  See <a href="ACL2____PL2.html">pl2</a>.  Thanks to Robert 
 Krug for requesting such a capability.</p> 
 
 <p>ACL2 now provides a utility for canonicalizing filenames, so that soft 
 links are resolved; see <a href="ACL2____CANONICAL-PATHNAME.html">canonical-pathname</a>.  Moreover, ACL2 uses this 
 utility in its own sources, which can eliminate some issues.  In particular, 
 <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> with argument <span class="v">:ttags :all</span> no longer breaks when 
 given a book name differing from the book name that was used at certification 
 time; thanks to Sol Swords for reporting that problem.  Also, certain errors 
 have been eliminated involving the combination of packages in the 
 certification world and trust tags; thanks to Jared Davis for sending an 
 example of that problem.</p> 
 
 <p>You can now suppress or enable guard-checking for an individual form; see 
 <a href="ACL2____WITH-GUARD-CHECKING.html">with-guard-checking</a>.  Thanks to Sol Swords for requesting this 
 feature.</p> 
 
 <p>The <span class="tt"><a href="ACL2____WALKABOUT.html">walkabout</a></span> utility has been documented (thanks to Rob Sumners 
 for suggesting this documentation).  This utility can make it easy to explore 
 a large <span class="v">cons</span> tree.  New interactive commands <span class="v">(pp n)</span> and <span class="v">(pp
 print-level print-length)</span> have been added to restrict how much of the 
 current object is displayed.  See <a href="ACL2____WALKABOUT.html">walkabout</a>.</p> 
 
 <p>Rules of class <span class="v">:</span><span class="tt"><a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a></span> may now be provided a 
 <span class="v">:backchain-limit-lst</span> keyword.  The default behavior is unchanged, but now 
 <span class="tt"><a href="ACL2____TYPE-SET.html">type-set</a></span> is sensitive not only to the new <span class="v">:backchain-limit-lst</span> of 
 a <span class="v">:</span><span class="tt"><a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a></span> rule (if supplied) but to the <span class="tt"><a href="ACL2____DEFAULT-BACKCHAIN-LIMIT.html">default-backchain-limit</a></span> of the current logical <a href="ACL2____WORLD.html">world</a>.  Setting of 
 backchain-limits can now specify either the new (type-set) limit or the old 
 limit (for rewriting); see <a href="ACL2____SET-DEFAULT-BACKCHAIN-LIMIT.html">set-default-backchain-limit</a> and see <a href="ACL2____SET-BACKCHAIN-LIMIT.html">set-backchain-limit</a>.  Moreover, the functions <span class="tt"><a href="ACL2____DEFAULT-BACKCHAIN-LIMIT.html">default-backchain-limit</a></span> 
 and <span class="tt"><a href="ACL2____BACKCHAIN-LIMIT.html">backchain-limit</a></span> now take a second argument of <span class="v">:ts</span> or 
 <span class="v">:rewrite</span> to specify which backchain-limit is desired.</p> 
 
 <p><b>HEURISTIC IMPROVEMENTS</b></p> 
 
 <p>The so-called ``too-many-ifs'' heuristic has been modified.  Such a 
 heuristic has been employed in ACL2 (and previous Boyer-Moore provers) for 
 many years, in order to limit the introduction of calls of <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span> by 
 non-recursive functions.  Most users need not be concerned with this change, 
 but two proofs in the regression suite (out of thousands) needed trivial 
 adjustment, so user proofs could need tweaking.  In one application, this 
 modification sped up proofs by 15%; but the change in runtime for the 
 regression suite is negligible, so such speedups may vary.  Thanks to Sol 
 Swords for providing a test from ACL2 runs at Centaur Technology, which was 
 useful in re-tuning this heuristic.</p> 
 
 <p>Guard proof obligations could have size quadratic in the number of clauses 
 in a <span class="tt"><a href="COMMON-LISP____CASE.html">case</a></span> statement.  This inefficiency has been removed with a change 
 that eliminates a hypothesis of the form <span class="v">(<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____EQL.html">eql</a> term constant))</span> when 
 there is already a stronger hypothesis, equating the same term with a 
 different constant.  Thanks to Sol Swords for bringing this problem to our 
 attention and suggesting an alternate approach to solving it, which we may 
 consider in the future if related efficiency problems persist.</p> 
 
 <p>We adjusted the heuristics for determining induction schemes in the 
 presence of <a href="ACL2____RULER-EXTENDERS.html">ruler-extenders</a>, when handling calls of a function symbol 
 that is a ruler-extender, in either of two cases: either the function takes 
 only one argument; or the function is <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span> or <span class="tt"><a href="ACL2____EC-CALL.html">ec-call</a></span>, and 
 the first argument contains no recursive call.  These cases are treated more 
 directly as though the ruler-extender call is replaced by the unique (in the 
 case of <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span> and <span class="tt"><a href="ACL2____EC-CALL.html">ec-call</a></span>, the second) argument.</p> 
 
 <p>A new <span class="v">:</span><span class="tt"><a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a></span> rule, <span class="v">true-listp-append</span>, has 
 been added:</p> 
 
 <pre class="code">(<a href="ACL2____IMPLIES.html">implies</a> (<a href="ACL2____TRUE-LISTP.html">true-listp</a> b)
         (<a href="ACL2____TRUE-LISTP.html">true-listp</a> (<a href="COMMON-LISP____APPEND.html">append</a> a b)))</pre> 
 
 <p>If you are interested in the motivation for adding this rule, see comments 
 in <span class="v">true-listp-append</span> in ACL2 source file <span class="v">axioms.lisp</span>.</p> 
 
 <p>The use of <span class="v">:forward-chaining</span> lemmas has been improved slightly.  In 
 previous versions, a conclusion derived by forward chaining was discarded if 
 it was derivable by type-set reasoning, since it was ``already provable.'' 
 But this heuristic prevented the conclusion from triggering further forward 
 chaining.  This has been fixed.  Thanks to Dave Greve for pointing out this 
 problem.</p> 
 
 <p>The fundamental utility that turns an <span class="v">IF</span> expression into a set of 
 clauses has been optimized to better handle tests of the form <span class="v">(<a href="COMMON-LISP____EQUAL.html">equal</a> x
 'constant)</span> and their negations.  This eliminates an exponential explosion in 
 large case analyses.  But it comes at the inconvenience of sometimes reordering 
 the clauses produced.  The latter aspect of this change may require you to 
 change some Subgoal numbers in proof hints.  We apologize for the 
 inconvenience.</p> 
 
 <p>Certification can now run faster (specifically, the compilation phase) for 
 books with very large structures generated by <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span>, when there 
 is significant sharing of substructure, because of a custom optimization of 
 the Lisp reader.  Thanks to Sol Swords for bringing this efficiency issue to 
 our attention.</p> 
 
 <p>Jared Davis reported inefficiency in certain <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> evaluation 
 due to a potentially expensive ``bad lisp object'' check on the expansion 
 produced by the <span class="v">make-event</span>.  This check has been eliminated except in the 
 case that the expansion introduces packages (for example, by including a book 
 during the expansion phase that introduces packages).  Thanks to Jared for 
 providing a helpful example.</p> 
 
 <p>The application of rules of class <span class="v">:</span><span class="tt"><a href="ACL2____INDUCTION.html">induction</a></span> had the potential 
 to loop (as commented in ACL2 source function <span class="v">apply-induction-rule</span>). 
 This has been fixed.  Thanks to Daron Vroon and Pete Manolios for sending nice 
 examples causing the loop.</p> 
 
 <p>Heuristics have been tweaked so that false goals may be simplified to 
 <span class="v">nil</span> that had formerly been left unchanged by simplification, perhaps 
 resulting in useless and distracting proofs by induction.  Thanks to Pete 
 Manolios for pointing out this issue by sending the following example: <span class="v">(<a href="ACL2____THM.html">thm</a>
 (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> (<a href="COMMON-LISP_____B2.html">+</a> 1 (<a href="ACL2____ACL2-COUNT.html">acl2-count</a> x)) 0))</span>.  (Technical explanation: When every literal in 
 a clause simplifies to <span class="v">nil</span>, even though we might not normally delete one 
 or more such literals, we will replace the entire clause by the false 
 clause.)</p> 
 
 <p>Improved the efficiency of the built-in function, <span class="tt"><a href="ACL2____TAKE.html">take</a></span>.  Thanks to 
 Bob Boyer for suggesting this improvement.</p> 
 
 <p>ACL2 can now use evaluation to relieve hypotheses when applying 
 <span class="v">:</span><span class="tt"><a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a></span> rules.  Thanks to Peter Dillinger and Dave 
 Greve for requesting this enhancement, and to Robert Krug for a relevant 
 discussion long ago.</p> 
 
 <p>Evaluation has been sped up during theorems for calls of <span class="tt"><a href="ACL2____MV-LET.html">mv-let</a></span>, by 
 avoiding repeated evaluation of the expression to which its variables are 
 bound.  Thanks to Sol Swords for requesting this improvement and sending an 
 illustrative example.</p> 
 
 <p>Modified a heuristic to avoid the opening up non-recursive function calls 
 on calls of <span class="tt"><a href="ACL2____HIDE.html">hide</a></span> involving <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span>-expressions.  For example, the 
 <span class="tt"><a href="ACL2____THM.html">thm</a></span> form below is now admitted</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> bar (x)
  (<a href="COMMON-LISP____CONS.html">cons</a> x x))
(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (bar (<a href="ACL2____HIDE.html">hide</a> (<a href="COMMON-LISP____IF.html">if</a> a b c)))
     (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="ACL2____HIDE.html">hide</a> (<a href="COMMON-LISP____IF.html">if</a> a b c)) (<a href="ACL2____HIDE.html">hide</a> (<a href="COMMON-LISP____IF.html">if</a> a b c)))))</pre> 
 
 <p><b>BUG FIXES</b></p> 
 
 <p>Fixed a soundness bug in destructor elimination, which was preventing some 
 cases from being generated.  Thanks to Eric Smith for reporting this bug and 
 sending a helpful example.  (Technical detail: the fixes were in ACL2 source 
 functions <span class="v">apply-instantiated-elim-rule</span> and 
 <span class="v">eliminate-destructors-clause1</span>, and comments in the former contain Eric's 
 example.)</p> 
 
 <p>Fixed a bug that supported a proof of <span class="v">nil</span> by exploiting the fact that 
 <a href="ACL2____PORTCULLIS.html">portcullis</a> <a href="ACL2____COMMAND.html">command</a>s were not included in check-sum computations 
 in a book's <a href="ACL2____CERTIFICATE.html">certificate</a>.  For such a proof of <span class="v">nil</span>, see the 
 relevant comment in the ACL2 source file <span class="v">ld.lisp</span> under <span class="v">(<a href="ACL2____DEFLABEL.html">deflabel</a>
 note-4-0 ...)</span>.</p> 
 
 <p>Changed the implementation of <span class="tt"><a href="ACL2____ADD-INCLUDE-BOOK-DIR.html">add-include-book-dir</a></span>.  The previous 
 implementation could allow relative pathnames to be stored in the <a href="ACL2____PORTCULLIS.html">portcullis</a> <a href="ACL2____COMMAND.html">command</a>s of <a href="ACL2____CERTIFICATE.html">certificate</a>s of <a href="ACL2____BOOKS.html">books</a>, which 
 perhaps could lead to unsoundness (though we did not try to exploit this to 
 prove <span class="v">nil</span>).  Thanks to Jared Davis for reporting a bug in our first new 
 implementation.  An additional change to both <span class="tt"><a href="ACL2____ADD-INCLUDE-BOOK-DIR.html">add-include-book-dir</a></span> and 
 <span class="tt"><a href="ACL2____DELETE-INCLUDE-BOOK-DIR.html">delete-include-book-dir</a></span> is that these now work in raw-mode (see <a href="ACL2____SET-RAW-MODE.html">set-raw-mode</a>).  (Thanks to Dave Greve for suggesting a reduction in the 
 warnings we produced related to raw-mode.)  Note that it is no longer 
 permitted to make a direct call of the form <span class="v">(<a href="ACL2____TABLE.html">table</a> acl2-defaults-table
 :include-book-dir-alist ...)</span>; use <span class="tt"><a href="ACL2____ADD-INCLUDE-BOOK-DIR.html">add-include-book-dir</a></span> instead.</p> 
 
 <p>Fixed a soundness bug related to <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> keyword 
 <span class="v">:non-executable</span>.  New macros, <span class="v">defun-nx</span> and <span class="v">defund-nx</span>, have been 
 provided for declaring functions to be non-executable; see <a href="ACL2____DEFUN-NX.html">defun-nx</a>. 
 While we expect this bug to occur only rarely if at all in practice, the 
 following example shows how it could be evoked.</p> 
 
 <pre class="code">;;;;;;;;;;;;;;;;;;;;
;;; Book sub.lisp
;;;;;;;;;;;;;;;;;;;;
(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "ACL2")
(<a href="COMMON-LISP____DEFUN.html">defun</a> f ()
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t
                  :non-executable t))
  (<a href="ACL2____MV-LET.html">mv-let</a> (a b c)
          (<a href="ACL2____MV.html">mv</a> 3 4)
          (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORE.html">ignore</a> a b))
          c))
(<a href="COMMON-LISP____DEFUN.html">defun</a> g ()
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t))
  (<a href="ACL2____PROG2_42.html">prog2$</a> (<a href="ACL2____MV-LET.html">mv-let</a> (x y z)
                  (<a href="ACL2____MV.html">mv</a> 2 3 4)
                  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORE.html">ignore</a> x y z))
                  nil)
          (f)))
(<a href="ACL2____DEFTHM.html">defthm</a> g-nil
  (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ACL2____G.html">g</a>) nil)
  :hints (("Goal" :in-theory (<a href="ACL2____DISABLE.html">disable</a> (f))))
  :rule-classes nil)
;;;;;;;;;;;;;;;;;;;;
;;; Book top.lisp
;;;;;;;;;;;;;;;;;;;;
(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "ACL2")
(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "sub")
(<a href="ACL2____DEFTHM.html">defthm</a> contradiction
  nil
  :hints (("Goal" :use g-nil))
  :rule-classes nil)</pre> 
 
 <p>The modification described above pertaining to <span class="tt"><a href="ACL2____DEFUN-NX.html">defun-nx</a></span> also 
 prevents execution of non-executable functions that have been <a href="COMMON-LISP____TRACE.html">trace</a>d. 
 The following example illustrates the problem; now, the following <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> of <span class="v">g</span> is illegal, and the problem disappears if <span class="tt"><a href="ACL2____DEFUN-NX.html">defun-nx</a></span> is 
 used instead.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> g (x) ; Use defun-nx to avoid an error after Version_3.6.1.
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t :non-executable t))
  x)
(<a href="ACL2____G.html">g</a> 3) ; causes error, as expected
(<a href="ACL2____TRACE_42.html">trace$</a> g)
(<a href="ACL2____G.html">g</a> 3) ; returned 3 before the bug fix; after fix, causes error as expected</pre> 
 
 <p>A hard error was possible when attempting to include an uncertified book 
 containing <a href="ACL2____EVENTS.html">events</a> of the form <span class="v">(<a href="ACL2____MAKE-EVENT.html">make-event</a> '(<a href="ACL2____LOCAL.html">local</a> ...))</span>.  This has 
 been fixed.  Thanks to Sol Swords for bringing this issue to our 
 attention.</p> 
 
 <p>Fixed a bug in the heuristic improvement described for Version_3.6 (see 
 <a href="ACL2____NOTE-3-6.html">note-3-6</a>) as ``We simplified induction schemes....''  The bug had 
 prevented, in unusual cases such as the following (notice the impossible 
 case), a proof by induction.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (a x)
  (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____CONSP.html">consp</a> x)
       (<a href="COMMON-LISP____CASE.html">case</a> a
         (0 (foo (<a href="COMMON-LISP____CAR.html">car</a> x) (<a href="COMMON-LISP____CDR.html">cdr</a> x)))
         (1 (foo (<a href="COMMON-LISP____CDR.html">cdr</a> x) (<a href="COMMON-LISP____CAR.html">car</a> x)))
         (0 (foo a (<a href="COMMON-LISP____CONS.html">cons</a> x x))))))
(<a href="ACL2____IN-THEORY.html">in-theory</a> (<a href="ACL2____DISABLE.html">disable</a> (:type-prescription foo)))
(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____ATOM.html">atom</a> (foo a x)))</pre> 
 
 <p>Macro <span class="tt"><a href="ACL2____CW-GSTACK.html">cw-gstack</a></span> did not work with an <span class="v">:evisc-tuple</span> argument. 
 This has been fixed by changing <span class="v">cw-gstack</span> so that it now evaluates its 
 arguments.  Thanks to Sol Swords for bringing this bug to our attention.</p> 
 
 <p>Fixed a bug in <span class="v">:</span><span class="tt"><a href="ACL2____PSO.html">pso</a></span> during the printing of failure messages 
 for termination proofs.</p> 
 
 <p>Fixed a bug in the handling of <span class="v">#.</span> (see <a href="ACL2____SHARP-DOT-READER.html">sharp-dot-reader</a>). 
 Thanks to Bob Boyer for bringing this bug to our attention.</p> 
 
 <p>Replaced a hard Lisp error with a clean error, in certain cases that a 
 <span class="v">:</span><span class="tt"><a href="ACL2____HINTS.html">hints</a></span> value is erroneously supplied as a non-<span class="v">nil</span> atom. 
 Example: <span class="v">(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> x x) :hints 3)</span>.</p> 
 
 <p>Fixed a bug in the interaction of function tracing with conversion of a 
 function from <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> to <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode.  The 
 following example illustrates what had been wrong.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> f (x)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :program))
  (<a href="COMMON-LISP____CAR.html">car</a> x))
(f 3) ; raw Lisp hard error
(<a href="ACL2____TRACE_42.html">trace$</a> f)
(f 3) ; raw Lisp hard error (still)
(<a href="COMMON-LISP____DEFUN.html">defun</a> f (x) (<a href="COMMON-LISP____CAR.html">car</a> x)) ; upgrade f to :logic mode
(f 3) ; clean guard violation; f is no longer traced
(<a href="ACL2____TRACE_42.html">trace$</a>) ; uh oh - f is shown as traced
(<a href="ACL2____UNTRACE_42.html">untrace$</a> f)
(f 3) ; OUCH: hard Lisp error because old :program mode definition of
      ; the executable counterpart (sometimes called *1*f) was restored!</pre> 
 
 <p>Made a fix so that when building ACL2 with `make' option 
 <span class="v">ACL2_SAFETY=3</span>, there will no longer be any safety-0 compiled code 
 generated.  Thanks to Gary Byers for bringing this bug to our attention.</p> 
 
 <p>Fixed a bug in the handling of <a href="ACL2____OVERRIDE-HINTS.html">override-hints</a> that generate custom 
 keyword hints (see <a href="ACL2____CUSTOM-KEYWORD-HINTS.html">custom-keyword-hints</a>) involving the variable 
 <span class="v">stable-under-simplificationp</span>.  Thanks to Ian Johnson for bringing this 
 bug to our attention with explanation that included a helpful example, 
 included as comment in the ACL2 source code for function 
 <span class="v">apply-override-hint</span>.</p> 
 
 <p>The <span class="v">saved_acl2</span> script in CLISP could contain unexpected characters 
 where simple newlines were expected.  Dave Greve found this in a Cygwin 
 environment on Windows.  Thanks to Dave for reporting this bug and 
 experimenting with a fix, and thanks to the CLISP folks for providing helpful 
 information.</p> 
 
 <p>Fixed a bug that could make <span class="v">:</span><span class="tt"><a href="ACL2____OOPS.html">oops</a></span> cause an error.  Also, the 
 <span class="tt"><a href="ACL2____OOPS.html">oops</a></span> command can no longer take you back before a <span class="tt"><a href="ACL2____RESET-PREHISTORY.html">reset-prehistory</a></span> event.</p> 
 
 <p>(GCL only) Fixed a bug that could occur when calling <span class="v">trace</span> in raw Lisp 
 in GCL.</p> 
 
 <p>Proof summaries have been improved, so that they account for <a href="ACL2____RUNE.html">rune</a>s 
 used in rewriting that takes place when generating goals to be proved in a 
 forcing round.  Thanks to Jared Davis for sending us an example illustrating 
 this issue.</p> 
 
 <p>Fixed a bug that (at least in CCL) could put extra backslashes (`<span class="v">\</span>') 
 in a pathname that ACL2 writes out to the executable script created by a 
 build.  Thanks to Gary Byers for explaining that the CCL behavior is legal 
 (for our previous use of Common Lisp function <span class="v">merge-pathnames</span>).</p> 
 
 <p>We closed some holes in the handling of trust tags (also known as 
 ``ttags''; see <a href="ACL2____DEFTTAG.html">defttag</a>) by <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>.  The following example 
 illustrates this rather subtle situation.  Consider the following book.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "ACL2")
(<a href="ACL2____MAKE-EVENT.html">make-event</a>
 (<a href="ACL2____ER-PROGN.html">er-progn</a>
  (<a href="ACL2____ENCAPSULATE.html">encapsulate</a>
   ()
   (<a href="ACL2____DEFTTAG.html">defttag</a> :foo)
   (<a href="ACL2____VALUE-TRIPLE.html">value-triple</a> "Imagine something bad here!"))
  (<a href="ACL2____VALUE.html">value</a> '(<a href="ACL2____VALUE-TRIPLE.html">value-triple</a> :some-value)))
 :check-expansion t)</pre> 
 
 <p>Formerly, the following commands succeeded.</p> 
 
 <pre class="code">(<a href="ACL2____CERTIFY-BOOK.html">certify-book</a> "test3" 0 t :ttags :all)
:u
(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "test3" :ttags nil)</pre> 
 
 <p>But because of <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> keyword argument <span class="v">:check-expansion t</span>, 
 we know that the event <span class="v">(<a href="ACL2____DEFTTAG.html">defttag</a> :foo)</span> is evaluated by the above <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> form, and hence the <span class="v">:ttags</span> argument of <span class="v">include-book</span>, 
 above, should have specified <span class="v">:foo</span>.  The problem was that <span class="tt"><a href="ACL2____DEFTTAG.html">defttag</a></span> 
 forms evaluated during <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> expansion did not contribute to the 
 trust tag information stored in the book's <a href="ACL2____CERTIFICATE.html">certificate</a>.  Note: Because 
 of this change, one should avoid using <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> with 
 <span class="v">:check-expansion t</span> when the expansion would introduce a <span class="tt"><a href="ACL2____DEFTTAG.html">defttag</a></span> 
 event during <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> but not <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> time.  For an 
 example illustrating this issue, see <a href="ACL2____MAKE-EVENT-DETAILS.html">make-event-details</a>, specifically 
 the new version of the section labeled ``A note on ttags'' at the end of that 
 <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> topic.</p> 
 
 <p>Closed a small loophole that had the potential, in rare circumstances, to 
 violate atomicity of under-the-hood updates for ACL2 <a href="ACL2____ARRAYS.html">arrays</a>.</p> 
 
 <p>The following example was formerly allowed, but resulted in a 
 guard-verified function (here, <span class="v">g</span>) whose guard proof obligation is not a 
 theorem outside the <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> event.  We now disallow <a href="ACL2____GUARD.html">guard</a> 
 verification for functions introduced non-<a href="ACL2____LOCAL.html">local</a>ly inside an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> event unless we determine that the proof obligations hold outside 
 the <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> event as well.</p> 
 
 <pre class="code">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a>
 ((f (x) t))
 (<a href="ACL2____LOCAL.html">local</a> (<a href="COMMON-LISP____DEFUN.html">defun</a> f (x) (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t)) (<a href="COMMON-LISP____CONSP.html">consp</a> x)))
 ;; ERROR!
 (<a href="COMMON-LISP____DEFUN.html">defun</a> g (x)
   (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (f x)))
   (<a href="COMMON-LISP____CAR.html">car</a> x)))</pre> 
 
 <p>The use of <span class="v">:</span><span class="tt"><a href="ACL2____COMP.html">comp</a></span> on <a href="ACL2____STOBJ.html">stobj</a> functions had potentially 
 caused a hard Lisp error; for example, this could occur when <span class="v">(<a href="ACL2____DEFSTOBJ.html">defstobj</a> foo
 fld)</span> was followed by <span class="v">:comp foop</span>.  This has been fixed.</p> 
 
 <p>Fixed a bug that could cause a raw Lisp error when the first argument of 
 <span class="tt"><a href="ACL2____WITH-LOCAL-STOBJ.html">with-local-stobj</a></span> is not a symbol.</p> 
 
 <p>It had been possible to use the reserved keyword 
 :computed-hints-replacement as the name of a custom keyword hint (see <a href="ACL2____CUSTOM-KEYWORD-HINTS.html">custom-keyword-hints</a>).  This has been fixed.  Thanks to Dave Greve, who 
 pointed out a confusing hint error message (which has also been fixed) that 
 led us to this issue.</p> 
 
 <p>Fixed a bug that could cause a hard Lisp error, instead of a graceful ACL2 
 error, if keyword <span class="v">:backchain-limit-lst</span> in a rule class is given a cons 
 that is not a true list, such as <span class="v">(1 . 1)</span>.</p> 
 
 <p>Eliminated an error that could occur when redefining a function as a macro 
 and then compiling, as in the example below.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x) x)
:redef!
(<a href="COMMON-LISP____DEFMACRO.html">defmacro</a> foo (x) x)
:comp t</pre> 
 
 <p>Thanks to Eric Smith for sending the above example in his bug report.</p> 
 
 <p>Fixed a bug that could result in an assertion when a <a href="ACL2____CLAUSE-PROCESSOR.html">clause-processor</a> causes an error.</p> 
 
 <p><b>NEW AND UPDATED BOOKS AND RELATED INFRASTRUCTURE</b></p> 
 
 <p>See the <a href="http://code.google.com/p/acl2-books/source/list" target="_blank"><nobr>log 
 entries<img src="../Icon_External_Link.png" title="External link to http://code.google.com/p/acl2-books/source/list"></nobr></a> for a record of books changed or added since the preceding 
 release, with log entries.</p> 
 
 <p>We note in particular the new <span class="v">system/</span> directory, which begins to 
 specify ACL2 system code in anticipation of opening the architecture of ACL2 
 (see <a href="ACL2____DEFATTACH.html">defattach</a> for a relevant tool).  Some system functions were 
 changed slightly (but with the expectation of not generally affecting ACL2 
 behavior) in support of the development of this directory.  Those interested 
 in contributing to further such efforts are invited to contact the ACL2 
 implementors.</p> 
 
 <p>New utilities have been provided for certifying most of the distributed 
 books with more `make'-level parallelism.  For example, we have obtained close 
 to a 12x reduction in time by using `<span class="v">make -j 24 regression-fast</span>' on a 
 24-processor machine.  For more information see <span class="v">books/make-targets</span>, or to 
 include the <span class="v">books/workshops</span> in the regression run, see 
 <span class="v">books/regression-targets</span>.  Thanks to Sol Swords for providing these nice 
 utilities.</p> 
 
 <p>The top-level makefile, <span class="v">GNUmakefile</span>, has been fixed so that the build 
 processes (which are inherently sequential) will ignore the <span class="v">-j</span> option of 
 `make'.  Note that regressions can still, however, be done in parallel, as the 
 <span class="v">-j</span> option will be passed automatically to the appropriate `make' 
 command.</p> 
 
 <p><b>EMACS SUPPORT</b></p> 
 
 <p><b>EXPERIMENTAL VERSIONS</b></p> 
 
 <p>The HONS version, supported primarily by Bob Boyer and Warren Hunt (see 
 <a href="ACL2____HONS-AND-MEMOIZATION.html">hons-and-memoization</a>), has undergone numerous improvements.  For 
 example, keyword argument <span class="v">:FORGET</span> is now supported when calling <span class="tt"><a href="ACL2____MEMOIZE.html">memoize</a></span> from within the ACL2 loop, and system function <span class="v">worse-than</span> is 
 <a href="ACL2____MEMOIZE.html">memoize</a>d with the <span class="v">:condition</span> that both terms are function 
 applications (clearing the memo-table after each prover invocation).  Thanks 
 to Jared Davis and Sol Swords for investigating the memoization of 
 <span class="v">worse-than</span>, and with suitable <span class="v">condition</span>.  Thanks also to Jared Davis 
 for contributing structural modifications to the implementation of <span class="tt"><a href="ACL2____HONS.html">hons</a></span>.</p> 
 
 <p>David Rager contributed modifications to the parallel version (see <a href="ACL2____PARALLELISM.html">parallelism</a>), which include taking advantage of atomic increments available 
 at least since Version 1.0.21 of SBCL and Version 1.3 of CCL.</p>
</body>
</html>
