<html>
<head>
<meta charset="UTF-8">
<title>Gen-write-function</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=X86ISA____GEN-WRITE-FUNCTION">Click for Gen-write-function in the Full Manual</a></h3>

<p></p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(gen-write-function &amp;key size signed? 
                    check-alignment?-var mem-ptr?-var) 
 
  → 
*</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">size</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____NATP.html">natp</a> size)</span>.</font>
</dd> 
  <dd>
<span class="tt">signed?</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> signed?)</span>.</font>
</dd> 
  <dd>
<span class="tt">check-alignment?-var</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> check-alignment?-var)</span>.</font>
</dd> 
  <dd>
<span class="tt">mem-ptr?-var</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> mem-ptr?-var)</span>.</font>
</dd> 
 
</dl></div> 
 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>gen-write-function-fn</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 gen-write-function-fn
 (size signed?
       check-alignment?-var mem-ptr?-var)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____NATP.html">natp</a> size)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> signed?)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> check-alignment?-var)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> mem-ptr?-var))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'gen-write-function))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   ((size-str (<a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a> (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP_____C3.html">&lt;</a> size 10)
                               (<a href="ACL2____PACKN.html">acl2::packn</a> (<a href="COMMON-LISP____LIST.html">list</a> 0 size))
                               (<a href="ACL2____PACKN.html">acl2::packn</a> (<a href="COMMON-LISP____LIST.html">list</a> size)))))
    (fn (<a href="STR____CAT.html">str::cat</a> (<a href="COMMON-LISP____IF.html">if</a> signed? "WIME" "WME")
                  size-str))
    (fn-name (<a href="ACL2____INTERN_42.html">intern$</a> fn "X86ISA"))
    (fn-call
     (<a href="COMMON-LISP____CONS.html">cons</a>
      fn-name
      (<a href="COMMON-LISP____CONS.html">cons</a>
       'proc-mode
       (<a href="COMMON-LISP____CONS.html">cons</a>
        'eff-addr
        (<a href="COMMON-LISP____CONS.html">cons</a>
             'seg-reg
             (<a href="COMMON-LISP____CONS.html">cons</a> 'val
                   (<a href="COMMON-LISP____APPEND.html">append</a> (<a href="COMMON-LISP____AND.html">and</a> check-alignment?-var
                                '(check-alignment?))
                           (<a href="COMMON-LISP____CONS.html">cons</a> 'x86
                                 (<a href="COMMON-LISP____AND.html">and</a> mem-ptr?-var
                                      '(:mem-ptr? mem-ptr?))))))))))
    (lin-mem-fn (<a href="STR____CAT.html">str::cat</a> (<a href="COMMON-LISP____IF.html">if</a> signed? "WIML" "WML")
                          size-str))
    (lin-mem-fn-name (<a href="ACL2____INTERN_42.html">intern$</a> lin-mem-fn "X86ISA"))
    (short-doc-string
        (<a href="STR____CAT.html">str::cat</a> "Write "
                  (<a href="COMMON-LISP____IF.html">if</a> signed? "a signed " "an unsigned ")
                  (<a href="STR____NAT-TO-DEC-STRING.html">str::nat-to-dec-string</a> size)
                  "-bit value to memory via an effective address."))
    (long-doc-string
     (<a href="STR____CAT.html">str::cat</a>
      "&lt;p&gt;The effective address @('eff-addr') is translated to a canonical
          linear address.  If this translation is successful and no other error
          occurs (like alignment errors), then @(see "
      lin-mem-fn
      ") is
          called.&lt;/p&gt;
          &lt;p&gt;Prior to the effective address translation, we check whether write
          access is allowed.  In 32-bit mode, write access is allowed in data
          segments (DS, ES, FS, GS, and SS) if the W bit in the segment
          descriptor is 1; write access is disallowed in code segments (this is
          not explicitly mentioned in Intel manual, May'18, Volume 3, Section
          3.4.5.1, but it seems reasonable).  In 64-bit mode, the W bit is
          ignored (see Atmel manual, Dec'17, Volume 2, Section 4.8.1); by
          analogy, we allow write access to the code segment as well.
          These checks may be slightly optimized using the invariant that
          SS.W must be 1 when SS is loaded.&lt;/p&gt;")))
   (<a href="COMMON-LISP____CONS.html">cons</a>
    'define
    (<a href="COMMON-LISP____CONS.html">cons</a>
     fn-name
     (<a href="COMMON-LISP____CONS.html">cons</a>
      (<a href="COMMON-LISP____CONS.html">cons</a>
       '(proc-mode :type (integer 0 4))
       (<a href="COMMON-LISP____CONS.html">cons</a>
        '(eff-addr :type (signed-byte 64))
        (<a href="COMMON-LISP____CONS.html">cons</a>
         '(seg-reg :type (integer 0 5))
         (<a href="COMMON-LISP____CONS.html">cons</a>
          (<a href="COMMON-LISP____CONS.html">cons</a>
           'val
           (<a href="COMMON-LISP____CONS.html">cons</a>
                ':type
                (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____IF.html">if</a> signed? 'signed-byte 'unsigned-byte)
                            (<a href="COMMON-LISP____CONS.html">cons</a> size 'nil))
                      'nil)))
          (<a href="COMMON-LISP____APPEND.html">append</a>
               (<a href="COMMON-LISP____AND.html">and</a> check-alignment?-var
                    '((check-alignment? booleanp)))
               (<a href="COMMON-LISP____CONS.html">cons</a> 'x86
                     (<a href="COMMON-LISP____AND.html">and</a> mem-ptr?-var
                          '(<a href="COMMON-LISP_____62KEY.html">&amp;key</a> ((mem-ptr? booleanp) 'nil)))))))))
      (<a href="COMMON-LISP____CONS.html">cons</a>
       ':inline
       (<a href="COMMON-LISP____CONS.html">cons</a>
        't
        (<a href="COMMON-LISP____CONS.html">cons</a>
         ':no-function
         (<a href="COMMON-LISP____CONS.html">cons</a>
          't
          (<a href="COMMON-LISP____CONS.html">cons</a>
           ':returns
           (<a href="COMMON-LISP____CONS.html">cons</a>
            '(<a href="ACL2____MV.html">mv</a> flg (x86-new x86p :hyp (x86p x86)))
            (<a href="COMMON-LISP____CONS.html">cons</a>
             ':parents
             (<a href="COMMON-LISP____CONS.html">cons</a>
              '(<a href="X86ISA____TOP-LEVEL-MEMORY.html">top-level-memory</a>)
              (<a href="COMMON-LISP____CONS.html">cons</a>
               ':short
               (<a href="COMMON-LISP____CONS.html">cons</a>
                short-doc-string
                (<a href="COMMON-LISP____CONS.html">cons</a>
                 ':long
                 (<a href="COMMON-LISP____CONS.html">cons</a>
                  long-doc-string
                  (<a href="COMMON-LISP____CONS.html">cons</a>
                   (<a href="COMMON-LISP____CONS.html">cons</a>
                    'b*
                    (<a href="COMMON-LISP____CONS.html">cons</a>
                     (<a href="COMMON-LISP____CONS.html">cons</a>
                      '((when
                         (<a href="COMMON-LISP____AND.html">and</a>
                          (<a href="COMMON-LISP_____F2_D3.html">/=</a> proc-mode 0)
                          (<a href="COMMON-LISP____OR.html">or</a>
                           (<a href="COMMON-LISP_____D3.html">=</a> seg-reg 1)
                           (<a href="ACL2____B_A2.html">b*</a>
                            ((attr
                              (<a href="ACL2____LOGHEAD.html">loghead</a>
                                 16 (seg-hidden-attri seg-reg x86)))
                             (<a href="ACL2____W.html">w</a> (<a href="X86ISA____DATA-SEGMENT-DESCRIPTOR-ATTRIBUTESBITS-_E3W.html">data-segment-descriptor-attributesbits-&gt;w</a>
                                     attr)))
                            (<a href="COMMON-LISP_____D3.html">=</a> w 0)))))
                        (<a href="ACL2____MV.html">mv</a>
                         (<a href="COMMON-LISP____LIST.html">list</a>
                             :non-writable-segment eff-addr seg-reg)
                         x86))
                      (<a href="COMMON-LISP____CONS.html">cons</a>
                       (<a href="COMMON-LISP____CONS.html">cons</a>
                        '(<a href="ACL2____MV.html">mv</a> flg lin-addr)
                        (<a href="COMMON-LISP____CONS.html">cons</a>
                         (<a href="COMMON-LISP____CONS.html">cons</a>
                          'ea-to-la
                          (<a href="COMMON-LISP____CONS.html">cons</a>
                            'proc-mode
                            (<a href="COMMON-LISP____CONS.html">cons</a> 'eff-addr
                                  (<a href="COMMON-LISP____CONS.html">cons</a> 'seg-reg
                                        (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP_____F2.html">/</a> size 8) '(x86))))))
                         'nil))
                       (<a href="COMMON-LISP____CONS.html">cons</a>
                        '((when flg) (<a href="ACL2____MV.html">mv</a> flg x86))
                        (<a href="COMMON-LISP____AND.html">and</a>
                         check-alignment?-var
                         (<a href="COMMON-LISP____CONS.html">cons</a>
                          (<a href="COMMON-LISP____CONS.html">cons</a>
                           (<a href="COMMON-LISP____CONS.html">cons</a>
                            'unless
                            (<a href="COMMON-LISP____CONS.html">cons</a>
                             (<a href="COMMON-LISP____CONS.html">cons</a>
                              'or
                              (<a href="COMMON-LISP____CONS.html">cons</a>
                               '(<a href="COMMON-LISP____NOT.html">not</a> check-alignment?)
                               (<a href="COMMON-LISP____CONS.html">cons</a>
                                (<a href="COMMON-LISP____CONS.html">cons</a>
                                 'address-aligned-p
                                 (<a href="COMMON-LISP____CONS.html">cons</a>
                                  'lin-addr
                                  (<a href="COMMON-LISP____CONS.html">cons</a>
                                   (<a href="COMMON-LISP_____F2.html">/</a> size 8)
                                   (<a href="COMMON-LISP____CONS.html">cons</a>
                                    (<a href="COMMON-LISP____IF.html">if</a> mem-ptr?-var 'mem-ptr? 'nil)
                                    'nil))))
                                'nil)))
                             'nil))
                           '((<a href="ACL2____MV.html">mv</a>
                              (<a href="COMMON-LISP____LIST.html">list</a>
                                 :unaligned-linear-address lin-addr)
                              x86)))
                          'nil)))))
                     (<a href="COMMON-LISP____CONS.html">cons</a>
                          (<a href="COMMON-LISP____CONS.html">cons</a> lin-mem-fn-name '(lin-addr val x86))
                          'nil)))
                   (<a href="COMMON-LISP____CONS.html">cons</a>
                    '///
                    (<a href="COMMON-LISP____CONS.html">cons</a>
                     (<a href="COMMON-LISP____CONS.html">cons</a>
                      'defrule
                      (<a href="COMMON-LISP____CONS.html">cons</a>
                       (<a href="X86ISA____MK-NAME.html">mk-name</a>
                            fn "-WHEN-64-BIT-MODEP-AND-NOT-FS/GS")
                       (<a href="COMMON-LISP____CONS.html">cons</a>
                        (<a href="COMMON-LISP____CONS.html">cons</a>
                         'implies
                         (<a href="COMMON-LISP____CONS.html">cons</a>
                          (<a href="COMMON-LISP____CONS.html">cons</a>
                           'and
                           (<a href="COMMON-LISP____CONS.html">cons</a>
                            '(<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> seg-reg 4))
                            (<a href="COMMON-LISP____CONS.html">cons</a>
                             '(<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> seg-reg 5))
                             (<a href="COMMON-LISP____CONS.html">cons</a>
                              '(<a href="X86ISA____CANONICAL-ADDRESS-P.html">canonical-address-p</a> eff-addr)
                              (<a href="COMMON-LISP____AND.html">and</a>
                               check-alignment?-var
                               (<a href="COMMON-LISP____CONS.html">cons</a>
                                (<a href="COMMON-LISP____CONS.html">cons</a>
                                 'or
                                 (<a href="COMMON-LISP____CONS.html">cons</a>
                                  '(<a href="COMMON-LISP____NOT.html">not</a> check-alignment?)
                                  (<a href="COMMON-LISP____CONS.html">cons</a>
                                   (<a href="COMMON-LISP____CONS.html">cons</a>
                                    'address-aligned-p
                                    (<a href="COMMON-LISP____CONS.html">cons</a>
                                     'eff-addr
                                     (<a href="COMMON-LISP____CONS.html">cons</a>
                                      (<a href="COMMON-LISP_____F2.html">/</a> size 8)
                                      (<a href="COMMON-LISP____CONS.html">cons</a>
                                          (<a href="COMMON-LISP____IF.html">if</a> mem-ptr?-var 'mem-ptr?
                                              'nil)
                                          'nil))))
                                   'nil)))
                                'nil))))))
                          (<a href="COMMON-LISP____CONS.html">cons</a>
                           (<a href="COMMON-LISP____CONS.html">cons</a>
                            'equal
                            (<a href="COMMON-LISP____CONS.html">cons</a>
                             (search-and-replace-once 'proc-mode
                                                      '0
                                                      fn-call)
                             (<a href="COMMON-LISP____CONS.html">cons</a>
                              (<a href="COMMON-LISP____CONS.html">cons</a>
                                lin-mem-fn-name '(eff-addr val x86))
                              'nil)))
                           'nil)))
                        'nil)))
                     (<a href="COMMON-LISP____APPEND.html">append</a>
                      (<a href="COMMON-LISP____AND.html">and</a>
                       check-alignment?-var
                       (<a href="COMMON-LISP____CONS.html">cons</a>
                        (<a href="COMMON-LISP____CONS.html">cons</a>
                         'defrule
                         (<a href="COMMON-LISP____CONS.html">cons</a>
                          (<a href="X86ISA____MK-NAME.html">mk-name</a>
                           fn
                           "-UNALIGNED-WHEN-64-BIT-MODEP-AND-NOT-FS/GS")
                          (<a href="COMMON-LISP____CONS.html">cons</a>
                           (<a href="COMMON-LISP____CONS.html">cons</a>
                            'implies
                            (<a href="COMMON-LISP____CONS.html">cons</a>
                             (<a href="COMMON-LISP____CONS.html">cons</a>
                              'and
                              (<a href="COMMON-LISP____CONS.html">cons</a>
                               '(<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> seg-reg 4))
                               (<a href="COMMON-LISP____CONS.html">cons</a>
                                '(<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> seg-reg 5))
                                (<a href="COMMON-LISP____CONS.html">cons</a>
                                 (<a href="COMMON-LISP____CONS.html">cons</a>
                                  'not
                                  (<a href="COMMON-LISP____CONS.html">cons</a>
                                   (<a href="COMMON-LISP____CONS.html">cons</a>
                                    'or
                                    (<a href="COMMON-LISP____CONS.html">cons</a>
                                     '(<a href="COMMON-LISP____NOT.html">not</a> check-alignment?)
                                     (<a href="COMMON-LISP____CONS.html">cons</a>
                                      (<a href="COMMON-LISP____CONS.html">cons</a>
                                       'address-aligned-p
                                       (<a href="COMMON-LISP____CONS.html">cons</a>
                                        'eff-addr
                                        (<a href="COMMON-LISP____CONS.html">cons</a>
                                         (<a href="COMMON-LISP_____F2.html">/</a> size 8)
                                         (<a href="COMMON-LISP____CONS.html">cons</a>
                                          (<a href="COMMON-LISP____IF.html">if</a> mem-ptr?-var 'mem-ptr?
                                              'nil)
                                          'nil))))
                                      'nil)))
                                   'nil))
                                 '((<a href="X86ISA____CANONICAL-ADDRESS-P.html">canonical-address-p</a>
                                        eff-addr))))))
                             (<a href="COMMON-LISP____CONS.html">cons</a>
                              (<a href="COMMON-LISP____CONS.html">cons</a>
                               'equal
                               (<a href="COMMON-LISP____CONS.html">cons</a>
                                (search-and-replace-once 'proc-mode
                                                         '0
                                                         fn-call)
                                '((<a href="COMMON-LISP____LIST.html">list</a>
                                     (<a href="COMMON-LISP____LIST.html">list</a> :unaligned-linear-address
                                           eff-addr)
                                     x86))))
                              'nil)))
                           'nil)))
                        'nil))
                      (<a href="COMMON-LISP____CONS.html">cons</a>
                       (<a href="COMMON-LISP____CONS.html">cons</a>
                        'defrule
                        (<a href="COMMON-LISP____CONS.html">cons</a>
                         (<a href="X86ISA____MK-NAME.html">mk-name</a> fn "-WHEN-64-BIT-MODEP-AND-FS/GS")
                         (<a href="COMMON-LISP____CONS.html">cons</a>
                          (<a href="COMMON-LISP____CONS.html">cons</a>
                           'implies
                           (<a href="COMMON-LISP____CONS.html">cons</a>
                            '(<a href="COMMON-LISP____OR.html">or</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> seg-reg 4)
                                 (<a href="COMMON-LISP____EQUAL.html">equal</a> seg-reg 5))
                            (<a href="COMMON-LISP____CONS.html">cons</a>
                             (<a href="COMMON-LISP____CONS.html">cons</a>
                              'equal
                              (<a href="COMMON-LISP____CONS.html">cons</a>
                               (search-and-replace-once 'proc-mode
                                                        '0
                                                        fn-call)
                               (<a href="COMMON-LISP____CONS.html">cons</a>
                                (<a href="COMMON-LISP____CONS.html">cons</a>
                                 'b*
                                 (<a href="COMMON-LISP____CONS.html">cons</a>
                                  (<a href="COMMON-LISP____CONS.html">cons</a>
                                   '((<a href="ACL2____MV.html">mv</a> flg lin-addr)
                                     (<a href="ACL2____B_A2.html">b*</a>
                                      (((<a href="ACL2____MV.html">mv</a> base &amp; &amp;)
                                        (<a href="X86ISA____SEGMENT-BASE-AND-BOUNDS.html">segment-base-and-bounds</a>
                                             0 seg-reg x86))
                                       (lin-addr
                                        (<a href="X86ISA____I64.html">i64</a>
                                          (<a href="COMMON-LISP_____B2.html">+</a> base (<a href="X86ISA____N64.html">n64</a> eff-addr)))))
                                      (<a href="COMMON-LISP____IF.html">if</a>
                                       (<a href="X86ISA____CANONICAL-ADDRESS-P.html">canonical-address-p</a>
                                            lin-addr)
                                       (<a href="ACL2____MV.html">mv</a> nil lin-addr)
                                       (<a href="ACL2____MV.html">mv</a>
                                        (<a href="COMMON-LISP____LIST.html">list</a> :non-canonical-address
                                              lin-addr)
                                        0))))
                                   (<a href="COMMON-LISP____CONS.html">cons</a>
                                    '((when flg) (<a href="ACL2____MV.html">mv</a> flg x86))
                                    (<a href="COMMON-LISP____AND.html">and</a>
                                     check-alignment?-var
                                     (<a href="COMMON-LISP____CONS.html">cons</a>
                                      (<a href="COMMON-LISP____CONS.html">cons</a>
                                       (<a href="COMMON-LISP____CONS.html">cons</a>
                                        'unless
                                        (<a href="COMMON-LISP____CONS.html">cons</a>
                                         (<a href="COMMON-LISP____CONS.html">cons</a>
                                          'or
                                          (<a href="COMMON-LISP____CONS.html">cons</a>
                                           '(<a href="COMMON-LISP____NOT.html">not</a> check-alignment?)
                                           (<a href="COMMON-LISP____CONS.html">cons</a>
                                            (<a href="COMMON-LISP____CONS.html">cons</a>
                                             'address-aligned-p
                                             (<a href="COMMON-LISP____CONS.html">cons</a>
                                              'lin-addr
                                              (<a href="COMMON-LISP____CONS.html">cons</a>
                                               (<a href="COMMON-LISP_____F2.html">/</a> size 8)
                                               (<a href="COMMON-LISP____CONS.html">cons</a>
                                                    (<a href="COMMON-LISP____IF.html">if</a> mem-ptr?-var
                                                        'mem-ptr?
                                                        'nil)
                                                    'nil))))
                                            'nil)))
                                         'nil))
                                       '((<a href="ACL2____MV.html">mv</a>
                                          (<a href="COMMON-LISP____LIST.html">list</a>
                                           :unaligned-linear-address
                                           lin-addr)
                                          x86)))
                                      'nil))))
                                  (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> lin-mem-fn-name
                                              '(lin-addr val x86))
                                        'nil)))
                                'nil)))
                             'nil)))
                          '(:hints
                            (("Goal"
                               :in-theory (<a href="ACL2____E_F2D.html">e/d</a> (<a href="X86ISA____EA-TO-LA.html">ea-to-la</a>) nil)))))))
                       'nil)))))))))))))))))))))))</pre> 

</body>
</html>
