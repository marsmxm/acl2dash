<html>
<head>
<meta charset="UTF-8">
<title>Set-max-mem</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____SET-MAX-MEM">Click for Set-max-mem in the Full Manual</a></h3>

<p>An enhanced memory management scheme. (CCL only; requires 
  a trust tag)</p><p>Typical usage:</p> 
 
<pre class="code">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "centaur/misc/memory-mgmt" :dir :system) ;; adds ttag
(<a href="ACL2____VALUE-TRIPLE.html">value-triple</a> (<a href="ACL2____SET-MAX-MEM.html">set-max-mem</a> (<a href="COMMON-LISP_____A2.html">*</a> 4 (<a href="COMMON-LISP____EXPT.html">expt</a> 2 30))))           ;; 4 GB</pre> 
 
<p>Logically <span class="tt">(set-max-mem n)</span> just returns <span class="v">nil</span>.</p> 
 
<p>Under the hood, loading the <span class="v">centaur/misc/memory-mgmt</span> book adds some 
special garbage collection hooks into CCL, and <span class="v">set-max-mem</span> influences the 
behavior of these hooks.</p> 
 
<p>Roughly speaking, <span class="tt">(set-max-mem n)</span> means: <b>try</b> to use no more than 
<span class="v">n</span> bytes of <b>heap</b> memory.  You should think of this as a soft cap. 
Generally the limit will grow by increments of 1 GB as you start to run out of 
memory.</p> 
 
<p>Note that this only influences the heap memory.  To avoid swapping death, 
you should typically pick an <span class="v">n</span> that leaves space for the stacks and other 
processes on your system.  For instance, if your machine has only 8 GB of 
physical memory, you may wish to reserve no more than about 6 GB for the 
heap.</p> 
 
 
<h3>Interaction with <a href="BUILD____CERT.PL.html">build::cert.pl</a>
</h3> 
 
<p>The <a href="BUILD____CERT.PL.html">build::cert.pl</a> build system scans for calls of <span class="v">set-max-mem</span> 
and uses them to infer how much memory a book will need.  This information may 
be useful for scheduling jobs when carrying out distributed builds on a 
cluster.</p> 
 
<p>Note that this parsing is done by a simple Perl script, so you can't just 
use an arbitrary Lisp expression here.  Explicitly supported expressions 
are:</p> 
 
<ul> 
 <li><span class="v">(<a href="COMMON-LISP_____A2.html">*</a> n (<a href="COMMON-LISP____EXPT.html">expt</a> 2 30))</span></li> 
 <li><span class="v">(<a href="COMMON-LISP____EXPT.html">expt</a> 2 n)</span></li> 
</ul> 
 
 
<h3>Using <span class="v">set-max-mem</span> in Pure ACL2 Books</h3> 
 
<p>To make it possible to embed calls of <a href="ACL2____SET-MAX-MEM.html">set-max-mem</a> into ordinary, 
trust-tag free ACL2 code, the logical definition of <span class="v">set-max-mem</span> is found 
in the book:</p> 
 
<pre class="code">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "centaur/misc/memory-mgmt-logic" :dir :system)</pre> 
 
<p>Note that if you load only this <span class="v">-logic</span> book, without also loading the 
raw book, then <span class="v">set-max-mem</span> will <b>do nothing</b> except print a message 
saying it is doing nothing.</p>
</body>
</html>
