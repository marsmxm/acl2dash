<html>
<head>
<meta charset="UTF-8">
<title>Note-8-4</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____NOTE-8-4">Click for Note-8-4 in the Full Manual</a></h3>

<p>ACL2 Version  8.4 (August, 2021) Notes</p><p>NOTE!  New users can ignore these release notes, because the <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> has been updated to reflect all changes that are recorded 
 here.</p> 
 
 <p>Below we roughly organize the changes to ACL2 since Version 8.3 into the 
 following categories of changes: existing features, new features, heuristic 
 and efficiency improvements, bug fixes, changes at the system level, Emacs 
 support, and experimental versions.  Each change is described in just one 
 category, though of course many changes could be placed in more than one 
 category.</p> 
 
 <p>Note that only ACL2 system changes are listed below.  See also <a href="ACL2____NOTE-8-4-BOOKS.html">note-8-4-books</a> for a summary of changes made to the ACL2 Community Books 
 since ACL2 8.3, including the build system.  Also note that with each release, 
 it is typical that the value of constant <span class="tt"><a href="ACL2_____A2ACL2-EXPORTS_A2.html">*ACL2-exports*</a></span> has been 
 extended, and that some built-in functions that were formerly in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode are now <a href="ACL2____GUARD.html">guard</a>-verified <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode 
 functions.</p> 
 
 <h3>Changes to Existing Features</h3> 
 
 <p><span class="tt"><a href="ACL2____APPLY_42.html">Apply$</a></span>, <span class="tt"><a href="ACL2____LAMBDA_42.html">lambda$</a></span>, and <span class="tt"><a href="ACL2____LOOP_42.html">loop$</a></span> may be used with <a href="ACL2____BADGE.html">badge</a>d <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode functions in top-level evaluation.  To 
 assign a badge to a <span class="v">program</span> mode function, use the new feature <span class="tt"><a href="ACL2____DEFBADGE.html">defbadge</a></span>.</p> 
 
 <p>For calls of the form <span class="v">(<a href="ACL2____HIDE.html">HIDE</a> (<a href="ACL2____COMMENT.html">COMMENT</a> "..." ...))</span>, the string is a 
 bit more descriptive.  See <a href="ACL2____COMMENT.html">comment</a> and see <a href="ACL2____HIDE.html">hide</a>.  Thanks to Mark 
 Greenstreet for helpful discussions leading to this change.</p> 
 
 <p>The <a href="ACL2____EVENTS.html">events</a> <span class="tt"><a href="ACL2____DEFUN-NX.html">defun-nx</a></span> and <span class="tt"><a href="ACL2____DEFUND-NX.html">defund-nx</a></span> now <a href="ACL2____DISABLE.html">disable</a> 
 the <a href="ACL2____EXECUTABLE-COUNTERPART.html">executable-counterpart</a> <a href="ACL2____RUNE.html">rune</a> for the new function symbol. 
 Thus, after either of these introduces function symbol <span class="v">f</span>, the ACL2 
 rewriter will no longer attempt to simplify a call of <span class="v">f</span> on concrete 
 arguments by using evaluation (unless of course that executable-counterpart is 
 enabled first).  Thanks to Mark Greenstreet for an email leading to this 
 change.  The implementation of this change also fixes a bug: when the <a href="ACL2____DEFAULT-DEFUN-MODE.html">default-defun-mode</a> is program mode, <span class="tt"><a href="ACL2____DEFUND-NX.html">defund-nx</a></span> now <a href="ACL2____DISABLE.html">disable</a>s the 
 definition <a href="ACL2____RUNE.html">rune</a> for the new function, but that was not previously the 
 case.</p> 
 
 <p>Some built-in functions supporting the macro, <span class="tt"><a href="COMMON-LISP____POSITION.html">position</a></span>, now <span class="tt"><a href="ACL2____FIX.html">fix</a></span> (coerce) their accumulator argument to a natural number.  Thanks to Mihir 
 Mehta for supplying the initial such changes, for the purpose of avoiding 
 numeric type hypotheses.  After that, thanks to email correspondence from 
 Warren Hunt, we added built-in <span class="v">:</span><span class="tt"><a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a></span> rules for those 
 same functions so that ACL2 <a href="ACL2____TYPE-SET.html">type-set</a> reasoning infers that 
 <span class="v">position</span> always returns either <span class="v">nil</span> or a natural number.</p> 
 
 <p>The macro <span class="tt"><a href="ACL2____DEFCONST.html">defconst</a></span> no longer accepts an optional documentation 
 string (which was already being ignored).  Thanks to Eric Smith and Alessandro 
 Coglio for suggesting this change, which avoids potential confusion; consider 
 for example <span class="v">(<a href="ACL2____DEFCONST.html">defconst</a> *c* () "abc")</span>.</p> 
 
 <p>Two improvements have been made in support of the <span class="tt"><a href="ACL2____CASE-MATCH.html">case-match</a></span> macro. 
 (1) The built-in constant <span class="tt"><a href="ACL2_____A2ACL2-EXPORTS_A2.html">*ACL2-exports*</a></span> now includes the 
 <span class="v">"ACL2"</span> package symbol, <span class="v">quotep~</span>.  (2) The built-in function 
 <span class="v">symbol-name-equal</span> is now a <a href="ACL2____GUARD.html">guard</a>-verified <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode 
 function.  Thanks to Stephen Westfold for email leading to these changes: 
 for (1), pointing out that the special role of <span class="v">quotep~</span> for the <span class="tt"><a href="ACL2____CASE-MATCH.html">case-match</a></span> macro applies only to that <span class="v">"ACL2"</span> package symbol, not to 
 other symbols with the same name; and for (2), pointing out that the expansion 
 of a <span class="v">case-match</span> call that invokes <span class="v">quotep~</span> for matching was 
 introducing <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode code.</p> 
 
 <p>A call of <span class="tt"><a href="ACL2____COMMENT.html">comment</a></span> is more often inserted when the prover inserts a 
 call of <span class="tt"><a href="ACL2____HIDE.html">hide</a></span>.  See <a href="ACL2____COMMENT.html">comment</a> for a discussion of such ways in 
 which <span class="v">comment</span> is used.</p> 
 
 <p>When a <a href="ACL2____REWRITE.html">rewrite</a> rule's conclusion is of the form <span class="v">(equiv term1
 term2)</span> where <span class="v">equiv</span> is a known <a href="ACL2____EQUIVALENCE.html">equivalence</a> relation, ACL2 
 generally creates the rule to rewrite an instance of <span class="v">term1</span> to the 
 corresponding instance of <span class="v">term2</span>, in a context where it is sufficient to 
 preserve <span class="v">equiv</span>.  However, if that rule is illegal, for example because it 
 would rewrite a variable, then the rule is effectively treated as <span class="v">(<a href="COMMON-LISP____EQUAL.html">equal</a>
 (equiv term1 term2) t)</span>.  This behavior is not new, but now an explanatory 
 <a href="ACL2____OBSERVATION.html">observation</a> is printed when this happens, as for <span class="v">foo</span> in the 
 following example.  Thanks to Mihir Mehta for suggesting such an 
 enhancement.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> my-equiv (x y) (<a href="COMMON-LISP____EQUAL.html">equal</a> x y))
(<a href="ACL2____DEFEQUIV.html">defequiv</a> my-equiv)
(<a href="ACL2____IN-THEORY.html">in-theory</a> (<a href="ACL2____DISABLE.html">disable</a> my-equiv)) ; optional (avoids warnings for the next form)
(<a href="ACL2____DEFTHM.html">defthm</a> foo (my-equiv x (<a href="COMMON-LISP____CAR.html">car</a> (<a href="COMMON-LISP____CONS.html">cons</a> x x))))</pre> 
 
 <p>A trust tag (see <a href="ACL2____DEFTTAG.html">defttag</a>) is now required to set the <a href="ACL2____LD-PROMPT.html">ld-prompt</a> to a non-Boolean value, other than the <a href="ACL2____BRR.html">brr</a> prompt, since 
 that can cause printing of the prompt to modify state in rather arbitrary 
 ways.</p> 
 
 <p>Improved translation of function calls, especially those that involve 
 congruent <a href="ACL2____STOBJ.html">stobj</a>s, including better error messages, much improved code 
 comments, and simplified code.  Thanks to Sol Swords for sending an example 
 with a misleading error message.</p> 
 
 <p>The error message has been improved when a <span class="v">:</span><span class="tt"><a href="ACL2____LINEAR.html">linear</a></span> rule is 
 illegal due to simplification of its conclusion to a constant by ground 
 evaluation.  Thanks to Eric Smith for suggesting such an improvement.</p> 
 
 <p>It is no longer an error to repeat a <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> event after removing 
 or adding the <a href="ACL2____XARGS.html">xargs</a> <a href="COMMON-LISP____DECLARATION.html">declaration</a>, <span class="v">:guard t</span>; the latter is 
 now essentially redundant.  It is similarly no longer an error to repeat a 
 <span class="v">defun-sk</span> event by adding, removing, or changing keyword <span class="v">:guard-hints</span> 
 in an <span class="v">xargs</span> declaration.  Thanks to Alessandro Coglio for reporting these 
 issues.</p> 
 
 <p>The set of <span class="tt"><a href="ACL2____APPLY_42.html">apply$</a></span> primitives has been expanded.  These are built-in 
 function symbols that do not need a <a href="ACL2____WARRANT.html">warrant</a> when reasoning about the 
 application of <span class="v">apply$</span> to them or using them in <span class="tt"><a href="ACL2____LOOP_42.html">loop$</a></span>.  Thanks to 
 Alessandro Coglio for noting that some built-in <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span>-mode 
 functions do not have warrants, in particular, <span class="tt"><a href="ACL2____SUBLIS-VAR.html">sublis-var</a></span>.</p> 
 
 <p>Improved <span class="tt"><a href="ACL2____DEFWARRANT.html">defwarrant</a></span> to be a no-op for <span class="tt"><a href="ACL2____APPLY_42.html">apply$</a></span> 
 primitives.</p> 
 
 <p>ACL2 now points out when specious simplification takes place; see <a href="ACL2____SPECIOUS-SIMPLIFICATION.html">specious-simplification</a>.  Formerly this was the case only with <a href="ACL2____GAG-MODE.html">gag-mode</a> turned off; still, <span class="v">prove</span> output needs to be on for any such 
 message to be printed (see <a href="ACL2____SET-INHIBIT-OUTPUT-LST.html">set-inhibit-output-lst</a>).  Thanks to Mihir 
 Mehta for a query that led to this enhancement.</p> 
 
 <p>For <span class="tt"><a href="ACL2____FMT.html">fmt</a></span> directives <span class="v">~f</span> and <span class="v">~F</span>, ACL2 now uses the alist 
 component of the <span class="v">evisc-tuple</span> argument and the global <span class="tt"><a href="ACL2____EVISC-TABLE.html">evisc-table</a></span>. 
 Previously it used these only for directives <span class="v">~x</span>, <span class="v">~y</span>, <span class="v">~X</span>, and 
 <span class="v">~Y</span> (and deprecated directives <span class="v">~p</span> etc.; see <a href="ACL2____FMT.html">fmt</a>).  Thanks to 
 Eric Smith for a query leading to this enhancement.</p> 
 
 <p>Reporting has been improved when encountering possible invariance 
 violations for abstract <a href="ACL2____STOBJ.html">stobj</a>s.  Now, when that happens an 
 ``illegal-state'' is entered, as indicated by the prompt, and instructions are 
 printed for how to proceed at your own risk.  See <a href="ACL2____ILLEGAL-STATE.html">illegal-state</a>.</p> 
 
 <p>A <span class="tt"><a href="ACL2____TABLE.html">table</a></span>'s guard may now reference the ACL2 <a href="ACL2____STATE.html">state</a>.  Thus, it 
 may now be a term involving (at most) the variables <span class="v">WORLD</span>, <span class="v">ENS</span>, and 
 <span class="v">STATE</span>.</p> 
 
 <p>It is now always redundant to <span class="tt"><a href="ACL2____UNMEMOIZE.html">unmemoize</a></span> a function symbol that is 
 not currently <a href="ACL2____MEMOIZE.html">memoize</a>d.  See <a href="ACL2____REDUNDANT-EVENTS.html">redundant-events</a>.</p> 
 
 <p>The ``basic'' ruler-extenders (see <a href="ACL2____RULERS.html">rulers</a>) now include not only the 
 symbols <span class="tt"><a href="ACL2____RETURN-LAST.html">return-last</a></span> and <span class="tt"><a href="ACL2____MV-LIST.html">mv-list</a></span> but also the symbol <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span>.  As before, the termination analysis always continues through the true 
 and false branches of <span class="v">IF</span> calls; but now, by default, it also continues 
 through the first argument of an <span class="v">IF</span> call.  Thanks to Eric Smith for 
 suggesting this improvement and testing it on some proprietary books.</p> 
 
 <p>When supplying <span class="v">state</span> as an argument to <span class="tt"><a href="ACL2____DEFUN-NX.html">defun-nx</a></span> (or <span class="tt"><a href="ACL2____DEFUND-NX.html">defund-nx</a></span>), it is no longer necessary to declare <span class="v">state</span> as a <a href="ACL2____STOBJ.html">stobj</a> 
 or use <span class="tt"><a href="ACL2____SET-STATE-OK.html">set-state-ok</a></span>.  Thanks to Eric Smith for suggesting the 
 possibility of this change.</p> 
 
 <p>It had been the case that if <span class="tt"><a href="ACL2____DEFUN-NX.html">defun-nx</a></span> or <span class="tt"><a href="ACL2____DEFUND-NX.html">defund-nx</a></span> is used 
 for a recursive definition, and that form specifies a value for 
 <span class="v">:ruler-extenders</span> that omits <span class="tt"><a href="ACL2____RETURN-LAST.html">return-last</a></span> (see <a href="ACL2____RULERS.html">rulers</a> for 
 relevant background), then the definition generally fails to be admitted. 
 (This is due to the generated <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>'s use of <span class="tt"><a href="ACL2____PROG2_42.html">prog2$</a></span>, which is 
 a macro that abbreviates a call of <span class="tt"><a href="ACL2____RETURN-LAST.html">return-last</a></span>, which blocks the 
 termination analysis.)  That has been fixed, by ensuring that <span class="v">defun-nx</span> 
 and <span class="v">defund-nx</span> arrange that <span class="v">return-last</span> is always among the 
 ruler-extenders of the generated <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> form.  Thanks to Eric Smith for 
 noticing this issue and for a helpful discussion.</p> 
 
 <p>Improved handling of <a href="ACL2____LINEAR.html">linear</a> rules: cause an error with a helpful 
 message when a linear rule is no longer created during <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> or 
 the second pass of an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> form, and optimize by avoiding 
 certain calculations when the <span class="v">:trigger-terms</span> keyword is supplied.  Thanks 
 to Eric Smith for sending an example that illustrates the former issue, 
 essentially as included in a comment in <a href="ACL2____COMMUNITY-BOOK.html">community-book</a> 
 <span class="v">books/system/doc/acl2-doc.lisp</span>, form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-8-4 ...)</span>.</p> 
 
 <p>The <a href="ACL2____EVENT.html">event</a> macros <span class="tt"><a href="ACL2____VALUE-TRIPLE.html">value-triple</a></span> and <span class="tt"><a href="ACL2____ASSERT-EVENT.html">assert-event</a></span> have 
 been changed to be more flexible, in particular by providing an option to 
 allow the given form to return multiple values.  They are also more efficient, 
 as they no longer evaluate using <a href="ACL2____SAFE-MODE.html">safe-mode</a> by default. 
 (Technical note: As a consequence of implementation changes, one will rarely 
 if ever see ``hard'' errors (see <a href="ACL2____ER.html">er</a>) from these utilities.)  Thanks to 
 Eric Smith for requesting that a single utility encompass what is provided by 
 the built-in utility <span class="tt"><a href="ACL2____ASSERT-EVENT.html">assert-event</a></span> and the <a href="ACL2____COMMUNITY-BOOKS.html">community-books</a> 
 utilities <span class="tt"><a href="ACL2____ASSERT_12.html">assert!</a></span> and <span class="tt"><a href="ACL2____ASSERT_12-STOBJ.html">assert!-stobj</a></span>.  That single utility is 
 now <span class="tt"><a href="ACL2____ASSERT-EVENT.html">assert-event</a></span>, which in turn uses <span class="v">value-triple</span> to check the 
 supplied assertion.</p> 
 
 <p>The ACL2 <span class="tt"><a href="ACL2____BDD.html">bdd</a></span> package can now reason using the implicit rewrite rule 
 <span class="v">(<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____CONSP.html">consp</a> (<a href="COMMON-LISP____CONS.html">cons</a> x y)) t)</span>.  Thanks to Warren Hunt for requesting this 
 enhancement.</p> 
 
 <p>The <a href="ACL2____EVENT.html">event</a> macro <span class="tt"><a href="ACL2____WITH-OUTPUT.html">with-output</a></span> has been improved with several 
 changes and new features (and correspondingly, so has <span class="v">with-output!</span>).  In 
 addition to improvements to its documentation, these include the following; 
 see <span class="tt"><a href="ACL2____WITH-OUTPUT.html">with-output</a></span> for more information.</p> 
 
 <ul> 
 
 <li>The keyword argument <span class="v">:summary</span> has been replaced by keyword arguments 
 <span class="v">:summary-on</span> and <span class="v">:summary-off</span>, which control inhibited summary types 
 in analogy to how keyword arguments <span class="v">:on</span> and <span class="v">:off</span> control inhibited 
 output.</li> 
 
 <li>The keyword arguments <span class="v">:on</span> and <span class="v">:off</span> may now take value 
 <span class="v">nil</span>.</li> 
 
 <li>So-called ``on-off specs'', <span class="v">(:on-off sym1 ... symk)</span> are now allowed 
 for keyword arguments <span class="v">:on</span> and <span class="v">:off</span>, which let you turn on or off all 
 output types except the specified <span class="v">symi</span>.  On-off specs are similarly 
 supported for keyword arguments <span class="v">:summary-on</span> and <span class="v">:summary-off</span>.</li> 
 
 <li>There is a new keyword for <span class="tt"><a href="ACL2____WITH-OUTPUT.html">with-output</a></span>, <span class="v">:ctx</span>, which supports 
 a sort of global override of <a href="ACL2____EVENT.html">event</a> contexts.  See <a href="ACL2____WITH-OUTPUT.html">with-output</a> 
 and see <a href="ACL2____CTX.html">ctx</a>.</li> 
 
 <li>There is better error checking, in particular for duplicate keywords.</li> 
 
 </ul> 
 
 <p>The value returned by a successful event <span class="v">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a> ... ev_i
 ... ev_n)</span> is no longer always <span class="v">T</span>.  See <a href="ACL2____ENCAPSULATE.html">encapsulate</a>.</p> 
 
 <p>Two event macros produce much less output than before, as follows.  Thanks 
 to Alessandro Coglio for requesting these changes and to him and Eric Smith 
 for helpful discussions.</p> 
 
 <ul> 
 
 <li>
<span class="tt"><a href="ACL2____DEFSTUB.html">Defstub</a></span> is not only quieter but also does a bit more 
 error checking.</li> 
 
 <li>
<span class="tt"><a href="ACL2____DEFUN-SK.html">Defun-sk</a></span> has a new <span class="v">:verbose</span> argument for when output is 
 desired after all.</li> 
 
 </ul> 
 
 <p>For the <span class="v">:logic</span> and <span class="v">:exec</span> components of a <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span> 
 export, <a href="ACL2____SIGNATURE.html">signature</a>s no longer need to match.  Thanks to Sol Swords for 
 suggesting this improvement.  Now, the only such requirements are that the 
 lengths of the input signatures are equal and the lengths of the output 
 signatures are equal.</p> 
 
 <p>The utility <span class="tt"><a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a></span> now prints messages to 
 <span class="v">(<a href="ACL2____STANDARD-CO.html">standard-co</a> state)</span> rather than to <span class="v">*standard-co*</span>.  (Of course, these 
 are the same by default.)</p> 
 
 <p>In a proposed <a href="ACL2____LINEAR.html">linear</a> rule, hypotheses that are calls of <span class="tt"><a href="ACL2____BIND-FREE.html">bind-free</a></span> are now accounted for when considering whether each of the 
 <span class="v">:trigger-terms</span> has sufficient free variables (see <a href="ACL2____LINEAR.html">linear</a>, in 
 particular condition (b) there, and see <a href="ACL2____BIND-FREE.html">bind-free</a>).  Thanks to Dave 
 Greve for reporting this issue.  The example below has the indicated failure 
 in ACL2  Version 8.3 but is now accepted.</p> 
 
 <pre class="code">(<a href="ACL2____DEFSTUB.html">defstub</a> f (x) t)
(<a href="ACL2____DEFSTUB.html">defstub</a> g (x) t)

; The following two events are the same except that the first supplies
; :trigger-terms while the second does not (instead computing trigger terms
; heuristically).  These should either both fail or both succeed; now they
; both succeed.

; FAILED, but now SUCCEEDS after the fix since then variables y and z are
; considered to occur (free) in the hypotheses when determining
; whether the hypotheses and trigger term include enough variables to cover
; those in the conclusion.
(<a href="ACL2____DEFAXIOM.html">defaxiom</a> ax1
  (<a href="ACL2____IMPLIES.html">implies</a> (<a href="ACL2____BIND-FREE.html">bind-free</a> '((z . z))) ; or, (<a href="ACL2____BIND-FREE.html">bind-free</a> '((z . z)) (y z))
           (<a href="COMMON-LISP_____C3.html">&lt;</a> (f x) (<a href="ACL2____G.html">g</a> y)))
  :rule-classes ((:linear :trigger-terms ((f x)))))

; SUCCEEDED even before the fix: the bind-free hypothesis fools ACL2
; into believing that otherwise-free variables may be bound by the
; bind-free alist.
(<a href="ACL2____DEFAXIOM.html">defaxiom</a> ax2
  (<a href="ACL2____IMPLIES.html">implies</a> (<a href="ACL2____BIND-FREE.html">bind-free</a> '((z . z))) ; or, (<a href="ACL2____BIND-FREE.html">bind-free</a> '((z . z)) (y z))
           (<a href="COMMON-LISP_____C3.html">&lt;</a> (f x) (<a href="ACL2____G.html">g</a> y)))
  :rule-classes :linear)</pre> 
 
 <p>The report for <span class="v">:</span><span class="tt"><a href="ACL2____BRR.html">brr</a></span> when a hypothesis fails to be relieved 
 shows repeated attempts to bind free variables not only as before  that 
 is, when a hypothesis has free variables  but also when the hypothesis 
 is a call of <span class="tt"><a href="ACL2____BIND-FREE.html">bind-free</a></span> that returns a list of substitutions.  Thanks 
 to Dave Greve for bringing up this issue.</p> 
 
 <p>It is now an error for a <span class="v">:</span><span class="tt"><a href="ACL2____LINEAR.html">linear</a></span> rule's conclusion to generate 
 a polynomial whose terms are all determined to be non-numeric.  Thanks to Eric 
 Smith for suggesting such a check.  Here is an example of such a rule that was 
 formerly admitted but useless but now causes an error.</p> 
 
 <pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> bad-rule
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP_____C3.html">&lt;</a> (foo x) x) nil)
        :rule-classes :linear)</pre> 
 
 <p>In executable code, calls of <span class="tt"><a href="ACL2____HIDE.html">hide</a></span> in <span class="tt"><a href="COMMON-LISP____LET.html">let</a></span>-bindings or <span class="tt"><a href="COMMON-LISP____LAMBDA.html">lambda</a></span> bodies are no longer considered to represent <span class="tt"><a href="COMMON-LISP____IGNORE.html">ignore</a></span> 
 declarations.  We thank Alessandro Coglio for raising and discussing this 
 issue.  Below is a log, based on that discussion, that was produced using ACL2 
 before this change.  After this change, the second and third calls of 
 <span class="v">:</span><span class="tt"><a href="ACL2____TRANS.html">trans</a></span> will now result in errors, as noted in comments below. 
 Previously ACL2 treated the <span class="v">hide</span> calls in those two input expressions as 
 though they represented <span class="v">ignore</span> declarations, in the sense of translation 
 of the first form shown below.  That is still the case when translating for 
 theorems rather than executable code; for details see the ``Essay on Using 
 Hide for Ignored Let-bindings'' in the ACL2 source code.</p> 
 
 <pre class="code">ACL2 !&gt;:trans (<a href="COMMON-LISP____LET.html">let</a> ((x 0)) (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORE.html">ignore</a> x)) 1)

((<a href="COMMON-LISP____LAMBDA.html">LAMBDA</a> (X) '1) (<a href="ACL2____HIDE.html">HIDE</a> '0))

=&gt; *

ACL2 !&gt;:trans ((<a href="COMMON-LISP____LAMBDA.html">LAMBDA</a> (X) '1) (<a href="ACL2____HIDE.html">HIDE</a> '0)) ; error after this change

((<a href="COMMON-LISP____LAMBDA.html">LAMBDA</a> (X) '1) (<a href="ACL2____HIDE.html">HIDE</a> '0))

=&gt; *

ACL2 !&gt;(<a href="ACL2____UNTRANSLATE.html">untranslate</a> '((<a href="COMMON-LISP____LAMBDA.html">LAMBDA</a> (X) '1) (<a href="ACL2____HIDE.html">HIDE</a> '0)) nil (<a href="ACL2____W.html">w</a> state))
(<a href="COMMON-LISP____LET.html">LET</a> ((X (<a href="ACL2____HIDE.html">HIDE</a> 0))) 1)
ACL2 !&gt;:trans (<a href="COMMON-LISP____LET.html">LET</a> ((X (<a href="ACL2____HIDE.html">HIDE</a> 0))) 1) ; error after this change

((<a href="COMMON-LISP____LAMBDA.html">LAMBDA</a> (X) '1) (<a href="ACL2____HIDE.html">HIDE</a> '0))

=&gt; *

ACL2 !&gt;</pre> 
 
 <p>The <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span> keyword, <span class="v">:CONCRETE</span>, has been changed to 
 <span class="v">:FOUNDATION</span>.  Although the use of <span class="v">:CONCRETE</span> is still supported in 
 this release (Version 8.4), it generates a warning that this usage is 
 deprecated and will likely not be supported after this release.  Also, 
 documentation and comments now typically speak of ``foundational stobj'' for 
 the underlying stobj of the abstract stobj (which can be supplied explicitly 
 by the <span class="v">:FOUNDATION</span> keyword) rather than ``corresponding concrete stobj''; 
 this reflects the fact that the foundational stobj may itself be an abstract 
 stobj (which is not new for this release).</p> 
 
 <p>Strengthened error-checking for <span class="tt"><a href="ACL2____STOBJ-LET.html">stobj-let</a></span> to insist that if an 
 updater is supplied explicitly in a binding, then it must be a valid updater. 
 This check was formerly made only if the variable bound in that binding is 
 among the producer variables (see <a href="ACL2____NESTED-STOBJS.html">nested-stobjs</a>).  For example, the 
 following now causes an error, but it was formerly accepted in spite of the 
 fact that <span class="v">xyz</span> is not the updater for the accessor, <span class="v">top1-fld</span>; in fact 
 <span class="v">xyz</span> is not even defined!</p> 
 
 <pre class="code">(<a href="ACL2____DEFSTOBJ.html">defstobj</a> sub1 sub1-fld1)
(<a href="ACL2____DEFSTOBJ.html">defstobj</a> top1 (top1-fld :type sub1))
(<a href="COMMON-LISP____DEFUN.html">defun</a> f1 (top1)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs top1))
  (<a href="ACL2____STOBJ-LET.html">stobj-let</a>
   ((sub1 (top1-fld top1) xyz)) ; bad updater!
   (val)
   (sub1-fld1 sub1)
   val))</pre> 
 
 <p>The function symbol <span class="v">symbol&lt;</span> replaces the function symbol 
 <span class="v">symbol-&lt;</span>.  More generally, for every built-in function symbol and theorem 
 name containing <span class="v">"SYMBOL-&lt;"</span>, that string in its <span class="tt"><a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a></span> is 
 replaced by <span class="v">"SYMBOL&lt;"</span>.  The function <span class="v">logical-defun</span> is similarly 
 replaced by <span class="v">get-defun-event</span>.  Thanks to Alessandro Coglio for suggesting 
 these changes.  Note that the old function names still work in ACL2 Version 
 8.4, as they are macro-aliases for the corresponding new function names (see 
 <a href="ACL2____ADD-MACRO-ALIAS.html">add-macro-alias</a>); however, they are deprecated and will probably not be 
 supported in later ACL2 versions.  (A deprecation warning is printed each time 
 one of those macros is expanded.)</p> 
 
 <p>The keyword <span class="v">:witness-dcls</span> of <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> is deprecated and will 
 probably be unsupported in future ACL2 releases.  Use <span class="tt"><a href="COMMON-LISP____DECLARE.html">declare</a></span> forms 
 instead; see <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span>.</p> 
 
 <h3>New Features</h3> 
 
 <p>It is now possible to assign <span class="tt"><a href="ACL2____BADGE.html">badge</a></span>s to <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode 
 functions, which allows them to be used by <span class="tt"><a href="ACL2____APPLY_42.html">apply$</a></span>, <span class="tt"><a href="ACL2____LAMBDA_42.html">lambda$</a></span> and 
 <span class="tt"><a href="ACL2____LOOP_42.html">loop$</a></span> during top-level evaluation.  See <span class="tt"><a href="ACL2____DEFBADGE.html">defbadge</a></span>, which 
 assigns badges but not <a href="ACL2____WARRANT.html">warrant</a>s and which can handle both <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> and <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode functions.</p> 
 
 <p>A new option for <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span>, provided with keyword option 
 <span class="v">:useless-runes</span> or environment variable <span class="v">ACL2_USELESS_RUNES</span>, makes it 
 possible to speed up repeated certification of a book, sometimes 
 substantially.  See <a href="ACL2____USELESS-RUNES.html">useless-runes</a>.  Thanks to Sol Swords for reporting 
 a bug (in ACL2 source function <span class="v">read-file-iterate-safe</span>) and supplying a 
 fix, which we have incorporated.  Also thanks to Eric Smith for requesting 
 that each tuple in a generated ``useless-runes'' file be printed on a single 
 line starting after a space, thus supporting grep-like tools.  Finally, thanks 
 to Alessandro Coglio and Eric Smith for discussions leading to creation of 
 <span class="v">.sys/</span> subdirectories to hold useless-runes files.</p> 
 
 <p>A new keyword for <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span>, <span class="v">:non-executable</span>, can be given 
 value <span class="v">t</span> to skip memory allocation for the new <a href="ACL2____STOBJ.html">stobj</a>, by avoiding 
 creation of a ``live'' (mutable) stobj.  See <a href="ACL2____DEFSTOBJ.html">defstobj</a>.  Thanks to 
 Warren Hunt for encouraging development of this feature.</p> 
 
 <p>The rewriter now rewrites the bodies of certain quoted <a href="COMMON-LISP____LAMBDA.html">lambda</a> 
 objects.  However, some restrictions apply.  See <a href="ACL2____REWRITE-LAMBDA-OBJECT.html">rewrite-lambda-object</a>. 
 In addition some new lemmas and a new metafunction have been added to the book 
 <span class="v">projects/apply/top</span>, which users are still encouraged to include in 
 sessions dealing with <span class="tt"><a href="ACL2____APPLY_42.html">apply$</a></span>.  The new metafunction is named 
 <span class="v">relink-fancy-scion</span> and can also cause <span class="v">lambda</span> objects to be 
 transformed.  See the discussion of that metafunction in <a href="ACL2____REWRITE-LAMBDA-OBJECT.html">rewrite-lambda-object</a>.</p> 
 
 <p>Added <span class="tt"><a href="ACL2____TOGGLE-INHIBIT-WARNING.html">toggle-inhibit-warning</a></span> and <span class="tt"><a href="ACL2____TOGGLE-INHIBIT-WARNING_12.html">toggle-inhibit-warning!</a></span> to 
 add or delete a warning string from the <span class="v">inhibit-warnings-table</span>, rather 
 than setting that entire table as is done by <span class="tt"><a href="ACL2____SET-INHIBIT-WARNINGS.html">set-inhibit-warnings</a></span>.</p> 
 
 <p>It is now possible to instruct the prover to respect requests to <a href="ACL2____DISABLE.html">disable</a> the <a href="ACL2____DEFINITION.html">definition</a> of the primitive, <span class="tt"><a href="ACL2____MV-NTH.html">mv-nth</a></span>, rather than 
 continuing to expand that definition.  See <a href="ACL2____THEORIES-AND-PRIMITIVES.html">theories-and-primitives</a>, in 
 particular the note for advanced users at the end of that topic.  Thanks to 
 Alessandro Coglio for requesting this feature.</p> 
 
 <p>A new utility, <span class="tt"><a href="ACL2____MEMOIZE-PARTIAL.html">memoize-partial</a></span>, allows memoization for functions 
 that were made admitted by adding a formal parameter that decreases on each 
 recursive call (sometimes called a ``limit'' or a ``clock'').  Normally that 
 extra parameter can severely impede the utility of memoization; however, the 
 function actually executed does not have that extra parameter.  This allows 
 for more memoization hits.  Thanks to Mertcan Temel for an inquiry leading to 
 this enhancement, and for helpful discussions.</p> 
 
 <p>A new rule-class (see <a href="ACL2____RULE-CLASSES.html">rule-classes</a>) has been added, named 
 <span class="v">:</span><span class="tt"><a href="ACL2____REWRITE-QUOTED-CONSTANT.html">rewrite-quoted-constant</a></span>.  Rules in this class can cause the 
 rewriter to replace one quoted constant by an equivalent one under a given 
 <a href="ACL2____EQUIVALENCE.html">equivalence</a> relation.  See <a href="ACL2____REWRITE-QUOTED-CONSTANT.html">rewrite-quoted-constant</a>.</p> 
 
 <p>The <span class="tt"><a href="ACL2____LOOP_42.html">loop$</a></span> parser produces more informative error messages on 
 ill-formed <span class="v">loop$</span> statements.</p> 
 
 <p>A new <span class="tt"><a href="ACL2____MEMOIZE.html">memoize</a></span> keyword, <span class="v">:invoke</span>, supports the replacement of 
 calls of one function by another.  In that sense it is similar to <span class="tt"><a href="ACL2____DEFATTACH.html">defattach</a></span>; the difference is that with <span class="v">(<a href="ACL2____MEMOIZE.html">memoize</a> f :invoke g)</span>, it is 
 necessary first to prove the equality of <span class="v">f</span> and <span class="v">g</span>; therefore, ACL2 
 will compute calls of <span class="v">f</span> by calling <span class="v">g</span> even during proofs.  In 
 particular, the tool <a href="ACL2____ADD-IO-PAIRS.html">add-io-pairs</a> is built on top of this capability; 
 it allows evaluating a function call by fast lookup of a verified input-output 
 pair.  Thanks to Eric McCarthy, Alessandro Coglio, and Eric Smith for 
 requesting the latter capability and providing helpful feedback.</p> 
 
 <p>A new <a href="ACL2____XARGS.html">xargs</a> keyword for <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>, <span class="v">:type-prescription</span>, can 
 be supplied as a formula in the shape of a <a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a> rule.  It 
 is checked to be implied by the built-in type-prescription rule computed for 
 the newly-defined function.  Thus, it can serve as documentation for the 
 expected type returned by the function; if the implication is not equivalence, 
 a warning is printed.  Thanks to Alessandro Coglio and Eric Smith for the 
 suggestion.</p> 
 
 <p><a href="ACL2____TABLE.html">Table</a>s may now supply custom error messages for table <span class="v">:guard</span> 
 failures.  This is accomplished by supplying a table <span class="v">:guard</span> that returns 
 two values instead of one.  For a return <span class="v">(<a href="ACL2____MV.html">mv</a> okp msg)</span>, if <span class="v">okp</span> is 
 non-<span class="v">nil</span> then the table guard is considered to be true, that is, it has 
 the same meaning as a non-<span class="v">nil</span> single-value return.  Also, <span class="v">(<a href="ACL2____MV.html">mv</a> nil
 nil)</span> has the same meaning and effect as a <span class="v">nil</span> single-value return: the 
 table guard fails, and a generic error message is printed about the illegal 
 key/value pair.  The new case is a return of <span class="v">(<a href="ACL2____MV.html">mv</a> nil msg)</span>, where <span class="v">msg</span> 
 should be a <span class="tt"><a href="ACL2____MSGP.html">msgp</a></span>  a string or a cons suitable for printing with 
 the <span class="tt"><a href="ACL2____FMT.html">fmt</a></span> directive, <span class="v">~@</span>.  In that case, <span class="v">msg</span> is printed (using 
 the <span class="tt"><a href="ACL2____FMT.html">fmt</a></span> directive, <span class="v">~@</span>) instead of a generic error message.  This 
 new feature is now used in some built-in tables.  See <a href="ACL2____TABLE.html">table</a>.</p> 
 
 <p>The <a href="ACL2____PROOF-BUILDER.html">proof-builder</a> command <span class="tt"><a href="ACL2____TYPE-ALIST.html">type-alist</a></span> has a new optional 
 argument that supports printing the type-alist in an alist format.  Thanks to 
 Mihir Mehta for requesting this feature.</p> 
 
 <p>A new summary type, <span class="v">REDUNDANT</span>, controls whether a message is printed 
 indicating a redundant event (see <a href="ACL2____REDUNDANT-EVENTS.html">redundant-events</a>), which however will 
 still always take place if <span class="v">EVENT</span> output is not inhibited (see <a href="ACL2____SET-INHIBIT-OUTPUT-LST.html">set-inhibit-output-lst</a>).  See <a href="ACL2____SUMMARY.html">summary</a>.</p> 
 
 <p>A <span class="v">defabsstobj</span> event may now specify child <a href="ACL2____STOBJ.html">stobj</a> fields, for use 
 by <span class="tt"><a href="ACL2____STOBJ-LET.html">stobj-let</a></span>.  See <a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a>, and see <a href="ACL2____COMMUNITY-BOOKS.html">community-books</a> 
 file <span class="v">books/system/tests/abstract-stobj-nesting/README</span> for a brief guide 
 to the examples in that directory.  Thanks to Sol Swords for requesting this 
 feature and helping to design it, as well as for his helpful discussions, 
 feedback, and test files.</p> 
 
 <p>The <span class="v">:congruent-to</span> keyword is now supported for <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span>.</p> 
 
 <p><span class="tt"><a href="ACL2____STOBJ-LET.html">Stobj-let</a></span> now allows aliases in the bindings in some cases where 
 this is safe because updating is not involved.  Thanks to Sol Swords for 
 suggesting such a change.</p> 
 
 <p>Added a function <span class="tt"><a href="ACL2____CTXP.html">ctxp</a></span> to recognize valid contexts, which are used 
 for printing error message (see <a href="ACL2____CTX.html">ctx</a>).  Thanks to Eric Smith for 
 requesting this addition and to Alessandro Coglio for suggesting that it be 
 disabled, for efficiency.</p> 
 
 <p>The utilities <span class="tt"><a href="ACL2____BRR.html">brr</a></span> and <span class="tt"><a href="ACL2____MONITOR.html">monitor</a></span> now each take an optional 
 argument that avoids output.  A new utility, <span class="tt"><a href="ACL2____MONITOR_12.html">monitor!</a></span>, is a 
 combination of these two with their new optional arguments of <span class="v">t</span>, thus 
 also avoiding output.  Thanks to Eric Smith for requesting a version of 
 <span class="v">monitor</span> that turns on <span class="v">brr</span>.</p> 
 
 <p>A new utility, <span class="tt"><a href="ACL2____GET-GUARD-CHECKING.html">get-guard-checking</a></span>, returns the <a href="ACL2____GUARD.html">guard</a>-checking value most recently installed, either <span class="v">t</span> (when the ACL2 
 executable was built) or presumably by <span class="tt"><a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a></span>.  Thanks to 
 Eric McCarthy for suggesting this utility.</p> 
 
 <p>The function <span class="tt"><a href="ACL2____ASET1-TRUSTED.html">aset1-trusted</a></span> may be used in place of <span class="tt"><a href="ACL2____ASET1.html">aset1</a></span> to 
 avoid <a href="ACL2____INVARIANT-RISK.html">invariant-risk</a>, but is therefore <a href="ACL2____UNTOUCHABLE.html">untouchable</a>.</p> 
 
 <p>Added a new utility, <span class="tt"><a href="ACL2____PRINT-OBJECT_42_B2.html">print-object$+</a></span>, that is like <span class="tt"><a href="ACL2____PRINT-OBJECT_42.html">print-object$</a></span> but instead of taking <span class="v">STATE</span>, <span class="tt"><a href="ACL2____PRINT-OBJECT_42_B2.html">print-object$+</a></span> is a 
 macro that takes keyword arguments to customize the output.  See <a href="ACL2____PRINT-OBJECT_42_B2.html">print-object$+</a>.  Thanks to Eric Smith for requesting such additional print 
 control.</p> 
 
 <h3>Heuristic and Efficiency Improvements</h3> 
 
 <p>We changed the lightweight ``preprocess'' simplifier for ``<a href="ACL2____SIMPLE.html">simple</a>'' 
 rules in the prover's <a href="ACL2____WATERFALL.html">waterfall</a>, in the case that the term is the 
 application of a defined function symbol to constant (quoted) arguments.  As 
 before, if the <a href="ACL2____EXECUTABLE-COUNTERPART.html">executable-counterpart</a> rule for that function symbol is 
 <a href="ACL2____ENABLE.html">enable</a>d, then the call is evaluated in Lisp; and if that evaluation 
 fails (typically because a constrained function is called), then an attempt is 
 made to rewrite the term by applying a <a href="ACL2____SIMPLE.html">simple</a> rule.  The change is for 
 how failure is handled, that is, in the case that evaluation fails and the 
 term is not rewritten.  Formerly, the term was surrounded by a call of <span class="tt"><a href="ACL2____HIDE.html">hide</a></span>.  Now, that is only done by the main rewriter, not by the ``preprocess'' 
 simplifier.  Thanks to Eric Smith for a communication on the acl2-help list, 
 on a thread started by Mark Greenstreet, that led us towards making this 
 change.  Mark's failed proof now succeeds after this change, but here is a 
 simpler example.  Formerly, the commented-out <span class="v">:do-not</span> hint was required 
 for the proof of the <span class="tt"><a href="ACL2____THM.html">thm</a></span> call below to succeed, because the definition 
 of <span class="v">g</span> is not simple and hence the ``preprocess'' simplifier replaced <span class="v">(<a href="ACL2____G.html">g</a>
 3)</span> by a term <span class="v">(<a href="ACL2____HIDE.html">hide</a> (<a href="ACL2____COMMENT.html">comment</a> ...) (<a href="ACL2____G.html">g</a> 3))</span> before the rewriter could apply 
 the definition of <span class="v">g</span>.</p> 
 
 <pre class="code">(<a href="ACL2____DEFSTUB.html">defstub</a> f (x) t)
(<a href="COMMON-LISP____DEFUN.html">defun</a> g (x) (<a href="COMMON-LISP____CONS.html">cons</a> x (f x)))
(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____CAR.html">car</a> (<a href="ACL2____G.html">g</a> 3)) 3)
     ;; :hints (("Goal" :do-not '(preprocess)))
     )</pre> 
 
 <p>The ACL2 rewriter has a ``being-openedp'' heuristic that prevents loops, by 
 saving a stack based on what is currently being rewritten.  This can prevent 
 the use of a <a href="ACL2____DEFINITION.html">definition</a> or <a href="ACL2____REWRITE.html">rewrite</a> rule.  Now the heuristic is 
 turned off when the term's function symbol has a non-recursive definition and 
 simplification has just settled down (see <a href="ACL2____HINTS-AND-THE-WATERFALL.html">hints-and-the-waterfall</a>).  To 
 restore the old behavior, i.e., to use the heuristic in all cases  thus 
 providing backward compatibility when a proof fails  evaluate the form: 
 <span class="v">(<a href="ACL2____DEFATTACH-SYSTEM.html">defattach-system</a> being-openedp-limited-for-nonrec
 constant-nil-function-arity-0)</span>.</p> 
 
 <p>When a command executed in a logical <a href="ACL2____WORLD.html">world</a>, <span class="v">w</span>, is interrupted, 
 the world is reverted to <span class="v">w</span>.  That reversion process could be very slow if 
 the interrupt was taken during the installation of the new world, as indicated 
 by the messages:</p> 
 
 <pre class="code">Flushing current installed world.
Reversing the new world.
Installing the new world.</pre> 
 
 <p>That process has been sped up significantly.  Moreover, the new process 
 avoids a bug reported by Eric Smith, who we thank for sending an example of 
 how the process was interacting badly with <span class="tt"><a href="ACL2____RESET-PREHISTORY.html">reset-prehistory</a></span>.  Code 
 implementing that interaction was introduced in Version  4.0 to speed up the 
 process; that code has been eliminated, as it is no longer necessary.</p> 
 
 <p>ACL2's <a href="ACL2____TYPE-SET.html">type-set</a> reasoning has been slightly strengthened to 
 comprehend Boolean combinations of strong <a href="ACL2____COMPOUND-RECOGNIZER.html">compound-recognizer</a> calls on 
 a single variable when building a context (a so-called <a href="ACL2____TYPE-ALIST.html">type-alist</a>). 
 (By a ``strong compound-recognizer call'' we mean a unary function that 
 recognizes a union of primitive ACL2 types and has, either explicitly or 
 implicity, a corresponding <a href="ACL2____COMPOUND-RECOGNIZER.html">compound-recognizer</a> rule; examples include 
 <span class="tt"><a href="COMMON-LISP____STRINGP.html">stringp</a></span>, <span class="tt"><a href="COMMON-LISP____INTEGERP.html">integerp</a></span>, and <span class="tt"><a href="ACL2____TRUE-LISTP.html">true-listp</a></span>.)  In particular, 
 this change can strengthen the result of <a href="ACL2____FORWARD-CHAINING.html">forward-chaining</a>.  Thanks to 
 Eric Smith, who raised this issue by providing an example that we include in a 
 comment, inside the form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-8-4 ...)</span> in <a href="ACL2____COMMUNITY-BOOK.html">community-book</a> 
 <span class="v">books/system/doc/acl2-doc.lisp</span>.</p> 
 
 <p><a href="ACL2____TYPE-SET.html">Type-set</a> reasoning also has been improved for inequalities to take 
 more advantage of the fact that the number 1 constitutes a singleton type. 
 For example, after evaluating <span class="v">(<a href="ACL2____DEFSTUB.html">defstub</a> foo (x) t)</span> ACL2 is now able to 
 prove <span class="v">(<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP_____C3.html">&lt;</a> 2 x) (<a href="COMMON-LISP____EQUAL.html">equal</a> (foo (<a href="ACL2____BITP.html">bitp</a> x)) (foo nil)))</span> where previously 
 it could not.  In fact <span class="v">2</span> can now be replaced by any rational number that 
 is at least 1.</p> 
 
 <p>The function <span class="tt"><a href="ACL2____COMPRESS1.html">compress1</a></span> has been made more efficient in the 
 following ways.</p> 
 
 <ul> 
 
 <li>
<span class="v">Compress1</span> is now faster when the <span class="v">:ORDER</span> specified by the given 
 <a href="COMMON-LISP____ARRAY.html">array</a>'s <a href="ACL2____HEADER.html">header</a> is <span class="v">&lt;</span> or <span class="v">&gt;</span> and the alist is properly 
 ordered: header first, then ascending (for <span class="v">:ORDER &lt;</span>) or descending (for 
 <span class="v">:ORDER &gt;</span>) order of indices, with no value in the alist equal to the 
 <span class="v">:DEFAULT</span> specified by the header.  In particular, this can cut the time 
 to run <span class="v">compress1</span> on an alist containing only the header by more than 
 half, which addresses a request made by Eric Smith (whom we thank for bringing 
 this efficiency issue to our attention).</li> 
 
 <li>For the change noted just above, Eric also noticed that when the <a href="ACL2____DEFAULT.html">default</a> is <span class="v">nil</span> then there was no speedup.  This led us to fix an 
 existing bug (technical description: for an array with default <span class="v">nil</span>, the 
 alist was never considered to be in order).</li> 
 
 <li>Functions <span class="tt"><a href="ACL2____COMPRESS1.html">compress1</a></span> and <span class="tt"><a href="ACL2____COMPRESS2.html">compress2</a></span> no longer require the 
 new and old dimensions to agree in order that the underlying raw lisp array is 
 reused.  Now it suffices for the new dimension (for <span class="v">compress1</span>; each 
 dimension for <span class="v">compress2</span>) to be at least as great as the old. 
 (You can still avoid reuse of the raw Lisp array by using <span class="tt"><a href="ACL2____FLUSH-COMPRESS.html">flush-compress</a></span>.)  Thanks to Eric Smith for suggesting this change.</li> 
 
 </ul> 
 
 <p>We found that <span class="tt"><a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a></span> was measurably slowing down 
 ACL2 even when it is off.  We modified its implementation and measured a time 
 reduction of 3.7% for a proof-intensive book.  The modification includes a 
 documented efficiency tweak to <span class="tt"><a href="ACL2____WORMHOLE-EVAL.html">wormhole-eval</a></span>.</p> 
 
 <p>The <a href="ACL2____LINEAR-ARITHMETIC.html">linear-arithmetic</a> heuristics have long taken advantage of 
 negated equality hypotheses.  These heuristics have been strengthened to take 
 further such advantage.  Thanks to Warren Hunt for sending an example proof 
 attempt that failed before this change but now succeeds, and for his 
 encouragement to pursue an improvement to linear arithmetic that can benefit 
 such proof attempts.</p> 
 
 <p>The removal of <a href="ACL2____GUARD-HOLDERS.html">guard-holders</a> has been augmented to include removal 
 of certain ``trivial'' lambda applications.  See <a href="ACL2____GUARD-HOLDERS.html">guard-holders</a>, in 
 particular for how to restore the legacy behavior.  Thanks to Alessandro 
 Coglio for an example and Eric Smith for a subsequent suggestion that led to 
 this enhancement.</p> 
 
 <h3>Bug Fixes</h3> 
 
 <p>A soundness bug, present since <span class="tt"><a href="ACL2____LOOP_42.html">loop$</a></span> was introduced, was fixed. The 
 bug was manifested when the keyword <span class="v">:guard</span> was used as the <span class="v">loop$</span> 
 body, as in <span class="v">(<a href="ACL2____LOOP_42.html">loop$</a> for v in lst collect :guard)</span>.  (Note: It's not clear 
 that this bug could be used to prove <span class="v">nil</span>.)</p> 
 
 <p>A soundness bug was fixed by changing <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span> to avoid using 
 <span class="tt"><a href="ACL2____MBE.html">mbe</a></span> in the definitions generated for the logic.  The problem was that 
 the <span class="v">:logic</span> and <span class="v">:exec</span> forms are not actually equal (they correspond, 
 in the sense of the correspondence predicate), and this can be exploited by 
 using a <span class="v">:</span><span class="tt"><a href="ACL2____GUARD-THEOREM.html">guard-theorem</a></span> <a href="ACL2____LEMMA-INSTANCE.html">lemma-instance</a>.  For an example 
 proof of <span class="v">nil</span> in Version 8.3, see a comment about a <span class="v">defabsstobj</span> bug 
 in the form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-8-4 ...)</span> in file 
 <span class="v">books/system/doc/acl2-doc.lisp</span>.</p> 
 
 <p>A soundness bug was fixed in the functions that print to strings, such as 
 <span class="v">fmt-to-string</span>; see <a href="ACL2____PRINTING-TO-STRINGS.html">printing-to-strings</a>.  The bug was a dependence 
 of the result on the ACL2 <a href="ACL2____STATE.html">state</a>, even though <span class="v">state</span> is not an 
 argument to these functions.  More specifically, the dependence was on the 
 <span class="tt"><a href="ACL2____CURRENT-PACKAGE.html">current-package</a></span> and the global <span class="tt"><a href="ACL2____EVISC-TABLE.html">evisc-table</a></span>.  For examples see 
 <a href="ACL2____COMMUNITY-BOOKS.html">community-books</a> <span class="v">books/system/tests/fmt-to-string.lisp</span> and 
 <span class="v">books/system/tests/fmt-to-string-pkg.lisp</span>.  Note: We also strengthened 
 the <a href="ACL2____GUARD.html">guard</a>s on these functions to require that the keys of the 
 <span class="v">fmt-control-alist</span> alist argument are all appropriate; in particular, the 
 symbol <span class="v">current-package</span> in the <span class="v">"ACL2"</span> package is a suitable key, 
 but for example the keyword <span class="v">:current-package</span> is not.</p> 
 
 <p>It was possible to prove <span class="v">nil</span> by counterfeiting <span class="v">record-expansion</span> 
 calls, which are normally only created by the implementation in support of 
 <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> calls.  This soundness bug has been fixed.  (The bug was 
 perhaps impossible to hit in ordinary usage, where <span class="v">record-expansion</span> is 
 not used explicitly.)  A proof of <span class="v">nil</span> before this fix may be found in a 
 comment in ACL2 source function, <span class="v">corresponding-encaps</span>.</p> 
 
 <p>The mechanism for tracking <a href="ACL2____WARRANT.html">warrant</a>s needed during a proof had a bug, 
 which might be a soundness bug if one uses <span class="tt"><a href="ACL2____APPLY_42.html">apply$</a></span> or <span class="tt"><a href="ACL2____LOOP_42.html">loop$</a></span>. 
 That bug has been fixed.</p> 
 
 <p>Fixed a bug that was preventing use of the RDTSC hardware instruction in 
 SBCL on most x86-based platforms, and possibly erroneously attempting to make 
 use of that instruction on some other platforms.  Thanks to Keshav Kini for a 
 query that led to this fix.  Also restricted RDTSC to x86-based platforms, 
 thanks to a suggestion by Curtis Dunham, to enable Arm builds of ACL2.</p> 
 
 <p>The use of <span class="tt"><a href="ACL2____APPLY_42.html">apply$</a></span> on calls of <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span> no longer cause raw Lisp 
 errors.  (The same is true for calls of the subroutine <span class="v">apply$-prim</span> of 
 <span class="v">apply$</span>.)  For example, these calls now evaluate without error: <span class="v">(<a href="ACL2____APPLY_42.html">apply$</a>
 'if '(nil nil nil))</span> and <span class="v">(apply$-prim 'if '(nil nil nil))</span>.</p> 
 
 <p>We made the following fixes to the <span class="tt"><a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a></span> 
 utility.</p> 
 
 <ul> 
 
 <li>Applications of <a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a> rules that were erroneously 
 labeled as ``useless'' are now appropriatedly labeled as ``useful''.</li> 
 
 <li>The documentation for <span class="tt"><a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a></span> now correctly states 
 that the form <span class="v">(<a href="ACL2____ACCUMULATED-PERSISTENCE-OOPS.html">accumulated-persistence-oops</a>)</span> undoes the clearing effect 
 of <span class="v">(<a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a> t)</span>, rather than of 
 <span class="v">(<a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a> nil)</span>.</li> 
 
 <li>Uses of <a href="ACL2____DEFINITION.html">definition</a> rules because of <span class="v">:</span><span class="tt"><a href="ACL2____EXPAND.html">expand</a></span> hints, 
 either explicitly given by the user or generated by ACL2's heuristics for doing 
 induction, were not being recorded by <span class="tt"><a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a></span>.  They 
 are now.</li> 
 
 </ul> 
 
 <p>Fixed a bug that was causing books to be included as ``uncertified'' after 
 their certification stored checksums (see <a href="ACL2____BOOK-HASH.html">book-hash</a>).  Thanks to Keshav 
 Kini for reporting this bug.</p> 
 
 <p>ACL2 could occasionally simplify subterms of a call of <span class="tt"><a href="ACL2____HIDE.html">hide</a></span> even 
 without any applicable rules or <span class="v">:expand</span> <a href="ACL2____HINTS.html">hints</a>.  (Technical note: 
 the problematic source function was <span class="v">normalize</span>.)  We considered this to be 
 a bug, so it has been fixed.</p> 
 
 <p>The notion of redundancy for <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span> <a href="ACL2____EVENTS.html">events</a> was too weak, 
 as evidenced by the following example.  Consider the following book, named 
 <span class="v">"bug.lisp"</span>.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "ACL2")
(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st fld)
(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (st) (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs st)) (fld st))</pre> 
 
 <p>After certifying this book, a raw Lisp error could occur after evaluating 
 the following forms, because the compiled definition of <span class="v">foo</span> from 
 including the book referenced a function, <span class="v">fld</span>, which is now a macro.</p> 
 
 <pre class="code">(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st fld :inline t)
(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "bug") ; The defstobj event in this book is redundant here.
(foo st)</pre> 
 
 <p>The bug has been fixed by requiring a redundant <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span> event to 
 be syntactically identical to the pre-existing corresponding <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span> 
 event.</p> 
 
 <p>A raw Lisp error would occur when the value of an <span class="v">:</span><span class="tt"><a href="ACL2____INSTRUCTIONS.html">instructions</a></span> hint is not a true (null-terminated) list.  ACL2 now produces an 
 informative error message in that case.</p> 
 
 <p>Improved <span class="v">:</span><span class="v">print-gv</span> to do its computation in the ACL2 <a href="ACL2____WORLD.html">world</a> 
 in which the <a href="ACL2____GUARD.html">guard</a> violation took place.  See <a href="ACL2____PRINT-GV.html">print-gv</a>; in 
 particular, that topic concludes with a discussion of this issue.  Thanks to 
 Eric Smith for reporting this issue along with a simple example.</p> 
 
 <p>The following <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span> bugs were fixed.</p> 
 
 <ul> 
 
 <li>The <a href="ACL2____GUARD.html">guard</a> was being ignored (that is, treated as <span class="v">t</span>) when 
 <span class="v">:constrained t</span> was specified in a <span class="v">defun-sk</span> event.  Thanks to 
 Alessandro Coglio for reporting this bug.</li> 
 
 <li>
<span class="tt"><a href="ACL2____DEFUN-SK.html">Defun-sk</a></span> could fail when the formal parameters include <a href="ACL2____STOBJ.html">stobj</a>s or <span class="v">state</span>.</li> 
 
 <li>
<span class="tt"><a href="ACL2____DEFUN-SK.html">Defun-sk</a></span> provided no direct way to allow formals to be ignored. 
 Now, <span class="v">ignorable</span> <a href="COMMON-LISP____DECLARATION.html">declaration</a>s are permitted.</li> 
 
 </ul> 
 
 <p>For Lisps that do not compile on the fly (that is, Lisps other than CCL and 
 SBCL), evaluation of <span class="v">:comp t</span> effectively unmemoized functions that were 
 not already compiled.  This has been fixed.</p> 
 
 <p>When a <a href="ACL2____STOBJ.html">stobj</a> hash-table's ``init'' function was called with size 0, 
 an error could occur for host Lisp GCL, complaining that size 0 is not allowed 
 for hash-tables.  This has been fixed by using size 1 instead of 0 in this 
 case.</p> 
 
 <p>Reporting by <a href="ACL2____BREAK-REWRITE.html">break-rewrite</a> has been fixed for cases when failure is 
 due to a hypothesis with a <a href="ACL2____BACKCHAIN-LIMIT.html">backchain-limit</a> of 0.  There were actually 
 two such bugs: one due to improper handling of <a href="ACL2____LINEAR.html">linear</a> rules (which 
 might have occurred even for other backchain-limits besides 0), and one due to 
 the erroneous assumption that backchaining has only just begun at the point of 
 failure.  Thanks to Mihir Mehta for sending an example that exhibited both 
 bugs.  A discussion of the second bug, including a simple example, may be 
 found in a comment in the ACL2 source function, 
 <span class="v">tilde-@-failure-reason-phrase1-backchain-limit</span>.</p> 
 
 <p><span class="v">:OR</span> <a href="ACL2____HINTS.html">hints</a> that contain a single list (which satisfies <span class="tt"><a href="ACL2____KEYWORD-VALUE-LISTP.html">keyword-value-listp</a></span>) were being mishandled.  This has been fixed.  Thanks to 
 Dave Greve who sent an example <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> event specifying 
 <span class="v">:hints (("Goal" :or ((:in-theory (<a href="ACL2____E_F2D.html">e/d</a> () ()) :nonlinearp t))))</span>, which 
 formerly caused a Lisp error.</p> 
 
 <p>Fixed a bug in tracking the <a href="ACL2____CBD.html">cbd</a> that could cause failures of <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> in raw-mode.  Thanks to Warren Hunt for a query leading to this 
 fix.</p> 
 
 <p>Fixed a bug that was preventing some deep <a href="ACL2____PATTERNED-CONGRUENCE.html">patterned-congruence</a> rules 
 from being applied.  This could occur when on the left-hand side, the outermost 
 function symbol is the same as the next function symbol going in towards the 
 variable that differs on the right-hand side.  Thanks to Mihir Mehta for 
 reporting this bug and including a replayable example.</p> 
 
 <p>Fixed several issues with <span class="tt"><a href="ACL2____FMT.html">fmt</a></span> (and related printing utilities) 
 pertaining to linebreaks.  These include the following, many of which are 
 illustrated in a new file, <span class="v">system/tests/fmt-tests-input.lsp</span> (search there 
 for ``2020'').</p> 
 
 <ul> 
 
 <li>A space past the <span class="tt"><a href="ACL2____FMT-SOFT-RIGHT-MARGIN.html">fmt-soft-right-margin</a></span> now results in a linebreak 
 even in the case of tilde-space (`<span class="v">~ </span>').</li> 
 
 <li>As before, for puctuation after a tilde-x (`<span class="v">~x</span>') directive, ACL2 
 avoids printing in column 0 after a linebreak.  This desirable behavior now 
 extends to the case that `<span class="v">~x</span>' is inside a tilde-atsign (`<span class="v">~@</span>') 
 directive.  For example, after <span class="v">(<a href="ACL2____SET-FMT-HARD-RIGHT-MARGIN.html">set-fmt-hard-right-margin</a> 10 state)</span> try 
 either <span class="v">(<a href="ACL2____FMX.html">fmx</a> "~@0." (<a href="ACL2____MSG.html">msg</a> "~x0" '(ab de gh)))</span> or (fmx 
 "~#0~[~x0~/~x0~]." '(ab de gh)).</li> 
 
 <li>Spaces are respected after tilde-y (`<span class="v">~y</span>') directives.  For example, 
 <span class="v">(<a href="ACL2____CW.html">cw</a> "~y0 A~%" 3 4)</span> now prints the letter <span class="v">A</span> in column 2 rather than 
 column 0.  Thanks to Eric Smith and Alessandro Coglio for suggesting this 
 change.</li> 
 
 <li>An extra character is sometimes permitted before deciding that a tilde-x 
 (`<span class="v">~x</span>') directive causes a linebreak.</li> 
 
 <li>Tilde directives that cause no printing are often ignored when deciding 
 whether to keep a punctuation mark with a pretty-printed expression.  For 
 example, when setting both right margins (soft and hard) to 10, the following 
 no longer prints a comma in column 0: <span class="v">(<a href="ACL2____FMX.html">fmx</a> "~x0~@1, more~%"
 'aaaaaaaaaa "")</span>.</li> 
 
 <li>Fixed a <span class="tt"><a href="ACL2____DOUBLE-REWRITE.html">double-rewrite</a></span> warning, which was breaking the word 
 ``is''.  Thanks to Mihir Mehta for pointing this out.</li> 
 
 </ul> 
 
 <p>After setting <a href="ACL2____STATE.html">state</a> global <span class="v">trace-co</span>, for example with 
 <span class="v">(<a href="ACL2____F-PUT-GLOBAL.html">f-put-global</a> 'trace-co (<a href="ACL2_____04.html">@</a> standard-co) state)</span> (say, after setting 
 standard-co to an open output channel), printing of the trace level such as 
 ``<span class="v">1&gt;</span>'' and ``<span class="v">&lt;1</span>'' will now go to that channel.  Formerly, this could 
 fail after setting <span class="v">trace-co</span> directly rather than using <span class="tt"><a href="ACL2____OPEN-TRACE-FILE.html">open-trace-file</a></span>.</p> 
 
 <p>There are improvements to <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> and <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>, 
 which pertain to the loading of compiled files by <span class="v">include-book</span> before 
 events in the book are processed.  That process supports preservation of <a href="ACL2____HONS.html">hons</a>es and <a href="ACL2____FAST-ALISTS.html">fast-alists</a>, and reporting of ``stolen'' alists (see for 
 example <a href="ACL2____WITH-STOLEN-ALIST.html">with-stolen-alist</a>).  Relevant tests, with implementation-level 
 comments, may be found in the new <a href="ACL2____COMMUNITY-BOOKS.html">community-books</a> directory, 
 <span class="v">books/system/tests/early-load-of-compiled/</span>.  Thanks to Sol Swords for 
 helpful discussions.</p> 
 
 <p>Improved a utility that builds sets of clauses, which improves the 
 reliability of using a <a href="ACL2____LEMMA-INSTANCE.html">lemma-instance</a> of the form <span class="v">(:guard-theorem
 &lt;name&gt; nil)</span>.  Thanks to Eric Smith for reporting this problem with a simple 
 example, and to Dave Greve for following up with a related example; both now 
 work as one would expect.</p> 
 
 <p>Fixed printing of the ACL2 <a href="ACL2____STATE.html">state</a> in error messages, specifically 
 when executing a non-executable function.</p> 
 
 <p>Fixed a bug that could cause a raw Lisp error when processing a <a href="ACL2____LINEAR.html">linear</a> rule with a <span class="tt"><a href="ACL2____BIND-FREE.html">bind-free</a></span> hypothesis, when that hypothesis does 
 not specify a list of variables (in its second argument).  Thanks to Dave 
 Greve for reporting this bug by sending a simple example.  (Technical note: 
 the fix was in the definition of source function all-vars-in-hyps.)</p> 
 
 <p>For <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span>, a suitable error now occurs when the <span class="v">:LOGIC</span> 
 version of an abstract <a href="ACL2____STOBJ.html">stobj</a> export has the foundational stobj as a 
 formal parameter that is declared as a <a href="ACL2____STOBJ.html">stobj</a>.  Formerly, a confusing 
 hard error could occur in this case.</p> 
 
 <p>An unfortunate ``Proof skipped'' could be printed during the 
 <span class="v">include-book</span> phase of <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> for certain uses of <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span>, including calls of <span class="tt"><a href="ACL2____THM.html">thm</a></span>.  This has been fixed.</p> 
 
 <p>Fixed an implementation error that was being reported when a <span class="tt"><a href="ACL2____STOBJ-LET.html">stobj-let</a></span> form updates two array fields each with at least two indices that 
 are not all natural numbers.  For an example that caused this error, see <a href="ACL2____COMMUNITY-BOOK.html">community-book</a> <span class="v">books/system/tests/nested-stobj-two-updates.lisp</span>.</p> 
 
 <p>Fixed a bug in resizing <a href="ACL2____STOBJ.html">stobj</a> arrays whose elements are specified to 
 be <span class="v">(signed-byte 30)</span> or a subtype of that type.  Thanks to Eric Smith for 
 reporting this bug with a reproducible example.</p> 
 
 <p>For a <span class="tt"><a href="ACL2____STOBJ-LET.html">stobj-let</a></span> call occurring in other than a definition body, the 
 top-level bindings of variables to child stobj accessors was treated as <span class="tt"><a href="COMMON-LISP____LET_A2.html">let*</a></span> rather than as <span class="tt"><a href="COMMON-LISP____LET.html">let</a></span>.  That was at odds with the documentation, 
 and has been fixed.</p> 
 
 <p>Fixed a bug that caused an error when attempting to redefine a function for 
 which a <span class="v">:</span><span class="tt"><a href="ACL2____COMPOUND-RECOGNIZER.html">compound-recognizer</a></span> rule has been proved.  Thanks to 
 Eric McCarthy for reporting this bug (GitHub Issue #1273) with a reproducible 
 example.</p> 
 
 <p>Raw mode now does a better job of maintaining global <a href="ACL2____STOBJ.html">stobj</a> values. 
 Here is an example that illustrates the fix; also see <a href="ACL2____SET-RAW-MODE.html">set-raw-mode</a>, 
 which has been extended to explain a related but remaining issue.</p> 
 
 <pre class="code">(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st2 (ar :type (<a href="COMMON-LISP____ARRAY.html">array</a> t (8)) :resizable t))
(<a href="ACL2____SET-RAW-MODE-ON_12.html">set-raw-mode-on!</a>)
(resize-ar 20 st2)
(ar-length st2) ; formerly 8, but now 20 as expected</pre> 
 
 <p>For any <span class="tt"><a href="ACL2____PROOF-BUILDER.html">proof-builder</a></span> command of the form <span class="v">(<a href="COMMON-LISP_____D3.html">=</a> term1 term2 atom
 ...)</span>, the keyword arguments were ignored.  This has been fixed, and also the 
 documentation for <span class="tt"><a href="ACL2-PC_____D3.html">ACL2-pc::=</a></span> has been improved.</p> 
 
 <p>Consider when a <a href="ACL2____COMMUNITY-BOOK.html">community-book</a> is included using an ACL2 executable 
 different from the one that certified the book, with those two executables 
 being located in different directories.  The book is now considered to be 
 uncertified in that case.  To avoid this issue see <a href="ACL2____INCLUDE-BOOK.html">include-book</a> for a 
 discussion of environment variable <span class="v">ACL2_SYSTEM_BOOKS</span>.</p> 
 
 <h3>Changes at the System Level</h3> 
 
 <p>(SBCL only) Filenames are now read as ASCII (specifically, ISO-8859-1) when 
 the host Lisp is SBCL, which formerly was not the case.  Thanks to Stephen 
 Westfold for suggesting this change.</p> 
 
 <p>ACL2 can once again be built on CMU Common Lisp (CMUCL) (though we have 
 only done minimal testing).  The problem turned out to be with ACL2, not 
 CMUCL: low-level Lisp code in the ACL2 sources was destructively modifying a 
 quoted constant.  (For implementation details, see <span class="v">*fncall-cache*</span> in 
 source file <span class="v">translate.lisp</span>.)  The bug was discovered when considering 
 modification of the build process to compile ACL2 source files when the host 
 Lisp is SBCL.  Thanks to Stas Boukarev for pointing us in the right direction 
 to debug this error.</p> 
 
 <p>There is now a way to save the untranslated bodies of built-in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode functions.  WARNING: This is not officially supported!  But it 
 may be useful for tools such as a linter.  See <span class="v">GNUmakefile</span>: search there 
 for <span class="v">:acl2-save-unnormalized-bodies</span>, where you will see that a more 
 general capability is actually available for evaluating forms before the build 
 begins.  Thanks to Eric Smith for correspondence leading to this 
 enhancement.</p> 
 
 <p>Starting with ACL2 Version 7.0, the availability of hash consing (see 
 <span class="tt"><a href="ACL2____HONS.html">hons</a></span>) and the other features described in <a href="ACL2____HONS-AND-MEMOIZATION.html">hons-and-memoization</a> 
 have been part of a default ACL2 build; meanwhile, support for ``classic'' 
 ACL2 has essentially been discontinued.  These features require a certain Lisp 
 action (implementation note: pushing <span class="v">:hons</span> onto <span class="v">*features*</span>) that had 
 been done during the ACL2 build by the `<span class="v">make</span>' process (with code in 
 <span class="v">GNUmakefile</span>).  Now that action is taken unconditionally in the ACL2 
 source code.  Thanks to Petter Gustad for reporting an error when attempting 
 to build ACL2 without using `<span class="v">make</span>'; this change should fix that bug. 
 With this change you can no longer attempt to build ``classic'' ACL2(c) 
 without editing ACL2 source file <span class="v">init.lisp</span>; environment variable 
 <span class="v">ACL2_HONS</span> no longer has any effect.  (On a related technical note: An 
 obscure feature <span class="v">:memoize-hack</span> seems not to be used anywhere, and has been 
 eliminated.)</p> 
 
 <p>(SBCL only) Handling in ACL2 of the SBCL ``read-cycle-counter'' has been 
 modified to reflect its handling in recent SBCL versions (starting around late 
 2018 or early 2019).  This avoids an ACL2 build error on some platforms. 
 Thanks to John R. Strohm for reporting such a problem (on a Raspberry Pi).</p> 
 
 <p>(SBCL only) Increased the number of special variables that can be created, 
 which allowed community book 
 <span class="v">books/kestrel/apt/schemalg-template-proofs.lisp</span> to certify.</p> 
 
 <p>Fixed builds that use a relative pathname for the LISP environment 
 variable (for host Lisps CCL, SBCL, Allegro CL, and CMUCL; GCL and LispWorks 
 didn't seem to have this problem).  Thanks to Mihir Mehta for bringing this 
 issue to our attention; and thanks to Andrew Walter for reporting a problem 
 with our first solution for SBCL and proposing an alternative, which we 
 adopted.</p> 
 
 <p>Fixed the process for running ACL2 without building an executable image. 
 Some initialization that was missing from that process is now included.  Also, 
 added the missing command, (lp), to the instructions in section ``Running 
 Without Building an Executable Image'' on the ``Obtaining and Installing 
 ACL2'' web page (accessible from the ``Obtaining, Installing, and License'' 
 link on the ACL2 home page).  Thanks to Petter Gustad for an inquiry leading 
 to these improvements.</p> 
 
 <p>When invoking `<span class="v">make</span>' to build the ACL2 executable, output from the 
 build process is now written to file <span class="v">make.log</span>.  The terminal output is 
 now minimal.  If there is already a file <span class="v">make.log</span>, it is first moved to 
 <span class="v">make.log.bak</span>.  See file <span class="v">GNUmakefile</span> for additional documentation. 
 Thanks to Alessandro Coglio and Eric Smith for suggesting this change, and to 
 David Rager for pointing out associated changes to make for Jenkins 
 builds.</p> 
 
 <p>The startup banner now has a cleaner look (see <a href="ACL2____STARTUP-BANNER.html">startup-banner</a>). 
 Thanks to Alessandro Coglio and Eric Smith for key suggestions for 
 improvement.</p> 
 
 <p>(CCL only) When an attempt to build ACL2 fails, a more informative error 
 message is printed when the error is caused by invoking CCL as a soft link on 
 the Unix PATH rather than as a regular file.  Thanks to Mertcan Temel for 
 feedback leading to this change.</p> 
 
 <p>A script <span class="v">bin/acl2</span> has been added below the main ACL2 direcctory.  It 
 may be used in place of <span class="v">saved_acl2</span>, invoked from any directory.  If the 
 <span class="v">bin</span> subdirectory is on one's Unix <span class="v">PATH</span> then of course <span class="v">acl2</span> will 
 invoke this script (unless a different <span class="v">acl2</span> is in a directory that is 
 earlier on that path).  Thanks to Alessandro Coglio for suggesting that an 
 <span class="v">acl2</span> script be made available with ACL2, and to him and Eric Smith for 
 subsequent discussions on that topic.</p> 
 
 <p>When an error occurs while loading an <a href="ACL2____ACL2-CUSTOMIZATION.html">ACL2-customization</a> file, ACL2 
 quits with exit code 1.  Thanks to Eric Smith for suggesting the quit and to 
 Eric McCarthy for suggesting exit code 1 in that case.</p> 
 
 <p>ACL2 now does a more thorough job of doing proofs when ``<span class="v">make proofs</span>'' 
 is executed.  In particular, proofs were formerly skipped but are now 
 performed for <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> forms containing the explicit <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> <a href="COMMON-LISP____DECLARATION.html">declaration</a>, <span class="v">:mode :logic</span>, and for <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> events evaluated with 
 <a href="ACL2____DEFAULT-DEFUN-MODE.html">default-defun-mode</a> <span class="v">:logic</span> outside the so-called ``pass 2 
 files''.</p> 
 
 <h3>EMACS Support</h3> 
 
 <p>The <a href="ACL2____ACL2-DOC.html">ACL2-doc</a> search commands (`<span class="v">s</span>' and `<span class="v">S</span>') were seen to 
 use all available memory on a linux system, during the process of initializing 
 the <span class="v">acl2-doc-search</span> buffer that is used for doing the searching.  That 
 problem has been solved: that buffer is now loaded from a file that is built 
 by the manual-building process and is downloaded by the acl2-doc `<span class="v">D</span>' 
 command.</p> 
 
 <p>Highlighting in lisp-mode (inside Emacs) has been improved, both by 
 recognizing more keywords and by highlighting of some new arguments, in 
 particular the first argument of <span class="v">defthm</span>.  Thanks to Vivek Ramanathan, 
 both for pointing out the <span class="v">defthm</span> issue and for suggesting code that was 
 incorporated into the changes.</p> 
 
 <p>The <a href="ACL2____ACL2-DOC.html">ACL2-doc</a> browser now queries when first loading an ACL2+books 
 manual if you have a newer web-based version.  A ``yes'' response will use 
 the (out-of-date) manual, while a ``no'' response will generally produce a new 
 query asking if you want to download the manual from the web.  This change was 
 made in support of building the manual more quickly, as the acl2-doc manual is 
 no longer built by default.  See <a href="ACL2____ACL2-DOC.html">ACL2-doc</a> for how to do that build and 
 other details.  Thanks to Alessandro Coglio, Eric Smith, and Sol Swords for 
 discussions about speeding up the build of the manual.</p> 
 
 <p>Fixed certain hangs in the <a href="ACL2____ACL2-DOC.html">ACL2-doc</a> browser.  For example, when 
 standing on whitespace near the left margin of topic <a href="ACL2_____A2ACL2-EXPORTS_A2.html">*ACL2-exports*</a>, 
 the '<span class="v">g</span>' command could formerly hang.</p> 
 
 <h3>Experimental Versions</h3> 
 
 <p>ACL2(p) now runs much more reliably on host Lisp SBCL (by taking advantage 
 of a locking mechanism provided by SBCL).  Thanks to David Rager for providing 
 this improvement.</p> 
 
 <p>In ACL2(p), <span class="tt"><a href="ACL2____SET-WATERFALL-PARALLELISM.html">set-waterfall-parallelism</a></span> no longer causes an error 
 when there are <span class="tt"><a href="ACL2____OVERRIDE-HINTS.html">override-hints</a></span> if the argument is the existing value of 
 the <a href="ACL2____STATE.html">state</a> global, <span class="v">'waterfall-parallelism</span>, or upon a transition of 
 <a href="ACL2____WATERFALL-PARALLELISM.html">waterfall-parallelism</a> to <span class="v">nil</span>.  Thanks to David Rager for raising 
 this issue (see GitHub Issue #1171) and discussing its resolution.</p> 
 
 
</body>
</html>
