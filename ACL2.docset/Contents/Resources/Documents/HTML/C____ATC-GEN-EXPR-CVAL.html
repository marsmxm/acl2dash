<html>
<head>
<meta charset="UTF-8">
<title>Atc-gen-expr-cval</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=C____ATC-GEN-EXPR-CVAL">Click for Atc-gen-expr-cval in the Full Manual</a></h3>

<p>Generate a C expression from an ACL2 term 
          that must be an expression term returning a C value.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(atc-gen-expr-cval term var-term-alist 
                   inscope fn prec-fns ctx state) 
 
  → 
(mv erp val state)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">term</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> term)</span>.</font>
</dd> 
  <dd>
<span class="tt">var-term-alist</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____SYMBOL-PSEUDOTERM-ALISTP.html">symbol-pseudoterm-alistp</a> var-term-alist)</span>.</font>
</dd> 
  <dd>
<span class="tt">inscope</span> — <font color="#606060">Guard <span class="v">(<a href="C____ATC-SYMBOL-TYPE-ALIST-LISTP.html">atc-symbol-type-alist-listp</a> inscope)</span>.</font>
</dd> 
  <dd>
<span class="tt">fn</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn)</span>.</font>
</dd> 
  <dd>
<span class="tt">prec-fns</span> — <font color="#606060">Guard <span class="v">(<a href="C____ATC-SYMBOL-FNINFO-ALISTP.html">atc-symbol-fninfo-alistp</a> prec-fns)</span>.</font>
</dd> 
  <dd>
<span class="tt">ctx</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____CTXP.html">ctxp</a> ctx)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">val</span> — <font color="#606060">Type <span class="v">(tuple (<a href="C____EXPR.html">expr</a> exprp)
       (<a href="C____TYPE.html">type</a> typep)
       (affect symbol-listp)
       (limit pseudo-termp)
       val)
</span>.</font>
</dd> 
 
</dl></div> 
<p>At the same time, 
     we check that the term is an expression term returning a C value, 
     as described in the user documentation.</p><p>We also return the C type of the expression, 
     the affected variables, 
     and a limit that suffices for <span class="tt"><a href="C____EXEC-EXPR-CALL-OR-PURE.html">exec-expr-call-or-pure</a></span> 
     to execute the expression completely.</p><p>If the term is a call of a function that precedes <span class="v">fn</span> 
     in the list of target functions <span class="v">fn1</span>, ..., <span class="v">fnp</span>, 
     we translate it to a C function call on the translated arguments. 
     The type of the expression is the result type of the function, 
     which is looked up in the function alist passed as input: 
     we ensure that this type is not <span class="v">void</span>. 
     A sufficient limit for <span class="tt"><a href="C____EXEC-FUN.html">exec-fun</a></span> to execute the called function 
     is retrieved from the called function's information; 
     we add 2 to it, to take into account the decrementing of the limit 
     to go from <span class="tt"><a href="C____EXEC-EXPR-CALL-OR-PURE.html">exec-expr-call-or-pure</a></span> to <span class="tt"><a href="C____EXEC-EXPR-CALL.html">exec-expr-call</a></span> 
     and from there to <span class="tt"><a href="C____EXEC-FUN.html">exec-fun</a></span>.</p><p>Otherwise, we attempt to translate the term 
     as a pure expression term returning a C value. 
     The type is the one returned by that translation. 
     As limit we return 1, which suffices for <span class="tt"><a href="C____EXEC-EXPR-CALL-OR-PURE.html">exec-expr-call-or-pure</a></span> 
     to not stop right away due to the limit being 0.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>atc-gen-expr-cval</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 atc-gen-expr-cval
 (term var-term-alist
       inscope fn prec-fns ctx state)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs (<a href="ACL2____STATE.html">state</a>)))
 (<a href="COMMON-LISP____DECLARE.html">declare</a>
      (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> term)
                         (<a href="ACL2____SYMBOL-PSEUDOTERM-ALISTP.html">symbol-pseudoterm-alistp</a> var-term-alist)
                         (<a href="C____ATC-SYMBOL-TYPE-ALIST-LISTP.html">atc-symbol-type-alist-listp</a> inscope)
                         (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn)
                         (<a href="C____ATC-SYMBOL-FNINFO-ALISTP.html">atc-symbol-fninfo-alistp</a> prec-fns)
                         (<a href="ACL2____CTXP.html">ctxp</a> ctx))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'atc-gen-expr-cval))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   (((<a href="ACL2____MV.html">mv</a> okp called-fn
         args in-types out-type affect limit)
     (<a href="C____ATC-CHECK-CFUN-CALL.html">atc-check-cfun-call</a> term var-term-alist prec-fns (<a href="ACL2____W.html">w</a> state)))
    ((when okp)
     (<a href="ACL2____B_A2.html">b*</a>
      (((when (<a href="C____TYPE-CASE.html">type-case</a> out-type :void))
        (<a href="ACL2____ER-SOFT_B2.html">er-soft+</a>
         ctx
         t (<a href="COMMON-LISP____LIST.html">list</a> (<a href="C____IRR-EXPR.html">irr-expr</a>) (<a href="C____IRR-TYPE.html">irr-type</a>) nil nil)
         "A call ~x0 of the function ~x1, which returns void, ~
                         is being used where ~
                         an ACL2 term is expected to return a C value."
         term called-fn))
       ((unless
            (<a href="C____ATC-CHECK-CFUN-CALL-ARGS.html">atc-check-cfun-call-args</a> (<a href="ACL2____FORMALS_B2.html">formals+</a> called-fn (<a href="ACL2____W.html">w</a> state))
                                      in-types args))
        (<a href="ACL2____ER-SOFT_B2.html">er-soft+</a>
         ctx
         t (<a href="COMMON-LISP____LIST.html">list</a> (<a href="C____IRR-EXPR.html">irr-expr</a>) (<a href="C____IRR-TYPE.html">irr-type</a>) nil nil)
         "The call ~x0 does not satisfy the restrictions ~
                         on array arguments being identical to the formals."
         term))
       ((<a href="ACL2____MV.html">mv</a> erp (<a href="COMMON-LISP____LIST.html">list</a> arg-exprs types) state)
        (<a href="C____ATC-GEN-EXPR-CVAL-PURE-LIST.html">atc-gen-expr-cval-pure-list</a> args inscope fn ctx state))
       ((when erp)
        (<a href="ACL2____MV.html">mv</a> erp (<a href="COMMON-LISP____LIST.html">list</a> (<a href="C____IRR-EXPR.html">irr-expr</a>) (<a href="C____IRR-TYPE.html">irr-type</a>) nil nil)
            state))
       ((unless (<a href="COMMON-LISP____EQUAL.html">equal</a> types in-types))
        (<a href="ACL2____ER-SOFT_B2.html">er-soft+</a>
         ctx
         t (<a href="COMMON-LISP____LIST.html">list</a> (<a href="C____IRR-EXPR.html">irr-expr</a>) (<a href="C____IRR-TYPE.html">irr-type</a>) nil nil)
         "The function ~x0 with input types ~x1 ~
                         is applied to terms ~x2 returning ~x3. ~
                         This is indicative of provably dead code, ~
                         given that the code is guard-verified."
         called-fn in-types args types)))
      (<a href="ACL2____VALUE.html">acl2::value</a>
          (<a href="COMMON-LISP____LIST.html">list</a> (<a href="C____MAKE-EXPR-CALL.html">make-expr-call</a>
                     :fun (<a href="C____MAKE-IDENT.html">make-ident</a> :name (<a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a> called-fn))
                     :args arg-exprs)
                out-type affect
                (<a href="COMMON-LISP____CONS.html">cons</a> 'binary-+
                      (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'quote (<a href="COMMON-LISP____CONS.html">cons</a> '2 'nil))
                            (<a href="COMMON-LISP____CONS.html">cons</a> limit 'nil))))))))
   (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> erp (<a href="COMMON-LISP____LIST.html">list</a> expr type) state)
         (<a href="C____ATC-GEN-EXPR-CVAL-PURE.html">atc-gen-expr-cval-pure</a> term inscope fn ctx state))
        ((when erp)
         (<a href="ACL2____MV.html">mv</a> erp (<a href="COMMON-LISP____LIST.html">list</a> (<a href="C____IRR-EXPR.html">irr-expr</a>) (<a href="C____IRR-TYPE.html">irr-type</a>) nil nil)
             state)))
       (<a href="ACL2____VALUE.html">acl2::value</a> (<a href="COMMON-LISP____LIST.html">list</a> expr type affect ''1))))))</pre> 
<p><b>Theorem: </b>return-type-of-atc-gen-expr-cval.val</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> return-type-of-atc-gen-expr-cval.val
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?erp ?val acl2::?state)
              (<a href="C____ATC-GEN-EXPR-CVAL.html">atc-gen-expr-cval</a> term var-term-alist
                                 inscope fn prec-fns ctx state)))
            (tuple (<a href="C____EXPR.html">expr</a> exprp)
                   (<a href="C____TYPE.html">type</a> typep)
                   (affect symbol-listp)
                   (limit pseudo-termp)
                   val))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>typeset-of-atc-gen-expr-cval</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> typeset-of-atc-gen-expr-cval
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?erp ?val acl2::?state)
              (<a href="C____ATC-GEN-EXPR-CVAL.html">atc-gen-expr-cval</a> term var-term-alist
                                 inscope fn prec-fns ctx state)))
            (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____CONSP.html">consp</a> val) (<a href="ACL2____TRUE-LISTP.html">true-listp</a> val)))
        :rule-classes :type-prescription)</pre> 

</body>
</html>
