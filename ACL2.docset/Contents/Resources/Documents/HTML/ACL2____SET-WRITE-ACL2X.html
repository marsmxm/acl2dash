<html>
<head>
<meta charset="UTF-8">
<title>Set-write-ACL2x</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____SET-WRITE-ACL2X">Click for Set-write-ACL2x in the Full Manual</a></h3>

<p>Cause <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> to write out a <span class="v">.acl2x</span> file</p><pre class="code">Example Forms:
(<a href="ACL2____SET-WRITE-ACL2X.html">set-write-acl2x</a> nil state)
(<a href="ACL2____SET-WRITE-ACL2X.html">set-write-acl2x</a> t state)
(<a href="ACL2____SET-WRITE-ACL2X.html">set-write-acl2x</a> '(nil) state) ; same as just above, but allow inclusion of
                               ; uncertified books during certify-book
(<a href="ACL2____SET-WRITE-ACL2X.html">set-write-acl2x</a> '(t) state)
(<a href="ACL2____SET-WRITE-ACL2X.html">set-write-acl2x</a> '(include-book-with-locals) state)</pre> 
 
 <pre class="code">General Form:
(<a href="ACL2____SET-WRITE-ACL2X.html">set-write-acl2x</a> val state)</pre> 
 
 <p>where <span class="v">val</span> evaluates to <span class="v">t</span>, <span class="v">nil</span>, or a one-element list whose 
 element is a legal value for the global <span class="v">'ld-skip-proofsp</span>; see <a href="ACL2____LD-SKIP-PROOFSP.html">ld-skip-proofsp</a>.  The value returned is an error triple, which in the 
 non-error case is <span class="v">(<a href="ACL2____MV.html">mv</a> nil v state)</span>, where <span class="v">v</span> is the value of <span class="v">val</span> 
 and <span class="v">state</span> is the result of updating the input <a href="ACL2____STATE.html">state</a> by assigning 
 state global <span class="v">'write-acl2x</span> the value <span class="v">v</span>.</p> 
 
 <p>The command <span class="v">(<a href="ACL2____SET-WRITE-ACL2X.html">set-write-acl2x</a> val state)</span> assigns the value of <span class="v">val</span> 
 to the <a href="ACL2____STATE.html">state</a> global variable <span class="v">'write-acl2x</span>, affecting whether or 
 not <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> writes out a file with extension <span class="v">acl2x</span>, called a 
 ``<span class="v">.acl2x</span> file'' and pronounced ``dot-acl2x file''.  Such a file is read 
 or written by <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> when it is supplied with keyword argument 
 <span class="v">:acl2x t</span>.  By default, such a call of <span class="v">certify-book</span> reads a 
 <span class="v">.acl2x</span> file; but if the value of state global variable <span class="v">'write-acl2x</span> 
 is not <span class="v">nil</span>, then <span class="v">certify-book</span> writes a <span class="v">.acl2x</span> file (in which 
 case it is illegal to specify a non-<span class="v">nil</span> value for <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> 
 keyword argument <span class="v">:pcert</span>).  Consider for example <span class="v">(<a href="ACL2____CERTIFY-BOOK.html">certify-book</a> "foo"
 0 nil :acl2x t)</span>.  By default, this command reads file <span class="v">foo.acl2x</span>, which 
 supplies replacements for some forms in <span class="v">foo.lisp</span>, as described later 
 below.  But if the value of state global <span class="v">'write-acl2x</span> is not <span class="v">nil</span>, 
 then instead, this <span class="v">certify-book</span> command writes such a file 
 <span class="v">foo.acl2x</span>.</p> 
 
 <p>Before we discuss the function of <span class="v">.acl2x</span> files, we first explain more 
 about how a non-<span class="v">nil</span> value of <a href="ACL2____STATE.html">state</a> global <span class="v">'write-acl2x</span> 
 affects the behavior of a command <span class="v">(<a href="ACL2____CERTIFY-BOOK.html">certify-book</a> ... :acl2x t ...)</span>.  A 
 significant effect on the behavior is that after processing events in the 
 given book, ACL2 writes out a <span class="v">.acl2x</span> file and then returns, skipping the 
 other subsequent actions typically performed by <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span>: a <a href="ACL2____LOCAL-INCOMPATIBILITY.html">local-incompatibility</a> check, writing of a <a href="ACL2____CERTIFICATE.html">certificate</a> file, and 
 possibly <a href="ACL2____COMPILATION.html">compilation</a>.  Another effect is that proofs may be skipped 
 when processing <a href="ACL2____EVENTS.html">events</a> assuming that the the <span class="v">certify-book</span> command 
 does not explicitly specify <span class="v">:skip-proofs-okp nil</span>, as we now explain.  A 
 non-<span class="v">nil</span> value of <span class="v">'write-acl2x</span> should either be <span class="v">t</span> or a 
 one-element list <span class="v">(x)</span>, where <span class="v">x</span> is a legal value for the <a href="ACL2____STATE.html">state</a> 
 global <span class="v">'ld-skip-proofsp</span> (see <a href="ACL2____LD-SKIP-PROOFSP.html">ld-skip-proofsp</a>).  In both cases, 
 <span class="v">certify-book</span> will process <a href="ACL2____EVENTS.html">events</a> to write out a <span class="v">.acl2x</span> file 
 as described above.  But in the latter (list) case, event processing will take 
 place according to the value of <span class="v">x</span>: in particular, proofs will be skipped 
 when <span class="v">x</span> is not <span class="v">nil</span>, and if moreover <span class="v">x</span> is the symbol 
 <span class="v">include-book-with-locals</span>, then only one pass will be made through each 
 <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> form.  A third effect of a non-<span class="v">nil</span> value of 
 <span class="v">'write-acl2x</span>, which is restricted to the list case, is that <a href="ACL2____INCLUDE-BOOK.html">include-book</a> events encountered during event processing are allowed to 
 succeed on uncertified books, something that is prohibited during most calls 
 of <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span>.</p> 
 
 <p>When <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> is used to write out a <span class="v">.acl2x</span> file, there is 
 typically a subsequent run of <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> that reads that file. 
 Consider how this can work with a book <span class="v">foo.lisp</span>.  In the first call of 
 <span class="v">certify-book</span>, a file <span class="v">foo.acl2x</span> is written that contains all <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> expansions, but <span class="v">foo.cert</span> is not written.  In the second call 
 of <span class="v">certify-book</span>, no <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> expansion typically takes place, 
 because <span class="v">foo.acl2x</span> supplies the expansions.  The command 
 <span class="v">(<a href="ACL2____SET-WRITE-ACL2X.html">set-write-acl2x</a> t state)</span> should be evaluated before the first 
 certification (though another legal non-<span class="v">nil</span> value may be used in place of 
 <span class="v">t</span>), setting the value of <span class="tt"><a href="ACL2____STATE.html">state</a></span> global <span class="v">'write-acl2x</span> to 
 <span class="v">t</span>, to enable writing of <span class="v">foo.acl2x</span>; and the command 
 <span class="v">(<a href="ACL2____SET-WRITE-ACL2X.html">set-write-acl2x</a> nil state)</span> may be evaluated before the second run 
 (though this is not necessary in a fresh ACL2 session) in order to complete 
 the certification (writing out <span class="v">foo.cert</span>) using <span class="v">foo.acl2x</span> to supply 
 the <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> expansions.</p> 
 
 <p>When <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">Certify-book</a></span> is supplied with keyword argument <span class="v">:acl2x t</span> 
 it will read or write the book's <span class="v">.acl2x</span> file; when supplied with 
 <span class="v">:acl2x nil</span>, it will not read or write that <span class="v">.acl2x</span> file.  The value 
 of <span class="v">:acl2x</span> is <span class="v">nil</span> by default.  The interaction of <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> with the corresponding <span class="v">.acl2x</span> file is as follows.</p> 
 
 <pre class="code">o If <span class="v">:acl2x</span> is <span class="v">t</span>, then: 
  - If <span class="v">set-write-acl2x</span> has been (most recently) called with a value of 
    <span class="v">t</span> for its first argument,then ACL2 writes the corresponding 
    <span class="v">.acl2x</span> file. 
  - If <span class="v">set-write-acl2x</span> has been (most recently) called with a value of 
    <span class="v">nil</span> for its first argument, or not called at all, then ACL2 insists 
    on a corresponding <span class="v">.acl2x</span> file that is at least as recent as the 
    corresponding <span class="v">.lisp</span> file, causing an error otherwise. 
 o If <span class="v">:acl2x</span> is <span class="v">nil</span>,then: 
  - If <span class="v">set-write-acl2x</span> has been (most recently) called with a value 
    <span class="v">t</span> for its first argument, or if argument <span class="v">:ttagsx</span> is supplied, 
    then an error occurs. 
  - If the <span class="v">.acl2x</span> file exists, then regardless of whether or how 
    <span class="v">set-write-acl2x</span> has been called, ACL2 ignores the <span class="v">.acl2x</span> file 
    but issues a warning about it. 
</pre> 
 
 <p>Suppose you use the two-runs approach: first write a <span class="v">.acl2x</span> file, then 
 certify using (reading) that <span class="v">.acl2x</span> file.  Then with scripts such as 
 makefiles, then you may wish to provide a single <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> command 
 to use for both runs.  For that purpose, <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> supports the 
 keyword argument <span class="v">:ttagsx</span>.  If this argument is supplied and 
 <span class="v">write-acl2x</span> is true, then this argument is treated as the <span class="v">:ttags</span> 
 argument, overriding a <span class="v">:ttags</span> argument if present.  That is, for the two 
 runs, <span class="v">:ttagsx</span> may be used to specify the trust tags used in the first 
 certification while <span class="v">:ttags</span> specifies the trust tags, if any (else 
 <span class="v">:ttags</span> may be omitted), used in the second certification.  Note: If the 
 argument <span class="v">:ttagsx</span> is not supplied, then its value defaults to the 
 (explicit or default) value of the <span class="v">:ttags</span> argument.</p> 
 
 <p>The built-in ACL2 Makefile support automatically generates suitable 
 dependencies if you create a <span class="v">.acl2</span> file with a <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> call 
 matching the following regular expression, case-independent:</p> 
 
 <pre class="code">(certify-book[^;]*:acl2x t</pre> 
 
 <p>For an example <span class="v">.acl2</span> file with a <span class="v">certify-book</span> call matching the 
 above pattern, see community books file 
 <span class="v">books/make-event/double-cert-test-1.acl2</span>.</p> 
 
 <p>Note that <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> is generally not affected by 
 <span class="v">set-write-acl2x</span>, other than through the indirect effect on <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span>.  More precisely: All expansions are stored in the <a href="ACL2____CERTIFICATE.html">certificate</a> file, so when <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> is applied to a certified 
 book, the <span class="v">.acl2x</span> file is not consulted.</p> 
 
 <p>An example of how to put this all together may be found in community book 
 <span class="v">books/make-event/double-cert-test-1.lisp</span>.  There, we see the following 
 form.</p> 
 
 <pre class="code">(<a href="ACL2____MAKE-EVENT.html">make-event</a>
 (<a href="COMMON-LISP____PROGN.html">progn</a> (<a href="ACL2____DEFTTAG.html">defttag</a> :my-ttag)
        (<a href="ACL2____PROGN_12.html">progn!</a> (<a href="COMMON-LISP____LET.html">let</a> ((val (<a href="ACL2____SYS-CALL.html">sys-call</a> "pwd" nil)))
                  (<a href="ACL2____VALUE.html">value</a> (<a href="COMMON-LISP____LIST.html">list</a> 'defun 'foo () val))))))</pre> 
 
 <p>Imagine that in place of the binding computed using <span class="tt"><a href="ACL2____SYS-CALL.html">sys-call</a></span>, which 
 by the way requires a trust tag, is some computation of your choice (such as 
 reading forms from a file) that is used to construct your own event, in place 
 of the <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> event constructed above.  The <span class="v">Makefile</span> in that 
 directory contains the following added dependency, so that file 
 <span class="v">double-cert-test-1.acl2x</span> will be created:</p> 
 
 <pre class="code">double-cert-test-1.cert: double-cert-test-1.acl2x</pre> 
 
 <p>There is also the file <span class="v">double-cert-test-1.acl2</span> in that directory, 
 which contains a single form as follows.</p> 
 
 <pre class="code">(<a href="ACL2____CERTIFY-BOOK.html">certify-book</a> "double-cert-test-1" ? t :ttagsx :all :ttags nil)</pre> 
 
 <p>Thus, a call of `make' first creates file <span class="v">double-cert-test-1.acl2x</span>, 
 which uses the above <span class="v">:ttagsx</span> argument in order to support the use of 
 <span class="tt"><a href="ACL2____DEFTTAG.html">defttag</a></span> during <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> expansion.  Then, `make' goes on to 
 cause a second certification in which no trust tags are involved.  As a 
 result, the parent book <span class="v">double-cert-test.lisp</span> is ultimately certified 
 without requiring any trust tags.</p> 
 
 <p>The discussion above is probably sufficient for most users of the two-run 
 approach it describes.  We conclude with further details for those who want 
 more information.  Those who wish to see a yet lower-level explanation of how 
 all this works are invited to read the comment in the ACL2 source code 
 entitled ``Essay on .acl2x Files (Double Certification).</p> 
 
 <p>Consider the <span class="v">.acl2x</span> file produced by the first run as described above. 
 It contains a single expression, which is an association list whose keys are 
 all positive integers, which occur in increasing order.  When the <span class="v">.acl2x</span> 
 file is present and at least as recent as the corresponding <span class="v">.lisp</span> file, 
 then for a subsequent <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> with argument <span class="v">:acl2x t</span> and the 
 (default) value of <span class="v">nil</span> for <a href="ACL2____STATE.html">state</a> global <span class="v">'write-acl2x</span>, that 
 association list will be applied to the top-level events in the book, as 
 follows.  Suppose the entry <span class="v">(n . ev)</span> belongs to the association list in 
 the <span class="v">.acl2x</span> file.  Then <span class="v">n</span> is a positive integer, and the <span class="v">n</span>th 
 top-level event in the book — where the <span class="v">0</span>th event is the initial 
 <span class="tt"><a href="COMMON-LISP____IN-PACKAGE.html">in-package</a></span> form — will be replaced by <span class="v">ev</span>.  In practice, 
 <span class="v">ev</span> is the <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> expansion created during certification for 
 the <span class="v">nth</span> top-level event in the book; and this will always be the case if 
 the <span class="v">.acl2x</span> file is created by <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> after execution of the 
 form <span class="v">(<a href="ACL2____SET-WRITE-ACL2X.html">set-write-acl2x</a> t state)</span>.  However, you are welcome to associate 
 indices manually with any <a href="ACL2____EVENTS.html">events</a> you wish into the alist stored in the 
 <span class="v">.acl2x</span> file.</p> 
 
 <p>Note: Also see the community book <span class="v">make-event/acl2x-help.lisp</span> for a 
 useful utility that can be used to skip proofs during the writing of 
 <span class="v">.acl2x</span> files.</p>
</body>
</html>
