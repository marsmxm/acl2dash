<html>
<head>
<meta charset="UTF-8">
<title>Spec-mv-let</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____SPEC-MV-LET">Click for Spec-mv-let in the Full Manual</a></h3>

<p>Modification of <span class="tt"><a href="ACL2____MV-LET.html">mv-let</a></span> supporting speculative and parallel execution</p><p>This <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> topic relates to the experimental 
 extension of ACL2 supporting parallel execution and proof; see <a href="ACL2____PARALLELISM.html">parallelism</a>, and see <a href="ACL2____PARALLEL-PROGRAMMING.html">parallel-programming</a>, which has a disclaimer.</p> 
 
 <pre class="code">Example Form:
(<a href="COMMON-LISP____DEFUN.html">defun</a> pfib-with-step-count (x)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :program))
  (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____OR.html">or</a> (<a href="ACL2____ZP.html">zp</a> x) (<a href="COMMON-LISP_____C3.html">&lt;</a> x 33))
      (fib-with-step-count x)
    (<a href="ACL2____SPEC-MV-LET.html">spec-mv-let</a>
     (a cnt1)
     (pfib-with-step-count (<a href="COMMON-LISP____-.html">-</a> x 1))
     (<a href="ACL2____MV-LET.html">mv-let</a> (b cnt2)
             (pfib-with-step-count (<a href="COMMON-LISP____-.html">-</a> x 2))
             (<a href="COMMON-LISP____IF.html">if</a> t
                 (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP_____B2.html">+</a> a b)
                     (<a href="COMMON-LISP_____B2.html">+</a> 1 cnt1 cnt2))
               (<a href="ACL2____MV.html">mv</a> "speculative result is always needed"
                   -1))))))

General Form:
(<a href="ACL2____SPEC-MV-LET.html">spec-mv-let</a>
 (v1 ... vn)  ; bind distinct variables
 &lt;spec&gt;       ; evaluate speculatively; return n values
 (<a href="ACL2____MV-LET.html">mv-let</a>      ; or, use mv?-let if k=1 below
  (w1 ... wk) ; bind distinct variables
  &lt;eager&gt;     ; evaluate eagerly
  (<a href="COMMON-LISP____IF.html">if</a> &lt;test&gt;  ; use results from &lt;spec&gt; if true
      &lt;typical-case&gt; ; may mention v1 ... vn
    &lt;abort-case&gt;)))  ; does not mention v1 ... vn</pre> 
 
 <p>Our design of <span class="v">spec-mv-let</span> is guided by its use in ACL2 source code to 
 parallelize part of ACL2's proof process, in the experimental parallel 
 extension of ACL2.  The user can think of <span class="v">spec-mv-let</span> as a speculative 
 version of <span class="tt"><a href="ACL2____MV-LET.html">mv-let</a></span>.  (In ordinary ACL2, the semantics agree with this 
 description but without speculative or parallel execution.)</p> 
 
 <p>Evaluation of the above general form proceeds as suggested by the comments. 
 First, <span class="v">&lt;spec&gt;</span> is executed speculatively.  Control then passes immediately 
 to the <span class="tt"><a href="ACL2____MV-LET.html">mv-let</a></span> call, without waiting for the result of evaluating 
 <span class="v">&lt;spec&gt;</span>.  The variables <span class="v">(w1 ... wk)</span> are bound to the result of 
 evaluating <span class="v">&lt;eager&gt;</span>, and then <span class="v">&lt;test&gt;</span> is evaluated.  If the value of 
 <span class="v">&lt;test&gt;</span> is true, then the values of <span class="v">(v1 ... vn)</span> are needed, and 
 <span class="v">&lt;typical-case&gt;</span> blocks until they are available.  If the value of 
 <span class="v">&lt;test&gt;</span> is false, then the values of <span class="v">(v1 ... vn)</span> are not needed, and 
 the evaluation of <span class="v">&lt;spec&gt;</span> may be aborted.</p> 
 
 <p>The calls to <span class="v">mv-let</span> and to <span class="v">if</span> displayed above in the General Form 
 are an essential part of the design of <span class="v">spec-mv-let</span>, and are thus 
 required.</p> 
 
 <p>The following definition of <span class="v">fib-with-step-count</span> completes the example 
 above:</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> fib-with-step-count (x)
(<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :program))
(<a href="COMMON-LISP____COND.html">cond</a> ((<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> x 0)
       (<a href="ACL2____MV.html">mv</a> 0 1))
      ((<a href="COMMON-LISP_____D3.html">=</a> x 1) (<a href="ACL2____MV.html">mv</a> 1 1))
      (t (<a href="ACL2____MV-LET.html">mv-let</a> (a cnt1)
                 (fib-with-step-count (<a href="COMMON-LISP____-.html">-</a> x 1))
                 (<a href="ACL2____MV-LET.html">mv-let</a> (b cnt2)
                         (fib-with-step-count (<a href="COMMON-LISP____-.html">-</a> x 2))
                         (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP_____B2.html">+</a> a b)
                             (<a href="COMMON-LISP_____B2.html">+</a> 1 cnt1 cnt2)))))))</pre>
</body>
</html>
