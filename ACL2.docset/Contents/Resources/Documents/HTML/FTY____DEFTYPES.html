<html>
<head>
<meta charset="UTF-8">
<title>Deftypes</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=FTY____DEFTYPES">Click for Deftypes in the Full Manual</a></h3>

<p>Generate mutually recursive types with equivalence relations and 
fixing functions.</p><p><span class="v">Deftypes</span> generates mutually-recursive types. We'll begin with 
an example.</p> 
 
<pre class="code">;; Associate fixing functions and equivalence relations
;; with component types.  Note: this is done for most
;; basic types in the book centaur/fty/basetypes.lisp.

(<a href="FTY____DEFFIXTYPE.html">deffixtype</a> integer :pred integerp :fix ifix :equiv int-equiv :define t)
(<a href="FTY____DEFFIXTYPE.html">deffixtype</a> symbol :pred symbolp :fix symbol-fix :equiv sym-equiv :define t)

(<a href="FTY____DEFTYPES.html">deftypes</a> intterm
  (<a href="FTY____DEFFLEXSUM.html">defflexsum</a> intterm
    (:num :cond (<a href="COMMON-LISP____ATOM.html">atom</a> x)
     :fields ((val :type integerp :acc-body x))
     :ctor-body val)
    (:call
     :fields ((fn :type symbol :acc-body (<a href="COMMON-LISP____CAR.html">car</a> x))
              (<a href="ACL2____ARGS.html">args</a> :type inttermlist :acc-body (<a href="COMMON-LISP____CDR.html">cdr</a> x)))
     :ctor-body (<a href="COMMON-LISP____CONS.html">cons</a> fn args)))
  (<a href="FTY____DEFLIST.html">deflist</a> inttermlist
    :elt-type intterm))</pre> 
 
<p>This generates recognizers and fixing functions for two new types:</p> 
<ul> 
<li>intterm, which is either a "num" consisting of a single integer or a 
"call" consisting of a symbol consed onto an inttermlist,</li> 
<li>inttermlist, which is a list of intterms.</li> 
</ul> 
 
<p>The <span class="v">deftypes</span> form just bundles together two other forms -- a <a href="FTY____DEFFLEXSUM.html">defflexsum</a> and a <a href="FTY____DEFLIST.html">deflist</a>.  These two forms would be admissible by 
themselves, except that the types they are defining are mutually recursive, and 
therefore so are their recognizer predicates and fixing functions.</p> 
 
<p>The syntax and behavior of individual type generators is documented further 
in their own topics.  So far, the supported type generators are:</p> 
<ul> 
<li>
<a href="FTY____DEFLIST.html">deflist</a>: a list of elements of a particular type</li> 
<li>
<a href="FTY____DEFPROD.html">defprod</a>: a product (AKA record, aggregate, struct) type</li> 
<li>
<a href="FTY____DEFALIST.html">defalist</a>: an alist mapping keys of some type to values of some type</li> 
<li>
<a href="FTY____DEFSET.html">defset</a>: an oset of elements of a particular type</li> 
<li>
<a href="FTY____DEFOMAP.html">defomap</a>: an omap mapping keys of some type to values of some type</li> 
<li>
<a href="FTY____DEFTAGSUM.html">deftagsum</a>: a sum-of-products (AKA tagged union) type</li> 
<li>
<a href="FTY____DEFFLEXSUM.html">defflexsum</a>: a very flexible (and not as automated) sum-of-products 
type used to implement <a href="FTY____DEFPROD.html">defprod</a> and <a href="FTY____DEFTAGSUM.html">deftagsum</a>.</li> 
</ul> 
 
<p><span class="v">Deftypes</span> and its component type generators are intended to 
implement the type discipline described in the <a href="ACL2____FTY.html">fty</a> topic.  In 
particular, this means:</p> 
<ul> 
<li>the type predicates generated by any of these events each have an 
associated fixing function and equivalence relation, and these associations 
are recorded using a <a href="FTY____DEFFIXTYPE.html">deffixtype</a> event</li> 
<li>accessors and constructors of the sum and product types unconditionally 
return values of the appropriate type</li> 
<li>accessors and constructors have equality congruences based on the types of 
their arguments.</li> 
</ul> 
 
<p>To support these nice properties, all the component types (the fields of 
products, elements of lists, keys and values of alists) are required to also 
have an associated fixing function and equivalence relation, either produced by 
a <span class="v">deftypes</span> compatible type generator or recorded by a <a href="FTY____DEFFIXTYPE.html">deffixtype</a> 
event.  (They may also be untyped.)  The "preparation" forms in the example 
above show how this can be done.  Also see <a href="FTY____BASETYPES.html">basetypes</a> for some base types 
with fixing functions.</p>
</body>
</html>
