<html>
<head>
<meta charset="UTF-8">
<title>Set-check-invariant-risk</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____SET-CHECK-INVARIANT-RISK">Click for Set-check-invariant-risk in the Full Manual</a></h3>

<p>Affect certain <a href="ACL2____PROGRAM.html">program</a>-mode updates to <a href="ACL2____STOBJ.html">stobj</a>s or <a href="ACL2____ARRAYS.html">arrays</a></p><p>See <a href="ACL2____INVARIANT-RISK.html">invariant-risk</a> for an introduction to the notion of 
 invariant-risk.  Also see <a href="ACL2____SET-REGISTER-INVARIANT-RISK.html">set-register-invariant-risk</a> for a way to 
 avoid marking a specific set of functions as having invariant-risk, which can 
 be much safer than avoiding invariant-risk checking for all functions at 
 runtime as described below.</p> 
 
 <p>Briefly put, if a syntactic analysis suggests that the call of a 
 <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span>-mode function can lead to an ill-guarded call of a <a href="ACL2____STOBJ.html">stobj</a> updater or of <span class="tt"><a href="ACL2____ASET1.html">aset1</a></span> or <span class="tt"><a href="ACL2____ASET2.html">aset2</a></span>, then ACL2 considers such 
 a call to be an ``invariant-risk call''.  There are four different ways that 
 ACL2 can handle such a call, corresponding to four different values of the 
 ``invariant-risk mode'', which is the value obtained by evaluating 
 <span class="v">(<a href="ACL2____GET-CHECK-INVARIANT-RISK.html">get-check-invariant-risk</a> state)</span>.  The default invariant-risk mode is 
 <span class="v">:WARNING</span>: in that mode, ACL2 prints a warning when encountering a topmost 
 invariant-risk call and uses a slower mode of execution in order to avoid 
 ill-guarded calls as discussed above.  Mode <span class="v">T</span> has the same behavior, but 
 without the warning.  Mode <span class="v">:ERROR</span> causes a break when encountering a 
 topmost invariant-risk call; the Lisp should give you the option of 
 continuing (as though the mode were <span class="v">T</span>) or aborting, as you choose. 
 Finally, mode <span class="v">NIL</span> — which is unsafe and hence involves a trust 
 tag (see <a href="ACL2____DEFTTAG.html">defttag</a>), as discussed below — avoids any special 
 treatment for invariant-risk calls.</p> 
 
 <p>The utility, <span class="v">set-check-invariant-risk</span>, is provided for changing 
 invariant-risk mode.  The simplest case is when that utility is only called 
 with one argument, in which case, that argument becomes the new invariant-risk 
 mode, as follows.</p> 
 
 <pre class="code">(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :ERROR)   ; new mode is :ERROR
(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :WARNING) ; new mode is :WARNING (<a href="COMMON-LISP____THE.html">the</a> default)
(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> T)        ; new mode is T
(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> NIL)      ; new mode is NIL</pre> 
 
 <p>The argument is evaluated (to itself when given one of the four constants 
 shown above).  There must be an active trust tag in order to set the 
 invariant-risk mode to <span class="v">NIL</span>.  However, ACL2 arranges automatically to 
 create a temporary trust tag when invoking <span class="v">set-check-invariant-risk</span> on an 
 expression that is other than one of the symbols <span class="v">:ERROR</span>, <span class="v">:WARNING</span>, 
 or <span class="v">T</span>.</p> 
 
 <p>An environment variable, <span class="v">ACL2_CHECK_INVARIANT_RISK</span>, provides a 
 convenient way to evaluate one of these forms automatically when ACL2 is 
 invoked.  When that environment variable has a value other than the empty 
 string, the value is converted to a symbol after converting to upper-case with 
 the function <span class="tt"><a href="COMMON-LISP____STRING-UPCASE.html">string-upcase</a></span>, and then corresponding call is make 
 automatically (after loading the <a href="ACL2____ACL2-CUSTOMIZATION.html">ACL2-customization</a> file, if any).</p> 
 
 <pre class="code">"error", ":error" ==&gt; (<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :ERROR)
"warning", ":warning" ==&gt; (<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :WARNING)
"t" ==&gt; (<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> T)
"nil" ==&gt; (<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> NIL)</pre> 
 
 <p>Whether by direct user evaluation or environment variable, these calls 
 simply set a certain global parameter, <span class="v">'check-invariant-risk</span> 
 (technically, a <a href="ACL2____STATE.html">state</a> global variable).  However, they are not embedded 
 event forms (see <a href="ACL2____EMBEDDED-EVENT-FORM.html">embedded-event-form</a>: they cannot appear at the top 
 level of books, <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> <a href="ACL2____EVENTS.html">events</a>, or <span class="tt"><a href="COMMON-LISP____PROGN.html">progn</a></span> events.  A 
 non-nil second (optional) argument causes an <span class="tt"><a href="ACL2____ACL2-DEFAULTS-TABLE.html">ACL2-defaults-table</a></span> entry 
 to be made, associating the key <span class="v">:check-invariant-risk</span> with the 
 invariant-risk mode.  Thus, the following forms are embedded event forms. 
 Notice the new ``mode'', <span class="v">:CLEAR</span>, which behaves as though removing the key 
 <span class="v">:check-invariant-risk</span> from the <span class="tt"><a href="ACL2____ACL2-DEFAULTS-TABLE.html">ACL2-defaults-table</a></span>.</p> 
 
 <pre class="code">(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :ERROR   t)
(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :WARNING t)
(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> t        t)
(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> NIL      t)
(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :CLEAR t) ; avoid using table to determine mode</pre> 
 
 <p>As before, the value <span class="v">NIL</span> requires an active trust tag; but unlike 
 before, ACL2 does not create a temporary trust tag, but instead expect the 
 user to have created one already.  Note also that changes to the 
 <span class="v">acl2-defaults-table</span> are automatically local to a book or <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> event in which they occur; <span class="tt"><a href="ACL2____ACL2-DEFAULTS-TABLE.html">ACL2-defaults-table</a></span>. 
 Therefore, do not surround the forms just above with <span class="tt"><a href="ACL2____LOCAL.html">local</a></span>.</p> 
 
 <p>When the <span class="tt"><a href="ACL2____ACL2-DEFAULTS-TABLE.html">ACL2-defaults-table</a></span> associates the key 
 <span class="v">:check-invariant-risk</span> with any value (as in the calls above) other than 
 <span class="v">:CLEAR</span>, then the invariant-risk mode is actually the ``minimum'' of that 
 value and the value of the global parameter, <span class="v">'check-invariant-risk</span>, where 
 the modes are ordered from greatest to least as shown in the displays above. 
 An <a href="ACL2____OBSERVATION.html">observation</a> is printed when the new mode does not change: for 
 example, if you start your ACL2 session by evaluating 
 <span class="v">(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :ERROR t)</span>, then the invariant-risk mode will be 
 the minimum of the existing (default) value of <span class="v">:WARNING</span> and the proposed 
 value (newly stored in the <span class="v">acl2-defaults-table</span> of <span class="v">:ERROR</span>; that 
 minimum is <span class="v">:WARNING</span>, so the mode will remain <span class="v">:WARNING</span> and an <a href="ACL2____OBSERVATION.html">observation</a> will be printed to that effect.  You can see all the relevant 
 mode values as follows.</p> 
 
 <pre class="code">; current invariant-risk mode (:WARNING by default):
(<a href="ACL2____GET-CHECK-INVARIANT-RISK.html">get-check-invariant-risk</a> state)

; invariant-risk mode stored in global parameter 'check-invariant-risk:
(<a href="ACL2_____04.html">@</a> check-invariant-risk)

; invariant-risk mode stored in the acl2-defaults-table:
(<a href="ACL2____TABLE.html">table</a> acl2-defaults-table :check-invariant-risk)</pre> 
 
 <p>The following log illustrates the interaction of the two ways of setting 
 the invariant-risk mode (state global and table).</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :error t)

ACL2 Observation in SET-CHECK-INVARIANT-RISK:  No change is being made
in the value computed by (<a href="ACL2____GET-CHECK-INVARIANT-RISK.html">GET-CHECK-INVARIANT-RISK</a> STATE).  This happens
when the value of state global 'check-invariant-risk is less than the
new table value; see :DOC set-check-invariant-risk.
 :ERROR
ACL2 !&gt;(<a href="ACL2____GET-CHECK-INVARIANT-RISK.html">get-check-invariant-risk</a> state)
:WARNING
ACL2 !&gt;(<a href="ACL2_____04.html">@</a> check-invariant-risk)
:WARNING
ACL2 !&gt;(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :error)
 :ERROR
ACL2 !&gt;(<a href="ACL2_____04.html">@</a> check-invariant-risk)
:ERROR
ACL2 !&gt;(<a href="ACL2____GET-CHECK-INVARIANT-RISK.html">get-check-invariant-risk</a> state)
:ERROR
ACL2 !&gt;(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> t t)
 T
ACL2 !&gt;(<a href="ACL2____GET-CHECK-INVARIANT-RISK.html">get-check-invariant-risk</a> state)
T
ACL2 !&gt;(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :warning)

ACL2 Observation in SET-CHECK-INVARIANT-RISK:  No change is being made
in the value computed by (<a href="ACL2____GET-CHECK-INVARIANT-RISK.html">GET-CHECK-INVARIANT-RISK</a> STATE), because
the new value of state global 'check-invariant-risk is greater than
the table value; see :DOC set-check-invariant-risk.
 :WARNING
ACL2 !&gt;(<a href="ACL2____GET-CHECK-INVARIANT-RISK.html">get-check-invariant-risk</a> state)
T
ACL2 !&gt;(<a href="ACL2____SET-CHECK-INVARIANT-RISK.html">set-check-invariant-risk</a> :clear t)
 :CLEAR
ACL2 !&gt;(<a href="ACL2____GET-CHECK-INVARIANT-RISK.html">get-check-invariant-risk</a> state)
:WARNING
ACL2 !&gt;</pre> 
 
 <p>Note that the handling of an invariant-risk call of a function, <span class="v">f</span>, 
 depends on the current invariant-risk mode, not on the mode in place when 
 <span class="v">f</span> was defined.</p> 
 
 <p>It might not be obvious how a given function call could lead to an 
 ill-guarded call of a <a href="ACL2____STOBJ.html">stobj</a> updater or of a primitive with 
 invariant-risk such as <a href="ACL2____AREF1.html">aref1</a>.  It should be reasonably straightforward 
 to write a utility that provides this information; contact the ACL2 
 implementors if you want assistance in writing such a utility.</p>
</body>
</html>
