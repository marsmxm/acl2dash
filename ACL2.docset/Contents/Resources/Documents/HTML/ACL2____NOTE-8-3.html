<html>
<head>
<meta charset="UTF-8">
<title>Note-8-3</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____NOTE-8-3">Click for Note-8-3 in the Full Manual</a></h3>

<p>ACL2 Version  8.3 (April, 2020) Notes</p><p>NOTE!  New users can ignore these release notes, because the <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> has been updated to reflect all changes that are recorded 
 here.</p> 
 
 <p>Below we roughly organize the changes to ACL2 since Version 8.2 into the 
 following categories of changes: existing features, new features, heuristic 
 and efficiency improvements, bug fixes, changes at the system level, Emacs 
 support, and experimental versions.  Each change is described in just one 
 category, though of course many changes could be placed in more than one 
 category.</p> 
 
 <p>Note that only ACL2 system changes are listed below.  See also <a href="ACL2____NOTE-8-3-BOOKS.html">note-8-3-books</a> for a summary of changes made to the ACL2 Community Books 
 since ACL2 8.2, including the build system.  Also note that with each release, 
 it is typical that the value of constant <span class="tt"><a href="ACL2_____A2ACL2-EXPORTS_A2.html">*ACL2-exports*</a></span> has been 
 extended, and that some built-in functions that were formerly in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode are now <a href="ACL2____GUARD.html">guard</a>-verified <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode 
 functions.</p> 
 
 <h3>Changes to Existing Features</h3> 
 
 <p>It is now permitted for an evaluator to be ancestral in a metafunction or 
 clause-processor.  See <a href="ACL2____EVALUATOR-RESTRICTIONS.html">evaluator-restrictions</a>, or see the source code 
 comment ``Essay on Correctness of Meta Reasoning'', for discussion of the 
 remaining restrictions.  Thanks to Sol Swords for requesting this improvement 
 and for many helpful discussions.  Moreover, he found a bug in a proof in the 
 above Essay, which has been been fixed; he made a key observation that led to 
 completion of that fix.  Also thanks to Rob Sumners for helpful 
 discussions.</p> 
 
 <p>The <a href="ACL2____ACCUMULATED-PERSISTENCE.html">accumulated-persistence</a> utility no longer overcounts accumulated 
 frames due to nested (recursive) rule applications.  Although that shortcoming 
 was documented, it was unfortunate and we thank Sol Swords for an email that 
 nudged us into making this improvement and provided helpful insight, and Eric 
 Smith for suggesting this improvement more than 10 years ago (!).</p> 
 
 <p>In a (new-style) signature, any symbol whose <span class="tt"><a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a></span> is 
 <span class="v">"*"</span> now designates a non-<a href="ACL2____STOBJ.html">stobj</a> argument.  Formerly, only the 
 symbol <span class="v">*</span> in the <span class="v">"ACL2"</span> package could be used in that way.  Thanks 
 to Jared Davis for suggesting (in 2007!) that we consider such a change.</p> 
 
 <p>More functions can now be given <a href="ACL2____WARRANT.html">warrant</a>s.  In particular: the 
 requirement of a natural number measure for recursive definitions has been 
 relaxed to allow lexicographic combinations of natural numbers as defined by 
 the <span class="v">llist</span> function in the Community Books at <span class="v">books/ordinals/</span>, and it 
 is possible to warrant some functions that use local <a href="ACL2____STOBJ.html">stobj</a>s as long as 
 they don't call <span class="tt"><a href="ACL2____APPLY_42.html">apply$</a></span>.  See <a href="ACL2____DEFWARRANT.html">defwarrant</a>.</p> 
 
 <p>The function <span class="tt"><a href="ACL2____SYMBOL-NAME-LST.html">symbol-name-lst</a></span> is now a <a href="ACL2____GUARD.html">guard</a>-verified <a href="ACL2____LOGIC.html">logic</a>-mode function (formerly it was a <a href="ACL2____PROGRAM.html">program</a>-mode function).  Thanks 
 to Alessandro Coglio for suggesting that it might be good to document this 
 function, which led us to this change (and to its being documented).</p> 
 
 <p>The pattern language for the macro, <span class="tt"><a href="ACL2____CASE-MATCH.html">case-match</a></span>, now includes the 
 case <span class="v">(quote~ sym)</span>, where <span class="v">sym</span> is a symbol and this case matches any 
 symbol whose <span class="tt"><a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a></span> is <span class="v">(<a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a> sym)</span>.</p> 
 
 <p>The following symbols, when used in special syntactic roles in the macro 
 <span class="tt"><a href="ACL2____LOOP_42.html">loop$</a></span>, may be in any package: <span class="v">for</span>, <span class="v">in</span>, <span class="v">on</span>, <span class="v">from</span>, 
 <span class="v">to</span>, <span class="v">by</span>, <span class="v">of-type</span>, <span class="v">when</span>, <span class="v">until</span>, <span class="v">sum</span>, <span class="v">collect</span>, 
 <span class="v">always</span>, <span class="v">thereis</span>, and <span class="v">append</span>.  Thanks to Mertcan Temel for 
 requesting this enhancement.</p> 
 
 <p><span class="v">:Expand</span> <a href="ACL2____HINTS.html">hints</a> now act more reliably for <a href="ACL2____EQUALITY-VARIANTS.html">equality-variants</a>, by expanding away <a href="ACL2____GUARD-HOLDERS.html">guard-holders</a>.  Thanks to Sol 
 Swords for supplying this enhancement and sending the following example that 
 works now but formerly failed:</p> 
 
 <pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> member-of-cons
  (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____MEMBER.html">member</a> x (<a href="COMMON-LISP____CONS.html">cons</a> x y)) (<a href="COMMON-LISP____CONS.html">cons</a> x y))
  :hints(("Goal" :in-theory (<a href="ACL2____DISABLE.html">disable</a> member)
          :expand ((<a href="COMMON-LISP____MEMBER.html">member</a> x (<a href="COMMON-LISP____CONS.html">cons</a> x y))))))</pre> 
 
 <p>An analogous improvement has been made for <span class="v">:by</span>, <span class="v">:use</span>, and 
 <span class="v">:hands-off</span> hints.</p> 
 
 <p>The macros <span class="tt"><a href="ACL2____DEFEQUIV.html">defequiv</a></span>, <span class="tt"><a href="ACL2____DEFREFINEMENT.html">defrefinement</a></span>, and <span class="tt"><a href="ACL2____DEFCONG.html">defcong</a></span> now 
 conform to the following principle discussed in a new <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> 
 topic, <a href="ACL2____PACKAGES-FOR-GENERATED-SYMBOLS.html">packages-for-generated-symbols</a>: ideally, utilities generate 
 symbols in the <span class="tt"><a href="ACL2____CURRENT-PACKAGE.html">current-package</a></span>, at least by default.  These three 
 macros now have a <span class="v">:package</span> keyword argument whose default value is 
 <span class="v">:current</span>; with this value the macros conform to the above principle.  See 
 their <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> topics.  To get the previous behavior, use the 
 <span class="v">:legacy</span> value.  (Another way to deal with failures caused by this change 
 may be to fix packages when referring to generated symbols, such as changing 
 <span class="v">acl2::x-equiv</span> to <span class="v">x-equiv</span>.)  In particular, the <span class="v">:legacy</span> option 
 was used to update definitions in the <a href="ACL2____COMMUNITY-BOOKS.html">community-books</a> for macros that 
 generate <span class="tt"><a href="ACL2____DEFCONG.html">defcong</a></span> forms.  Also, all three macros now do some 
 error-checking (rather than leaving that entirely to the generated <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> form), and the unsupported <span class="v">:doc</span> keyword argument has been removed 
 from these macros.  Thanks to Pete Manolios for suggesting all of these 
 changes, and for providing not only implementations but also modifications to 
 the <a href="ACL2____COMMUNITY-BOOKS.html">community-books</a>.</p> 
 
 <p>The translation of a term <span class="v">(<a href="COMMON-LISP____AND.html">and</a> t u0)</span> is <span class="v">(<a href="COMMON-LISP____IF.html">if</a> 't u1 'nil)</span>, where 
 <span class="v">u1</span> is the translation of <span class="v">u0</span>.  That term, <span class="v">(<a href="COMMON-LISP____IF.html">if</a> 't u1 'nil)</span>, is 
 now generally displayed to the user (``<a href="ACL2____UNTRANSLATE.html">untranslate</a>d'') as <span class="v">(<a href="COMMON-LISP____AND.html">and</a> t
 u0)</span>, but formerly it was displayed as <span class="v">u0</span>, which could be confusing. 
 Thanks to Stephen Westfold, who sent an example showing how, when using the 
 <a href="ACL2____PROOF-BUILDER.html">proof-builder</a>'s <span class="v">REWRITE</span> command to replace a subterm <span class="v">a0</span> by 
 <span class="v">t</span> in a term <span class="v">(<a href="COMMON-LISP____AND.html">and</a> a b)</span> could lead to confusion, since the resulting 
 <span class="v">(<a href="COMMON-LISP____AND.html">and</a> t b)</span> was printed only as <span class="v">b</span>.  Note:  For Boolean contexts, the 
 analogous change was also made for terms <span class="v">(<a href="COMMON-LISP____AND.html">and</a> u0 t)</span>.</p> 
 
 <p>It no longer causes an error to call <span class="tt"><a href="ACL2____TRANS-EVAL.html">trans-eval</a></span> on an expression 
 that references a locally-bound <span class="tt"><a href="ACL2____STOBJ.html">stobj</a></span>, that is, one bound by <span class="tt"><a href="ACL2____WITH-LOCAL-STOBJ.html">with-local-stobj</a></span> or <span class="tt"><a href="ACL2____STOBJ-LET.html">stobj-let</a></span>.  The user is responsible for 
 understanding that when calling <span class="v">trans-eval</span>, all stobj variables in the 
 supplied expression refer to globally-bound stobjs, that is, stobjs stored in 
 the <span class="v">user-stobj-alist</span> field of the ACL2 <span class="tt"><a href="ACL2____STATE.html">state</a></span>.  See the new 
 documentation topic, <a href="ACL2____TRANS-EVAL-AND-LOCALLY-BOUND-STOBJS.html">trans-eval-and-locally-bound-stobjs</a>, for relevant 
 discussion.  (Another topic, <a href="ACL2____USER-STOBJS-MODIFIED-WARNINGS.html">user-stobjs-modified-warnings</a>, may also be 
 helpful for understanding the interaction of <span class="v">trans-eval</span> with stobjs.) 
 Thanks to Sol Swords for suggesting this change and convincing us of its 
 suitability.</p> 
 
 <p>The <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span> event now supports <a href="ACL2____STOBJ.html">stobj</a>s with fields that are 
 hash tables in raw Lisp but are represented logically as association lists. 
 Thanks to Sol Swords for providing not only the design but also the 
 implementation, which was moved from community book 
 <span class="v">books/add-ons/hash-stobjs.lisp</span> into the ACL2 sources (with small 
 modifications to both the new code and existing code).  That book still 
 provides lemmas that may be helpful for reasoning about hash-table fields, as 
 well as some tests.  See also <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span>.</p> 
 
 <p>Added suitable <a href="ACL2____GUARD.html">guard</a>s, with custom error messages, to <span class="tt"><a href="ACL2____ADD-INVISIBLE-FNS.html">add-invisible-fns</a></span> and to <span class="tt"><a href="ACL2____REMOVE-INVISIBLE-FNS.html">remove-invisible-fns</a></span>.  Also removed 
 confusing messages for each in the case of redundancy.  Thanks to Pete 
 Manolios for pointing us to a bug in the documentation for the latter (which 
 we have fixed), which led us to the addition of guards.</p> 
 
 <p>The notion of <i>untouchable</i> macro is no longer directly supported. 
 Specifically: the form <span class="v">(<a href="ACL2____PUSH-UNTOUCHABLE.html">push-untouchable</a> SYM t)</span> is now illegal if 
 <span class="v">SYM</span> is already the name of a macro; and after this call of <span class="tt"><a href="ACL2____PUSH-UNTOUCHABLE.html">push-untouchable</a></span> it is illegal to define <span class="v">SYM</span> as a macro.  However, a 
 macro can be made effectively untouchable by defining it with the new utility, 
 <span class="tt"><a href="ACL2____DEFMACRO-UNTOUCHABLE.html">defmacro-untouchable</a></span>.  Note that the alleged support for untouchable 
 macros was already incomplete, as explained in an example in the form 
 <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-8-3 ...)</span> in <a href="ACL2____COMMUNITY-BOOK.html">community-book</a> 
 <span class="v">books/system/doc/acl2-doc.lisp</span>.</p> 
 
 <p>The <a href="ACL2____EVENT.html">event</a> macro, <span class="tt"><a href="ACL2____THM.html">thm</a></span>, is now treated like <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> in 
 the following way: if keyword <span class="v">:hints</span> is supplied, then the hints are 
 checked syntactically when skipping proofs (see <a href="ACL2____LD-SKIP-PROOFSP.html">ld-skip-proofsp</a>) except 
 during <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> or the second pass of <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span>.  For 
 example, evaluation of the form <span class="v">(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> x x) :hints bad-hints)</span> now 
 causes an error after evaluating <span class="v">(<a href="ACL2____SET-LD-SKIP-PROOFSP.html">set-ld-skip-proofsp</a> t state)</span>, while 
 before this change, it did not.</p> 
 
 <p>The default slow-alist-action (see <a href="ACL2____SLOW-ALIST-WARNING.html">slow-alist-warning</a>) is now 
 <span class="v">:break</span> instead of <span class="v">:warning</span> in ACL2.  (It remains <span class="v">:warning</span> in 
 ACL2(p); see <a href="ACL2____UNSUPPORTED-WATERFALL-PARALLELISM-FEATURES.html">unsupported-waterfall-parallelism-features</a>.)</p> 
 
 <p>For a user-defined <span class="v">:</span><span class="tt"><a href="ACL2____INDUCTION.html">induction</a></span> rule to be applied, it is no 
 longer required for the induction scheme associated with a recursive 
 definition to be enabled.  For an example of the effect of this change, see 
 the <a href="ACL2____COMMUNITY-BOOK.html">community-book</a>, 
 <span class="v">books/system/tests/induction-rule-with-disabled-scheme.lisp</span>.  Thanks to 
 Pete Manolios for reporting this issue, including the sending of the events in 
 that book.  Also see <a href="ACL2____INDUCTION.html">induction</a> (as that documentation has been 
 updated).</p> 
 
 <p>An undocumented kind of <a href="ACL2____FAKE-RUNE.html">fake-rune</a> is no longer reported by <span class="tt"><a href="ACL2____SHOW-ACCUMULATED-PERSISTENCE.html">show-accumulated-persistence</a></span>.  Thanks to Eric Smith for bringing this issue 
 to our attention.</p> 
 
 <p>The algorithm for removing <a href="ACL2____GUARD-HOLDERS.html">guard-holders</a> has been modified to avoid 
 diving into calls of <span class="tt"><a href="ACL2____HIDE.html">hide</a></span>.  However, it is possible to obtain the 
 former behavior; see <a href="ACL2____GUARD-HOLDERS.html">guard-holders</a>.</p> 
 
 <p>Since its earliest years, ACL2 uses evaluation to simplify ground 
 terms (terms with no free variables).  ACL2 would sometimes generate a call of 
 <span class="tt"><a href="ACL2____HIDE.html">hide</a></span> around a term that fails to evaluate because of an attempt to 
 call a constrained function.  Now, that call incorporates a comment saying 
 which constrained function is responsible for the failure.  See <a href="ACL2____COMMENT.html">comment</a>.  Also see <a href="ACL2____HIDE.html">hide</a> for how to fix proof failures caused by this 
 new behavior by using <span class="v">:expand</span> <a href="ACL2____HINTS.html">hints</a> or even by turning off this 
 new behavior using <span class="tt"><a href="ACL2____DEFATTACH.html">defattach</a></span>.  Thanks to Rob Sumners (in 2003), 
 Francisco J. Martin-Mateos (in 2004), and Anna Slobodova (in 2005), perhaps 
 among others, for discussions leading to this enhancement.</p> 
 
 <p>Both <span class="v">:</span><span class="tt"><a href="ACL2____PUFF.html">puff</a></span> and <span class="v">:</span><span class="tt"><a href="ACL2____PUFF_A2.html">puff*</a></span> have been made more 
 robust.  Related changes include:</p> 
 
 <ul> 
 
 <li>A new table, <span class="v">puff-included-books</span>, generally prevents the same book 
 from being puffed more than once.</li> 
 
 <li>Book directories are tracked more carefully, which can prevent 
 errors.</li> 
 
 <li>We no longer allow <span class="v">:puff*</span> to puff non-trivial <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> 
 events.  (For a technical discussion of reasons for this change, see comments 
 in function <span class="v">puffed-command-sequence</span> in ACL2 source file 
 <span class="v">ld.lisp</span>.)</li> 
 
 <li>Changes to the <span class="tt"><a href="ACL2____ACL2-DEFAULTS-TABLE.html">ACL2-defaults-table</a></span> no longer persist outside the 
 scope of a puffed <span class="v">encapsulate</span> event.</li> 
 
 <li>A <span class="tt"><a href="ACL2____THEORY-INVARIANT.html">theory-invariant</a></span> event no longer 
 stores the event <span class="v">(<a href="ACL2____IN-THEORY.html">in-theory</a> (<a href="ACL2____CURRENT-THEORY.html">current-theory</a> :here))</span> in 
 the <a href="ACL2____WORLD.html">world</a>.</li> 
 
 </ul> 
 
 <h3>New Features</h3> 
 
 <p>A new <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> keyword, <span class="v">:guard-simplify</span> (default <span class="v">t</span>), 
 controls certain simplifications that may be applied to the guard conjecture 
 while generating the initial goal.  Setting it to <span class="v">nil</span> skips all 
 simplifications that depend on the set of currently <a href="ACL2____ENABLE.html">enable</a>d rules.  See 
 <a href="ACL2____VERIFY-GUARDS.html">verify-guards</a>.  Thanks to Sol Swords for designing this feature and 
 providing its implementation, along with documentation and corresponding 
 adjustments to the community books.</p> 
 
 <p>Now <span class="tt"><a href="ACL2____DEFSTUB.html">defstub</a></span> accepts the same keywords as <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span>, both 
 for the new-style signatures and for the old-style signatures.  Thanks to 
 Alessandro Coglio for suggesting and implementing this enhancement.</p> 
 
 <p>New function <span class="v">(<a href="ACL2____MAYBE-FLUSH-AND-COMPRESS1.html">maybe-flush-and-compress1</a> name ar)</span> calls 
 <span class="v">(<a href="ACL2____FLUSH-COMPRESS.html">flush-compress</a> name)</span> and then returns <span class="v">(<a href="ACL2____COMPRESS1.html">compress1</a> name ar)</span>, except 
 that all this is skipped if the given array is already compressed.</p> 
 
 <p>A new utility, <span class="tt"><a href="ACL2____SWAP-STOBJS.html">swap-stobjs</a></span>, does what its name suggests: it swaps 
 <a href="ACL2____STOBJ.html">stobj</a>s.  Thus, if <span class="v">st1</span> and <span class="v">st2</span> are stobjs then after returning 
 from execution of a call <span class="v">(<a href="ACL2____SWAP-STOBJS.html">swap-stobjs</a> st1 st2)</span> of <span class="v">swap-stobjs</span>, the 
 global value of stobj <span class="v">st1</span> will be the old value of <span class="v">st2</span> and the 
 global value of stobj <span class="v">st2</span> will be the old value of <span class="v">st1</span>.  See <a href="ACL2____SWAP-STOBJS.html">swap-stobjs</a>.  Thanks to Sol Swords for requesting this feature and for 
 helpful discussions about it.</p> 
 
 <p>By invoking <span class="v">(<a href="ACL2____SET-ABSSTOBJ-DEBUG.html">set-absstobj-debug</a> :ignore)</span>, which requires an active 
 trust tag (see <a href="ACL2____DEFTTAG.html">defttag</a>), one can defeat invariance checks for abstract 
 stobj fields that otherwise are protected by specifying <span class="v">:protect t</span> (or by 
 using the <span class="v">:protect-default</span> keyword to get that effect).  See <a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a>.  Thanks to Sol Swords for suggesting consideration of adding 
 some such capability.  In a few preliminary tests we found an average drop of 
 about 3.5% in the time it took to run the tests.</p> 
 
 <p>It is now permitted to define functions in which recursive calls occur from 
 inside <span class="tt"><a href="ACL2____LOOP_42.html">loop$</a></span> statements.  See <span class="tt"><a href="ACL2____LOOP_42-RECURSION.html">loop$-recursion</a></span>.  Such functions 
 do not automatically suggest induction schemes.  Furthermore, care must be 
 taken when formulating inductively provable theorems about such functions. 
 See <a href="ACL2____LOOP_42-RECURSION-INDUCTION.html">loop$-recursion-induction</a> and <span class="tt"><a href="ACL2____DEFINDUCTOR.html">definductor</a></span>.</p> 
 
 <p>You can now change the second line in the startup banner for a GitHub 
 version of ACL2 obtained between releases.  See <a href="ACL2____STARTUP-BANNER.html">startup-banner</a>.  Thanks 
 to Andrew Walter for requesting this enhancement.</p> 
 
 <h3>Heuristic and Efficiency Improvements</h3> 
 
 <p>ACL2 keeps a complete list of all the runes in the tau database (see <a href="ACL2____INTRODUCTION-TO-THE-TAU-SYSTEM.html">introduction-to-the-tau-system</a>).  Formerly this list was duplicate-free, but 
 that is no longer the case.  As a result we have seen some faster performance; 
 in particular, this change has cut 17% from the time to include the community 
 book, <span class="v">"centaur/sv/top"</span>.</p> 
 
 <p>Made slight efficiency improvement for <a href="ACL2____TABLE.html">table</a> update (<span class="v">:put</span>) 
 events.</p> 
 
 <p>Improved efficiency of the maintenance of <a href="ACL2____STOBJ.html">stobj</a>-related arrays (the 
 so-called stobj accessor arrays) by using the new function, <span class="tt"><a href="ACL2____MAYBE-FLUSH-AND-COMPRESS1.html">maybe-flush-and-compress1</a></span>.  That code is related to printing stobj field 
 accesses using field names rather than indices.  (For background on printing 
 untranslated terms, see <a href="ACL2____TERM.html">term</a>.)  For example, after evaluating 
 the form <span class="v">(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st fld)</span>, the form</p> 
 
 <pre class="code">(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (fld st) xxx)
     :hints (("Goal" :in-theory (<a href="ACL2____DISABLE.html">disable</a> nth))))</pre> 
 
 <p>produces the (untranslated) goal <span class="v">(<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (<a href="COMMON-LISP____NTH.html">NTH</a> *FLD* ST) XXX)</span> rather 
 than <span class="v">(<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (<a href="COMMON-LISP____NTH.html">NTH</a> 0 ST) XXX)</span>.  A further change has been to reduce the 
 frequency of ensuring that those <a href="ACL2____ARRAYS.html">arrays</a> are up-to-date.  (Technical 
 note: this latter change is to source function <span class="v">update-wrld-structures</span>, 
 which has an explanatory comment, including an example of a 2.6% time 
 reduction.)</p> 
 
 <p>Improved the speed of <a href="ACL2____THEORY.html">theory</a> updates by avoiding repeated length 
 computations.  As a result, we have seen about a 5% time reduction on MacOS, 
 and between 3% and 4% on Linux, for executing the form, <span class="v">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a>
 "centaur/sv/top" :dir :system)</span>.</p> 
 
 <p>The definition of the macro <span class="tt"><a href="ACL2____EC-CALL.html">ec-call</a></span> has been tweaked to speed up 
 compilation in some cases when the host Lisp is SBCL.  In particular, for 
 admitting the definition of <span class="v">apply$-prim</span> in <a href="ACL2____COMMUNITY-BOOK.html">community-book</a> 
 <span class="v">books/projects/apply-model-2/apply-prim.lisp</span> with host Lisp SBCL, we have 
 seen the time decrease from 1294.33 seconds to 8 seconds.</p> 
 
 <p>A heuristic for ``lazy'' rewriting of calls of <span class="v">mv-nth</span> has been made 
 much more efficient in some cases.  Thanks to Sol Swords for investigating 
 performance issues leading him to implement such a change, and for making 
 modifications to <a href="ACL2____COMMUNITY-BOOKS.html">community-books</a> so that they continue to certify after 
 the change.  Those interested in implementation details may start with source 
 function <span class="v">simplifiable-mv-nth1</span>.</p> 
 
 <p>The raw Lisp representation of <a href="ACL2____STOBJ.html">stobj</a>s has been improved to avoid 
 some indirection in two ways: a scalar field (one that is not an array or hash 
 table) with non-trivial type had been wrapped in a one-element array, but no 
 longer; and if there is only one field, and it is an array or hash table, then 
 that field is the entire stobj.  (The first change is however avoided when the 
 host Lisp is GCL.)  Thanks to Warren Hunt and Sol Swords for suggesting these 
 changes.  Technical note: in the course of making these changes, a bug was 
 exposed in source function <span class="v">raw-ev-fncall</span>; that has been fixed.</p> 
 
 <p>Reduced the computation and consing for <a href="ACL2____THEORY.html">theory</a> management, which 
 might reduce time by a percent or two when including some books.  (Technical 
 note.  The idea was to expand the cases in which the use of <span class="tt"><a href="ACL2____COMPRESS1.html">compress1</a></span> 
 is replaced by more efficient code.  That code is specific to enabled 
 structures and may be found in ACL2 source function 
 <span class="v">update-enabled-structure-array</span>.  We also arranged, in 
 <span class="v">load-theory-into-enabled-structure</span>, to double the array size when that 
 exceeds the expansion by a minimal suitable multiple of 500.)</p> 
 
 <p>Changed how <a href="ACL2____COMPOUND-RECOGNIZER.html">compound-recognizer</a> rules are stored in the logical 
 <a href="ACL2____WORLD.html">world</a> (per function symbol, rather than in a single alist), which a few 
 experiments suggest might reduce time by a couple percent or so.</p> 
 
 <p>A tweak was made to how properties are ordered when stored in the ACL2 
 logical <a href="ACL2____WORLD.html">world</a>, which experiments show provides small speed-ups. 
 (Technical note: the change is to constant 
 <span class="v">*current-acl2-world-key-ordering*</span>, and also, functions <span class="tt"><a href="ACL2____SYMBOL-CLASS.html">symbol-class</a></span> and <span class="tt"><a href="ACL2____LOGICP.html">logicp</a></span> avoid calling <span class="tt"><a href="ACL2____GETPROP.html">getprop</a></span> for the symbol, 
 <span class="v">cons</span>.)</p> 
 
 <p>ACL2 now avoids <a href="ACL2____SUMMARY.html">summary</a> calculations during <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>. 
 We have seen this change cut more than 9% of the time for the event 
 <span class="v">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "centaur/sv/top" :dir :system)</span>.</p> 
 
 <p>We now avoid translation of <span class="tt"><a href="ACL2____DEFAULT-HINTS.html">default-hints</a></span> for termination proofs 
 during <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>.  We have seen this change cut more than 4% of the 
 time for the event <span class="v">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "centaur/sv/top" :dir :system)</span>.</p> 
 
 <p>ACL2 now saves, in <a href="ACL2____CERTIFICATE.html">certificate</a> files, the translated bodies of 
 <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> and <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> <a href="ACL2____EVENTS.html">events</a>.  (See <a href="ACL2____TERM.html">term</a> for a 
 discussion of translated terms.)  This can speed up <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>; for 
 example, we have measured approximately a 3% reduction in time for the event, 
 <span class="v">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "centaur/sv/top" :dir :system)</span>, but with a space 
 trade-off of about 41% more bytes allocated.  (Implementation note: the 
 relevant algorithms and code are discussed in an expanded version of the Essay 
 on Cert-data in the ACL2 source code.)  Thanks to Eric Smith for pointing out 
 a bug (which we then fixed) in a preliminary implementation of this 
 feature.</p> 
 
 <p>Some stack overflows may be avoided by a change to a built-in system 
 function, <span class="v">cons-count-bounded-ac</span>, so that it is now tail recursive as it 
 CDRs the list, rather than as it takes the CAR.  Thanks to Shilpi Goel for 
 reporting the problem with an example and to Sol Swords for suggesting this 
 fix.  That example exhibited a second stack overflow, due to a built-in 
 memoized system function that is no longer called when computing a call of the 
 built-in system function, <span class="v">pkg-names</span>.</p> 
 
 <p>The second pass of <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> now uses <a href="ACL2____FAST-ALISTS.html">fast-alists</a> when 
 calculating new triples in the logical <a href="ACL2____WORLD.html">world</a> (in ACL2 system function 
 <span class="v">new-trips</span>).  We have seen this change result in cutting the time by 4.7% 
 and the bytes allocated by 34% for including the community book, 
 <span class="v">"centaur/sv/top"</span>.</p> 
 
 <p>Computation of the <a href="ACL2____GUARD.html">guard</a> proof obligation has been sped up in some 
 cases involving evaluation of ground terms (terms without free variables). 
 Thanks to Warren Hunt for sending us an example that prompted us to make this 
 change.</p> 
 
 <h3>Bug Fixes</h3> 
 
 <p>As noted in the documentation for <a href="ACL2____LEMMA-INSTANCE.html">lemma-instance</a>, ACL2 may avoid 
 proving some constraints required for <a href="ACL2____FUNCTIONAL-INSTANTIATION.html">functional-instantiation</a> that 
 were previously proved.  There was such support even in the case that the 
 previous proof was done on behalf of a <span class="tt"><a href="ACL2____DEFATTACH.html">defattach</a></span> event, but that 
 support has been made more complete (by keeping more functional substitutions 
 in canonical form).</p> 
 
 <p>A hard Lisp error has been fixed that could occur (probably only rarely) 
 after adding rules of class <span class="v">:</span><span class="tt"><a href="ACL2____DEFINITION.html">definition</a></span> that introduce 
 recursion.</p> 
 
 <p>The function <span class="tt"><a href="ACL2____META-EXTRACT-FORMULA.html">meta-extract-formula</a></span> could return a non-trivial 
 value (i.e., not <span class="v">'T</span>) when applied to a <a href="ACL2____PROGRAM.html">program</a>-mode function.  We 
 thank Sol Swords for reporting this bug with a proof of <span class="v">nil</span> that 
 exploited it.  This soundness bug has been fixed.  That work led us to fix the 
 following related bugs (which could also be soundness bugs, though we have not 
 checked).  First, the function <span class="tt"><a href="ACL2____FNCALL-TERM.html">fncall-term</a></span> could similarly return a 
 non-trivial value when applied to a program-mode function.  Second, the 
 utility <span class="tt"><a href="ACL2____MFC-RW.html">mfc-rw</a></span>, as well as other such <span class="v">mfc-xx</span> utilities in support 
 of <a href="ACL2____EXTENDED-METAFUNCTIONS.html">extended-metafunctions</a> and <span class="tt"><a href="ACL2____META-EXTRACT-CONTEXTUAL-FACT.html">meta-extract-contextual-fact</a></span>, 
 could be called on terms containing program-mode function symbols.</p> 
 
 <p>Eliminated an error occurring when attempting to compute the guard proof 
 obligation for a constrained function, in particular, when using the 
 <span class="v">:</span><span class="tt"><a href="ACL2____GTHM.html">gthm</a></span> utility on such a function (also see <a href="ACL2____GUARD-THEOREM.html">guard-theorem</a>). 
 Thanks to Alessandro Coglio for pointing out this bug and for noting that 
 <span class="v">t</span> could be a reasonable result for the guard theorem in such cases.</p> 
 
 <p>Fixed ACL2 raw Lisp error caused by <a href="ACL2____ADD-DEFAULT-HINTS_12.html">add-default-hints!</a>.  Thanks to 
 Pete Manolios for debugging this problem.</p> 
 
 <p>Fixed a bug in the <a href="ACL2____PROOF-BUILDER.html">proof-builder</a> command <span class="v">apply-linear</span> (and its 
 abbreviation, <span class="v">al</span>), which was making it impossible to save an event after 
 an interactive session that includes such a command.  Thanks to Mihir Mehta 
 for bringing this bug to our attention and sending an example.</p> 
 
 <p>Fixed a bug in <span class="tt"><a href="ACL2____DEFUN-SK.html">defun-sk</a></span>, which was generating a <span class="tt"><a href="ACL2____VERIFY-GUARDS.html">verify-guards</a></span> or <span class="v">verify-guards?</span> event with <span class="v">:guard-hints</span> instead of 
 <span class="v">:hints</span>.  Thanks to Alessandro Coglio for reporting this bug and providing 
 the fix.</p> 
 
 <p>The use of <span class="v">:stack :pop</span> in the macro <span class="tt"><a href="ACL2____WITH-OUTPUT.html">with-output</a></span> failed to 
 restore <a href="ACL2____GAG-MODE.html">gag-mode</a> properly.  For example, the use of 
 <span class="v">(<a href="ACL2____WITH-OUTPUT.html">with-output</a> :stack :push :gag-mode nil (<a href="ACL2____WITH-OUTPUT.html">with-output</a> :stack :pop &lt;form&gt;))</span> 
 failed to run <span class="v">&lt;form&gt;</span> with the existing value for gag-mode (default: 
 <span class="v">:goals</span>).  Thanks to Mihir Mehta for a query that led us to make this 
 fix.  Technical note: state global <span class="v">inhibit-output-lst-stack</span> is now a list 
 of pairs <span class="v">(inhibit-output-lst . gag-mode)</span>; see <a href="ACL2____WITH-OUTPUT.html">with-output</a>.</p> 
 
 <p>The <a href="ACL2____PROOF-BUILDER.html">proof-builder</a>'s <span class="v">DV</span> command was broken for expressions of 
 the form <span class="v">(<a href="COMMON-LISP____IF.html">if</a> t term1 term2)</span>; for example, <span class="v">(<a href="ACL2____VERIFY.html">verify</a> (<a href="COMMON-LISP____IF.html">if</a> t x y))</span> 
 followed by <span class="v">1</span>, <span class="v">2</span>, or <span class="v">3</span> caused a raw Lisp error.  Thanks to 
 Stephen Westfold for bringing this bug to our attention and pointing out the 
 fix.</p> 
 
 <p>We fixed a bug in the implementation of <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> that could 
 cause a hard ACL2 error (``Unexpected expansion-alist ... for second pass of 
 encapsulate'').  Thanks to Pete Manolios for sending an example that exhibited 
 this bug.  (A slightly simplified version of his example may be found in 
 a comment in the definition of function <span class="v">encapsulate-pass-2</span>, ACL2 source 
 file <span class="v">other-events.lisp</span>.)</p> 
 
 <p><span class="tt"><a href="ACL2____DEFSTOBJ.html">Defstobj</a></span> now provides a suitable error message, instead of an 
 implementation error, when new names are duplicated after renaming.  Here are 
 examples that now have improved error messages.</p> 
 
 <pre class="code">(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st x :renaming ((create-st x)))
(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st fld :renaming ((fld create-st)))
(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st fld1 fld2 :renaming ((fld1 fld) (fld2 fld)))</pre> 
 
 <p>We fixed an obscure error message when attempting to <a href="ACL2____MEMOIZE.html">memoize</a> either 
 <span class="v">IF</span> or <span class="v">RETURN-LAST</span>, and we improved the <a href="ACL2____MEMOIZE.html">memoize</a> documentation 
 to mention these and other restrictions on what can be memoized.</p> 
 
 <p>Fixed erroneous <a href="COMMON-LISP____TYPE.html">type</a> declarations in array copying 
 functions.  (Technical notes.  (1) It's not clear that these bugs have ever 
 had any effect.  (2) Those source code functions have been renamed by dropping 
 their <span class="v">"stobj-"</span> prefixes from <span class="v">stobj-copy-array-xxx</span>, now that one of 
 them has application to other than stobjs, in new code mentioned above for 
 enabled structures.)</p> 
 
 <p>Fixed the process of translating the <a href="ACL2____TYPE-SPEC.html">type-spec</a>, <span class="v">standard-char</span>, 
 into a <a href="ACL2____TERM.html">term</a>.  For example, the following definition failed but now 
 succeeds:<br> <span class="v">(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x) (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____TYPE.html">type</a> standard-char x)) (<a href="COMMON-LISP____CONS.html">cons</a> 3
 x))</span>.</p> 
 
 <p>Fixed a bug that could cause the wrong <a href="ACL2____STOBJ.html">stobj</a> to be displayed by 
 <span class="tt"><a href="ACL2____PRINT-GV.html">print-gv</a></span>, when congruent stobjs with a single bit-array field are 
 involved.  See a comment in ACL2 source function 
 <span class="v">apply-user-stobj-alist-or-kwote</span> for an example of this bug.</p> 
 
 <p>When including a book that is uncertified because of a stale <a href="ACL2____CERTIFICATE.html">certificate</a> file, ACL2 was inappropriately using information about <a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a> rules (specifically, those computed by the system at 
 definition time) that was stored in that certificate.  This has been fixed, 
 thanks to a bug report from Eric Smith about a related feature mentioned 
 above, on saving translated bodies in certificate files.  Moreover, the 
 relevant system function, <span class="v">include-book-fn1</span>, has been modified to do a 
 better job of ignoring certificate files of uncertified books.</p> 
 
 <p>The utility <span class="v">set-saved-output</span> has been badly broken for years, but 
 without complaints (other than from one of us shortly before the release), 
 suggesting that it hasn't been directly called by users.  So we have 
 eliminated it.</p> 
 
 <h3>Changes at the System Level</h3> 
 
 <p>The makefile target <span class="v">certify-books</span> has been removed from 
 <span class="v">GNUmakefile</span> and <span class="v">books/GNUmakefile</span>.  It was deprecated in the 
 preceding release, where we thanked the acl2-books email list (in particular 
 we got feedback from Alessandro Coglio, Shilpi Goel, David Rager, Eric Smith, 
 and Sol Swords, all helpful) for working through this issue.</p> 
 
 <p>The keyword <span class="v">:ACL2</span> is now a member of the Lisp global, <span class="v">*features*</span>, 
 which allows other programs to use read-time conditionals <span class="v">#+acl2</span> / 
 <span class="v">#-acl2</span> to indicate the presence or absence of ACL2.  Thanks to Andrew 
 Walter for suggesting that this might be useful, for example for Quicklisp 
 code.</p> 
 
 <h3>EMACS Support</h3> 
 
 <p>The command `<span class="v">Ctl-t p</span>' now works in Emacs 25.</p> 
 
 <p>The <a href="ACL2____ACL2-DOC.html">ACL2-doc</a> browser for ACL2+books documentation can be extended 
 with a new command, <span class="v">U</span>, to open a URL (or in some cases, a file) in a 
 browser.  See file <span class="v">emacs/acl2-doc-open-url.el</span> for more information.</p> 
 
 <h3>Experimental Versions</h3> 
 
 
</body>
</html>
