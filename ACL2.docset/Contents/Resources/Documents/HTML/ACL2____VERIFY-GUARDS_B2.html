<html>
<head>
<meta charset="UTF-8">
<title>Verify-guards+</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____VERIFY-GUARDS_B2">Click for Verify-guards+ in the Full Manual</a></h3>

<p>Verify the <a href="ACL2____GUARD.html">guard</a>s of a function</p><p>We assume familiarity with <a href="ACL2____GUARD.html">guard</a> verification; see <a href="ACL2____VERIFY-GUARDS.html">verify-guards</a>.  Unlike <span class="v">verify-guards</span>, the macro call <span class="v">(<a href="ACL2____VERIFY-GUARDS_B2.html">verify-guards+</a>
 mac ...)</span> will verify guards for a function, <span class="v">fn</span>, such that the macro 
 <span class="v">mac</span> is associated with the function symbol <span class="v">fn</span> in <span class="tt"><a href="ACL2____MACRO-ALIASES-TABLE.html">macro-aliases-table</a></span> 
 (also see <a href="ACL2____ADD-MACRO-ALIAS.html">add-macro-alias</a>).  For example, if you define a macro 
 <span class="v">app</span> and list append function <span class="v">binary-app</span>, and you associate macro 
 <span class="v">app</span> with function symbol <span class="v">binary-app</span> in <span class="tt"><a href="ACL2____MACRO-ALIASES-TABLE.html">macro-aliases-table</a></span>, 
 then evaluation of the form <span class="v">(<a href="ACL2____VERIFY-GUARDS_B2.html">verify-guards+</a> app)</span> will have the effect of 
 evaluating <span class="v">(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> fn)</span>.  Note that in this setting, evaluation of 
 <span class="v">(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> app)</span> would cause an error, because <span class="v">app</span> is a macro and 
 <span class="v">verify-guards</span>, unlike <span class="v">verify-guards+</span>, cannot handle macros.</p> 
 
 <p>The rest of this <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> topic discusses why we do not simply 
 arrange that <span class="v">verify-guards</span> be permitted to take a macro alias.  The 
 following example shows a soundness issue in doing so.</p> 
 
 <pre class="code">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a>
 ()
 (<a href="COMMON-LISP____DEFUN.html">defun</a> f1 (x)
   (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____CONSP.html">consp</a> x)
                   :verify-guards nil))
   (<a href="COMMON-LISP____CAR.html">car</a> x))
 (<a href="COMMON-LISP____DEFUN.html">defun</a> f2 (x)
   (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t
                   :verify-guards nil))
   (<a href="COMMON-LISP____CDR.html">cdr</a> x))
 (<a href="COMMON-LISP____DEFMACRO.html">defmacro</a> mac (x)
   x)
 (<a href="ACL2____ADD-MACRO-ALIAS.html">add-macro-alias</a> mac f2) ; silly macro alias ;
 (<a href="ACL2____LOCAL.html">local</a> (<a href="ACL2____ADD-MACRO-ALIAS.html">add-macro-alias</a> mac f1)) ; alternate silly macro alias ;
 (<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> mac))</pre> 
 
 <p>If we were to allow macro aliases in <span class="tt"><a href="ACL2____VERIFY-GUARDS.html">verify-guards</a></span>, this event 
 would be admitted, because on the first pass we are verifying guards of 
 <span class="v">f1</span>.  But after the <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> form completes evaluation, it 
 would appear that <span class="v">f2</span> is guard-verified.  That could of course cause a raw 
 Lisp error.</p> 
 
 <p>The enhanced functionality provided by <span class="v">verify-guards+</span> does not have 
 the above problem, because it takes advantage of <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> to avoid 
 taking advantage of the contradictory results produced by the two calls of 
 <span class="v">add-macro-alias</span>.  See <a href="ACL2____MAKE-EVENT.html">make-event</a>.  If the specific example above 
 is modified by replacing <span class="v">verify-guards</span> with <span class="v">verify-guards+</span>, then the 
 first pass through the <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> form will expand the form 
 <span class="v">(<a href="ACL2____VERIFY-GUARDS_B2.html">verify-guards+</a> mac)</span> to <span class="v">(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> f1)</span>.  That same expansion 
 will be used for the <span class="v">verify-guards+</span> call during the second pass through 
 the <span class="v">encapsulate</span> form, which is evaluated successfully and leaves us in a 
 <a href="ACL2____WORLD.html">world</a> where <span class="v">f1</span> is guard-verified and <span class="v">f2</span> is not.</p>
</body>
</html>
