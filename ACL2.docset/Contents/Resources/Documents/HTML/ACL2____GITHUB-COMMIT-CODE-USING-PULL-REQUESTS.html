<html>
<head>
<meta charset="UTF-8">
<title>Github-commit-code-using-pull-requests</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____GITHUB-COMMIT-CODE-USING-PULL-REQUESTS">Click for Github-commit-code-using-pull-requests in the Full Manual</a></h3>

<p>How to commit code to the books using pull requests</p><p>This guide is written for contributors who will probably only 
 commit to the repository a few times a year. If you find yourself committing 
 more often, you should see <a href="ACL2____GITHUB-COMMIT-CODE-USING-PUSH.html">github-commit-code-using-push</a>.</p> 
 
 A nice result of using pull requests is that all changes will be peer-reviewed 
 before being committed.  Also, we sometimes call this method the <i>Fork and 
 Pull</i> method. 
 
 <h2>(A) GETTING STARTED</h2> 
 
 <ol> 
 
 <li>Go to <a href="https://github.com/acl2/acl2" target="_blank"><nobr>https://github.com/acl2/acl2<img src="../Icon_External_Link.png" title="External link to https://github.com/acl2/acl2"></nobr></a> and 
  click on the <span class="v">fork</span> button on the top-right.  Fork the repository into 
  your github space.  This will create a new repository at 
  <span class="v">https://github.com/&lt;your-github-username&gt;/acl2</span>.</li> 
 
 <li>In your working space on your computer, create a <span class="v">clone</span> of your github 
  repository and <span class="v">cd</span> into it: 
 
 <pre class="code">git clone https://github.com/&lt;your-github-username&gt;/acl2
cd acl2</pre>
</li> 
 
 <li>Add the Community ACL2 repository as a git remote: 
 
 <pre class="code">git remote add upstream https://github.com/acl2/acl2</pre>
</li> 
 
 </ol> 
 
 <h2>(B) UPDATING</h2> 
 
 <p>The following commands will update your local repository to match the latest 
 contents of the ACL2 Community github repository (on the web).</p> 
 
 <pre class="code">git fetch --all
git merge remotes/upstream/master</pre> 
 
 <h2>(C) CONTRIBUTING</h2> 
 
 <h3>Change and Test</h3> 
 
 <ol> 
 
 <li>Before beginning your edits, update, as in (B) above: 
 
 <pre class="code">git fetch --all
git merge remotes/upstream/master</pre>
</li> 
 
 <li>Build an executable. 
 
 <pre class="code">(time nice make LISP=&lt;your_lisp&gt;) &gt;&amp; make.log</pre>
</li> 
 
 <li>Make book changes.  If you are creating any new books, tell git that you 
 intend to add them (but the local repository on the web won't change until the 
 <span class="v">commit</span> step below is executed). 
 
 <pre class="code">git add file1 file2 ...</pre> 
 
 Also, consider adding some high-level information about your changes to the 
 Community Books' release notes — i.e., the appropriate <a href="ACL2____RELEASE-NOTES-BOOKS.html">release-notes-books</a> XDOC topic in <span class="v">books/doc/relnotes.lisp</span>.</li> 
 
 <li>Run a regression. 
 
 <pre class="code">(time nice make -j 8 regression-fresh) &gt;&amp; make-regression.log</pre> 
 
 Note that the <span class="v">-j 8</span> option specifies the use of 8 hardware threads; feel 
 free to omit it or use a more suitable number (especially if your computer has 
 other than 8 hardware threads). </li> 
 
 <li>Look for failures, as indicated by <span class="v">**</span> in the log. 
 
 <pre class="code">fgrep -a '**' make-regression.log</pre>
</li> 
 
 <li>If there were failures, then go back to Step 1 above to make appropriate 
 changes and re-test, but you can replace the '<span class="v">make</span>' step by replacing 
 <span class="v">regression-fresh</span> with <span class="v">regression</span>, since '<span class="v">make</span>' is clever enough 
 to avoid recertifying more than is necessary.  For example: 
 
 <pre class="code">(time nice make -j 8 regression) &gt;&amp; make-regression-finish-1.log</pre>
</li> 
 
 </ol> 
 
 <h3>Update, and Iterate If Necessary</h3> 
 
 <p>Update again as in (B) above:</p> 
 
 <pre class="code">git fetch --all
git merge remotes/upstream/master</pre> 
 
 <blockquote> 
 
 <p>The merge may fail if there have been remote updates, that is updates in 
 the repository on the web.  In that case, commit your changes locally and then 
 try the merge again.  You might want to use the <span class="v">-F</span> option instead of 
 <span class="v">-m</span>; see the next section for more on those options.</p> 
 
 <pre class="code">git commit -a -m '&lt;some message, with descriptive first line&gt;'
git merge remotes/upstream/master</pre> 
 
 <p>If the second command (the <span class="v">git merge</span>) prompts you for a message, the 
 empty message should suffice as a reasonable default (in emacs — if vi 
 tries to come up, just type <span class="v">:q</span> and <span class="v">&lt;RETURN&gt;</span>.</p> 
 
 </blockquote> 
 
 <p>You can now go on to the next step (Contribute Your Changes).  But ideally: 
 If the output indicates that anything has changed, then go back to ``Change 
 and Test'' above.  Of course, you can skip the build if no ACL2 sources have 
 changed, and you can skip making book changes if you are still happy with your 
 changes.</p> 
 
 <h3>Contribute Your Changes</h3> 
 
 <p>The following commands will update your github repository on the web.  The 
 <span class="v">-m ...</span> option is a log message whose first line should be a summary of 
 your changes and other lines may give more details.  You are welcome to 
 replace the <span class="v">-m ...</span> option by <span class="v">-F &lt;filename&gt;</span>, where <span class="v">&lt;filename&gt;</span> is 
 the name of a file that contains your log message.</p> 
 
 <pre class="code">git commit -a -m '&lt;some message, with descriptive first line&gt;'
git push</pre> 
 
 You now need to create a <i>pull request</i>, where you request that changes 
 from your github repository be accepted into the Community ACL2 repository. 
 To achieve this: 
 
 <ol> 
 
 <li>Goto <span class="v">https://github.com/&lt;your-github-username&gt;/acl2</span>.</li> 
 
 <li>Click the <span class="v">New pull request</span> button (you can search for it with your 
 browser).</li> 
 
 <li>In the drop-down box labeled "base" (next to the box labeled "base 
 fork"), change the value from "master" to "testing".</li> 
 
 <li>Click <span class="v">Create pull request</span>.</li> 
 
 <li>Put some explanation about what's in the changes in the comments section. 
 It's helpful if you quote (possibly abbreviated) versions of your commit log 
 messages here, as that way the descriptions are easily read when clicking on 
 the Community Repository <span class="v">commits</span> tab, which goes to <a href="https://github.com/acl2/acl2/commits/master" target="_blank"><nobr> 
 https://github.com/acl2/acl2/commits/master<img src="../Icon_External_Link.png" title="External link to https://github.com/acl2/acl2/commits/master"></nobr></a>.</li> 
 
 <li>Click <span class="v">Create pull request</span>.</li> 
 
 </ol> 
 At this point, the Community ACL2 repository maintainers will be notified, 
 check that things seem to be in order, and then adopt your changes.
</body>
</html>
