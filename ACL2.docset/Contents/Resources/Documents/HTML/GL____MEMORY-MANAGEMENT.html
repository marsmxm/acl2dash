<html>
<head>
<meta charset="UTF-8">
<title>Memory-management</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=GL____MEMORY-MANAGEMENT">Click for Memory-management in the Full Manual</a></h3>

<p></p> 
 
<p>Memory management can play a significant role in symbolic execution 
performance.  In some cases GL may use too much memory, leading to swapping and 
slow performance.  In other cases, garbage collection may run too frequently or 
may not reclaim much space.  We have several recommendations for managing 
memory in large-scale GL proofs.  Some of these suggestions are specific to 
Clozure Common Lisp.</p> 
 
 
<h4>Use set-max-mem</h4> 
 
<p>You can load the <span class="v">centaur/misc/memory-mgmt</span> book and use the <a href="ACL2____SET-MAX-MEM.html">set-max-mem</a> command to indicate how large you would like the Lisp heap to be. 
For instance,</p> 
 
<pre class="code">(<a href="ACL2____SET-MAX-MEM.html">set-max-mem</a> (<a href="COMMON-LISP_____A2.html">*</a> 8 (<a href="COMMON-LISP____EXPT.html">expt</a> 2 30)))</pre> 
 
<p>says to allocate 8 GB of memory.  To avoid swapping, you should use somewhat 
less than your available physical memory.  This book disables ephemeral garbage 
collection and configures the garbage collector to run only when the threshold 
set above is exceeded, which can boost performance.</p> 
 
 
<h4>Optimize hash-consing performance.</h4> 
 
<p>GL's representations of BDDs and AIGs use <a href="ACL2____HONS.html">hons</a> for structure-sharing. 
The <a href="ACL2____HONS-SUMMARY.html">hons-summary</a> command can be used at any time to see how many honses 
are currently in use, and hash-consing performance can be improved by 
pre-allocating space for these honses with <a href="ACL2____HONS-RESIZE.html">hons-resize</a>.</p> 
 
 
<h4>Manage hash-consing and memoization overhead.</h4> 
 
<p>Symbolic execution can use a lot of hash conses and can populate the 
memoization tables for various functions.  The memory used for these purposes 
is <b>not</b> automatically freed during garbage collection, so it may 
sometimes be necessary to manually reclaim it.</p> 
 
<p>A useful function is <span class="v">(maybe-wash-memory n)</span>, which frees this memory and 
triggers a garbage collection only when the amount of free memory is below some 
threshold <span class="v">n</span>.  A good choice for <span class="v">n</span> might be 20% of the <a href="ACL2____SET-MAX-MEM.html">set-max-mem</a> threshold.</p> 
 
<p>It can be useful to call <a href="ACL2____MAYBE-WASH-MEMORY.html">ACL2::maybe-wash-memory</a> between proofs, or 
between the cases of parametrized theorems; see for instance the 
<span class="v">:run-before-cases</span> argument of <a href="ACL2____DEF-GL-PARAM-THM.html">def-gl-param-thm</a>.</p>
</body>
</html>
