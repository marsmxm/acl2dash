<html>
<head>
<meta charset="UTF-8">
<title>Shallow-structures</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=C____SHALLOW-STRUCTURES">Click for Shallow-structures in the Full Manual</a></h3>

<p>A model of C structures in the shallow embedding.</p><p>Since C structure types are user-defined, 
     we provide a macro <span class="tt"><a href="C____DEFSTRUCT.html">defstruct</a></span> to define 
     an ACL2 representation of a C structure type. 
     The user must call this macro 
     to introduce the structure types that the C code must use.</p><p>The <span class="tt"><a href="C____DEFSTRUCT.html">defstruct</a></span> macro takes as inputs 
     the name (i.e. tag [C:6.7.2.3]) of the structure type 
     and a sequence of members; 
     each member consists of a name and a designation of 
     an integer type or of a sized integer array type 
     (for now we only support members of these types). 
     The names of the structure type and of the members 
     must be symbols whose <span class="tt"><a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a></span> is a portable ASCII identifier; 
     the members must have all different <span class="tt"><a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a></span>s 
     (it is not enough for the symbols to be different).</p><p>The designation of each member type is one of</p><ul>
<li><span class="v">schar</span></li>
<li><span class="v">uchar</span></li>
<li><span class="v">sshort</span></li>
<li><span class="v">ushort</span></li>
<li><span class="v">sint</span></li>
<li><span class="v">uint</span></li>
<li><span class="v">slong</span></li>
<li><span class="v">ulong</span></li>
<li><span class="v">sllong</span></li>
<li><span class="v">ullong</span></li>
<li><span class="v">(<a href="C____SCHAR.html">schar</a> &lt;pos&gt;)</span></li>
<li><span class="v">(<a href="C____UCHAR.html">uchar</a> &lt;pos&gt;)</span></li>
<li><span class="v">(<a href="C____SSHORT.html">sshort</a> &lt;pos&gt;)</span></li>
<li><span class="v">(<a href="C____USHORT.html">ushort</a> &lt;pos&gt;)</span></li>
<li><span class="v">(<a href="C____SINT.html">sint</a> &lt;pos&gt;)</span></li>
<li><span class="v">(<a href="C____UINT.html">uint</a> &lt;pos&gt;)</span></li>
<li><span class="v">(<a href="C____SLONG.html">slong</a> &lt;pos&gt;)</span></li>
<li><span class="v">(<a href="C____ULONG.html">ulong</a> &lt;pos&gt;)</span></li>
<li><span class="v">(<a href="C____SLLONG.html">sllong</a> &lt;pos&gt;)</span></li>
<li><span class="v">(<a href="C____ULLONG.html">ullong</a> &lt;pos&gt;)</span></li>
</ul><p>where <span class="v">&lt;pos&gt;</span> is a positive integer not exceeding <span class="tt"><a href="C____ULLONG-MAX.html">ullong-max</a></span>. 
     That is, the type of a member of integer type is specified by 
     the name of the fixtype of the integer type, 
     while the type of a member of integer array type is specified by 
     the name of the fixtype of the integer type and a size; 
     the size must be representable as an integer constant 
     (i.e. not exceed <span class="tt"><a href="C____ULLONG-MAX.html">ullong-max</a></span>, 
     which is the maximum integer representable as an integer constant).</p><p>Let <span class="v">&lt;tag&gt;</span> be the tag of the structure type.</p><p>The <span class="tt"><a href="C____DEFSTRUCT.html">defstruct</a></span> macro introduces:</p><ul>
<li>A recognizer <span class="v">struct-&lt;tag&gt;-p</span> for the structures.</li>
<li>A fixer <span class="v">struct-&lt;tag&gt;-fix</span> for the structures.</li>
<li>A fixtype <span class="v">struct-&lt;tag&gt;</span> for the structures.</li>
</ul><p>For each member named <span class="v">&lt;member&gt;</span> of integer type, 
     the <span class="tt"><a href="C____DEFSTRUCT.html">defstruct</a></span> macro introduces:</p><ul>
<li>A reader <span class="v">struct-&lt;tag&gt;-read-&lt;member&gt;</span> 
      that returns the value of the member.</li>
<li>A writer <span class="v">struct-&lt;tag&gt;-write-&lt;member&gt;</span> 
      that updates the value of the member.</li>
</ul><p>For each member named <span class="v">&lt;member&gt;</span> of integer array type, 
     the <span class="tt"><a href="C____DEFSTRUCT.html">defstruct</a></span> macro introduces:</p><ul>
<li>A checker <span class="v">struct-&lt;tag&gt;-&lt;member&gt;-index-okp)
      that checks whether an ACL2 integer index
      is within the range of the array.&lt;/li&gt;&lt;li&gt;A checker @('struct-&lt;tag&gt;-&lt;member&gt;-&lt;type&gt;-index-okp</span>, 
      for each <span class="v">&lt;type&gt;</span> that is the name of a fixtype of a C integer type, 
      that checks whether an index of the C integer type denoted by <span class="v">&lt;type&gt;</span> 
      is within the range of the array.</li>
<li>A reader <span class="v">struct-&lt;tag&gt;-read-&lt;member&gt;</span> 
      that returns the value of an element of the array, 
      where the element is indexed by an ACL2 integer. 
      This reader uses <span class="v">struct-&lt;tag&gt;-&lt;member&gt;-index-okp</span> 
      in the guard.</li>
<li>A reader <span class="v">struct-&lt;tag&gt;-read-&lt;member&gt;-&lt;type&gt;</span>, 
      for each <span class="v">&lt;type&gt;</span> that is the name of a fixtype of a C integer type, 
      that returns the value of an element of the array, 
      where the element is indexed by a C integer type denoted by <span class="v">&lt;type&gt;</span>. 
      This reader has <span class="v">struct-&lt;tag&gt;-&lt;member&gt;-&lt;type&gt;-index-okp</span> 
      in the guard.</li>
<li>A writer <span class="v">struct-&lt;tag&gt;-write-&lt;member&gt;</span> 
      that updates the value of an element of the array, 
      where the element is indexed by an ACL2 integer. 
      This writer uses <span class="v">struct-&lt;tag&gt;-&lt;member&gt;-index-okp</span> 
      in the guard.</li>
<li>A writer <span class="v">struct-&lt;tag&gt;-write-&lt;member&gt;-&lt;type&gt;</span>, 
      for each <span class="v">&lt;type&gt;</span> that is the name of a fixtype of a C integer type, 
      that udpates the value of an element of the array, 
      where the element is indexed by a C integer type denoted by <span class="v">&lt;type&gt;</span>. 
      This writer has <span class="v">struct-&lt;tag&gt;-&lt;member&gt;-&lt;type&gt;-index-okp</span> 
      in the guard.</li>
</ul><p>C code shallowly embedded in ACL2 can use 
     the recognizers <span class="v">struct-&lt;tag&gt;-p</span> in guards 
     to specify structure types for parameters; 
     more precisely, pointers to structure types, for now. 
     That is, similarly to arrays, structures are in the heap, 
     and pointers to them are passed to the represented C functions, 
     which may side-effect those structures via the member writers, 
     which represent assignments to structure members 
     accessed via the C <span class="v">-&gt;</span> operator (not the <span class="v">.</span> operator). 
     C structures may also be passed around by value in general, 
     but initially we support only passing by pointer. 
     Note that C arrays may only be passed by pointers, in effect, 
     as arrays are not first-class entities in C, 
     but merely collections of contiguous objects, 
     normally accessed via pointers to the first object of the collections.</p><p>The <span class="tt"><a href="C____DEFSTRUCT.html">defstruct</a></span> macro also records, in an ACL2 table, 
     information about the shallowly embedded structures it defines.</p>
</body>
</html>
