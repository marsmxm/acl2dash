<html>
<head>
<meta charset="UTF-8">
<title>Bip32-extend-tree</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=BITCOIN____BIP32-EXTEND-TREE">Click for Bip32-extend-tree in the Full Manual</a></h3>

<p>Extend a key tree with a key.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(bip32-extend-tree tree parent-path child-index) 
  → 
(mv error? new-tree)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">tree</span> — <font color="#606060">Guard <span class="v">(<a href="BITCOIN____BIP32-KEY-TREEP.html">bip32-key-treep</a> tree)</span>.</font>
</dd> 
  <dd>
<span class="tt">parent-path</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____UBYTE32-LISTP.html">ubyte32-listp</a> parent-path)</span>.</font>
</dd> 
  <dd>
<span class="tt">child-index</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____UBYTE32P.html">ubyte32p</a> child-index)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">error?</span> — <font color="#606060">Type <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> error?)</span>.</font>
</dd> 
<dd>
<span class="tt">new-tree</span> — <font color="#606060">Type <span class="v">(<a href="BITCOIN____BIP32-KEY-TREEP.html">bip32-key-treep</a> new-tree)</span>.</font>
</dd> 
 
</dl></div> 
<p>The new key is identified by 
     (i) the path of its parent and (ii) the child index of the new key. 
     The parent must be already in the tree, while the new child key must not: 
     this is expressed by the guard of this function. 
     The total depth of the new key should not exceed 255: 
     this is also expressed by the guard.</p><p>Given our model of key trees, 
     we just add the path of the new key to the underlying index tree. 
     But we need to check whether the child key derivation fails: 
     if it does, we return the input key tree unchanged, 
     along with <span class="v">t</span> as the first result. 
     The first result is <span class="v">nil</span> if key derivation succeeds.</p><p>If the key tree consists of private keys, the new key is private. 
     If the key tree consists of public keys, the new key is public. 
     We uniformly use the <span class="tt"><a href="BITCOIN____BIP32-CKD.html">bip32-ckd</a></span> function.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>bip32-extend-tree</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 bip32-extend-tree
 (tree parent-path child-index)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="BITCOIN____BIP32-KEY-TREEP.html">bip32-key-treep</a> tree)
                             (<a href="ACL2____UBYTE32-LISTP.html">ubyte32-listp</a> parent-path)
                             (<a href="ACL2____UBYTE32P.html">ubyte32p</a> child-index))))
 (<a href="COMMON-LISP____DECLARE.html">declare</a>
  (<a href="ACL2____XARGS.html">xargs</a>
     :guard
     (<a href="COMMON-LISP____AND.html">and</a> (<a href="BITCOIN____BIP32-PATH-IN-TREE-P.html">bip32-path-in-tree-p</a> parent-path tree)
          (<a href="COMMON-LISP____NOT.html">not</a> (<a href="BITCOIN____BIP32-PATH-IN-TREE-P.html">bip32-path-in-tree-p</a> (<a href="ACL2____RCONS.html">rcons</a> child-index parent-path)
                                     tree))
          (<a href="COMMON-LISP_____C3.html">&lt;</a> (<a href="COMMON-LISP_____B2.html">+</a> (<a href="BITCOIN____BIP32-KEY-TREE-_E3ROOT-DEPTH.html">bip32-key-tree-&gt;root-depth</a> tree)
                (<a href="ACL2____LEN.html">len</a> parent-path))
             255))))
 (<a href="ACL2____B_A2.html">b*</a> ((tree (<a href="ACL2____MBE.html">mbe</a> :logic (<a href="BITCOIN____BIP32-KEY-TREE-FIX.html">bip32-key-tree-fix</a> tree)
                 :exec tree))
      (parent-path (<a href="ACL2____MBE.html">mbe</a> :logic (<a href="ACL2____UBYTE32-LIST-FIX.html">ubyte32-list-fix</a> parent-path)
                        :exec parent-path))
      (child-index (<a href="ACL2____MBE.html">mbe</a> :logic (<a href="ACL2____UBYTE32-FIX.html">ubyte32-fix</a> child-index)
                        :exec child-index))
      ((<a href="BITCOIN____BIP32-KEY-TREE.html">bip32-key-tree</a> tree) tree)
      ((unless (<a href="ACL2____MBT.html">mbt</a> (<a href="BITCOIN____BIP32-PATH-IN-TREE-P.html">bip32-path-in-tree-p</a> parent-path tree)))
       (<a href="ACL2____MV.html">mv</a> t tree))
      (new-path (<a href="ACL2____RCONS.html">rcons</a> child-index parent-path))
      ((unless (<a href="ACL2____MBT.html">mbt</a> (<a href="COMMON-LISP____NOT.html">not</a> (<a href="BITCOIN____BIP32-PATH-IN-TREE-P.html">bip32-path-in-tree-p</a> new-path tree))))
       (<a href="ACL2____MV.html">mv</a> t tree))
      ((unless (<a href="ACL2____MBT.html">mbt</a> (<a href="COMMON-LISP_____C3.html">&lt;</a> (<a href="COMMON-LISP_____B2.html">+</a> tree.root-depth (<a href="ACL2____LEN.html">len</a> parent-path))
                       255)))
       (<a href="ACL2____MV.html">mv</a> t tree))
      ((<a href="ACL2____MV.html">mv</a> error? &amp;)
       (<a href="BITCOIN____BIP32-CKD_A2.html">bip32-ckd*</a> tree.root-key new-path))
      ((when error?) (<a href="ACL2____MV.html">mv</a> error? tree))
      (new-index-tree (<a href="SET____INSERT.html">insert</a> new-path tree.index-tree))
      (new-tree (<a href="BITCOIN____CHANGE-BIP32-KEY-TREE.html">change-bip32-key-tree</a> tree
                                       :index-tree new-index-tree)))
     (<a href="ACL2____MV.html">mv</a> nil new-tree)))</pre> 
<p><b>Theorem: </b>booleanp-of-bip32-extend-tree.error?</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> booleanp-of-bip32-extend-tree.error?
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?error? ?new-tree)
              (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))
            (<a href="ACL2____BOOLEANP.html">booleanp</a> error?))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>bip32-key-treep-of-bip32-extend-tree.new-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> bip32-key-treep-of-bip32-extend-tree.new-tree
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?error? ?new-tree)
              (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))
            (<a href="BITCOIN____BIP32-KEY-TREEP.html">bip32-key-treep</a> new-tree))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>bip32-key-tree-&gt;root-key-of-bip32-extend-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 bip32-key-tree-&gt;root-key-of-bip32-extend-tree
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
     (<a href="BITCOIN____BIP32-KEY-TREE-_E3ROOT-KEY.html">bip32-key-tree-&gt;root-key</a>
          (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                  (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))
     (<a href="BITCOIN____BIP32-KEY-TREE-_E3ROOT-KEY.html">bip32-key-tree-&gt;root-key</a> tree)))</pre> 
<p><b>Theorem: </b>bip32-key-tree-&gt;root-depth-of-bip32-extend-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 bip32-key-tree-&gt;root-depth-of-bip32-extend-tree
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
     (<a href="BITCOIN____BIP32-KEY-TREE-_E3ROOT-DEPTH.html">bip32-key-tree-&gt;root-depth</a>
          (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                  (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))
     (<a href="BITCOIN____BIP32-KEY-TREE-_E3ROOT-DEPTH.html">bip32-key-tree-&gt;root-depth</a> tree)))</pre> 
<p><b>Theorem: </b>bip32-key-tree-&gt;root-index-of-bip32-extend-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 bip32-key-tree-&gt;root-index-of-bip32-extend-tree
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
     (<a href="BITCOIN____BIP32-KEY-TREE-_E3ROOT-INDEX.html">bip32-key-tree-&gt;root-index</a>
          (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                  (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))
     (<a href="BITCOIN____BIP32-KEY-TREE-_E3ROOT-INDEX.html">bip32-key-tree-&gt;root-index</a> tree)))</pre> 
<p><b>Theorem: </b>bip32-key-tree-&gt;root-parent-of-bip32-extend-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 bip32-key-tree-&gt;root-parent-of-bip32-extend-tree
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
     (<a href="BITCOIN____BIP32-KEY-TREE-_E3ROOT-PARENT.html">bip32-key-tree-&gt;root-parent</a>
          (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                  (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))
     (<a href="BITCOIN____BIP32-KEY-TREE-_E3ROOT-PARENT.html">bip32-key-tree-&gt;root-parent</a> tree)))</pre> 
<p><b>Theorem: </b>bip32-key-tree-&gt;index-tree-of-bip32-extend-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
     bip32-key-tree-&gt;index-tree-of-bip32-extend-tree
     (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> error? tree1)
           (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))
         (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-KEY-TREE-_E3INDEX-TREE.html">bip32-key-tree-&gt;index-tree</a> tree1)
                (<a href="COMMON-LISP____IF.html">if</a> error? (<a href="BITCOIN____BIP32-KEY-TREE-_E3INDEX-TREE.html">bip32-key-tree-&gt;index-tree</a> tree)
                    (<a href="SET____INSERT.html">insert</a> (<a href="ACL2____RCONS.html">rcons</a> (<a href="ACL2____UBYTE32-FIX.html">ubyte32-fix</a> child-index)
                                   (<a href="ACL2____UBYTE32-LIST-FIX.html">ubyte32-list-fix</a> parent-path))
                            (<a href="BITCOIN____BIP32-KEY-TREE-_E3INDEX-TREE.html">bip32-key-tree-&gt;index-tree</a> tree))))))</pre> 
<p><b>Theorem: </b>bip32-key-tree-priv-p-of-bip32-extend-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 bip32-key-tree-priv-p-of-bip32-extend-tree
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
     (<a href="BITCOIN____BIP32-KEY-TREE-PRIV-P.html">bip32-key-tree-priv-p</a>
          (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                  (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))
     (<a href="BITCOIN____BIP32-KEY-TREE-PRIV-P.html">bip32-key-tree-priv-p</a> tree)))</pre> 
<p><b>Theorem: </b>bip32-path-in-tree-p-of-bip32-extend-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> bip32-path-in-tree-p-of-bip32-extend-tree
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> error? new-key-tree)
              (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> key-tree path index)))
            (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____NOT.html">not</a> error?)
                     (<a href="BITCOIN____BIP32-PATH-IN-TREE-P.html">bip32-path-in-tree-p</a> (<a href="ACL2____RCONS.html">rcons</a> index path)
                                           new-key-tree))))</pre> 
<p><b>Theorem: </b>bip32-extend-tree-of-bip32-key-tree-fix-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> bip32-extend-tree-of-bip32-key-tree-fix-tree
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> (<a href="BITCOIN____BIP32-KEY-TREE-FIX.html">bip32-key-tree-fix</a> tree)
                                  parent-path child-index)
               (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))</pre> 
<p><b>Theorem: </b>bip32-extend-tree-bip32-key-tree-equiv-congruence-on-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 bip32-extend-tree-bip32-key-tree-equiv-congruence-on-tree
 (<a href="ACL2____IMPLIES.html">implies</a>
     (<a href="BITCOIN____BIP32-KEY-TREE-EQUIV.html">bip32-key-tree-equiv</a> tree tree-equiv)
     (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)
            (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree-equiv parent-path child-index)))
 :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>bip32-extend-tree-of-ubyte32-list-fix-parent-path</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
     bip32-extend-tree-of-ubyte32-list-fix-parent-path
     (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree (<a href="ACL2____UBYTE32-LIST-FIX.html">ubyte32-list-fix</a> parent-path)
                               child-index)
            (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))</pre> 
<p><b>Theorem: </b>bip32-extend-tree-ubyte32-list-equiv-congruence-on-parent-path</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 bip32-extend-tree-ubyte32-list-equiv-congruence-on-parent-path
 (<a href="ACL2____IMPLIES.html">implies</a>
     (<a href="ACL2____UBYTE32-LIST-EQUIV.html">acl2::ubyte32-list-equiv</a> parent-path parent-path-equiv)
     (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)
            (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path-equiv child-index)))
 :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>bip32-extend-tree-of-ubyte32-fix-child-index</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
    bip32-extend-tree-of-ubyte32-fix-child-index
    (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree
                              parent-path (<a href="ACL2____UBYTE32-FIX.html">ubyte32-fix</a> child-index))
           (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)))</pre> 
<p><b>Theorem: </b>bip32-extend-tree-ubyte32-equiv-congruence-on-child-index</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 bip32-extend-tree-ubyte32-equiv-congruence-on-child-index
 (<a href="ACL2____IMPLIES.html">implies</a>
     (acl2::ubyte32-equiv child-index child-index-equiv)
     (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index)
            (<a href="BITCOIN____BIP32-EXTEND-TREE.html">bip32-extend-tree</a> tree parent-path child-index-equiv)))
 :rule-classes :congruence)</pre> 

</body>
</html>
