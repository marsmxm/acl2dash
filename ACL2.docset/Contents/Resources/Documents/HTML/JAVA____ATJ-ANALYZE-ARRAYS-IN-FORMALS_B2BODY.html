<html>
<head>
<meta charset="UTF-8">
<title>Atj-analyze-arrays-in-formals+body</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=JAVA____ATJ-ANALYZE-ARRAYS-IN-FORMALS_B2BODY">Click for Atj-analyze-arrays-in-formals+body in the Full Manual</a></h3>

<p>Array analysis of ACL2 function bodies.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(atj-analyze-arrays-in-formals+body formals body out-arrays wrld) 
  → 
nothing</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">formals</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> formals)</span>.</font>
</dd> 
  <dd>
<span class="tt">body</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> body)</span>.</font>
</dd> 
  <dd>
<span class="tt">out-arrays</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> out-arrays)</span>.</font>
</dd> 
  <dd>
<span class="tt">wrld</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PLIST-WORLDP.html">plist-worldp</a> wrld)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">nothing</span> — <font color="#606060">Type <span class="v">(<a href="COMMON-LISP____NULL.html">null</a> nothing)</span>.</font>
</dd> 
 
</dl></div> 
<p>This is the top level of the array analysis. 
     We analyze the body of the function, 
     and compare the inferred arrays 
     with the ones declared for the function 
     (via <span class="tt"><a href="JAVA____ATJ-MAIN-FUNCTION-TYPE.html">atj-main-function-type</a></span> and <span class="tt"><a href="JAVA____ATJ-OTHER-FUNCTION-TYPE.html">atj-other-function-type</a></span>). 
     The inferred arrays must be the same as the declared ones, 
     except that the inferred ones may have names for newly created arrays. 
     More precisely, for each position in the lists: 
     if the declared array name at that position is not <span class="v">nil</span> 
     then the inferred array name at that position must be the same; 
     if the declared array name at that position is <span class="v">nil</span>, 
     then the inferred array name at that position may be either <span class="v">nil</span> 
     or a new array name that is not among the function's formal parameters. 
     In the latter case, it means that the function body has 
     directly or indirectly created a new array and assigned it to a variable, 
     which is then returned as result of array analysis, 
     but the declared array names are only the ones 
     that match some formal parameter names.</p><p>These checks tie the intraprocedural array analysis 
     (performed by <span class="tt"><a href="JAVA____ATJ-ANALYZE-ARRAYS-IN-TERM.html">atj-analyze-arrays-in-term</a></span>) 
     with the output arrays assigned by the user to the functions. 
     Recall that 
     <span class="tt"><a href="JAVA____ATJ-MAIN-FUNCTION-TYPE.html">atj-main-function-type</a></span> and <span class="tt"><a href="JAVA____ATJ-OTHER-FUNCTION-TYPE.html">atj-other-function-type</a></span> 
     check the correctness of the declared types 
     but not of the declared output arrays, 
     aside from relatively simple constraints such as the fact that 
     the non-<span class="v">nil</span> output arrays are unique, 
     correspond to some formal parameters with the same array types, 
     etc. 
     By checking that the inferred arrays are consistent with the declared ones, 
     which are used to analyze the callers of the function, 
     we ensure that all the arrays potentially modified by the function 
     are returned by the function, 
     so that the callers have to receive them and return them as well. 
     This is similar to ACL2's stobj analysis.</p><p>This <span class="v">atj-analyze-arrays-in-formals+body</span> returns nothing, 
     but its execution stops with a hard error if the array analysis fails.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>atj-analyze-arrays-in-formals+body-aux</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 atj-analyze-arrays-in-formals+body-aux
 (<a href="ACL2____FORMALS.html">formals</a> inferred declared)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> formals)
                             (<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> inferred)
                             (<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> declared))))
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP_____D3.html">=</a> (<a href="ACL2____LEN.html">len</a> inferred) (<a href="ACL2____LEN.html">len</a> declared))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'atj-analyze-arrays-in-formals+body-aux))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="COMMON-LISP____OR.html">or</a>
   (<a href="COMMON-LISP____ENDP.html">endp</a> inferred)
   (<a href="ACL2____B_A2.html">b*</a>
    ((inf (<a href="COMMON-LISP____CAR.html">car</a> inferred))
     (decl (<a href="COMMON-LISP____CAR.html">car</a> declared)))
    (<a href="COMMON-LISP____AND.html">and</a>
      (<a href="COMMON-LISP____OR.html">or</a> (<a href="COMMON-LISP____EQ.html">eq</a> inf decl)
          (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____NULL.html">null</a> decl)
               (<a href="COMMON-LISP____NOT.html">not</a> (<a href="ACL2____MEMBER-EQ.html">member-eq</a> inf formals))))
      (atj-analyze-arrays-in-formals+body-aux formals (<a href="COMMON-LISP____CDR.html">cdr</a> inferred)
                                              (<a href="COMMON-LISP____CDR.html">cdr</a> declared)))))))</pre> 
<p><b>Theorem: </b>booleanp-of-atj-analyze-arrays-in-formals+body-aux</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> booleanp-of-atj-analyze-arrays-in-formals+body-aux
        (<a href="ACL2____B_A2.html">b*</a> ((yes/no (atj-analyze-arrays-in-formals+body-aux
                          formals inferred declared)))
            (<a href="ACL2____BOOLEANP.html">booleanp</a> yes/no))
        :rule-classes :rewrite)</pre> 
<p><b>Function: </b>atj-analyze-arrays-in-formals+body</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 atj-analyze-arrays-in-formals+body
 (<a href="ACL2____FORMALS.html">formals</a> body out-arrays wrld)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> formals)
                             (<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> body)
                             (<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> out-arrays)
                             (<a href="ACL2____PLIST-WORLDP.html">plist-worldp</a> wrld))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'atj-analyze-arrays-in-formals+body))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   (((<a href="ACL2____MV.html">mv</a> arrays &amp;)
     (<a href="JAVA____ATJ-ANALYZE-ARRAYS-IN-TERM.html">atj-analyze-arrays-in-term</a> body wrld))
    ((unless (<a href="COMMON-LISP_____D3.html">=</a> (<a href="ACL2____LEN.html">len</a> arrays) (<a href="ACL2____LEN.html">len</a> out-arrays)))
     (<a href="ACL2____RAISE.html">raise</a>
      "Internal error: ~
                the length of the inferred arrays ~x0 ~
                differs from the length of the declared arrays ~x1."
      arrays out-arrays))
    (pass (atj-analyze-arrays-in-formals+body-aux
               formals arrays out-arrays)))
   (<a href="COMMON-LISP____IF.html">if</a>
    pass nil
    (<a href="ACL2____RAISE.html">raise</a>
     "Array analysis failure: ~
              the function with formals ~x0 and body ~x1 ~
              returns the inferred arrays ~x2, ~
              which are inconsistent with the declared arrays ~x3."
     formals body arrays out-arrays)))))</pre> 
<p><b>Theorem: </b>null-of-atj-analyze-arrays-in-formals+body</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> null-of-atj-analyze-arrays-in-formals+body
        (<a href="ACL2____B_A2.html">b*</a> ((nothing (<a href="JAVA____ATJ-ANALYZE-ARRAYS-IN-FORMALS_B2BODY.html">atj-analyze-arrays-in-formals+body</a>
                           formals body out-arrays wrld)))
            (<a href="COMMON-LISP____NULL.html">null</a> nothing))
        :rule-classes :rewrite)</pre> 

</body>
</html>
