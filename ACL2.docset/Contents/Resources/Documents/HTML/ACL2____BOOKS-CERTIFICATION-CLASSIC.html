<html>
<head>
<meta charset="UTF-8">
<title>Books-certification-classic</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____BOOKS-CERTIFICATION-CLASSIC">Click for Books-certification-classic in the Full Manual</a></h3>

<p>Classic ACL2 `make'-based certification of <a href="ACL2____BOOKS.html">books</a></p><p>This <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> topic explains an approach to certifying 
 directories of books, which we call ``classic ACL2 `make'-based 
 certification''.</p> 
 
 <p>Warning: The capability described in this section might be replaced at any 
 time by a capability based on corresponding support for community books (see 
 <a href="ACL2____BOOKS-CERTIFICATION.html">books-certification</a>).  If you think that would be a hardship, please 
 contact the ACL2 implementors.</p> 
 
 <p>This topic discusses a way to certify a directory of books other than the 
 ACL2 community books.  See <a href="ACL2____BOOKS-CERTIFICATION.html">books-certification</a> for how to certify the 
 set of ACL2 community <a href="ACL2____BOOKS.html">books</a>.  There is also a section in that <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> topic, ``Restricting to Specific Directories and Books'', that 
 provides an alternative to classic ACL2 `make'-based certification (as 
 discussed in the present topic) for certifying specified sets of books.</p> 
 
 <p>We assume here a familiarity with Unix/Linux `make'.  We also assume that 
 you are using GNU `make' rather than some other flavor of `make'.  And 
 finally, we assume, as is typically the case by following the standard 
 installation instructions, that you install the ACL2 community books in the 
 <span class="v">books/</span> subdirectory of your ACL2 distribution.  We will refer below to 
 that directory as <span class="v">BOOKS</span>.</p> 
 
 <p>In summary: to use `make' to certify <a href="ACL2____BOOKS.html">books</a> under a given directory, 
 you may create a simple Makefile in that directory (as explained below) so 
 that when you stand in that directory, you can submit the command, `make', to 
 certify those books.  If you have a multi-processor machine or the like, then 
 you can use the `<span class="v">-j</span> flag `make'-level parallelism by specifying the 
 number of concurrent processes.  For example:</p> 
 
 <pre class="code">make -j 4</pre> 
 
 <p>For each book <span class="v">foo.lisp</span>, a file <span class="v">foo.out</span> in the same directory as 
 <span class="v">foo.lisp</span> will contain the output from the corresponding certification 
 attempt.  If you have previously executed such a command, then you might first 
 want to delete <a href="ACL2____CERTIFICATE.html">certificate</a> files and other generated files by executing 
 the following command.</p> 
 
 <pre class="code">make clean</pre> 
 
 <p>Note that when you run `make', then by default, the first error will cause 
 the process to stop.  You can use <span class="v">make -i</span> to force `make' to ignore 
 errors, thus continuing past them.  Or, use <span class="v">make -k</span> to keep going, but 
 skipping certification for any book that includes another whose certification 
 has failed.</p> 
 
 <p>By default, your acl2-customization file (see <a href="ACL2____ACL2-CUSTOMIZATION.html">ACL2-customization</a>) is 
 ignored by such `make' commands.  However, you can specify the use of an 
 acl2-customization file by setting the value of environment variable 
 <span class="v">ACL2_CUSTOMIZATION</span> to the empty string, indicating a default such file, 
 or to the desired absolute pathname.  For example:</p> 
 
 <pre class="code">make ACL2_CUSTOMIZATION=''
make ACL2_CUSTOMIZATION='~/acl2-customization.lisp'</pre> 
 
 <p>We now discuss how to create makefiles to support `make' commands as 
 discussed above.</p> 
 
 <p>First we give five steps for creating a <span class="v">Makefile</span> to support 
 certification of a directory of books, without subdirectories.  For examples 
 of such Makefiles you can look in community book directories (which, however, 
 might disappear in future versions of ACL2).</p> 
 
 <blockquote>
<p>1. Include the file <span class="v">Makefile-generic</span> from the <span class="v">books/</span> 
 subdirectory of your ACL2 sources directory, but first perhaps define the 
 variable `<span class="v">ACL2</span>'.  Consider the following example.</p> 
 
 <pre class="code">ACL2 ?= /Users/john_doe/acl2/acl2-sources/saved_acl2
include /Users/john_doe/acl2/acl2-sources/books/Makefile-generic</pre> 
 
 <p>In this example, you can omit the first line, because the default ACL2 
 executable is file <span class="v">saved_acl2</span> in the directory immediately above the 
 directory of the specified <span class="v">Makefile-generic</span> file.  Indeed, that is the 
 common case.  Note the use of <span class="v">?=</span> instead of <span class="v">=</span> or <span class="v">:=</span>, so that 
 <span class="v">ACL2</span> can instead be defined by the environment or provided on the command 
 line as part of the `make' command.</p> 
 
 <p>2. (Optional; usually skipped.)  Set the <span class="v">INHIBIT</span> variable if you want 
 to see more than the <a href="ACL2____SUMMARY.html">summary</a> output.  For example, if you want to see 
 the same output as you would normally see at the terminal, put this line in 
 your Makefile after the `<span class="v">include</span>' lines.</p> 
 
 <pre class="code">INHIBIT = (<a href="ACL2____ASSIGN.html">assign</a> inhibit-output-lst (<a href="COMMON-LISP____LIST.html">list</a> (<a href="COMMON-LISP____QUOTE.html">quote</a> proof-tree)))</pre> 
 
 <p>For other values to use for <span class="v">INHIBIT</span>, see <a href="ACL2____SET-INHIBIT-OUTPUT-LST.html">set-inhibit-output-lst</a> 
 and see the original setting of <span class="v">INHIBIT</span> in 
 <span class="v">books/Makefile-generic</span>.</p> 
 
 <p>3. Specify the books to be certified.  Normally, every file with extension 
 <span class="v">.lisp</span> will be a book that you want to certify, in which case you can skip 
 this step.  Otherwise, put a line in your <span class="v">Makefile</span> after the ones above 
 that specifies the books to be certified.  The following example, from an old 
 version of community books file <span class="v">books/finite-set-theory/osets/Makefile</span>, 
 should make this clear.</p> 
 
 <pre class="code">BOOKS = computed-hints fast instance map membership outer primitives \
        quantify set-order sets sort</pre> 
 
 <p>But better yet, use the extension <span class="v">.lsp</span> for any Lisp or ACL2 files that 
 are not to be certified, so that the definition of <span class="v">BOOKS</span> can be 
 omitted.</p> 
 
 <p>4. Create <span class="v">.acl2</span> files for books that are to be certified in other than 
 the initial ACL2 world (see <a href="ACL2____PORTCULLIS.html">portcullis</a>).  For example, if you look in 
 community books file <span class="v">books/arithmetic/equalities.acl2</span> you will see <span class="tt"><a href="ACL2____DEFPKG.html">defpkg</a></span> forms followed by a <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> command, because it was 
 determined that <span class="tt"><a href="ACL2____DEFPKG.html">defpkg</a></span> forms were necessary in the certification world 
 in order to certify the <span class="v">equalities</span> book.  In general, for each 
 <span class="v">&lt;book-name&gt;.lisp</span> whose certification requires a non-initial certification 
 world, you will need a corresponding <span class="v">&lt;book-name&gt;.acl2</span> file that ends with 
 the appropriate <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> command.</p> 
 
 <p>You also have the option of creating a file <span class="v">cert.acl2</span> that has a 
 special role.  When file <span class="v">&lt;book-name&gt;.lisp</span> is certified, if there is no 
 file <span class="v">&lt;book-name&gt;.acl2</span> but there is a file <span class="v">cert.acl2</span>, then 
 <span class="v">cert.acl2</span> will be used as <span class="v">&lt;book-name&gt;.acl2</span> would have been used, as 
 described in the preceding paragraph, except that the appropriate <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> command will be generated automatically.  Thus, no 
 <span class="v">certify-book</span> command should occur in <span class="v">cert.acl2</span>.</p> 
 
 <p>It is actually allowed to put raw lisp forms in a <span class="v">.acl2</span> file 
 (presumably preceded by <span class="v">:q</span> or <span class="v">(<a href="ACL2____VALUE.html">value</a> :q)</span> and followed by <span class="v">(<a href="ACL2____LP.html">lp</a>)</span>). 
 But this is not recommended; we make no guarantees about certification 
 performed any time after raw Lisp has been entered in the ACL2 session.</p> 
 
 <p>5. Generally, the next step is to include the following line after the 
 `<span class="v">include</span>' of <span class="v">Makefile-generic</span> (see the first step above).</p> 
 
 <pre class="code">-include Makefile-deps</pre> 
 
 <p>This will cause `make' to create and then include a file <span class="v">Makefile-deps</span> 
 that contains ``dependency'' lines needed by `make'.  If those dependencies 
 are somehow flawed, it may be because you have <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> forms that 
 are not truly including books, for example in multi-line comments 
 (<span class="v">#|..|#</span>).  These will be ignored if preceded by a semicolon (<span class="v">;</span>), or 
 if you add a line break after ``<span class="v">include-book</span>.''  But instead of adding 
 the `<span class="v">-include</span>' line above, you can create dependency lines yourself by 
 running the command</p> 
 
 <pre class="code">make dependencies</pre> 
 
 <p>and pasting the result into the end of your <span class="v">Makefile</span>, and editing as 
 you see fit.</p>
</blockquote> 
 
 <p>This concludes the basic instructions for creating a <span class="v">Makefile</span> in a 
 directory including books.  Here are some other capabilities offered by 
 community books file <span class="v">books/Makefile-subdirs</span>.  Not included below is a 
 discussion of how to increase parallelism by avoiding the need to certify 
 included books before certifying a given book; see <a href="ACL2____PROVISIONAL-CERTIFICATION.html">provisional-certification</a>.</p> 
 
 <p><b>Subdirectory Support</b></p> 
 
 <p>There is support for using `make' to certify books in subdirectories. 
 Consider the following example.</p> 
 
 <pre class="code">DIRS = pass1 bind-free floor-mod
include ../Makefile-subdirs</pre> 
 
 <p>This indicates that we are to run `make' in subdirectories <span class="v">pass1/</span>, 
 <span class="v">bind-free/</span>, and <span class="v">floor-mod/</span> of the current directory.</p> 
 
 <p>You can combine this subdirectory support with the support already 
 discussed for certifying books in the top-level directory.  Here is an 
 example, which as of this writing is in community books file 
 <span class="v">books/arithmetic-3/Makefile</span> contains the following lines.</p> 
 
 <pre class="code">arith-top: top all
all: top

DIRS = pass1 bind-free floor-mod
include ../Makefile-subdirs
include ../Makefile-generic

-include Makefile-deps</pre> 
 
 <p>The `<span class="v">top</span>' target is defined in <span class="v">../Makefile-subdirs</span> to call `make' 
 in each subdirectory specified in <span class="v">DIRS</span>.  We have set the default target 
 in the example above to a new name, <span class="v">arith-top</span>, that makes that <span class="v">top</span> 
 target before making the `<span class="v">all</span>' target which, in turn, is the default 
 target in any <span class="v">Makefile-generic</span>, and is responsible for certifying books 
 in the current directory as discussed in the five steps displayed above.</p> 
 
 <p>Use <span class="v">Makefile-psubdirs</span> instead of <span class="v">Makefile-subdirs</span> if 
 certification of a book in a subdirectory never depends on certification of a 
 book in a different subdirectory, because then the <span class="v">-j</span> option of `make' 
 can allow subdirectories to be processed in parallel.</p> 
 
 <p><b>Cleaning Up</b></p> 
 
 <p>We note that there is a <span class="v">clean</span> target.  Thus,</p> 
 
 <pre class="code">make clean</pre> 
 
 <p>will remove generated files including <span class="v">.cert</span>, <span class="v">.out</span> files, and 
 compiled files.</p> 
 
 <p><b>System Books</b></p> 
 
 <p>An environment variable <span class="v">ACL2_SYSTEM_BOOKS</span> is generally set 
 automatically, so you can probably skip reading the following paragraph unless 
 your attempt to certify books fails to locate those books properly.</p> 
 
 <p>The environment variable <span class="v">ACL2_SYSTEM_BOOKS</span> can be set to the top-level 
 directory of the ACL2 community books.  A Unix-style pathname, typically 
 ending in <span class="v">books/</span> or <span class="v">books</span>, is permissible.  In most cases, your ACL2 
 executable is a small script in which you can set this environment variable 
 just above the line on which the actual ACL2 image is invoked, for 
 example:</p> 
 
 <pre class="code">export ACL2_SYSTEM_BOOKS
ACL2_SYSTEM_BOOKS=/home/acl2/v3-2/acl2-sources/books</pre> 
 
 <p>However, you can also set <span class="v">ACL2_SYSTEM_BOOKS</span> as a `make' variable, by 
 setting it in your <span class="v">Makefile</span> before the first target definition, e.g.:</p> 
 
 <pre class="code">ACL2_SYSTEM_BOOKS ?= /home/acl2/v3-2/acl2-sources/books</pre> 
 
 <p><b>Compilation Support</b></p> 
 
 <p>The file <span class="v">books/Makefile-generic</span> provides support for compiling books 
 that are already certified (but see <a href="ACL2____COMPILATION.html">compilation</a> for an exception).  For 
 example, suppose that you have certified books using GCL as the host Lisp, 
 resulting in compiled files with the <span class="v">.o</span> extension.  Now suppose you would 
 like to compile the books for Allegro Common Lisp, whose compiled files have 
 the <span class="v">.fasl</span> extension.  The following command will work if you have 
 included <span class="v">books/Makefile-generic</span> in your <span class="v">Makefile</span>.</p> 
 
 <pre class="code">make fasl</pre> 
 
 <p>In general, the compiled file extension for a Lisp supported by ACL2 will 
 be a target name for building compiled files for all your books (after 
 certifying the books, if not already up-to-date on certification).</p> 
 
 <p>If you run into problems, you can get help by joining the <span class="v">acl2-help</span> 
 email list (follow the link from the ACL2 home page) and sending a message to 
 that list.  Also consider trying another version of GNU `make'; for example, 
 we have found that versions 3.81 and 3.82 sometimes cause errors on Linux 
 where version 3.80 does not.</p>
</body>
</html>
