<html>
<head>
<meta charset="UTF-8">
<title>Hons-acons</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____HONS-ACONS">Click for Hons-acons in the Full Manual</a></h3>

<p><span class="v">(<a href="ACL2____HONS-ACONS.html">hons-acons</a> key val alist)</span> is the main way to create or extend 
<a href="ACL2____FAST-ALISTS.html">fast-alists</a>.</p><p>Logically, <span class="v">hons-acons</span> is like <span class="tt"><a href="COMMON-LISP____ACONS.html">acons</a></span> except that its 
 guard does not require <span class="tt"><a href="ACL2____ALISTP.html">alistp</a></span>; we leave it enabled and would think it 
 odd to ever prove a theorem about it.</p> 
 
 <p>Under the hood, two things are done differently.  First, the key is copied 
 with <span class="tt"><a href="ACL2____HONS-COPY.html">hons-copy</a></span>; this lets us use EQL-based hash tables instead of 
 EQUAL-based hash tables for better performance.  Second, assuming there is a 
 valid hash table associated with this alist, we destructively update the hash 
 table by binding key to val.  The hash table will no longer be associated with 
 alist, but will instead be associated with the new alist returned by 
 <span class="v">hons-acons</span>.</p> 
 
 <p>Hash Table Creation</p> 
 
 <p>A new hash table is created by <span class="v">hons-acons</span> whenever alist is an atom. 
 Unlike ordinary <span class="v">acons</span>, we do not require that alist be nil, and in fact 
 you may wish to use a non-nil value for one of two reasons.</p> 
 
 <p>1.  As a size hint</p> 
 
 <p>By default, the new hash table will be given a quite modest default 
 capacity of 60 elements.  As more elements are added, the table may need to be 
 resized to accommodate them, and this resizing has some runtime cost.</p> 
 
 <p>When a natural number is used as a fast alist's name, we interpret it as a 
 size hint.  For example, <span class="v">(<a href="ACL2____HONS-ACONS.html">hons-acons</a> 'foo 'bar 1000)</span> instructs us to use 
 1000 as the initial size for this hash table and binds 'foo to 'bar.  The 
 resulting table should not need to be resized until more than 1000 elements 
 are added.  We ignore size hints that request fewer than 60 elements.</p> 
 
 <p>Because of hash collisions, hash tables typically need to have a larger 
 size than the actual number of elements they contain.  The hash tables for 
 fast alists are told to grow when they reach 70% full.  So, an easy rule of 
 thumb might be: multiply the expected number of elements you need by 1.5 to 
 keep your hash tables about 2/3 full.</p> 
 
 <p>2.  As an alist name</p> 
 
 <p>We also frequently use a symbol for alist, and think of this symbol as the 
 name of the new alist.  We have found that naming alists can be valuable for 
 two reasons:</p> 
 
 <p>First, the name can be helpful in identifying fast alists that should have 
 been freed, see <span class="tt"><a href="ACL2____FAST-ALIST-SUMMARY.html">fast-alist-summary</a></span>.</p> 
 
 <p>Second, names can sometimes be used to avoid a subtle and insidious 
 table-stealing phenomenon that occurs when using fast-alists that are 
 themselves normed; see <span class="tt"><a href="ACL2____HONS-ACONS_12.html">hons-acons!</a></span>.</p> 
 
 <p>At the moment, there is no way to simultaneously name a fast alist and also 
 give it a size hint.  We may eventually allow strings to include embedded name 
 and size components, but for now we have not implemented this 
 capability.</p> 
 
 <p><b>Function: </b>hons-acons</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> hons-acons (key val alist)
       (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t))
       (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> key val) alist))</pre>
</body>
</html>
