<html>
<head>
<meta charset="UTF-8">
<title>Note-8-0</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____NOTE-8-0">Click for Note-8-0 in the Full Manual</a></h3>

<p>ACL2 Version  8.0 (December, 2017) Notes</p><p>NOTE!  New users can ignore these release notes, because the <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> has been updated to reflect all changes that are recorded 
 here.</p> 
 
 <p>Below we roughly organize the changes to ACL2 since Version 7.4 into the 
 following categories of changes: existing features, new features, heuristic 
 and efficiency improvements, bug fixes, changes at the system level, Emacs 
 support, and experimental versions.  Each change is described in just one 
 category, though of course many changes could be placed in more than one 
 category.</p> 
 
 <p>Note that only ACL2 system changes are listed below.  See also <a href="ACL2____NOTE-8-0-BOOKS.html">note-8-0-books</a> for a summary of changes made to the ACL2 Community Books 
 since ACL2 7.4, including the build system.  Also note that with each release, 
 some built-in functions that were formerly in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode are 
 now <a href="ACL2____GUARD.html">guard</a>-verified <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode functions.</p> 
 
 <h3>Changes to Existing Features</h3> 
 
 <p>The macro, <span class="tt"><a href="ACL2____CASE-MATCH.html">case-match</a></span>, now treats keywords as constants when they 
 occur in patterns.  For example, the following form evaluates to 3 where 
 formerly an error occurred:</p> 
 
 <pre class="code">(<a href="COMMON-LISP____LET.html">let</a> ((x '(:foo 3)))
  (<a href="ACL2____CASE-MATCH.html">case-match</a> x
    ((:foo y) y)
    (&amp; 17)))</pre> 
 
 <p>Thanks to Keshav Kini for suggesting this improvement.</p> 
 
 <p>Several changes have been made to <span class="tt"><a href="ACL2____SYS-CALL.html">sys-call</a></span> and <span class="tt"><a href="ACL2____SYS-CALL_B2.html">sys-call+</a></span>, 
 and a new utility, <span class="tt"><a href="ACL2____SYS-CALL_A2.html">sys-call*</a></span>, has been added.  These stem from 
 feedback from an observation by Eric Smith: <span class="v">sys-call</span> could invoke the 
 operating system when simplifying terms (see <a href="ACL2____SYS-CALL.html">sys-call</a> for an example). 
 We thank Eric for helpful discussions.  Changes include:</p> 
 
 <ul> 
 
 <li>When <span class="tt"><a href="ACL2____SYS-CALL.html">sys-call</a></span> is invoked during a proof (from a prover call or 
 invocation of the <a href="ACL2____PROOF-BUILDER.html">proof-builder</a>), it no longer can make a (potentially 
 dangerous) call to the operating system.  If such an invocation occurs during 
 evaluation of a clause-processor or metafunction, an error will be 
 signaled.</li> 
 
 <li>
<span class="tt"><a href="ACL2____SYS-CALL_B2.html">Sys-call+</a></span> continues to call the OS during proofs, but now it only 
 does so when applied to the actual ``live'' ACL2 <a href="ACL2____STATE.html">state</a>.</li> 
 
 <li>A new utility, <span class="tt"><a href="ACL2____SYS-CALL_A2.html">sys-call*</a></span>, combines some features of <span class="tt"><a href="ACL2____SYS-CALL.html">sys-call</a></span> and <span class="tt"><a href="ACL2____SYS-CALL_B2.html">sys-call+</a></span>; it takes <span class="v">state</span> and takes effect even 
 during proofs like <span class="v">sys-call+</span>, but like <span class="v">sys-call</span> it does not capture 
 output.  Thus, it can be a good choice in place of <span class="v">sys-call</span> for 
 clause-processors and metafunctions, now that <span class="v">sys-call</span> would cause an 
 error.</li> 
 
 <li>The guards are no longer <span class="v">t</span>.  Now, the guard for all three functions 
 specifies the application of a string (the command) to a true list of 
 strings (the arguments).</li> 
 
 <li>The <a href="ACL2____EXECUTABLE-COUNTERPART.html">executable-counterpart</a> of <span class="tt"><a href="ACL2____SYS-CALL.html">sys-call</a></span> is disabled by 
 default.</li> 
 
 </ul> 
 
 <p>Several symbols have been added to the list <span class="tt"><a href="ACL2_____A2ACL2-EXPORTS_A2.html">*ACL2-exports*</a></span>, 
 including <span class="v">LET</span> (thanks to Eric Smith for that suggestion).</p> 
 
 <p>When a single-threaded object is being used where an ordinary object is 
 expected, the error message has been improved to show the enclosing form. 
 Moreover, such an error message can now appear when congruent stobjs are 
 involved, where formerly the error was blamed on the shape of the result. 
 Thanks to Sol Swords for bringing the latter problem to our attention with a 
 helpful example.  (See a comment in ACL2 source function <span class="v">translate11-call</span> 
 for a simplified version of that example.)</p> 
 
 <p>The banner printed when there is a raw Lisp error now points to a new <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> topic, <a href="ACL2____RAW-LISP-ERROR.html">raw-lisp-error</a>.  Thanks to Keshav Kini for most 
 recently pointing out that <span class="tt"><a href="ACL2____FMT.html">fmt</a></span> can cause a raw Lisp error.</p> 
 
 <p>When suppressing output of all types other than <span class="v">error</span> — see 
 <a href="ACL2____SET-INHIBIT-OUTPUT-LST.html">set-inhibit-output-lst</a> — then errors may be reported with 
 considerably less noise than before, because of the following changes.  Thanks 
 to Eric Smith, Alessandro Coglio, and Stephen Westfold for helpful 
 discussions and feedback.</p> 
 
 <ul> 
 
 <li>When all output is inhibited except error output, the generic failure 
 message for events is suppressed for <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span>, <span class="tt"><a href="COMMON-LISP____PROGN.html">progn</a></span>, 
 <span class="tt"><a href="ACL2____PROGN_12.html">progn!</a></span>, and <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span>.</li> 
 
 <li>When a call of <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> specifies keyword <span class="v">:on-behalf-of</span> 
 with value <span class="v">:quiet</span> or <span class="v">:quiet!</span>, an error for <span class="v">make-event</span> expansion 
 is generally suppressed; see <a href="ACL2____MAKE-EVENT-DETAILS.html">make-event-details</a>.</li> 
 
 <li>A failed call of <span class="tt"><a href="COMMON-LISP____PROGN.html">progn</a></span> no longer prints <span class="v">"PROGN failed!"</span>; 
 similarly for <span class="tt"><a href="ACL2____PROGN_12.html">progn!</a></span>.</li> 
 
 </ul> 
 
 <p>Some warnings have been made more compact for including uncertified books. 
 Thanks to Eric Smith for suggesting such an improvement.</p> 
 
 <p>The (minimal) support for infix printing has been removed.  (See the Essay 
 on infix printing in ACL2 source file <span class="v">axioms.lisp</span> for more information.) 
 However, as a result it is now possible to call certain functions during 
 evaluation of <span class="tt"><a href="ACL2____DEFCONST.html">defconst</a></span> forms, and during macroexpansion — in 
 general, during any evaluation when so-called ``safe mode'' is active and a 
 function with raw Lisp code is encountered.  For example, the following form 
 was formerly rejected but is now accepted.</p> 
 
 <pre class="code">(<a href="ACL2____DEFCONST.html">defconst</a> *c* (<a href="ACL2____FMS-TO-STRING.html">fms-to-string</a> "abc~x0" (<a href="COMMON-LISP____LIST.html">list</a> (<a href="COMMON-LISP____CONS.html">cons</a> #\0 (<a href="COMMON-LISP____EXPT.html">expt</a> 2 4)))))</pre> 
 
 <p>Thanks to Eric Smith for suggesting such a change.</p> 
 
 <p>The role of <a href="ACL2____RULER-EXTENDERS.html">ruler-extenders</a> for redundancy of <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> forms 
 has been simplified; see <a href="ACL2____REDUNDANT-EVENTS.html">redundant-events</a>.  Thanks to Alessandro Coglio 
 for contributing a patch for this change.  Moreover, there was a bug: the 
 redundancy check for definitions could allow the new definition to be 
 redundant even when it specified more than one value for 
 <span class="v">:ruler-extenders</span>, which is illegal.  This has been fixed.  Thanks to 
 Alessandro Coglio for bringing this issue to our attention.</p> 
 
 <p>Modified the built-in rule <span class="v">complex-0</span> to one that is simpler but 
 equivalent, and modified the definition of <span class="tt"><a href="COMMON-LISP____CONJUGATE.html">conjugate</a></span> so that it always 
 returns a number (essentially by ``fixing'' its argument).  We thank Keshav 
 Kini for suggesting such changes, and for helpful discussions we also thank 
 Alessandro Coglio and Sol Swords, who suggested the definition of 
 <span class="v">conjugate</span> that we ultimately installed.</p> 
 
 <p>The system-level utility, <span class="v">trans-eval</span>, now prints a warning by default 
 when its call modifies a user-defined <span class="tt"><a href="ACL2____STOBJ.html">stobj</a></span>.  This feature can be 
 defeated but it may be best to allow the warning to be printed.  See <a href="ACL2____TRANS-EVAL.html">trans-eval</a> and, especially, see <a href="ACL2____USER-STOBJS-MODIFIED-WARNINGS.html">user-stobjs-modified-warnings</a>.  A 
 related change is that in order to call <span class="tt"><a href="ACL2____LD.html">ld</a></span> in the body of a 
 definition, a new keyword argument, <span class="v">:ld-user-stobjs-modified-warning</span>, 
 must be supplied.  See <a href="ACL2____LD.html">ld</a>.  (Note: This issue was raised some time ago 
 by Sol Swords.)</p> 
 
 <p>Substantially improved error messages for illegal applications of <a href="ACL2____THEORY-FUNCTIONS.html">theory functions</a> <span class="tt"><a href="ACL2____ENABLE.html">enable</a></span>, <span class="tt"><a href="ACL2____DISABLE.html">disable</a></span>, <span class="tt"><a href="ACL2____SET-DIFFERENCE-THEORIES.html">set-difference-theories</a></span>, <span class="tt"><a href="ACL2____UNION-THEORIES.html">union-theories</a></span>, and <span class="tt"><a href="ACL2____INTERSECTION-THEORIES.html">intersection-theories</a></span>.</p> 
 
 <p>Theory warnings have been enhanced to report enabling or disabling of the 
 definition <a href="ACL2____RUNE.html">rune</a> for an undefined <a href="ACL2____PRIMITIVE.html">primitive</a> like <a href="COMMON-LISP____CONS.html">cons</a>. 
 Thanks to Eric Smith for pointing out that ACL2 quietly lets one enable or 
 disable undefined primitives to no effect, and also for feedback leading to 
 improvements on the initial implementation of this change.  For details, see 
 <a href="ACL2____THEORIES-AND-PRIMITIVES.html">theories-and-primitives</a>, specifically the last section, which pertains 
 to primitives.</p> 
 
 <p>Removed the symbol <span class="v">let-beta-reduce</span> from the list 
 <span class="v">*initial-untouchable-fns*</span> because <span class="v">let-beta-reduce</span> is not a known 
 function symbol.</p> 
 
 <p>The <span class="v">:do-not-induct</span> hint no longer accepts keyword arguments other than 
 <span class="v">:otf-flg-override</span> and <span class="v">:otf</span>, which would produce illegal theorem 
 names in the report of skipped goals.  Thanks to Eric Smith for a query that 
 led us to clean this up.</p> 
 
 <p>Duplicate hypotheses have been eliminated for events generated by <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span>.  Thanks to David Rager for bringing this issue to our attention 
 and for helpful conversations.</p> 
 
 <p>It is now legal for the bindings of a <span class="tt"><a href="ACL2____STOBJ-LET.html">stobj-let</a></span> form to call 
 accessors of a stobj, <span class="v">st1</span>, on a stobj <span class="v">st2</span> that is congruent to 
 <span class="v">st1</span>.  See <a href="ACL2____NESTED-STOBJS.html">nested-stobjs</a>.  Thanks to Sol Swords for requesting and 
 explaining this feature, implementing it, and providing tests.  To see tests, 
 search for ``how congruent stobjs may be used in stobj-let'' in <a href="ACL2____COMMUNITY-BOOK.html">community-book</a> <span class="v">books/system/tests/nested-stobj-tests.lisp</span>.</p> 
 
 <p>A low-level error starting with ``HARD ACL2 ERROR in 
 FIND-MAPPING-PAIRS-TAIL'' has been eliminated.  This error could formerly 
 occur when using redefinition; see comments in ACL2 source function 
 <span class="v">find-mapping-pairs-tail1</span> for two simple examples.  We thank Yan Peng for 
 bringing this issue to our attention.  Note that although we make some effort 
 to support redefinition, we do not guarantee that it always works well; for a 
 relevant warning, see <a href="ACL2____LD-REDEFINITION-ACTION.html">ld-redefinition-action</a>.</p> 
 
 <p>Several related changes have been made in ``second-order'' 
 capabilities.</p> 
 
 <ul> 
 
 <li>The function <span class="tt"><a href="ACL2____MAGIC-EV-FNCALL.html">magic-ev-fncall</a></span> could invoke functions that should 
 not be invoked because they require a trust tag (see <a href="ACL2____DEFTTAG.html">defttag</a>) or they 
 are untouchable (see <a href="ACL2____PUSH-UNTOUCHABLE.html">push-untouchable</a>).  A check is now in place to 
 prevent this; see <a href="ACL2____MAGIC-EV-FNCALL.html">magic-ev-fncall</a>.  For example, evaluation of the form 
 <span class="v">(<a href="ACL2____MAGIC-EV-FNCALL.html">magic-ev-fncall</a> 'sys-call '("pwd" nil) state t nil)</span> no longer prints 
 the current directory; instead it results in an error.</li> 
 
 <li>It was possible for system function <span class="v">ev-fncall-w</span> to subvert such a 
 check by placing it under a <a href="ACL2____PROGRAM-WRAPPER.html">program-wrapper</a>; so <span class="v">ev-fncall-w</span> is now 
 untouchable.</li> 
 
 <li>A new function, <span class="v">ev-fncall-w!</span>, always performs the check, and may be 
 used in place of <span class="v">ev-fncall-w</span>.  But consider instead using the documented 
 <a href="ACL2____LOGIC.html">logic</a>-mode function <span class="tt"><a href="ACL2____MAGIC-EV-FNCALL.html">magic-ev-fncall</a></span>.</li> 
 
 <li>The first argument of <span class="v">magic-ev-fncall</span> no longer needs to be in <a href="ACL2____LOGIC.html">logic</a> mode.</li> 
 
 <li>
<span class="v">Magic-ev-fncall</span> can execute considerably more quickly than before; 
 thanks to Eric Smith for sending an example that helped us to implement this 
 improvement.</li> 
 
 <li>Both <span class="v">oracle-apply</span> and <span class="v">oracle-funcall</span> have been eliminated.  Use 
 <span class="tt"><a href="ACL2____MAGIC-EV-FNCALL.html">magic-ev-fncall</a></span> where you would otherwise use one of those.</li> 
 
 </ul> 
 
 <p>Expressions in <a href="ACL2____TABLE.html">table</a> <a href="ACL2____EVENTS.html">events</a> may now use not only the 
 variable, <span class="v">WORLD</span>, but also the variable, <span class="v">ENS</span>.  See <a href="ACL2____TABLE.html">table</a>.</p> 
 
 <h3>New Features</h3> 
 
 <p>A new utility, <span class="tt"><a href="ACL2____APPLY_42.html">apply$</a></span>, provides a weak version of the Common Lisp 
 second-order utility, <span class="v">apply</span>.  Using this new primitive the user can 
 define functions like <span class="v">map</span>, which can apply certain function symbols and 
 lambda expressions.</p> 
 
 <p>Added utility <span class="tt"><a href="ACL2____CHECKPOINT-SUMMARY-LIMIT.html">checkpoint-summary-limit</a></span>.  Thanks to Mihir Mehta for 
 an email leading to this addition.</p> 
 
 <p>A new utility, <span class="tt"><a href="ACL2____SET-REGISTER-INVARIANT-RISK.html">set-register-invariant-risk</a></span>, provides a way to avoid 
 inclusion of the <a href="ACL2____INVARIANT-RISK.html">invariant-risk</a> check in code generated by ACL2 for 
 executable-counterpart functions (see <a href="ACL2____EVALUATION.html">evaluation</a>).  The effect of 
 <span class="v">set-register-invariant-risk</span> is limited to the enclosing book or <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> event.  Thanks to Eric Smith for a discussion leading to this 
 feature.</p> 
 
 <p>The new functions <span class="v">read-object-with-case</span> and 
 <span class="v">print-object$-preserving-case</span> are variants of <span class="v">read-object</span> and 
 <span class="v">print-object$</span>, respectively.  The function <span class="v">read-object-with-case</span> 
 lets you specify that case is preserved, inverted, or converted to lower case 
 or (as with <span class="v">read-object</span>) to upper case.  The function 
 <span class="v">print-object$-preserving-case</span> prints symbols without escaping them for 
 case; for example, the symbol in the current package with name <span class="v">"abc"</span> is 
 printed as <span class="v">abc</span>, not as <span class="v">|abc|</span> as would be printed by 
 <span class="v">print-object$</span>.  See <a href="ACL2____IO.html">io</a>.</p> 
 
 <p>New macro <span class="v">with-output!</span> is the same as <span class="tt"><a href="ACL2____WITH-OUTPUT.html">with-output</a></span> except for 
 two differences: <span class="v">with-output!</span> can be called in code, but it does not 
 generate an event form.</p> 
 
 <p>Now <span class="v">complex-definition</span> is a disabled rewrite rule (formerly <a href="ACL2____RULE-CLASSES.html">rule-classes</a> <span class="v">nil</span>).  Also added (enabled) rules <span class="v">default-pkg-imports</span>, 
 <span class="v">default-code-char</span>, and <span class="v">default-intern-in-package-of-symbol</span>.  All of 
 these may be found in ACL2 source file <span class="v">axioms.lisp</span>.  Thanks to Keshav 
 Kini for email that led us to add these rules.</p> 
 
 <p>New function <span class="tt"><a href="ACL2____GET-ENFORCE-REDUNDANCY.html">get-enforce-redundancy</a></span> queries the <a href="ACL2____WORLD.html">world</a> on 
 whether redundancy is being enforced.  Thanks to Eric Smith for requesting 
 this feature.</p> 
 
 <p>It is now possible to obtain output that is less likely to depend on the 
 directory where it was created, by evaluating the form <span class="v">(<a href="ACL2____ASSIGN.html">assign</a> script-mode
 t)</span>.  (This capability supports the new tool, <span class="tt"><a href="ACL2____RUN-SCRIPT.html">run-script</a></span>.)</p> 
 
 <p>We added support for more detailed reports on the progress of 
 forward-chaining.  However these reports are only available on an experimental 
 basis by redefining the system function <span class="v">forward-chain1</span> as directed by a 
 comment at the top of that <span class="v">defun</span>.  Users who find this level of reporting 
 useful are encouraged to tell us as we could incorporate it into the 
 documentation topic, <a href="ACL2____FORWARD-CHAINING-REPORTS.html">forward-chaining-reports</a>.</p> 
 
 <p>Normally, hard error messages (see <a href="ACL2____ER.html">er</a>) are not inhibited.  A new 
 <a href="ACL2____STATE.html">state</a> global, <span class="v">INHIBIT-ER-HARD</span>, inhibits hard error messages when 
 <span class="v">ERROR</span> output is inhibited; see <a href="ACL2____SET-INHIBIT-OUTPUT-LST.html">set-inhibit-output-lst</a>.</p> 
 
 <h3>Heuristic and Efficiency Improvements</h3> 
 
 <p>The checking done for <a href="ACL2____INVARIANT-RISK.html">invariant-risk</a> has been relaxed, so that it no 
 longer causes any slowdown in calls of <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span>-mode functions.</p> 
 
 <p>A low-level system function, <span class="v">cross-prod</span> (which is used by <a href="ACL2____TAU-SYSTEM.html">tau-system</a>), now uses tail-recursion, which may avoid some stack 
 overflows.</p> 
 
 <p><a href="ACL2____FORWARD-CHAINING.html">Forward-chaining</a> was improved so that if a <span class="v">:forward-chaining</span> 
 rule produces a conclusion that is a disjunction, the system watches for later 
 <a href="ACL2____TYPE-SET.html">type-set</a> information about the disjuncts.  E.g., if we forward-chain to 
 <span class="v">(<a href="COMMON-LISP____OR.html">OR</a> p q)</span> and later in the same forward-chaining process <span class="v">q</span> becomes 
 false, then <span class="v">p</span> is made true.  We thank Dave Greve for providing an example 
 requiring this.</p> 
 
 <p>An optimization for removing <a href="ACL2____STOBJ.html">stobj</a> recognizers, long applied to 
 bodies of executable definitions, is now also applied to <a href="ACL2____GUARD.html">guard</a>s. 
 Thanks to Sol Swords for suggesting this change and its implementation.</p> 
 
 <p>The function <span class="tt"><a href="ACL2____RESIZE-LIST.html">resize-list</a></span> is now defined using <span class="tt"><a href="ACL2____MBE.html">mbe</a></span> so that 
 its execution is tail-recursive.  Thanks to Martin Simmons of LispWorks 
 Technical Support for diagnosing a stall in the certification of community 
 book <span class="v">books/centaur/truth/perm4.lisp</span> as being due to a stack overflow 
 caused by an invocation of <span class="v">resize-list</span>.  Based on his advice we no longer 
 automatically grow the stack in LispWorks; this will ease debugging when 
 compilation is done with safety 3.  The maximum stack size is 399998, at least 
 in our 64-bit LispWorks build.</p> 
 
 <h3>Bug Fixes</h3> 
 
 <p>Soundness bugs have been fixed in the handling of <span class="tt"><a href="ACL2____STOBJ-LET.html">stobj-let</a></span>, due to 
 aliasing that could take place by binding two different but congruent stobjs 
 to the same stobj.  To see examples, search for ``soundness'' in <a href="ACL2____COMMUNITY-BOOK.html">community-book</a> <span class="v">books/system/tests/nested-stobj-tests.lisp</span>.  We are very 
 grateful to Sol Swords not only for bringing this to our attention, but 
 especially for his contributions to a fix through helpful conversations and by 
 providing code and examples.</p> 
 
 <p>A bug in the <a href="ACL2____PROOF-BUILDER.html">proof-builder</a>'s command, <span class="v">rewrite</span> (or equivalently, 
 <span class="v">r</span>; see <a href="ACL2-PC____REWRITE.html">ACL2-pc::rewrite</a>), avoided creating necessary subgoals, 
 which can presumably be unsound.  That bad behavior could occur when the 
 third (and optional) argument of that command was a non-<span class="v">nil</span> value other 
 than <span class="v">t</span>.</p> 
 
 <p>The built-in evaluator functions for ACL2 relied on a system function, 
 <span class="v">ev-fncall-w</span>, that was not a function!  We do not see how to exploit this 
 oddity to prove <span class="v">nil</span>, since <span class="v">ev-fncall-w</span> is guaranteed never to be in 
 <a href="ACL2____LOGIC.html">logic</a> mode.  However, it is clearly undesirable.  In the following 
 example, the two <span class="v">ev-fncall-w</span> calls gave different answers on the same 
 inputs — <span class="v">(<a href="ACL2____MV.html">mv</a> nil 7)</span> and <span class="v">(<a href="ACL2____MV.html">mv</a> nil 12)</span> — but now the second 
 call results in an error.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x y) (<a href="COMMON-LISP_____B2.html">+</a> x y))
(<a href="ACL2____ASSIGN.html">assign</a> old-w (<a href="ACL2____W.html">w</a> state))
(ev-fncall-w 'foo '(3 4) (<a href="ACL2_____04.html">@</a> old-w) nil nil nil t nil)
(<a href="ACL2____U.html">u</a>)
(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x y) (<a href="COMMON-LISP_____A2.html">*</a> x y))
(ev-fncall-w 'foo '(3 4) (<a href="ACL2_____04.html">@</a> old-w) nil nil nil t nil)</pre> 
 
 <p>The check for the requisite theorems supporting a <span class="tt"><a href="ACL2____DEFABSSTOBJ.html">defabsstobj</a></span> event 
 included a case where the check was too weak, and it also could cause an 
 unexpected assertion.  The first of these could probably cause unsoundness. 
 Thanks to Sol Swords for finding these issues and providing fixes.</p> 
 
 <p>A small change in <span class="tt"><a href="ACL2____DEFSTOBJ.html">defstobj</a></span> can lead to improved automation for some 
 <span class="tt"><a href="ACL2____GUARD.html">guard</a></span> proofs involving <span class="tt"><a href="ACL2____STOBJ-LET.html">stobj-let</a></span>.  Thanks to Sol Swords for 
 sending an example, which guided us to add a test (as suggested by Eric 
 Smith) in community book <span class="v">system/tests/nested-stobj-formals.lisp</span>.</p> 
 
 <p>Formatted printing (with <span class="tt"><a href="ACL2____FMT.html">fmt</a></span>, <span class="tt"><a href="ACL2____CW.html">cw</a></span>, etc.) failed to respect 
 newlines encountered while processing <span class="v">~s</span> and <span class="v">~S</span> directives.  This 
 has been fixed; see <span class="v">books/system/tests/fmt-to-string.lisp</span> for examples 
 that behave well now but formerly did not.  Thanks to Eric Smith for pointing 
 out this problem and sending, in essence, the following example.</p> 
 
 <pre class="code">(<a href="ACL2____CW.html">cw</a> "~s0"
    (string-append-lst
     (<a href="COMMON-LISP____MAKE-LIST.html">make-list</a> 100
                :initial-element
                (<a href="COMMON-LISP____COERCE.html">coerce</a> '(#\A #\B #\C #\D #\E #\F
                          #\G #\H #\I #\J #\Newline)
                        'string))))</pre> 
 
 <p>A bug that was in the <a href="ACL2____TAU-SYSTEM.html">tau-system</a> is illustrated by the following 
 example sent by Grant Passmore, in which tau discovers that the function being 
 defined always returns <span class="v">nil</span>, hence implies everything.  Tau no longer 
 causes an error in this situation.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> f (x) (<a href="COMMON-LISP_____E3.html">&gt;</a> x 0))
(<a href="COMMON-LISP____DEFUN.html">defun</a> g (x) (<a href="COMMON-LISP_____C3.html">&lt;</a> x 0))
(<a href="COMMON-LISP____DEFUN.html">defun</a> h (x) (<a href="COMMON-LISP____AND.html">and</a> (f x) (<a href="ACL2____G.html">g</a> x)))</pre> 
 
 <p>Moreover, tau ``knows'' that the function <span class="v">h</span> above is contradictory, as 
 evidenced by the successful proof of the <span class="v">thm</span> below.</p> 
 
 <pre class="code">(<a href="ACL2____THM.html">thm</a>
 (<a href="ACL2____IMPLIES.html">implies</a> (h x) (<a href="COMMON-LISP____CONSP.html">consp</a> x))
 :hints (("Goal" :in-theory '((:e tau-system)))))</pre> 
 
 <p>Fixed a bug in <span class="v">:</span><span class="tt"><a href="ACL2____PE_12.html">pe!</a></span> that could result in an error in <span class="v">:pe!
 :here</span> when the most recent command is an <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> event.</p> 
 
 <p>It was possible to be in raw-mode, when including an uncertified book with 
 a call of <span class="tt"><a href="ACL2____PROGN_12.html">progn!</a></span> that first sets raw-mode <span class="tt"><a href="ACL2____SET-RAW-MODE.html">set-raw-mode</a></span> and 
 then causes a raw Lisp error.  This has been fixed.</p> 
 
 <p>It is now possible to invoke <span class="tt"><a href="ACL2____VERIFY-TERMINATION.html">verify-termination</a></span> without an error 
 occurring due to the presence of untouchable variables or functions in the 
 definition (which hadn't prevented earlier admission in <a href="ACL2____PROGRAM.html">program</a> mode). 
 Thanks To Eric Smith for bringing this issue to our attention.</p> 
 
 <p>ACL2 has supported, and continues to support, <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> forms that 
 include the ACL2 <a href="ACL2____STATE.html">state</a> as an argument without declaring <span class="v">state</span> 
 explicitly to be a <a href="ACL2____STOBJ.html">stobj</a>.  This is done by first evaluating 
 <span class="v">(<a href="ACL2____SET-STATE-OK.html">set-state-ok</a> t)</span>.  But in that case, the guard for such a function 
 erroneously failed to include <span class="v">(state-p state)</span>, which can have unfortunate 
 consequences; see <span class="v">books/system/tests/state-p-in-guard.lisp</span> in the <a href="ACL2____COMMUNITY-BOOKS.html">community-books</a>.  This has been fixed.  Thanks to Alessandro Coglio for 
 contributing a fix and for helpful conversations.</p> 
 
 <p>Fixed bugs in reporting of errors and warnings by <span class="tt"><a href="ACL2____DEFCHOOSE.html">defchoose</a></span> when 
 pertaining to ignored variables.  Thanks to Eric Smith for bringing one of 
 these to our attention.</p> 
 
 <p>Fixed a bug in the <a href="ACL2____PROOF-BUILDER.html">proof-builder</a>: <a href="ACL2____HINTS.html">hints</a> on the <span class="v">prove</span> 
 command were not being passed down to induction.  Thanks to Mihir Mehta for 
 bringing this bug to our attention with a reproducible example.</p> 
 
 <p>Fixed a low-level bug (in source functions <span class="v">note-relieve-hyp-failure</span>), 
 discovered by using the new community book 
 <span class="v">books/system/check-system-guards.lisp</span>.  That book, which is useful for 
 system development, checks all top-level calls of built-in functions that are 
 in <a href="ACL2____LOGIC.html">logic</a> mode, <a href="ACL2____GUARD.html">guard</a>-verified.</p> 
 
 <h3>Changes at the System Level</h3> 
 
 <p>When building the combined manual, an error occurs if there is more than 
 the single expected broken link.  Thanks to Alessandro Coglio for helpful 
 discussions.  <i>Notes.</i> (1) This uses a new keyword argument available in 
 <span class="tt"><a href="XDOC____SAVE.html">xdoc::save</a></span>, <span class="v">:broken-links-limit</span>.  (2) There is no such limit for 
 saving the text-based manual.</p> 
 
 <p>As usual, several <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> improvements have been 
 made, for example, clarification made in the topic <a href="ACL2____LOCAL-INCOMPATIBILITY.html">local-incompatibility</a> thanks to Keshav Kini and Yan Peng.  A new 
 documentation topic, <a href="ACL2____EVALUATION.html">evaluation</a>, is probably long overdue: it 
 explains ACL2 evaluation with a focus on the notions of the 
 ``executable-counterpart function'' (sometimes called the ``*1* 
 function'') and the ``submitted function'' (sometimes called the 
 ``raw-Lisp function'').</p> 
 
 <p>Environment variable <span class="v">SBCL_USER_ARGS</span> allows one to pass runtime-options 
 to calls of ACL2 built on SBCL, without having to call <span class="tt"><a href="ACL2____SAVE-EXEC.html">save-exec</a></span>. 
 Thanks to Sol Swords for requesting this capability.  Example:</p> 
 
 <pre class="code">(export SBCL_USER_ARGS="--lose-on-corruption" ; ./sbcl-saved_acl2)</pre> 
 
 <p>There is a new documentation topic, <a href="ACL2____TALKS.html">talks</a>, which has a link from the 
 ACL2 home page (with Applications, Tours, and Tutorials/Demos).  Additional 
 contributions to this topic are welcomed!</p> 
 
 <p>For SBCL, the runtime option <span class="v">--disable-ldb</span> is now supplied by the 
 <span class="v">saved_acl2</span> script, which avoids passing control to the 
 lowest-level (<span class="v">ldb</span>) debugger (from which recovery is probably impossible). 
 Without this option, a parallel run of <span class="v">cert.pl</span> (see <a href="BUILD____CERT.PL.html">build::cert.pl</a>) can stall out when a single failure passes control to the 
 <span class="v">ldb</span> debugger.</p> 
 
 <p>Some infinite loops are now avoided in the debugger for SBCL (and perhaps 
 some other Lisp implementations).  Thanks to Keshav Kini for sending an 
 example and suggesting a fix, which we incorporated, as well as for helpful 
 conversations.  Implementation note: the definition of constant 
 <span class="v">*our-standard-io*</span> in ACL2 source file <span class="v">interface-raw.lisp</span> explains 
 the issue.</p> 
 
 <p>Warnings were being produced by <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> in CCL, and perhaps 
 some other Lisps, when including a book that redefines a function as a macro 
 or vice-versa.  We have eliminated those raw Lisp warnings.</p> 
 
 <p>It is now checked that the <span class="v">books/</span> directory exists before attempting 
 any operations using <span class="v">'make'</span> on that directory.  Thanks to Keshav Kini for 
 suggesting this check, since there are source-only distributions, without the 
 books.</p> 
 
 <p>(SBCL only) The setting of environment variable <span class="v">SBCL_HOME</span> has been 
 tweaked to be more robust.  In particular, we expect it to be unnecessary, and 
 even inadvisable, to set <span class="v">SBCL_HOME</span> manually.  Thanks to Keshav Kini for 
 contributing this change.</p> 
 
 <p>(CMUCL only) ACL2 Version  8.0 cannot be reliably run on CMUCL, so we have 
 disabled building ACL2 on CMUCL.  The CMUCL implementor is aware of the 
 problem, and we are hoping for a fix before the next ACL2 release</p> 
 
 <p>The <a href="ACL2____STATE.html">state</a> global variables, <span class="v">serialize-character-system</span> and 
 <span class="v">serialize-character</span>, are now preserved after <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> 
 expansion.  This change for <span class="v">serialize-character-system</span> allows the use of 
 <span class="v">make-event</span> to avoid a stack overflow when writing out a <a href="ACL2____CERTIFICATE.html">certificate</a> file; see <a href="ACL2____SET-SERIALIZE-CHARACTER-SYSTEM.html">set-serialize-character-system</a>.</p> 
 
 <h3>EMACS Support</h3> 
 
 <p>Now, tags table <span class="v">TAGS-acl2-doc</span> is automatically built when building the 
 manual unless environment variable <span class="v">TAGS_ACL2_DOC</span> has value <span class="v">SKIP</span>.  It 
 can also be built by using the new event <span class="tt"><a href="XDOC____SAVE-RENDERED-EVENT.html">xdoc::save-rendered-event</a></span>. 
 See <a href="ACL2____ACL2-DOC.html">ACL2-doc</a> and see <a href="XDOC____SAVE-RENDERED-EVENT.html">xdoc::save-rendered-event</a>.  Thanks to Eric 
 Smith and David Rager for discussions leading to this enhancement.  That tags 
 table can also be built when building ACL2; see <a href="ACL2____ACL2-DOC.html">ACL2-doc</a>.</p> 
 
 <p>Made miscellaneous fixes for <a href="ACL2____ACL2-DOC.html">ACL2-doc</a>: added <span class="v">Shift-&lt;tab&gt;</span> 
 (more precisely, <span class="v">&lt;backtab&gt;</span> to do the same thing as 
 <span class="v">Control-&lt;tab&gt;</span> (thanks to Eric McCarthy for the suggestion), avoided the 
 use of <span class="v">setf</span> (not always defined without requiring the <span class="v">cl</span> package), 
 avoided a potential error (when variable <span class="v">large-file-warning-threshold</span> is 
 <span class="v">nil</span>), and avoided an infinite loop on some platforms when quitting 
 acl2-doc.</p> 
 
 <p>Defined `<span class="v">meta-,</span>' in <span class="v">emacs/emacs-acl2.el</span> to be Emacs function 
 <span class="v">tags-loop-continue</span>, which is how it has traditionally been defined by 
 Emacs but might be defined differently in some versions of Emacs 25 (and 
 perhaps later).  <b>NOTE</b>: Put <span class="v">(setq *preserve-tags-loop-continue* t)</span> 
 in your <span class="v">.emacs</span> file before loading ACL2 file <span class="v">emacs/emacs-acl2.el</span>, if 
 you want to avoid redefining `<span class="v">meta-,</span>'.  Thanks to Keshav Kini and Mihir 
 Mehta for helpful discussions.</p> 
 
 <p>Removed both non-ascii characters from <span class="v">emacs/emacs-acl2.el</span>.  Thanks to 
 Keshav Kini for the suggestion.</p> 
 
 <p>For documentation printed at the terminal with <span class="v">:</span><span class="tt"><a href="ACL2____DOC.html">doc</a></span>, links 
 (enclosed in in square brackets, ``[..]'') continue to be printed with respect 
 to the <span class="v">"ACL2"</span> package (that is, as though the current package were 
 <span class="v">"ACL2"</span>).  Now, however, where a link formerly might be printed as 
 ``[acl2::foo]'', it is now printed as ``[foo]''; that is, a package prefix of 
 <span class="v">"ACL2"</span> (regardless of case) is not printed.</p> 
 
 <h3>Experimental Versions</h3> 
 
 <p>Improved <a href="ACL2____TYPE-SET.html">type-set</a> reasoning for the function, <span class="tt"><a href="COMMON-LISP____IMAGPART.html">imagpart</a></span>. 
 Thanks to Keshav Kini for identifying the problem and suggesting a code 
 change, and for sending an example of a theorem that formerly failed to be 
 proved in ACL2(r).</p> 
 
 <p>Improved <a href="ACL2____TYPE-SET.html">type-set</a> reasoning for the function, <span class="tt"><a href="COMMON-LISP____COMPLEX.html">complex</a></span>. 
 Thanks to Keshav Kini for identifying the problem and sending a patch, which 
 we installed, together with examples of theorems that formerly failed to be 
 proved in ACL2(r) but now prove, in particular:</p> 
 
 <pre class="code">(<a href="ACL2____THM.html">thm</a> (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____REAL_F2RATIONALP.html">real/rationalp</a> a)
                   (<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____RATIONALP.html">rationalp</a> a)))
              (<a href="COMMON-LISP____NOT.html">not</a> (<a href="ACL2____COMPLEX-RATIONALP.html">complex-rationalp</a> (<a href="COMMON-LISP____COMPLEX.html">complex</a> a b)))))</pre> 
 
 <p>Since <span class="tt"><a href="ACL2____WORMHOLE.html">wormhole</a></span> uses a lock (and has for some time), we modified 
 <span class="tt"><a href="ACL2____OBSERVATION-CW.html">observation-cw</a></span> so that it uses the same wormhole printing in ACL2(p) 
 (instead of using <span class="tt"><a href="ACL2____CW.html">cw</a></span>) that is used in regular ACL2.  Thanks to David 
 Rager for a helpful discussion.  If you see an increase in hangs while using 
 ACL2(p), please contact the implementors.</p> 
 
 <p>Fixed an infinite loop that could be caused with parallelism enabled when 
 there is an error, when Lisp variable <span class="v">*hard-error-is-error*</span> has been set 
 to a non-<span class="v">nil</span> value in raw Lisp (see <a href="ACL2____HARD-ERROR.html">hard-error</a>).</p> 
 
 
</body>
</html>
