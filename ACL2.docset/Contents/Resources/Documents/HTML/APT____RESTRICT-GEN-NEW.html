<html>
<head>
<meta charset="UTF-8">
<title>Restrict-gen-new</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=APT____RESTRICT-GEN-NEW">Click for Restrict-gen-new in the Full Manual</a></h3>

<p>Generate the new function definition.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(restrict-gen-new old restriction undefined 
                  new new-enable verify-guards wrld) 
 
  → 
(mv local-event exported-event)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">old</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> old)</span>.</font>
</dd> 
  <dd>
<span class="tt">restriction</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> restriction)</span>.</font>
</dd> 
  <dd>
<span class="tt">undefined</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> undefined)</span>.</font>
</dd> 
  <dd>
<span class="tt">new</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> new)</span>.</font>
</dd> 
  <dd>
<span class="tt">new-enable</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> new-enable)</span>.</font>
</dd> 
  <dd>
<span class="tt">verify-guards</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> verify-guards)</span>.</font>
</dd> 
  <dd>
<span class="tt">wrld</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PLIST-WORLDP.html">plist-worldp</a> wrld)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">local-event</span> — A <span class="tt"><a href="ACL2____PSEUDO-EVENT-FORMP.html">pseudo-event-formp</a></span>.</dd> 
<dd>
<span class="tt">exported-event</span> — A <span class="tt"><a href="ACL2____PSEUDO-EVENT-FORMP.html">pseudo-event-formp</a></span>.</dd> 
 
</dl></div> 
<p> 
   The macro used to introduce the new function is determined by 
   whether the new function must be 
   enabled or not, and non-executable or not. 
   We make it non-executable if and only if <span class="v">old</span> is non-executable. 
   </p> 
   <p> 
   The new function has the same formal arguments as the old function. 
   </p> 
   <p> 
   The body of the new function is obtained 
   from the body of the old function 
   by replacing every occurrence of the old function 
   with the new function 
   (a no-op if the old function is not recursive), 
   and then wrapping the resulting term with a conditional 
   that tests the restricting predicate, 
   as described in the documentation. 
   Thus, the new function is recursive iff the old function is. 
   If the old function is non-executable, 
   the non-executable wrapper is removed first. 
   </p> 
   <p> 
   If the new function is recursive, 
   its well-founded relation and measure are the same as the old function's. 
   Following the design notes, 
   the termination of the new function is proved 
   in the empty theory, using the termination theorem of the old function; 
   this should work also if the function is reflexive, 
   because of the automatic functional instantiation described in (6) of the 
   <a href="ACL2____LEMMA-INSTANCE.html">lemma instance documentation</a>. 
   The new function uses all ruler extenders, 
   in case the old function's termination depends on any ruler extender. 
   </p> 
   <p> 
   The guard of the new function is obtained 
   by conjoining the restricting predicate 
   after the guard of the old function, 
   as described in the documentation. 
   Since the restriction test follows from the guard, 
   it is wrapped with <span class="tt"><a href="ACL2____MBT_42.html">mbt$</a></span>. 
   </p> 
   <p> 
   Guard verification is deferred; 
   see <span class="tt"><a href="APT____RESTRICT-GEN-VERIFY-GUARDS.html">restrict-gen-verify-guards</a></span>. 
   </p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>restrict-gen-new</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 restrict-gen-new
 (old restriction undefined
      new new-enable verify-guards wrld)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> old)
                             (<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> restriction)
                             (<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> undefined)
                             (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> new)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> new-enable)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> verify-guards)
                             (<a href="ACL2____PLIST-WORLDP.html">plist-worldp</a> wrld))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'restrict-gen-new))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   ((macro
       (<a href="ACL2____FUNCTION-INTRO-MACRO.html">function-intro-macro</a> new-enable (<a href="ACL2____NON-EXECUTABLEP.html">non-executablep</a> old wrld)))
    (<a href="ACL2____FORMALS.html">formals</a> (<a href="ACL2____FORMALS.html">formals</a> old wrld))
    (old-body (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____NON-EXECUTABLEP.html">non-executablep</a> old wrld)
                  (<a href="ACL2____UNWRAPPED-NONEXEC-BODY.html">unwrapped-nonexec-body</a> old wrld)
                  (<a href="ACL2____UBODY.html">ubody</a> old wrld)))
    (new-body-core (<a href="ACL2____SUBLIS-FN-SIMPLE.html">sublis-fn-simple</a> (<a href="COMMON-LISP____ACONS.html">acons</a> old new nil)
                                     old-body))
    (new-body
         (<a href="COMMON-LISP____CONS.html">cons</a> 'if
               (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'mbt$ (<a href="COMMON-LISP____CONS.html">cons</a> restriction 'nil))
                     (<a href="COMMON-LISP____CONS.html">cons</a> new-body-core (<a href="COMMON-LISP____CONS.html">cons</a> undefined 'nil)))))
    (new-body (<a href="ACL2____UNTRANSLATE.html">untranslate</a> new-body nil wrld))
    (recursive (<a href="ACL2____RECURSIVEP.html">recursivep</a> old nil wrld))
    (wfrel? (<a href="COMMON-LISP____AND.html">and</a> recursive
                 (<a href="ACL2____WELL-FOUNDED-RELATION.html">well-founded-relation</a> old wrld)))
    (measure? (<a href="COMMON-LISP____AND.html">and</a> recursive
                   (<a href="ACL2____UNTRANSLATE.html">untranslate</a> (<a href="ACL2____MEASURE.html">measure</a> old wrld)
                                nil wrld)))
    (termination-hints?
     (<a href="COMMON-LISP____AND.html">and</a>
      recursive
      (<a href="COMMON-LISP____CONS.html">cons</a>
           (<a href="COMMON-LISP____CONS.html">cons</a> '"Goal"
                 (<a href="COMMON-LISP____CONS.html">cons</a> ':in-theory
                       (<a href="COMMON-LISP____CONS.html">cons</a> 'nil
                             (<a href="COMMON-LISP____CONS.html">cons</a> ':use
                                   (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> ':termination-theorem
                                               (<a href="COMMON-LISP____CONS.html">cons</a> old 'nil))
                                         'nil)))))
           'nil)))
    (old-guard (<a href="ACL2____GUARD.html">guard</a> old nil wrld))
    (new-guard (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> old-guard restriction)
                   old-guard
                   (<a href="ACL2____CONJOIN2.html">conjoin2</a> old-guard restriction)))
    (new-guard (<a href="ACL2____UNTRANSLATE.html">untranslate</a> new-guard t wrld))
    (local-event
     (<a href="COMMON-LISP____CONS.html">cons</a>
      'local
      (<a href="COMMON-LISP____CONS.html">cons</a>
       (<a href="COMMON-LISP____CONS.html">cons</a>
        macro
        (<a href="COMMON-LISP____CONS.html">cons</a>
         new
         (<a href="COMMON-LISP____CONS.html">cons</a>
          formals
          (<a href="COMMON-LISP____CONS.html">cons</a>
           (<a href="COMMON-LISP____CONS.html">cons</a>
            'declare
            (<a href="COMMON-LISP____CONS.html">cons</a>
             (<a href="COMMON-LISP____CONS.html">cons</a>
                'xargs
                (<a href="COMMON-LISP____APPEND.html">append</a>
                     (<a href="COMMON-LISP____AND.html">and</a> recursive
                          (<a href="COMMON-LISP____LIST.html">list</a> :well-founded-relation wfrel?
                                :measure measure?
                                :hints termination-hints?
                                :ruler-extenders :all))
                     (<a href="COMMON-LISP____CONS.html">cons</a> ':guard
                           (<a href="COMMON-LISP____CONS.html">cons</a> new-guard '(:verify-guards nil)))))
             'nil))
           (<a href="COMMON-LISP____CONS.html">cons</a> new-body 'nil)))))
       'nil)))
    (exported-event
     (<a href="COMMON-LISP____CONS.html">cons</a>
      macro
      (<a href="COMMON-LISP____CONS.html">cons</a>
       new
       (<a href="COMMON-LISP____CONS.html">cons</a>
        formals
        (<a href="COMMON-LISP____CONS.html">cons</a>
         (<a href="COMMON-LISP____CONS.html">cons</a>
          'declare
          (<a href="COMMON-LISP____CONS.html">cons</a>
           (<a href="COMMON-LISP____CONS.html">cons</a>
            'xargs
            (<a href="COMMON-LISP____APPEND.html">append</a> (<a href="COMMON-LISP____AND.html">and</a> recursive
                         (<a href="COMMON-LISP____LIST.html">list</a> :well-founded-relation wfrel?
                               :measure measure?
                               :ruler-extenders :all))
                    (<a href="COMMON-LISP____CONS.html">cons</a> ':guard
                          (<a href="COMMON-LISP____CONS.html">cons</a> new-guard
                                (<a href="COMMON-LISP____CONS.html">cons</a> ':verify-guards
                                      (<a href="COMMON-LISP____CONS.html">cons</a> verify-guards 'nil))))))
           'nil))
         (<a href="COMMON-LISP____CONS.html">cons</a> new-body 'nil)))))))
   (<a href="ACL2____MV.html">mv</a> local-event exported-event))))</pre> 

</body>
</html>
