<html>
<head>
<meta charset="UTF-8">
<title>Smtlink</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=SMT____SMTLINK">Click for Smtlink in the Full Manual</a></h3>

<p>Tutorial and documentation for the ACL2 book, Smtlink.</p><h3>Introduction</h3> 
<p>A framework for integrating external SMT solvers into ACL2 based on the 
  <a href="ACL2____CLAUSE-PROCESSOR.html">ACL2::clause-processor</a> and the <span class="tt"><a href="ACL2____COMPUTED-HINTS.html">ACL2::computed-hints</a></span> 
  mechanism.</p> 
 
<h4>Overview</h4> 
<p><span class="v">Smtlink</span> is a framework for representing suitable ACL2 theorems as a SMT 
(Satisfiability Modulo Theories) formula, and calling SMT solvers from within 
ACL2.</p> 
 
<p>SMT solvers combine domain-specific techniques together into a SAT 
(Satisfiability) Solver and solves domain-specific satisfiability problems. 
Typical domain specific procedures include procedures in integer and real, 
linear and non-linear arithmetic, array theory, and uninterpreted function 
theory.  Modern SMT solvers benefit from the development of both the SAT 
solvers and the domain-specific techniques and have become very fast at solving 
some relatively large problems.</p> 
 
<p>In the 2018 Workshop version, we call it <span class="v">smtlink 2.0</span>, we make major 
improvements over the initial version with respect to soundness, extensibility, 
ease-of-use, and the range of types and associated theory-solvers supported. 
Most theorems that one would want to prove using an SMT solver must first be 
translated to use only the primitive operations supported by the SMT solver -- 
this translation includes function expansion and type inference.  <span class="v">Smtlink
2.0</span> performs this translation using sequence of steps performed by verified 
clause processors and computed hints.  These steps are ensured to be sound. 
The final transliteration from ACL2 to Z3's Python interface requires a trusted 
clause processor.  This is a great improvement in soundness and extensibility 
over the the original <span class="v">Smtlink</span> which was implemented as a single, 
monolithic, trusted clause processor.  <span class="v">Smtlink 2.0</span> provides support for 
<span class="tt"><a href="ACL2____FTY.html">ACL2::fty</a></span>, <span class="tt"><a href="FTY____DEFPROD.html">defprod</a></span>, <span class="tt"><a href="FTY____DEFLIST.html">deflist</a></span>, <span class="tt"><a href="FTY____DEFALIST.html">defalist</a></span>, and <span class="tt"><a href="FTY____DEFOPTION.html">defoption</a></span> types by using Z3's arrays and user 
defined data types.</p> 
 
<p><span class="v">Smtlink</span> can be used both in ACL2 and ACL2(r).  The macro <a href="ACL2____REAL_F2RATIONALP.html">Real/rationalp</a> should make one's proof portable between ACL2 and ACL2(r). It 
is also compatible with both Python 2 and Python 3.</p> 
 
<p><span class="v">Smtlink</span> currently only supports <a href="https://github.com/Z3Prover/z3/wiki" target="_blank"><nobr>Z3<img src="../Icon_External_Link.png" title="External link to https://github.com/Z3Prover/z3/wiki"></nobr></a>.  We hope to add an interface 
to include the <a href="http://smtlib.cs.uiowa.edu/" target="_blank"><nobr>SMT-LIB<img src="../Icon_External_Link.png" title="External link to http://smtlib.cs.uiowa.edu/"></nobr></a> in near 
future.</p> 
 
<h3>Using Smtlink</h3> 
<h4>Requirements</h4> 
<ul> 
<li>Python 2/3 is properly installed.</li> 
<li>Z3 is properly installed. 
<p>One needs to build Z3 on one's own instead of using the binary release. 
Also, since we are using the Python interface, please follow the "python" 
section in the "z3 bindings" section in <a href="https://github.com/Z3Prover/z3/" target="_blank"><nobr>README<img src="../Icon_External_Link.png" title="External link to https://github.com/Z3Prover/z3/"></nobr></a> of Z3.</p> 
<p>I've also wrote a small piece of <a href="SMT____Z3-INSTALLATION.html">z3-installation</a> document about how 
to install Z3 and its Python API.</p> 
<p>To check if Z3 is properly installed, run Python, which will put you in an 
interactive loop. Then run:</p> 
<pre class="code">from z3 import *
x = Real('x')
y = Real('y')
s = Solver()
s.add(x + y &gt; 5, x &gt; 1, y &gt; 1)
print(s.check())
print(s.model())
quit()</pre> 
<p>One should expect some results like:</p> 
<pre class="code">&gt;&gt;&gt; print(s.check())
sat
&gt;&gt;&gt; print(s.model())
[y = 4, x = 2]</pre> 
</li> 
<li>ACL2 and the system books are properly installed.</li> 
<li>
<span class="v">Smtlink</span> uses Unix commands.</li> 
</ul> 
 
<h4>Build Smtlink</h4> 
<ul> 
<li>Setup smtlink configuration in file smtlink-config in either a user 
specified directory <span class="v">$SMT_HOME</span> or in directory <span class="v">$HOME</span>.  When both 
environment variables are set, <span class="v">$SMT_HOME</span> is used. The configuration takes 
below format: 
<pre class="code">smt-cmd=...</pre> 
<div class="box"> 
<p> 
<b><font color="#FF0000">NOTE:</font></b> 
It used to be four options, we simplified it into just one <span class="v">smt-cmd</span>. 
</p> 
</div> 
 
<p><span class="v">smt-cmd</span> is the command for running Z3, which is the Python command 
since we are using the Python interface.  The Z3 library is imported into Python 
in the scripts written out by Smtlink like is shown in the example script in 
"Requirements".</p>
</li> 
<li>Certify the book top.lisp in the Smtlink directory, to bake setup into 
certified books. 
<p>This took about 8 mins on my 4-core mac with hyperthreading <span class="v">-j 2</span>.</p> 
<div class="box"> 
<p> 
<b><font color="#FF0000">NOTE:</font></b> 
A complete recertification of Smtlink is required if one changes the 
configuration in smtlink-config. 
</p> 
</div> 
</li> 
 
</ul> 
 
<h4>Load and Setup Smtlink</h4> 
<p>To use <span class="v">Smtlink</span>, one needs to include book:</p> 
<pre class="code">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "projects/smtlink/top" :dir :system)</pre> 
<p>Then one needs to enable <span class="tt"><a href="ACL2____TSHELL.html">ACL2::tshell</a></span> by doing:</p> 
<pre class="code">(<a href="ACL2____VALUE-TRIPLE.html">value-triple</a> (<a href="ACL2____TSHELL-ENSURE.html">tshell-ensure</a>))</pre> 
<p><span class="tt"><a href="ACL2____VALUE-TRIPLE.html">value-triple</a></span> makes sure the form <span class="v">(<a href="ACL2____TSHELL-ENSURE.html">tshell-ensure</a>)</span> can be 
submitted in an event context and therefore is certifiable.</p> 
<p>In order to install the computed-hint, one needs to 
<a href="ACL2____ADD-DEFAULT-HINTS.html">add-default-hints</a>.</p> 
<pre class="code">(<a href="ACL2____ADD-DEFAULT-HINTS.html">add-default-hints</a> '((<a href="SMT____SMT-COMPUTED-HINT.html">SMT::SMT-computed-hint</a> clause)))</pre> 
<div class="box"> 
<p> 
<b><font color="#FF0000">NOTE:</font></b> 
The computed-hint used to be called <span class="v">SMT::SMT-process-hint</span>, we find this name 
  doesn't represent what it does. We changed the name to 
  <span class="v">SMT::SMT-computed-hint</span>. 
</p> 
</div> 
 
<p>For a detail description of how to setup and get started using <span class="v">Smtlink</span>, 
see <span class="tt"><a href="SMT____TUTORIAL.html">tutorial</a></span> and <span class="tt"><a href="SMT____SMT-HINT.html">SMT-hint</a></span>.</p> 
 
<h3>Reference</h3> 
<p><span class="v">Smtlink</span> has experienced a great interface and infrastructure change 
since its first publication at ACL2 workshop 2015.  But you may still find below 
paper useful in understanding basics of <span class="v">Smtlink</span>:</p> 
 
<p>Yan Peng and Mark R. Greenstreet. <a href="https://arxiv.org/abs/1509.06082" target="_blank"><nobr>Extending ACL2 with SMT Solvers<img src="../Icon_External_Link.png" title="External link to https://arxiv.org/abs/1509.06082"></nobr></a>In 
ACL2 Workshop 2015. October 2015. EPTCS 192. Pages 61-77.</p>
</body>
</html>
