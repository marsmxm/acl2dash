<html>
<head>
<meta charset="UTF-8">
<title>Program-wrapper</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____PROGRAM-WRAPPER">Click for Program-wrapper in the Full Manual</a></h3>

<p>Avoiding expensive guard checks using <a href="ACL2____PROGRAM.html">program</a>-mode functions</p><p>Application programs can benefit from the avoidance of expensive 
 <a href="ACL2____GUARD.html">guard</a> checks, as illustrated by the following contrived example.  In 
 this example, imagine that <span class="v">expensive-guard</span> is a <a href="ACL2____GUARD.html">guard</a> that is 
 expensive to evaluate, and that <span class="v">expensive-update</span> is a function that you 
 want to run in a context where you know the guard is true, so you want to 
 avoid the expense of evaluating that guard.  Then when you call 
 <span class="v">expensive-update-wrapper</span>, the call will be evaluated directly in raw 
 Lisp, hence without any subsidiary guard-checking for the function 
 <span class="v">expensive-update</span>.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> fib (n)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="ACL2____NATP.html">natp</a> n)))
  (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____ZP.html">zp</a> n)
      0
    (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____EQL.html">eql</a> n 1)
        1
      (<a href="COMMON-LISP_____B2.html">+</a> (fib (<a href="COMMON-LISP____-.html">-</a> n 1))
         (fib (<a href="COMMON-LISP____-.html">-</a> n 2))))))

(<a href="COMMON-LISP____DEFUN.html">defun</a> expensive-guard (n)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t))
  (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____NATP.html">natp</a> n)
       (<a href="ACL2____NATP.html">natp</a> (fib n))))

(<a href="ACL2____DEFSTOBJ.html">defstobj</a> st (fld :type integer :initially 0))

(<a href="COMMON-LISP____DEFUN.html">defun</a> expensive-update (n st)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs st
                  :guard (expensive-guard n)))
  (update-fld n st))

(<a href="COMMON-LISP____DEFUN.html">defun</a> expensive-update-wrapper (n st)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs st :mode :program))
  (expensive-update n st))</pre> 
 
 <p>Remark.  The example was chosen to illustrates an additional point: if you 
 evaluate (for example) the form <span class="v">(expensive-update-wrapper 3 st)</span>, you will 
 see an <span class="v">"Invariant-risk"</span> warning, which could indicate extra checks that 
 slow down evaluation.  This might not be a significant issue in practice.  See 
 <a href="ACL2____INVARIANT-RISK.html">invariant-risk</a>.</p>
</body>
</html>
