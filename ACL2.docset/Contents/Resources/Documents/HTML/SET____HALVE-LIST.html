<html>
<head>
<meta charset="UTF-8">
<title>Halve-list</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=SET____HALVE-LIST">Click for Halve-list in the Full Manual</a></h3>

<p>How we split the list for mergesort.</p><p>Originally I used the following function to split the list.</p> 
 
<pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> split-list-old (x)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="ACL2____TRUE-LISTP.html">true-listp</a> x)))
  (<a href="COMMON-LISP____COND.html">cond</a> ((<a href="COMMON-LISP____ENDP.html">endp</a> x) (<a href="ACL2____MV.html">mv</a> nil nil))
        ((<a href="COMMON-LISP____ENDP.html">endp</a> (<a href="COMMON-LISP____CDR.html">cdr</a> x)) (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP____LIST.html">list</a> (<a href="COMMON-LISP____CAR.html">car</a> x)) nil))
        (t (<a href="ACL2____MV-LET.html">mv-let</a> (part1 part2)
                   (split-list-old (<a href="COMMON-LISP____CDDR.html">cddr</a> x))
                   (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CAR.html">car</a> x) part1)
                       (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CADR.html">cadr</a> x) part2)))))))</pre> 
 
<p>But David Rager noted that this was not tail recursive, and accordingly it 
ran into trouble on large data sets.  Accordingly, in Version 0.91, I rewrote 
this to be tail recursive:</p> 
 
<pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> split-list (x acc acc2)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="ACL2____TRUE-LISTP.html">true-listp</a> x)))
  (<a href="COMMON-LISP____COND.html">cond</a> ((<a href="COMMON-LISP____ENDP.html">endp</a> x)
         (<a href="ACL2____MV.html">mv</a> acc acc2))
        ((<a href="COMMON-LISP____ENDP.html">endp</a> (<a href="COMMON-LISP____CDR.html">cdr</a> x))
         (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CAR.html">car</a> x) acc) acc2))
        (t (split-list (<a href="COMMON-LISP____CDDR.html">cddr</a> x)
                       (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CAR.html">car</a> x) acc)
                       (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CADR.html">cadr</a> x) acc2)))))</pre> 
 
<p>Since then, I wrote the <span class="v">defsort/defsort</span> library, which uses some tricks 
to provide a faster mergesort.  One key optimization is to take the first and 
second halves of the list, rather than splitting the list in terms of evens and 
odds.  This allows you to split the list with half as much consing.</p> 
 
<p>Defsort's approach uses a lot of arithmetic optimization.  I later wrote a 
mergesort for Milawa, where arithmetic is expensive.  Here, I implemented 
split-list by walking down "one cdr" and "two cdrs" at a time.  I now use 
this same strategy in osets.</p> 
 
<p>BOZO this strategy is still stupidly re-consing up half the list, when 
really we could avoid that by just being a bit smarter, like in defsort.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>halve-list-aux</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> halve-list-aux (mid x acc)
       (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> (<a href="ACL2____LEN.html">len</a> x) (<a href="ACL2____LEN.html">len</a> mid))))
       (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____OR.html">or</a> (<a href="COMMON-LISP____ATOM.html">atom</a> x) (<a href="COMMON-LISP____ATOM.html">atom</a> (<a href="COMMON-LISP____CDR.html">cdr</a> x)))
           (<a href="ACL2____MV.html">mv</a> acc mid)
           (halve-list-aux (<a href="COMMON-LISP____CDR.html">cdr</a> mid)
                           (<a href="COMMON-LISP____CDR.html">cdr</a> (<a href="COMMON-LISP____CDR.html">cdr</a> x))
                           (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CAR.html">car</a> mid) acc))))</pre> 
<p><b>Function: </b>halve-list</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> halve-list (x)
       (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t))
       (halve-list-aux x x nil))</pre> 

</body>
</html>
