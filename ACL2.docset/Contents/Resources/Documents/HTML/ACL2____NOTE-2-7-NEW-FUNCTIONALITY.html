<html>
<head>
<meta charset="UTF-8">
<title>Note-2-7-new-functionality</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____NOTE-2-7-NEW-FUNCTIONALITY">Click for Note-2-7-new-functionality in the Full Manual</a></h3>

<p>ACL2 Version  2.7 Notes on New Functionality</p><p>ACL2 now has a more powerful technique for relieving a <span class="v">:</span><span class="tt"><a href="ACL2____REWRITE.html">rewrite</a></span> or <span class="v">:</span><span class="tt"><a href="ACL2____LINEAR.html">linear</a></span> rule's hypothesis that contains free 
 variables.  A new <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> section has been written describing the 
 handling free variables in rules; see <a href="ACL2____FREE-VARIABLES.html">free-variables</a>.  In brief, the 
 primary change is that when a free-variable match for the current hypothesis 
 fails to allow subsequent hypotheses to be relieved, then additional matches 
 may be attempted until they have all been tried.  Also see <a href="ACL2____RULE-CLASSES.html">rule-classes</a> (discussion of <span class="v">:match-free</span>).  Also see <a href="ACL2____SET-MATCH-FREE-ERROR.html">set-match-free-error</a>, see <a href="ACL2____SET-MATCH-FREE-DEFAULT.html">set-match-free-default</a>, and see <a href="ACL2____ADD-MATCH-FREE-OVERRIDE.html">add-match-free-override</a> for interfaces provided to the user for controlling 
 the way ACL2 deals with free variables in hypotheses.  We thank Rob Sumners 
 for several helpful discussions about the designs of those interfaces, as well 
 as Eric Smith and Robert Krug for helpful related discussions.  Robert Krug 
 also found a performance bug in a preliminary version, for which we are 
 grateful.</p> 
 
 <p>WARNING: Book certification attempts may take much longer now that, by 
 default, ACL2 looks for more free variable matches (see paragraph just above). 
 You can get the old behavior by inserting the form</p> 
 
 <pre class="code">(<a href="ACL2____SET-MATCH-FREE-DEFAULT.html">set-match-free-default</a> :once)</pre> 
 
 <p>just after the initial <span class="tt"><a href="COMMON-LISP____IN-PACKAGE.html">in-package</a></span> form.  However, rules from 
 included books that have free variables can still slow down certification. 
 This can be fixed by inserting</p> 
 
 <pre class="code">(<a href="ACL2____ADD-MATCH-FREE-OVERRIDE.html">add-match-free-override</a> :once t)</pre> 
 
 <p>before the first event in the file that generates a proof.</p> 
 
 <p><a href="ACL2____FORWARD-CHAINING.html">Forward-chaining</a> has been made more powerful in the presence of free 
 variables (see <a href="ACL2____FREE-VARIABLES.html">free-variables</a>), thanks to a contribution by Erik 
 Reeber.  Both before and now, when an attempt is made to relieve (prove) a 
 hypothesis of a <span class="v">:forward-chaining</span> rule in the case that at least one 
 variable in that hypothesis is not yet bound, ACL2 looks in the current 
 context for an instance of that hypothesis.  If it finds one, then it binds 
 the unbound variables and continues to the next hypothesis.  What is new is 
 that ACL2 can now looks for multiple instances of that hypothesis.  Consider 
 the following example; an explanation is below.</p> 
 
 <pre class="code">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a> (((op * *) =&gt; *))
             (<a href="ACL2____LOCAL.html">local</a> (<a href="COMMON-LISP____DEFUN.html">defun</a> op (x y) (<a href="COMMON-LISP_____C3.html">&lt;</a> x y)))
             (<a href="ACL2____DEFTHM.html">defthm</a> transitivity-of-op
               (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____AND.html">and</a> (op x y) (op y z)) (op x z))
               :rule-classes :forward-chaining))

; fails in Version_2.6; succeeds in in Version_2.7
(<a href="ACL2____THM.html">thm</a> (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____AND.html">and</a> (op a b) (op b c) (op b e)) (op a c)))</pre> 
 
 <p>Before Version_2.7, the proof of the <span class="v">thm</span> above fails.  When the 
 <span class="v">:forward-chaining</span> rule <span class="v">transitivity-of-op</span> binds <span class="v">x</span> to <span class="v">a</span> and 
 <span class="v">y</span> to <span class="v">b</span>, it then looks for an instance of <span class="v">(op y z)</span> in the 
 current context, with <span class="v">y</span> bound to <span class="v">b</span> but <span class="v">z</span> unbound.  It happens 
 to find <span class="v">(op b e)</span> before <span class="v">(op b c)</span>, and it then adds <span class="v">(op a e)</span> to 
 the context.  But starting with Version_2.7, it continues to look for 
 additional instances and finds <span class="v">(op b c)</span> in the context as well, chaining 
 forward to <span class="v">(op a c)</span> and thus proving the theorem.</p> 
 
 <p>A new macro, <span class="tt"><a href="ACL2____BIND-FREE.html">bind-free</a></span>, provides a simple way to get much or most 
 of the power of <a href="ACL2____META.html">meta</a>functions.  Thanks to Eric Smith for coming up with 
 the idea and to Robert Krug for providing an implementation (which we modified 
 only very slightly) and documentation. See <a href="ACL2____BIND-FREE.html">bind-free</a> and see <a href="ACL2____BIND-FREE-EXAMPLES.html">bind-free-examples</a>.</p> 
 
 <p>With the addition of <span class="tt"><a href="ACL2____BIND-FREE.html">bind-free</a></span> (mentioned above), <span class="tt"><a href="ACL2____SYNTAXP.html">syntaxp</a></span> 
 has become a macro, although that change should be transparent to the user. 
 More importantly, the argument of <span class="v">syntaxp</span> may now refer to variables 
 <span class="v">mfc</span> and <span class="v">state</span>, giving <span class="v">syntaxp</span> some of the power of extended 
 metafunctions; see <a href="ACL2____SYNTAXP.html">syntaxp</a> and see <a href="ACL2____EXTENDED-METAFUNCTIONS.html">extended-metafunctions</a>. 
 Thanks to Robert Krug for implementing that extension.  Also, the argument of 
 <span class="tt"><a href="ACL2____SYNTAXP.html">syntaxp</a></span> may now include calls of <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode functions. 
 See <a href="ACL2____SYNTAXP.html">syntaxp</a> and see <a href="ACL2____SYNTAXP-EXAMPLES.html">syntaxp-examples</a> (thanks to Robert Krug for 
 updating the former and creating the latter documentation).</p> 
 
 <p>The linear-arithmetic decision procedure (see <a href="ACL2____LINEAR-ARITHMETIC.html">linear-arithmetic</a>) has 
 now been extended so that ACL2 can reason about non-linear arithmetic as well 
 (see <a href="ACL2____NON-LINEAR-ARITHMETIC.html">non-linear-arithmetic</a> for how to turn on this feature).  We thank 
 Robert Krug for the initial implementation of this, and Eric Smith for finding 
 a couple of bugs in it.</p> 
 
 <p>Some <span class="tt"><a href="COMMON-LISP____TRACE.html">trace</a></span> utilities have been made available in the ACL2 loop.</p> 
 
 <ul> 
 
 <li>Function <span class="tt"><a href="ACL2____TRACE_42.html">trace$</a></span> (and also <span class="tt"><a href="ACL2____UNTRACE_42.html">untrace$</a></span>) calls the 
 corresponding underlying Lisp routine <span class="v">trace</span> (and <span class="v">untrace</span>), which 
 however continues (as it has for some time) to be enhanced for GCL and Allegro 
 CL.</li> 
 
 <li>Macro <span class="tt"><a href="ACL2____OPEN-TRACE-FILE.html">open-trace-file</a></span> causes trace output to go to a specified 
 file.  Macro <span class="tt"><a href="ACL2____CLOSE-TRACE-FILE.html">close-trace-file</a></span> causes trace output to go to the screen 
 (which is the default).</li> 
 
 <li>Macro <span class="v">with-error-trace</span> (or, <span class="v">wet</span> for short) causes a backtrace 
 to be written out for many failures, including guard violations.  See <a href="COMMON-LISP____TRACE.html">trace</a>, see <a href="ACL2____TRACE_42.html">trace$</a>, and see :DOC <span class="v">wet</span> [** NOTE: eliminated after 
 Version 3.3].</li> 
 
 </ul> 
 
 <p>A new <span class="tt"><a href="ACL2____THEORY.html">theory</a></span>, <span class="tt"><a href="ACL2____MINIMAL-THEORY.html">minimal-theory</a></span> has been provided (see <a href="ACL2____THEORIES.html">theories</a>).  It can be particularly useful for speeding up proofs involving 
 <span class="v">:use</span> <a href="ACL2____HINTS.html">hints</a>.</p> 
 
 <p>New <span class="tt"><a href="ACL2____EVENTS.html">events</a></span> <span class="tt"><a href="ACL2____DEFUND.html">defund</a></span> and <span class="tt"><a href="ACL2____DEFTHMD.html">defthmd</a></span> behave exactly like 
 <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> and <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span>, respectively, except that these new events 
 disable the new name.</p> 
 
 <p>The new macro <span class="tt"><a href="ACL2____WITH-OUTPUT.html">with-output</a></span> can be used to suppress output that would 
 normally result from evaluation of a form.</p> 
 
 <p>The form <span class="v">(</span><span class="tt"><a href="ACL2____PSTACK.html">pstack</a></span><span class="v">)</span> can give the user an idea of what the 
 prover has been up to during a proof, or after a user-aborted proof. 
 Moreover, by evaluating <span class="v">(<a href="ACL2____VERBOSE-PSTACK.html">verbose-pstack</a> t)</span> (see <a href="ACL2____VERBOSE-PSTACK.html">verbose-pstack</a>) 
 one can get <a href="COMMON-LISP____TRACE.html">trace</a>-like information about prover functions, including 
 time summaries, printed to the screen during a proof.  Thanks to Bill Legato 
 and Robert Krug for initiating this work and to Robert for providing some 
 initial implementation.</p> 
 
 <p>The new command <span class="v">:</span><span class="tt"><a href="ACL2____COMP-GCL.html">comp-gcl</a></span> is identical in functionality, 
 except that it always leaves <span class="v">.c</span> and <span class="v">.h</span> files when compiling in GCL. 
 Thanks to Rob Sumners and Vernon Austel for suggesting such a capability.</p> 
 
 <p>The macro <span class="tt"><a href="ACL2____E_F2D.html">e/d</a></span> provides a convenient way to <span class="tt"><a href="ACL2____ENABLE.html">enable</a></span> some 
 rules and <span class="tt"><a href="ACL2____DISABLE.html">disable</a></span> others.  It was formerly in a book supplied with the 
 distribution, <span class="v">books/ihs/ihs-init.lisp</span>, written by Bishop Brock (who we 
 thank for providing this useful macro).</p> 
 
 <p>New distributed books include those in <span class="v">books/ordinals/</span>, 
 <span class="v">books/rtl/rel3/</span>, and <span class="v">books/misc/simplify-defuns.lisp</span> (which is 
 documented in <span class="v">books/misc/simplify-defuns.txt</span>).</p> 
 
 <p>The <span class="v">:expand</span> hint now accepts a special value, <span class="v">:LAMBDAS</span>, that 
 tells the ACL2 rewriter to expand all lambda applications (<span class="tt"><a href="COMMON-LISP____LET.html">let</a></span> 
 expressions).  See <a href="ACL2____HINTS.html">hints</a>.</p> 
 
 <p>A new function <span class="tt"><a href="ACL2____ZPF.html">zpf</a></span> has been added as fast test against 0 for 
 nonnegative fixnums.</p> 
 
 <p>A new macro <span class="tt"><a href="ACL2____GC_42.html">gc$</a></span> allows the user to call the garbage collector of 
 the underlying Common Lisp.  Thanks to Rob Sumners for suggesting this 
 feature.</p> 
 
 <p>It is now possible to <span class="tt"><a href="ACL2____MONITOR.html">monitor</a></span> <a href="ACL2____SIMPLE.html">simple</a> (abbreviation) rules. 
 However, as a warning explains, they are still not considered monitored during 
 preprocessing; see <a href="ACL2____MONITOR.html">monitor</a>.  Thanks to Robert Krug for providing this 
 improvement.</p> 
 
 <p>The second argument of <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span>, if supplied, formerly had to 
 be either <span class="v">t</span> or a non-negative integer.  Now it can be the symbol <span class="v">?</span>, 
 in the <span class="v">ACL2</span> package, indicating that the usual check should be suppressed 
 on the number of commands that have been executed to create the world in which 
 <span class="tt"><a href="ACL2____CERTIFY-BOOK.html">certify-book</a></span> was called.</p>
</body>
</html>
