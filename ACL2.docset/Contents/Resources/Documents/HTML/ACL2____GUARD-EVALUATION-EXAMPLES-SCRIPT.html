<html>
<head>
<meta charset="UTF-8">
<title>Guard-evaluation-examples-script</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____GUARD-EVALUATION-EXAMPLES-SCRIPT">Click for Guard-evaluation-examples-script in the Full Manual</a></h3>

<p>A script to show combinations of <a href="ACL2____DEFUN-MODE.html">defun-mode</a>s and <a href="ACL2____GUARD.html">guard</a>-checking</p><p>Below is a script that illustrates the combination of <a href="ACL2____DEFUN-MODE.html">defun-mode</a>s — <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode, <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode 
 without <a href="ACL2____GUARD.html">guard</a>s verified, and <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> mode with <a href="ACL2____GUARD.html">guard</a>s verified — with values from <span class="tt"><a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a></span> — 
 <span class="v">t</span> (the default), <span class="v">:all</span>, <span class="v">:none</span>, and <span class="v">nil</span>.  (It does not 
 illustrate the value <span class="v">:nowarn</span>, which is the same as <span class="v">t</span> except for 
 inhibiting a warning.)  The script also illustrates cases where the guard is 
 not, or is, <span class="v">t</span>.</p> 
 
 <p>See <a href="ACL2____GUARD-EVALUATION-EXAMPLES-LOG.html">guard-evaluation-examples-log</a> for result of running this script. 
 Before presenting the script below, we give some instructions in case you want 
 to run it yourself.</p> 
 
 <p>See <a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> for discussion of the interaction between 
 <a href="ACL2____DEFUN-MODE.html">defun-mode</a>s and <a href="ACL2____GUARD.html">guard</a>-checking that is illustrated by this 
 script.  Also see <a href="ACL2____GUARD-EVALUATION-TABLE.html">guard-evaluation-table</a> for a succinct table, with 
 associated discussion, that covers in detail the interactions illustrated 
 here.</p> 
 
 <p>The script mentions the running of ``Tracing Code''.  The code is the 
 following sequence of commands.</p> 
 
 <pre class="code">(<a href="ACL2____TRACE_42.html">trace$</a> fact)
:set-guard-checking t
(fact 2)
(fact t)
:set-guard-checking :all
(fact 2)
(fact t)
:set-guard-checking :none
(fact 2)
(fact t)
:set-guard-checking nil
(fact 2)
(fact t)</pre> 
 
 <p>If you want to run the script yourself, you may find it handy to use the 
 following Emacs keyboard macro for running the tracing code in 2-window mode, 
 with the cursor in the window with the script and ACL2 running in the other 
 window.</p> 
 
 <pre class="code">(fset 'step-guard-script
   [?C-a ?C-  ?C-e ?M-w ?C-a ?C-n
    ?C-x ?o ?M-&gt; ?C-y return ?C-x ?o])

; Put it on a key (<a href="COMMON-LISP____IF.html">if</a> you have defined the indicated keymap by using
; emacs/emacs-acl2.el):
(define-key ctl-t-keymap "r" 'step-guard-script)</pre> 
 
 <p>The script follows.</p> 
 
 <pre class="code">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; Program mode
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(<a href="COMMON-LISP____DEFUN.html">defun</a> fact (x)
         (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____INTEGERP.html">integerp</a> x)
                         :mode :program))
         (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____POSP.html">posp</a> x)
             (<a href="COMMON-LISP_____A2.html">*</a> x (fact (<a href="COMMON-LISP____1-.html">1-</a> x)))
           1))

; Run the Tracing Code here.  It shows execution in raw Lisp in the t and nil
; cases of :set-guard-checking, but not in the :all or :none cases.  We get a
; guard violation for argument t in the case :set-guard-checking t.

:u

(<a href="COMMON-LISP____DEFUN.html">defun</a> fact (x)
         (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t
                         :mode :program))
         (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____POSP.html">posp</a> x)
             (<a href="COMMON-LISP_____A2.html">*</a> x (fact (<a href="COMMON-LISP____1-.html">1-</a> x)))
           1))

; Run the Tracing Code here.  It should give the same results as above,
; except that we no longer get a guard violation in the case
; :set-guard-checking t.

:u

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; Logic mode, guard other than t
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(<a href="COMMON-LISP____DEFUN.html">defun</a> fact (x)
         (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____INTEGERP.html">integerp</a> x)
                         :verify-guards nil
                         :mode :logic))
         (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____POSP.html">posp</a> x)
             (<a href="COMMON-LISP_____A2.html">*</a> x (fact (<a href="COMMON-LISP____1-.html">1-</a> x)))
           1))

; Run the Tracing Code here.  It should give guard violations for (fact t)
; with guard-checking set to t or :all.  It should never run in raw Lisp,
; because we have not verified guards.  In the t case, we can get a warning
; about avoiding the guard check on recursive calls, but only if we do not
; trace the function, fact.

(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> fact)

; Run the Tracing Code here.  The results should be as described just above,
; except that now we go into raw Lisp for (fact 2) with guard-checking other
; than :none.

:u
:u

; The following definition is the same as above, except that guards are
; verified.

(<a href="COMMON-LISP____DEFUN.html">defun</a> fact (x)
         (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____INTEGERP.html">integerp</a> x)
                         :mode :logic))
         (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____POSP.html">posp</a> x)
             (<a href="COMMON-LISP_____A2.html">*</a> x (fact (<a href="COMMON-LISP____1-.html">1-</a> x)))
           1))

; Run the Tracing Code here.  We should get the same traces as in the
; immediately preceding case, since guards had been verified in both cases.

:u

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; Logic mode, guard t
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(<a href="COMMON-LISP____DEFUN.html">defun</a> fact (x)
         (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t
                         :verify-guards nil
                         :mode :logic))
         (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____POSP.html">posp</a> x)
             (<a href="COMMON-LISP_____A2.html">*</a> x (fact (<a href="COMMON-LISP____1-.html">1-</a> x)))
           1))

; Run the Tracing Code here.  We should never go in to raw Lisp, because
; guards have not been verified.  We will see the same traces for (fact 2) as
; with the (<a href="COMMON-LISP____INTEGERP.html">integerp</a> x) guard above with :verify-guards nil specified, except
; that even without tracing, there is no warning for :set-guard-checking t
; about recursive calls.  And, there are no guard violations for (fact t), of
; course, since posp (necessarily, if we are to verify guards) has a guard of
; t.

(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> fact)

; Run the Tracing Code here.  You shouldn't see any surprises.  Note however
; that if we back up to the start (using :u :u) and then define fact as just
; above but without :verify-guards nil, then the :none setting will allow us
; to go into raw Lisp: although :none generally avoids execution of raw Lisp
; counterparts, it allows this when the guard is T and guards have been
; verified.</pre>
</body>
</html>
