<html>
<head>
<meta charset="UTF-8">
<title>Defdata</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____DEFDATA">Click for Defdata in the Full Manual</a></h3>

<p>A Data Definition Framework</p> 
<h3>Introduction</h3> 
 
<p> 
The defdata framework enables the convenient specification of 
data types in ACL2s, the ACL2 Sedan.  The framework concisely 
supports common data definition patterns, e.g., list types, map 
types, enumerated types, record types, and mutually-recursive 
types. It also provides support for polymorphic functions and  
tight integration with Tau. 
</p> 
 
<p> 
The data definition framework is a key component of 
counterexample generation support in ACL2s, but can be 
independently used in ACL2, and is available as a community book. 
</p> 
 
<p> 
The defdata framework maintains both a predicative 
characterization, via a predicate recognizing elements of the 
datatype, and an enumerative characterization, via a function 
that can be used to enumerate all the elements of the 
datatype. ACL2s picks out the recognizers in a conjecture and can 
use the datatype enumerators to generate random elements of the 
datatype. This is a key part of counterexample generation in 
ACL2s. 
</p> 
 
<p> 
The defdata framework also allows us to increase the amount of 
automation ACL2s provides for reasoning about data definitions. 
For example, our framework generates useful theorems, with 
appropriate rule-classes, for list types; it generates accessor 
and constructor functions for records with a suitable theory for 
reasoning about compositions of these functions; it generates 
theorems that characterize the type relations such as inclusion 
and exclusion; and it generates events that support polymorphic 
type reasoning. 
</p> 
 
<p> The defdata framework is described in our ACL2 2014 paper (a link 
to the paper appears later). Below, we provide some examples of its 
use.</p> 
 
<p>Note: If you are trying these examples in a package other than ACL2S, 
then you might have to prefix the basic typenames i.e. acl2s::pos.</p> 
 
<h3>Examples</h3> 
 
<h4>Union and Product types</h4> 
<pre class="code">(<a href="ACL2____DEFDATA.html">defdata</a> inode nat)

(<a href="ACL2____DEFDATA.html">defdata</a> file (<a href="COMMON-LISP____CONS.html">cons</a> inode string))
(<a href="ACL2____DEFDATA.html">defdata</a> er-file (oneof file nil))

(<a href="ACL2____DEFDATA.html">defdata</a> UPNest 
  (oneof (oneof (<a href="COMMON-LISP____CONS.html">cons</a> (oneof 11 7) pos-list) 'ok symbol-alist) 
         (<a href="COMMON-LISP____CONS.html">cons</a> symbol (<a href="COMMON-LISP____COMPLEX.html">complex</a> integer -1))
         (oneof (oneof 42 (<a href="COMMON-LISP____CONS.html">cons</a> pos file) er-file) t 7/6)
         "nice"))

(<a href="ACL2____DEFDATA.html">defdata</a> loi (oneof nil (<a href="COMMON-LISP____CONS.html">cons</a> integer loi)))</pre> 
 
<h4>Range types</h4> 
<pre class="code">(<a href="ACL2____DEFDATA.html">defdata</a> cache-miss-ratio (range rational (0 &lt; _ &lt; 1)))

(<a href="ACL2____DEFDATA.html">defdata</a> big-unsigned-num (range integer ((<a href="COMMON-LISP____EXPT.html">expt</a> 2 32) &lt; _)))</pre> 
<p>  
Macros are allowed and the meaning of the defdata body 
is the given by its macroexpansion. 
</p> 
<pre class="code">(<a href="ACL2____DEFDATA.html">defdata</a> 3d-point (<a href="COMMON-LISP____LIST.html">list</a> rational rational rational))</pre> 
 
<h4>Enum types</h4> 
<pre class="code">(<a href="ACL2____DEFDATA.html">defdata</a> op-code (enum '(lw sw addi subi beqz jr)))

(<a href="COMMON-LISP____DEFUN.html">defun</a> generate-instruction-opcodes (x)
  (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____EQ.html">eq</a> x 'mips-risc-model)
      '(lw sw addi subi beqz jr)
    '()))

(<a href="ACL2____DEFDATA.html">defdata</a> op-code1 (enum (generate-instruction-opcodes 'mips-risc-model)))</pre> 
 
<h4>List and Alist types</h4> 
<pre class="code">(<a href="ACL2____DEFDATA.html">defdata</a> files (listof file))

(<a href="ACL2____DEFDATA.html">defdata</a> symb-alist (alistof symbol all))</pre> 
 
<h4>Mutually-recursive types</h4> 
<pre class="code">(<a href="ACL2____DEFDATA.html">defdata</a> 
  (dir (listof (<a href="COMMON-LISP____CONS.html">cons</a> string dir-entry)))
  (dir-entry (oneof file dir)))

(<a href="ACL2____DEFDATA.html">defdata</a>
  (sexpr (oneof symbol
                (<a href="COMMON-LISP____CONS.html">cons</a> symbol sexpr-list)))
  (sexpr-list (oneof nil
                     (<a href="COMMON-LISP____CONS.html">cons</a> sexpr sexpr-list))))</pre> 
 
<h4>Record (Struct) types</h4> 
<pre class="code">(<a href="ACL2____DEFDATA.html">defdata</a> reg-num (range integer (0 &lt;= _ &lt; 32)))
(<a href="ACL2____DEFDATA.html">defdata</a> immediate-range (range integer (0 &lt;= _ &lt; (<a href="COMMON-LISP____EXPT.html">expt</a> 2 16))))

(<a href="ACL2____DEFDATA.html">defdata</a> inst (record (op  . op-code)
                      (rd  . reg-num)
                      (rs1 . reg-num)
                      (imm . immediate-range)))</pre> 
 
 
<h4>Map (unique and sorted entries) types</h4> 
<pre class="code">(<a href="ACL2____DEFDATA.html">defdata</a> p-addr (range integer (0 &lt;= _ &lt; (<a href="COMMON-LISP____EXPT.html">expt</a> 2 32))))
(<a href="ACL2____DEFDATA.html">defdata</a> imem (map p-addr inst))</pre> 
 
<h4>Using record and map types</h4> 
<pre class="code">(<a href="ACL2____B_A2.html">b*</a> (;; pick a random imemory
       (I (nth-imem 4511))
       ;; fix a program counter value
       (<a href="ACL2____PC.html">pc</a> 1)
       ;; get the instruction pointed to by pc
       (instr (mget pc I)) 
       ;; get immediate value field of instr
       (im (inst-imm instr))
       ;; set immediate value field and the pc entry 
       (I1 (mset pc (set-inst-imm (<a href="COMMON-LISP____1_B2.html">1+</a> im) instr) I))
       ;; alternative way of getting immediate value field
       (im2 (mget :imm (mget pc I1)))
       ((inst op rd rs1 ?imm) instr)
       )
  (<a href="COMMON-LISP____EQUAL.html">equal</a> (inst op rd rs1 (<a href="COMMON-LISP____1-.html">1-</a> im2)) instr))</pre> 
 
<h4>Custom types</h4> 
<pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> make-descending-addresses (n)
  (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____ZP.html">zp</a> n)
    nil
    (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____1-.html">1-</a> n) (make-descending-addresses (<a href="COMMON-LISP____-.html">-</a> n 1)))))

(<a href="COMMON-LISP____DEFUN.html">defun</a> imem-custom-enum (n)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :program))
  (<a href="COMMON-LISP____LET_A2.html">let*</a> ((m (nth-imem-builtin n))
         (vals (<a href="ACL2____STRIP-CDRS.html">strip-cdrs</a> m))
         (keys (make-descending-addresses (<a href="ACL2____LEN.html">len</a> m))))
    (<a href="ACL2____PAIRLIS_42.html">pairlis$</a> keys vals)))

(<a href="COMMON-LISP____DEFUN.html">defun</a> imem-customp (x)
  (<a href="COMMON-LISP____OR.html">or</a> (<a href="COMMON-LISP____NULL.html">null</a> x)
      (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____CONSP.html">consp</a> x)
           (<a href="COMMON-LISP____CONSP.html">consp</a> (<a href="COMMON-LISP____CAR.html">car</a> x))
           (imem-customp (<a href="COMMON-LISP____CDR.html">cdr</a> x))
           (instp (<a href="COMMON-LISP____CDAR.html">cdar</a> x))
           (p-addrp (<a href="COMMON-LISP____CAAR.html">caar</a> x))
           (<a href="COMMON-LISP____OR.html">or</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____NULL.html">null</a> (<a href="COMMON-LISP____CDR.html">cdr</a> x))
                    (<a href="COMMON-LISP____EQUAL.html">equal</a> 0 (<a href="COMMON-LISP____CAAR.html">caar</a> x)))
               (<a href="COMMON-LISP_____E3.html">&gt;</a> (<a href="COMMON-LISP____CAAR.html">caar</a> x) (<a href="COMMON-LISP____CAADR.html">caadr</a> x))))))

(<a href="DEFDATA____REGISTER-TYPE.html">register-type</a> imem-custom
               :predicate imem-customp
               :enumerator imem-custom-enum)


(<a href="ACL2____DEFDATA-ATTACH.html">defdata-attach</a> imem :test-enumerator imem-custom-enum)</pre> 
 
 
<h4>Recursive record types (similar to ML datatype facility)</h4> 
<pre class="code">(<a href="ACL2____DEFDATA.html">defdata</a> tree (oneof 'Leaf 
                     (node (val   . string)
                           (left  . tree)
                           (right . tree))))</pre> 
 
 
<h4>Polymorphic Type Signatures</h4> 
<pre class="code">(<a href="DEFDATA____SIG.html">sig</a> binary-append ((listof :a) (listof :a)) =&gt; (listof :a))
(<a href="DEFDATA____SIG.html">sig</a> nthcdr (nat (listof :a)) =&gt; (listof :a))
(<a href="DEFDATA____SIG.html">sig</a> nth (nat (listof :a)) =&gt; :a 
     :satisfies (<a href="COMMON-LISP_____C3.html">&lt;</a> x1 (<a href="ACL2____LEN.html">len</a> x2)))
;; xi corresponds to the ith type appearing in the sig form. For example,
;; x1 corresponds to nat and x2 to (listof :a)</pre> 
 
<h4>Registering a data constructor</h4> 
<pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> acons-caar (x)  (<a href="COMMON-LISP____CAAR.html">caar</a> x))
(<a href="COMMON-LISP____DEFUN.html">defun</a> acons-cdar (x)  (<a href="COMMON-LISP____CDAR.html">cdar</a> x))
(<a href="COMMON-LISP____DEFUN.html">defun</a> acons-cdr (x)  (<a href="COMMON-LISP____CDR.html">cdr</a> x))

(<a href="ACL2____DEFTHM.html">defthm</a> acons-acl2-count-lemma
  (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ACL2____ACL2-COUNT.html">acl2-count</a> (<a href="COMMON-LISP____ACONS.html">acons</a> x1 x2 x3))
         (<a href="COMMON-LISP_____B2.html">+</a> 2 (<a href="ACL2____ACL2-COUNT.html">acl2-count</a> x1) (<a href="ACL2____ACL2-COUNT.html">acl2-count</a> x2) (<a href="ACL2____ACL2-COUNT.html">acl2-count</a> x3))))

(<a href="DEFDATA____REGISTER-DATA-CONSTRUCTOR.html">register-data-constructor</a> (aconsp acons)
                           ((allp acons-caar) (allp acons-cdar) (allp acons-cdr))
                           :rule-classes (:rewrite)
                           :verbose t)</pre> 
 
<h4>Registering a type</h4> 
<pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> nth-even-builtin (n) 
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="ACL2____NATP.html">natp</a> n)))
  (<a href="COMMON-LISP_____A2.html">*</a> 2 (nth-integer n)))

(<a href="DEFDATA____REGISTER-TYPE.html">register-type</a> even 
               :predicate evenp 
               :enumerator nth-even-builtin)</pre> 
 
<h4>Registering user-defined combinators</h4> 
<pre class="code">(<a href="DEFDATA____REGISTER-USER-COMBINATOR.html">register-user-combinator</a> alistof 
 :arity 2 :verbose t
 :aliases (acl2::alistof)
 :expansion (<a href="COMMON-LISP____LAMBDA.html">lambda</a> (_name _args) `(<a href="COMMON-LISP____OR.html">OR</a> nil (<a href="COMMON-LISP____ACONS.html">acons</a> ,(<a href="COMMON-LISP____CAR.html">car</a> _args) ,(<a href="COMMON-LISP____CADR.html">cadr</a> _args) ,_name)))
 :syntax-restriction-fn proper-symbol-listp
 :polymorphic-type-form (alistof :a :b)
 :post-pred-hook-fns (user-alistof-theory-events))</pre> 
 
<h3>Debugging</h3> 
<p> 
To debug a failed defdata form, you can proceed in multiple ways: 
<ul> 
<li> At the session editor (or emacs prompt), submit/evaluate 
     <span class="v">:trans1 (<a href="ACL2____DEFDATA.html">defdata</a> ...)</span> 
     And from the output, evaluate the form that says <span class="v">(defdata-events ...)</span>.</li> 
<li> Use keyword options <span class="v">:verbose t</span> and examine the ACL2 output.</li> 
</ul> 
</p> 
 
<h3>More details</h3>  
 
<p> Although most constructs of the defdata language are 
package-agnostic, some of the API functions/macros of the Defdata 
framework (like <span class="tt">sig</span>) reside in the ACL2S package. Use 
list (<span class="tt">*acl2s-exports*</span>) to import these symbols into your own 
package.</p> 
 
<p> For a comprehensive user guide and more details please refer to the following 
<a href="http://arxiv.org/abs/1406.1557" target="_blank"><nobr>paper<img src="../Icon_External_Link.png" title="External link to http://arxiv.org/abs/1406.1557"></nobr></a> </p> 

</body>
</html>
