<html>
<head>
<meta charset="UTF-8">
<title>Vl-check-bad-funcalls</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=VL2014____VL-CHECK-BAD-FUNCALLS">Click for Vl-check-bad-funcalls in the Full Manual</a></h3>

<p>Cause fatal warnings if function calls are in unacceptable places.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(vl-check-bad-funcalls ctx exprs description warnings) 
  → 
(mv okp warnings)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">ctx</span> — Context for error messages.<br>    <font color="#606060">Guard <span class="v">(<a href="VL2014____VL-CONTEXT-P.html">vl-context-p</a> ctx)</span>.</font>
</dd> 
  <dd>
<span class="tt">exprs</span> — A list of expressions that aren't allowed to have 
                                 function calls.<br>    <font color="#606060">Guard <span class="v">(<a href="VL2014____VL-EXPRLIST-P.html">vl-exprlist-p</a> exprs)</span>.</font>
</dd> 
  <dd>
<span class="tt">description</span> — A short explanation of what these expressions 
                                 are, e.g., <span class="v">delay expressions</span> or <span class="v">left-hand
                                 sides of assignments</span>.<br>    <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____STRINGP.html">stringp</a> description)</span>.</font>
</dd> 
  <dd>
<span class="tt">warnings</span> — Ordinary <a href="VL2014____WARNINGS.html">warnings</a> accumulator.<br>    <font color="#606060">Guard <span class="v">(<a href="VL2014____VL-WARNINGLIST-P.html">vl-warninglist-p</a> warnings)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">okp</span> — <font color="#606060">Type <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> okp)</span>.</font>
</dd> 
<dd>
<span class="tt">warnings</span> — <font color="#606060">Type <span class="v">(<a href="VL2014____VL-WARNINGLIST-P.html">vl-warninglist-p</a> warnings)</span>.</font>
</dd> 
 
</dl></div> 
<p>If these expressions contain any function calls, we add a fatal 
warning and set <span class="v">okp</span> to <span class="v">nil</span>.</p> 
 
<h3>Motivation</h3> 
 
<p>Which expressions should we allow to involve function calls?  Well, clearly 
we want to allow function calls on the right-hand sides of assignments, and in 
the inputs to module and gate instances.  But there are many other places where 
we clearly don't want to allow function calls, for instance what would it mean 
to assign to a function call, or to connect a function call to the output port 
of a module?  We think these things are crazy and should not be allowed.</p> 
 
<p>In other contexts the right thing to do is less clear.  Should we expand 
function calls in a delay statement?  In an parameter-argument?  In a wire's 
range declaration?</p> 
 
<p>These things probably make some sense, especially if the function is being 
applied to constant arguments and can be completely resolved at "elaboration 
time." But it does not seem like it makes any sense for functions that are 
dealing with wires.  At any rate, for now I am not going to try to support this 
sort of thing, because (1) handling all of this properly raises so many 
questions regarding widths, etc., and (2) it seems more elaborate than we 
really need to support.</p> 
 
<p>The moral of the story is:</p> 
 
<ul> 
 
<li>We only expand function calls in "reasonable" locations (right hand 
sides, inputs to module instances, conditions for if statements, etc.)</li> 
 
<li>We check whether there are any function calls in "unreasonable" 
locations (left hand sides, outputs of module instances, delays, declaration 
ranges, etc.) and cause fatal warnings if we find any.</li> 
 
</ul> 
 
<p>Some day, we might add better support for constant functions, and some of 
this could be changed, but there'd better be a really good reason to do so 
since it will be so tricky to get right.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>vl-check-bad-funcalls</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 vl-check-bad-funcalls
 (<a href="ACL2____CTX.html">ctx</a> exprs description warnings)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="VL2014____VL-CONTEXT-P.html">vl-context-p</a> ctx)
                             (<a href="VL2014____VL-EXPRLIST-P.html">vl-exprlist-p</a> exprs)
                             (<a href="COMMON-LISP____STRINGP.html">stringp</a> description)
                             (<a href="VL2014____VL-WARNINGLIST-P.html">vl-warninglist-p</a> warnings))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'vl-check-bad-funcalls))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   (((unless (<a href="VL2014____VL-EXPRLIST-HAS-FUNCALLS.html">vl-exprlist-has-funcalls</a> exprs))
     (<a href="ACL2____MV.html">mv</a> t (<a href="VL2014____OK.html">ok</a>)))
    (fns-called (<a href="VL2014____VL-EXPRLIST-FUNNAMES.html">vl-exprlist-funnames</a> exprs)))
   (<a href="ACL2____MV.html">mv</a>
    nil
    (<a href="VL2014____FATAL.html">fatal</a>
     :type :vl-bad-funcall
     :msg
     "In ~a0, function calls in ~s1 are not supported, but ~
                         we found ~s2 of ~&amp;3."
     :args (<a href="COMMON-LISP____LIST.html">list</a> ctx description
                 (<a href="COMMON-LISP____IF.html">if</a> (<a href="VL2014____VL-PLURAL-P.html">vl-plural-p</a> fns-called)
                     "calls" "a call")
                 (<a href="SET____MERGESORT.html">mergesort</a> fns-called)))))))</pre> 
<p><b>Theorem: </b>booleanp-of-vl-check-bad-funcalls.okp</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
     booleanp-of-vl-check-bad-funcalls.okp
     (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?okp ?warnings)
           (<a href="VL2014____VL-CHECK-BAD-FUNCALLS.html">vl-check-bad-funcalls</a> ctx exprs description warnings)))
         (<a href="ACL2____BOOLEANP.html">booleanp</a> okp))
     :rule-classes :type-prescription)</pre> 
<p><b>Theorem: </b>vl-warninglist-p-of-vl-check-bad-funcalls.warnings</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
     vl-warninglist-p-of-vl-check-bad-funcalls.warnings
     (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?okp ?warnings)
           (<a href="VL2014____VL-CHECK-BAD-FUNCALLS.html">vl-check-bad-funcalls</a> ctx exprs description warnings)))
         (<a href="VL2014____VL-WARNINGLIST-P.html">vl-warninglist-p</a> warnings))
     :rule-classes :rewrite)</pre> 

</body>
</html>
