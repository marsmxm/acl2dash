<html>
<head>
<meta charset="UTF-8">
<title>Atj-gen-test-method</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=JAVA____ATJ-GEN-TEST-METHOD">Click for Atj-gen-test-method in the Full Manual</a></h3>

<p>Generate a Java method to run one of the specified tests.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(atj-gen-test-method test$ deep$ guards$ java-class$ verbose$ 
                     pkg-class-names fn-method-names wrld) 
 
  → 
method</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">test$</span> — <font color="#606060">Guard <span class="v">(<a href="JAVA____ATJ-TESTP.html">atj-testp</a> test$)</span>.</font>
</dd> 
  <dd>
<span class="tt">deep$</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> deep$)</span>.</font>
</dd> 
  <dd>
<span class="tt">guards$</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> guards$)</span>.</font>
</dd> 
  <dd>
<span class="tt">java-class$</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____STRINGP.html">stringp</a> java-class$)</span>.</font>
</dd> 
  <dd>
<span class="tt">verbose$</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> verbose$)</span>.</font>
</dd> 
  <dd>
<span class="tt">pkg-class-names</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____STRING-STRING-ALISTP.html">string-string-alistp</a> pkg-class-names)</span>.</font>
</dd> 
  <dd>
<span class="tt">fn-method-names</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____SYMBOL-STRING-ALISTP.html">symbol-string-alistp</a> fn-method-names)</span>.</font>
</dd> 
  <dd>
<span class="tt">wrld</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PLIST-WORLDP.html">plist-worldp</a> wrld)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">method</span> — <font color="#606060">Type <span class="v">(<a href="JAVA____JMETHODP.html">jmethodp</a> method)</span>.</font>
</dd> 
 
</dl></div> 
<p>This is generated only if the <span class="v">:tests</span> input is not <span class="v">nil</span>.</p><p>This is a private static method 
     that prints the name of the test, 
     builds the input values (zero or more) of the test, 
     builds the output value(s) of the test, 
     calls (the Java representation of) the function on the inupt values, 
     compares the obtained result value(s) with the output value(s) of the test, 
     and prints a message of success or failure. 
     It also sets the failures field to true if the test fails.</p><p>This method also measures the time of the Java call, 
     by taking the current time just before and just after the call, 
     and subtracting them. 
     It does that for the number of repetitions 
     specified by the integer argument of the method. 
     It stores the times of each call in an array, 
     and calculates the minimum, maximum, and sum of all the times. 
     At the end, it prints all the times, 
     along with minimum, maximum, and average 
     (where the average is obtained from the sum). 
     To prevent unwanted JIT optimizations, 
     a boolean flag is used to cumulatively check that 
     all the repeated calls succeed 
     (in the sense of computing the same result as ACL2); 
     since the code is deterministic, 
     we expect that either they will all succeed or they will all fail.</p><p>As a special case, if the integer parameter of the method is 0, 
     times are not collected, 
     no minimum/maximum/sum is calculated, 
     and no time information is printed. 
     We use a <span class="v">do</span> loop to ensure that at least one call is made, 
     even when the parameter is 0. 
     The two values are subtracted, and the time printed. 
     The reason for storing the argument values into local variables 
     in the shallow embedding approach, 
     as opposed to passing the expressions directly to the method call, 
     is to accurately measure just the time of the call, 
     without the time needed to compute the argument expressions.</p><p>The code is slightly different based on whether 
     we are using the deep or shallow embedding approach. 
     The differences are factored into the functions 
     <span class="tt"><a href="JAVA____ATJ-GEN-DEEP-TEST-CODE.html">atj-gen-deep-test-code</a></span> and <span class="tt"><a href="JAVA____ATJ-GEN-SHALLOW-TEST-CODE.html">atj-gen-shallow-test-code</a></span>.</p><p>Examining any generated instance of this method 
     should make the above documentation, 
     and the implementation of this code generation function, 
     much clearer.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>atj-gen-test-method</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 atj-gen-test-method
 (test$ deep$ guards$ java-class$ verbose$
        pkg-class-names fn-method-names wrld)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="JAVA____ATJ-TESTP.html">atj-testp</a> test$)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> deep$)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> guards$)
                             (<a href="COMMON-LISP____STRINGP.html">stringp</a> java-class$)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> verbose$)
                             (<a href="ACL2____STRING-STRING-ALISTP.html">string-string-alistp</a> pkg-class-names)
                             (<a href="ACL2____SYMBOL-STRING-ALISTP.html">symbol-string-alistp</a> fn-method-names)
                             (<a href="ACL2____PLIST-WORLDP.html">plist-worldp</a> wrld))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'atj-gen-test-method))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   (((<a href="JAVA____ATJ-TEST.html">atj-test</a> test) test$)
    ((unless (<a href="COMMON-LISP____CONSP.html">consp</a> test.outputs))
     (<a href="ACL2____PROG2_42.html">prog2$</a> (<a href="ACL2____RAISE.html">raise</a> "Internal error: the test ~x0 has no outputs."
                    test$)
             (<a href="ACL2____EC-CALL.html">ec-call</a> (<a href="JAVA____JMETHOD-FIX.html">jmethod-fix</a> :irrelevant))))
    ((run-when verbose$)
     (<a href="ACL2____CW.html">cw</a> "  ~s0~%" test.name))
    (method-name (<a href="JAVA____ATJ-GEN-TEST-METHOD-NAME.html">atj-gen-test-method-name</a> test.name))
    (comp-var "resultsMatch")
    ((<a href="ACL2____MV.html">mv</a> arg-block ares-block
         call-block jres-block comp-block)
     (<a href="COMMON-LISP____IF.html">if</a> deep$
         (<a href="JAVA____ATJ-GEN-DEEP-TEST-CODE.html">atj-gen-deep-test-code</a> test.function test.inputs
                                 test.outputs comp-var java-class$)
         (<a href="JAVA____ATJ-GEN-SHALLOW-TEST-CODE.html">atj-gen-shallow-test-code</a>
              test.function test.inputs test.outputs
              comp-var guards$ java-class$
              pkg-class-names fn-method-names wrld)))
    (current-time-expr (<a href="JAVA____JEXPR-SMETHOD.html">jexpr-smethod</a> (<a href="JAVA____JTYPE-CLASS.html">jtype-class</a> "System")
                                      "currentTimeMillis" nil))
    (n!=0-expr (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-NE.html">jbinop-ne</a>)
                             (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "n")
                             (<a href="JAVA____JEXPR-LITERAL-0.html">jexpr-literal-0</a>)))
    (method-body
     (<a href="COMMON-LISP____APPEND.html">append</a>
      (<a href="JAVA____JBLOCK-IMETHOD.html">jblock-imethod</a>
       (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "System.out")
       "print"
       (<a href="COMMON-LISP____LIST.html">list</a>
         (<a href="JAVA____ATJ-GEN-JSTRING.html">atj-gen-jstring</a> (<a href="STR____CAT.html">str::cat</a> "Testing '" test.name "'..."))))
      arg-block ares-block
      (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> (<a href="JAVA____JTYPE-BOOLEAN.html">jtype-boolean</a>)
                     "pass" (<a href="JAVA____JEXPR-LITERAL-TRUE.html">jexpr-literal-true</a>))
      (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> (<a href="JAVA____JTYPE-ARRAY.html">jtype-array</a> (<a href="JAVA____JTYPE-LONG.html">jtype-long</a>))
                     "times"
                     (<a href="JAVA____JEXPR-COND.html">jexpr-cond</a> n!=0-expr
                                 (<a href="JAVA____JEXPR-NEWARRAY.html">jexpr-newarray</a> (<a href="JAVA____JTYPE-LONG.html">jtype-long</a>)
                                                 (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "n"))
                                 (<a href="JAVA____JEXPR-LITERAL-NULL.html">jexpr-literal-null</a>)))
      (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> (<a href="JAVA____JTYPE-LONG.html">jtype-long</a>)
                     "minTime" (<a href="JAVA____JEXPR-LITERAL-0.html">jexpr-literal-0</a>))
      (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> (<a href="JAVA____JTYPE-LONG.html">jtype-long</a>)
                     "maxTime" (<a href="JAVA____JEXPR-LITERAL-0.html">jexpr-literal-0</a>))
      (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> (<a href="JAVA____JTYPE-LONG.html">jtype-long</a>)
                     "sumTime" (<a href="JAVA____JEXPR-LITERAL-0.html">jexpr-literal-0</a>))
      (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> (<a href="JAVA____JTYPE-INT.html">jtype-int</a>)
                     "i" (<a href="JAVA____JEXPR-LITERAL-0.html">jexpr-literal-0</a>))
      (<a href="JAVA____JBLOCK-DO.html">jblock-do</a>
       (<a href="COMMON-LISP____APPEND.html">append</a>
        (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> (<a href="JAVA____JTYPE-LONG.html">jtype-long</a>)
                       "startTime" current-time-expr)
        call-block
        (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> (<a href="JAVA____JTYPE-LONG.html">jtype-long</a>)
                       "endTime" current-time-expr)
        jres-block comp-block
        (<a href="JAVA____JBLOCK-ASG.html">jblock-asg</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "pass")
                    (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-CONDAND.html">jbinop-condand</a>)
                                  (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "pass")
                                  (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> comp-var)))
        (<a href="JAVA____JBLOCK-IF.html">jblock-if</a>
         n!=0-expr
         (<a href="COMMON-LISP____APPEND.html">append</a>
           (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> (<a href="JAVA____JTYPE-LONG.html">jtype-long</a>)
                          "time"
                          (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-SUB.html">jbinop-sub</a>)
                                        (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "endTime")
                                        (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "startTime")))
           (<a href="JAVA____JBLOCK-ASG.html">jblock-asg</a> (<a href="JAVA____JEXPR-ARRAY.html">jexpr-array</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "times")
                                    (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "i"))
                       (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "time"))
           (<a href="JAVA____JBLOCK-ASG.html">jblock-asg</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "sumTime")
                       (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-ADD.html">jbinop-add</a>)
                                     (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "sumTime")
                                     (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "time")))
           (<a href="JAVA____JBLOCK-IF.html">jblock-if</a>
                (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-CONDOR.html">jbinop-condor</a>)
                              (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-EQ.html">jbinop-eq</a>)
                                            (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "i")
                                            (<a href="JAVA____JEXPR-LITERAL-0.html">jexpr-literal-0</a>))
                              (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-LT.html">jbinop-lt</a>)
                                            (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "time")
                                            (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "minTime")))
                (<a href="JAVA____JBLOCK-ASG.html">jblock-asg</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "minTime")
                            (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "time")))
           (<a href="JAVA____JBLOCK-IF.html">jblock-if</a> (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-GT.html">jbinop-gt</a>)
                                    (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "time")
                                    (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "maxTime"))
                      (<a href="JAVA____JBLOCK-ASG.html">jblock-asg</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "maxTime")
                                  (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "time")))))
        (<a href="JAVA____JBLOCK-EXPR.html">jblock-expr</a> (<a href="JAVA____JEXPR-UNARY.html">jexpr-unary</a> (<a href="JAVA____JUNOP-PREINC.html">junop-preinc</a>)
                                  (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "i"))))
       (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-LT.html">jbinop-lt</a>)
                     (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "i")
                     (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "n")))
      (<a href="JAVA____JBLOCK-IFELSE.html">jblock-ifelse</a>
         (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "pass")
         (<a href="JAVA____JBLOCK-IMETHOD.html">jblock-imethod</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "System.out")
                         "println"
                         (<a href="COMMON-LISP____LIST.html">list</a> (<a href="JAVA____ATJ-GEN-JSTRING.html">atj-gen-jstring</a> " PASS")))
         (<a href="COMMON-LISP____APPEND.html">append</a> (<a href="JAVA____JBLOCK-IMETHOD.html">jblock-imethod</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "System.out")
                                 "println"
                                 (<a href="COMMON-LISP____LIST.html">list</a> (<a href="JAVA____ATJ-GEN-JSTRING.html">atj-gen-jstring</a> " FAIL")))
                 (<a href="JAVA____JBLOCK-ASG-NAME.html">jblock-asg-name</a> "failures" (<a href="JAVA____JEXPR-LITERAL-TRUE.html">jexpr-literal-true</a>))))
      (<a href="JAVA____JBLOCK-IF.html">jblock-if</a>
       n!=0-expr
       (<a href="COMMON-LISP____APPEND.html">append</a>
        (<a href="JAVA____JBLOCK-IMETHOD.html">jblock-imethod</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "System.out")
                        "println"
                        (<a href="COMMON-LISP____LIST.html">list</a> (<a href="JAVA____JEXPR-LITERAL-STRING.html">jexpr-literal-string</a> "  Times:")))
        (<a href="JAVA____JBLOCK-FOR.html">jblock-for</a>
          (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-ASG.html">jbinop-asg</a>)
                        (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "i")
                        (<a href="JAVA____JEXPR-LITERAL-0.html">jexpr-literal-0</a>))
          (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-LT.html">jbinop-lt</a>)
                        (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "i")
                        (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "n"))
          (<a href="JAVA____JEXPR-UNARY.html">jexpr-unary</a> (<a href="JAVA____JUNOP-PREINC.html">junop-preinc</a>)
                       (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "i"))
          (<a href="JAVA____JBLOCK-IMETHOD.html">jblock-imethod</a>
               (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "System.out")
               "format"
               (<a href="COMMON-LISP____LIST.html">list</a> (<a href="JAVA____JEXPR-LITERAL-STRING.html">jexpr-literal-string</a> "    %.3f%n")
                     (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-DIV.html">jbinop-div</a>)
                                   (<a href="JAVA____JEXPR-ARRAY.html">jexpr-array</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "times")
                                                (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "i"))
                                   (<a href="JAVA____JEXPR-LITERAL-FLOATING.html">jexpr-literal-floating</a> 1000)))))
        (<a href="JAVA____JBLOCK-IMETHOD.html">jblock-imethod</a>
             (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "System.out")
             "format"
             (<a href="COMMON-LISP____LIST.html">list</a> (<a href="JAVA____JEXPR-LITERAL-STRING.html">jexpr-literal-string</a> "  Minimum: %.3f%n")
                   (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-DIV.html">jbinop-div</a>)
                                 (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "minTime")
                                 (<a href="JAVA____JEXPR-LITERAL-FLOATING.html">jexpr-literal-floating</a> 1000))))
        (<a href="JAVA____JBLOCK-IMETHOD.html">jblock-imethod</a>
         (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "System.out")
         "format"
         (<a href="COMMON-LISP____LIST.html">list</a>
          (<a href="JAVA____JEXPR-LITERAL-STRING.html">jexpr-literal-string</a> "  Average: %.3f%n")
          (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-DIV.html">jbinop-div</a>)
                        (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-DIV.html">jbinop-div</a>)
                                      (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "sumTime")
                                      (<a href="JAVA____JEXPR-LITERAL-FLOATING.html">jexpr-literal-floating</a> 1000))
                        (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "n"))))
        (<a href="JAVA____JBLOCK-IMETHOD.html">jblock-imethod</a>
             (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "System.out")
             "format"
             (<a href="COMMON-LISP____LIST.html">list</a> (<a href="JAVA____JEXPR-LITERAL-STRING.html">jexpr-literal-string</a> "  Maximum: %.3f%n")
                   (<a href="JAVA____JEXPR-BINARY.html">jexpr-binary</a> (<a href="JAVA____JBINOP-DIV.html">jbinop-div</a>)
                                 (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "maxTime")
                                 (<a href="JAVA____JEXPR-LITERAL-FLOATING.html">jexpr-literal-floating</a> 1000))))
        (<a href="JAVA____JBLOCK-IMETHOD.html">jblock-imethod</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "System.out")
                        "println" nil))))))
   (<a href="JAVA____MAKE-JMETHOD.html">make-jmethod</a> :access (<a href="JAVA____JACCESS-PRIVATE.html">jaccess-private</a>)
                 :abstract? nil
                 :static? t
                 :final? nil
                 :synchronized? nil
                 :native? nil
                 :strictfp? nil
                 :result (<a href="JAVA____JRESULT-VOID.html">jresult-void</a>)
                 :name method-name
                 :params (<a href="COMMON-LISP____LIST.html">list</a> (<a href="JAVA____MAKE-JPARAM.html">make-jparam</a> :final? nil
                                            :type (<a href="JAVA____JTYPE-INT.html">jtype-int</a>)
                                            :name "n"))
                 :throws (<a href="COMMON-LISP____LIST.html">list</a> *aij-class-undef-pkg-exc*)
                 :body method-body))))</pre> 
<p><b>Theorem: </b>jmethodp-of-atj-gen-test-method</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 jmethodp-of-atj-gen-test-method
 (<a href="ACL2____B_A2.html">b*</a>
  ((method
       (<a href="JAVA____ATJ-GEN-TEST-METHOD.html">atj-gen-test-method</a> test$ deep$ guards$ java-class$ verbose$
                            pkg-class-names fn-method-names wrld)))
  (<a href="JAVA____JMETHODP.html">jmethodp</a> method))
 :rule-classes :rewrite)</pre> 

</body>
</html>
