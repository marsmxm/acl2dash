<html>
<head>
<meta charset="UTF-8">
<title>Io</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____IO">Click for Io in the Full Manual</a></h3>

<p>Input/output facilities in ACL2</p><pre class="code">Example:
(<a href="ACL2____MV-LET.html">mv-let</a>
  (channel state)
  (<a href="ACL2____OPEN-INPUT-CHANNEL.html">open-input-channel</a> "foo.lisp" :object state)
  (<a href="ACL2____MV-LET.html">mv-let</a> (eofp obj state)
          (<a href="ACL2____READ-OBJECT.html">read-object</a> channel state)
          (.
            .
             (<a href="COMMON-LISP____LET.html">let</a> ((<a href="ACL2____STATE.html">state</a> (<a href="ACL2____CLOSE-INPUT-CHANNEL.html">close-input-channel</a> channel state)))
                   (<a href="ACL2____MV.html">mv</a> final-ans state))..)))</pre> 
 
 <p>Also see <a href="ACL2____STD_F2IO.html">std/io</a> and <a href="ACL2____FILE-READING-EXAMPLE.html">file-reading-example</a>.</p> 
 
 <p>For advanced ways to control printing, see <a href="ACL2____PRINT-CONTROL.html">print-control</a>.</p> 
 
 <p>For a discussion of formatted printing, see <a href="ACL2____FMT.html">fmt</a>.</p> 
 
 <p>To control ACL2 abbreviation (``evisceration'') of objects before printing 
 them, see <a href="ACL2____SET-EVISC-TUPLE.html">set-evisc-tuple</a>, see <a href="ACL2____WITHOUT-EVISC.html">without-evisc</a>, and see <a href="ACL2____SET-IPRINT.html">set-iprint</a>.</p> 
 
 <p>To redirect output to a file, see <a href="ACL2____OUTPUT-TO-FILE.html">output-to-file</a>.</p> 
 
 <p>ACL2 supports input and output facilities equivalent to a subset of those 
 found in Common Lisp.  ACL2 does not support random access to files or 
 bidirectional streams.  In Common Lisp, input and output are to or from 
 objects of type <span class="v">stream</span>.  In ACL2, input and output are to or from objects 
 called ``channels,'' which are actually symbols.  Although a channel is a 
 symbol, one may think of it intuitively as corresponding to a Common Lisp 
 stream.  Channels are in one of two ACL2 packages, <span class="v">"ACL2-INPUT-CHANNEL"</span> 
 and <span class="v">"ACL2-OUTPUT-CHANNEL"</span>.  When one ``opens'' a file one gets back a 
 channel whose <span class="tt"><a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a></span> is the file name passed to ``open,'' 
 postfixed with <span class="v">-n</span>, where <span class="v">n</span> is a counter that is incremented every 
 time an open or close occurs.</p> 
 
 <p>There are three channels which are open from the beginning and which cannot 
 be closed:</p> 
 
 <pre class="code">acl2-input-channel::standard-character-input-0
acl2-input-channel::standard-object-input-0
acl2-input-channel::standard-character-output-0</pre> 
 
 <p>All three of these are really Common Lisp's <span class="v">*standard-input*</span> or 
 <span class="v">*standard-output*</span>, appropriately.</p> 
 
 <p>For convenience, three global variables are bound to these rather tedious 
 channel names:</p> 
 
 <pre class="code">*standard-ci*
*standard-oi*
*standard-co*</pre> 
 
 <p>Common Lisp permits one to open a stream for several different kinds of 
 <span class="v">io</span>, e.g. character or byte.  ACL2 permits an additional type called 
 ``object''.  In ACL2 an ``io-type'' is a keyword, either <span class="v">:character</span>, 
 <span class="v">:byte</span>, or <span class="v">:object</span>.  When one opens a file, one specifies a type, 
 which determines the kind of io operations that can be done on the channel 
 returned.  The types <span class="v">:character</span> and <span class="v">:byte</span> are familiar.  Type 
 <span class="v">:object</span> is an abstraction not found in Common Lisp.  An <span class="v">:object</span> file 
 is a file of Lisp objects.  One uses <span class="v">read-object</span> or 
 <span class="v">read-object-with-case</span> (see below) to read from <span class="v">:object</span> files and 
 <span class="tt"><a href="ACL2____PRINT-OBJECT_42.html">print-object$</a></span>, its more flexible variant <span class="tt"><a href="ACL2____PRINT-OBJECT_42_B2.html">print-object$+</a></span>, or 
 <span class="v">print-object$-preserving-case</span> (see below; also, <span class="v">print-object$-fn</span>) to 
 print to <span class="v">:object</span> files.  (The reading and printing are really done with 
 the Common Lisp <span class="v">read</span> and printing functions.  For those familiar with 
 <span class="v">read</span>, we note that the <span class="v">recursive-p</span> argument is <span class="v">nil</span>.)  The 
 function <span class="v">read-object-suppress</span> is logically the same as <span class="v">read-object</span> 
 except that <span class="v">read-object-suppress</span> throws away the second returned value, 
 i.e. the value that would normally be read, simply returning <span class="v">(<a href="ACL2____MV.html">mv</a> eof
 state)</span>; under the hood, <span class="v">read-object-suppress</span> avoids errors, for example 
 those caused by encountering symbols in packages unknown to ACL2.</p> 
 
 <p>The functions <span class="v">read-object-with-case</span> is defined logically simply to be 
 <span class="v">read-object</span>, while the function <span class="v">print-object$-preserving-case</span> and 
 macro <span class="tt"><a href="ACL2____PRINT-OBJECT_42_B2.html">print-object$+</a></span> are defined logically simply to be 
 <span class="v">print-object$</span>.  However, these variants generally do I/O 
 differently (except that when the host Lisp is GCL, 
 <span class="v">print-object$-preserving-case</span> behaves the same as <span class="v">print-object$</span>). 
 For <span class="v">read-object-with-case</span> the value that is read is affected by an extra 
 argument, namely, the second argument: the <i>mode</i>.  The mode is one of 
 the keywords <span class="v">:upcase</span>, <span class="v">:downcase</span>, <span class="v">:preserve</span>, or <span class="v">:invert</span>, 
 where <span class="v">:upcase</span> gives the same behavior as <span class="v">read-object</span>, and the other 
 three modes are handled according to the specification for the Common Lisp 
 function, <span class="v">readtable-case</span> (see for example <a href="http://www.lispworks.com/documentation/HyperSpec/Body/23_aba.htm" target="_blank"><nobr>the 
 Common Lisp HyperSpec's documentation for ``Examples of Effect of Readtable 
 Case on the Lisp Reader''<img src="../Icon_External_Link.png" title="External link to http://www.lispworks.com/documentation/HyperSpec/Body/23_aba.htm"></nobr></a>).  The function 
 <span class="v">print-object$-preserving-case</span> is somewhat analogous: it is defined 
 logically to be <span class="v">print-object$</span> and it has the same behavior, except that 
 symbols are printed without adding escapes merely because of lowercase 
 letters; for example, the symbol in the current package with name <span class="v">"abc"</span> 
 will be printed as <span class="v">abc</span>, not as <span class="v">|abc|</span>.  But note that 
 <span class="v">print-object$-preserving-case</span> may still insert vertical bars, depending 
 on the host Lisp, because different Lisp implementations choose to escape 
 symbols differently.  Consider the symbol typically printed as <span class="v">|1u|</span>. 
 Using <span class="v">print-object$-preserving-case</span>, this prints simply as <span class="v">1u</span> in CCL 
 and Allegro CL, but it is printed as <span class="v">|1u|</span> in SBCL, LispWorks, and CMUCL 
 â€” at least in the implementations that we tested!</p> 
 
 <p>File-names are strings.  ACL2 does not support the Common Lisp type <span class="tt"><a href="COMMON-LISP____PATHNAME.html">pathname</a></span>.  However, for the <span class="v">file-name</span> argument of the output-related 
 functions listed below, ACL2 supports a special value, <span class="v">:STRING</span>.  For this 
 value, the channel connects (by way of a Common Lisp output string stream) to 
 a string rather than to a file: as characters are written to the channel they 
 can be retrieved by using <span class="v">get-output-stream-string$</span>.</p> 
 
 <p>Here are the names, formals and output descriptions of the ACL2 io 
 functions.</p> 
 
 <pre class="code">Input Functions:
  (<a href="ACL2____OPEN-INPUT-CHANNEL.html">open-input-channel</a> (file-name io-type state) (<a href="ACL2____MV.html">mv</a> channel state))
  (<a href="ACL2____OPEN-INPUT-CHANNEL-P.html">open-input-channel-p</a> (channel io-type state) boolean)
  (<a href="ACL2____CLOSE-INPUT-CHANNEL.html">close-input-channel</a> (channel state) state)
  (<a href="ACL2____READ-CHAR_42.html">read-char$</a> (channel state) (<a href="ACL2____MV.html">mv</a> char/nil state)) ; nil for EOF
  (<a href="ACL2____PEEK-CHAR_42.html">peek-char$</a> (channel state) char/nil)
  (<a href="ACL2____READ-BYTE_42.html">read-byte$</a> (channel state) (<a href="ACL2____MV.html">mv</a> byte/nil state)) ; nil for EOF
  (<a href="ACL2____READ-OBJECT.html">read-object</a> (channel state) (<a href="ACL2____MV.html">mv</a> eof-read-flg obj-read state))
  (<a href="ACL2____READ-OBJECT-WITH-CASE.html">read-object-with-case</a> (channel mode state) (<a href="ACL2____MV.html">mv</a> eof-read-flg obj-read state))
  (<a href="ACL2____READ-OBJECT-SUPPRESS.html">read-object-suppress</a> (channel state) (<a href="ACL2____MV.html">mv</a> eof-read-flg state))
  (<a href="ACL2____READ-FILE-INTO-STRING.html">read-file-into-string</a> (file-name &amp;key..) string/nil) ; macro (reads state)

Output Functions:
  (<a href="ACL2____OPEN-OUTPUT-CHANNEL.html">open-output-channel</a>  (file-name io-type state) (<a href="ACL2____MV.html">mv</a> channel state))
  (<a href="ACL2____OPEN-OUTPUT-CHANNEL_12.html">open-output-channel!</a> (file-name io-type state) (<a href="ACL2____MV.html">mv</a> channel state))
  (<a href="ACL2____OPEN-OUTPUT-CHANNEL-P.html">open-output-channel-p</a> (channel io-type state) boolean)
  (<a href="ACL2____CLOSE-OUTPUT-CHANNEL.html">close-output-channel</a> (channel state) state)
  (<a href="ACL2____PRINC_42.html">princ$</a> (obj channel state) state)
  (<a href="ACL2____WRITE-BYTE_42.html">write-byte$</a> (<a href="COMMON-LISP____BYTE.html">byte</a> channel state) state)
  (<a href="ACL2____PRINT-OBJECT_42.html">print-object$</a> (obj channel state) state)
  (<a href="ACL2____PRINT-OBJECT_42_B2.html">print-object$+</a> (obj channel &amp;key ...) state)
  (<a href="ACL2____PRINT-OBJECT_42-PRESERVING-CASE.html">print-object$-preserving-case</a> (obj channel state) state)
  (print-object$-fn (obj serialize-character channel state) state)
  (<a href="ACL2____FMS.html">fms</a>  (<a href="COMMON-LISP____STRING.html">string</a> alist channel state evisc-tuple) state)
  (<a href="ACL2____FMS_12.html">fms!</a> (<a href="COMMON-LISP____STRING.html">string</a> alist channel state evisc-tuple) state)
  (<a href="ACL2____FMT.html">fmt</a>  (<a href="COMMON-LISP____STRING.html">string</a> alist channel state evisc-tuple) (<a href="ACL2____MV.html">mv</a> col state))
  (<a href="ACL2____FMT_12.html">fmt!</a> (<a href="COMMON-LISP____STRING.html">string</a> alist channel state evisc-tuple) (<a href="ACL2____MV.html">mv</a> col state))
  (<a href="ACL2____FMT1.html">fmt1</a> (<a href="COMMON-LISP____STRING.html">string</a> alist col channel state evisc-tuple) (<a href="ACL2____MV.html">mv</a> col state))
  (<a href="ACL2____FMT1_12.html">fmt1!</a> (<a href="COMMON-LISP____STRING.html">string</a> alist col channel state evisc-tuple) (<a href="ACL2____MV.html">mv</a> col state))
  (<a href="ACL2____CW.html">cw</a> (<a href="COMMON-LISP____STRING.html">string</a> arg0 arg1 ... argn) nil)
  (<a href="ACL2____GET-OUTPUT-STREAM-STRING_42.html">get-output-stream-string$</a> (channel state
                              &amp;optional (close-p 't)
                                        (<a href="ACL2____CTX.html">ctx</a> ''get-output-stream-string$))
                             (<a href="ACL2____MV.html">mv</a> erp string state))</pre> 
 
 <p>Note that <span class="v">open-output-channel</span> and <span class="v">open-output-channel!</span> will 
 attempt to create directories as needed (but this is not the case for 
 <span class="v">open-input-channel</span>).  For example, the following can succeed in writing 
 to the indicated file by creating subdirectory <span class="v">"dir4"</span> if that directory 
 does not already exist.</p> 
 
 <pre class="code">(<a href="ACL2____MV-LET.html">mv-let</a>
  (channel state)
  (<a href="ACL2____OPEN-OUTPUT-CHANNEL.html">open-output-channel</a> "dir4/foo4" :object state)
  (<a href="ACL2____PPROGN.html">pprogn</a> (<a href="ACL2____FMS.html">fms</a> "Here: ~x0"
               (<a href="COMMON-LISP____LIST.html">list</a> (<a href="COMMON-LISP____CONS.html">cons</a> #\0 (<a href="COMMON-LISP____MAKE-LIST.html">make-list</a> 10)))
               channel state nil)
          (<a href="ACL2____CLOSE-OUTPUT-CHANNEL.html">close-output-channel</a> channel state)))</pre> 
 
 <p>The ``formatting'' functions are particularly useful; see <a href="ACL2____FMT.html">fmt</a> and 
 see <a href="ACL2____CW.html">cw</a>.  In particular, <span class="tt"><a href="ACL2____CW.html">cw</a></span> prints to a ``comment window'' and 
 does not involve the ACL2 <span class="tt"><a href="ACL2____STATE.html">state</a></span>, so many may find it easier to use 
 than <span class="tt"><a href="ACL2____FMT.html">fmt</a></span> and its variants.  The functions <span class="tt"><a href="ACL2____FMS_12.html">fms!</a></span>, <span class="tt"><a href="ACL2____FMT_12.html">fmt!</a></span>, 
 and <span class="tt"><a href="ACL2____FMT1_12.html">fmt1!</a></span> are the same as their respective functions without the 
 ``<span class="v">!</span>,'' except that the ``<span class="v">!</span>'' functions are guaranteed to print forms 
 that can be read back in (at a slight readability cost).</p> 
 
 <p>When one enters ACL2 with <span class="v">(<a href="ACL2____LP.html">lp</a>)</span>, input and output are taken from <span class="tt"><a href="ACL2_____A2STANDARD-OI_A2.html">*standard-oi*</a></span> to <span class="tt"><a href="ACL2_____A2STANDARD-CO_A2.html">*standard-co*</a></span>.  Because these are synonyms for 
 <span class="v">*standard-input*</span> and <span class="v">*standard-output*</span>, one can drive ACL2 io off of 
 arbitrary Common Lisp streams, bound to <span class="v">*standard-input*</span> and 
 <span class="v">*standard-output*</span> before entry to ACL2.</p> 
 
 <p>The macro <span class="v">get-output-stream-string$</span> returns the string accumulated 
 into the given channel.  By default, a call of this macro closes the supplied 
 output channel.  However, a third argument is optional (default <span class="v">t</span>), and 
 if it evaluates to <span class="v">nil</span> then the channel remains open.  The fourth 
 argument is an optional context, which generally evaluates to a symbol, for 
 error reporting.  The following example illustrates.</p> 
 
 <pre class="code">ACL2 !&gt;
(<a href="ACL2____MV-LET.html">mv-let</a>
   (channel state)
   (<a href="ACL2____OPEN-OUTPUT-CHANNEL.html">open-output-channel</a> :string :object state)
   (<a href="ACL2____PPROGN.html">pprogn</a> (print-object$-fn 17 nil channel state)
           (print-object$-fn '(a b (c d)) nil channel state)
           (<a href="ACL2____ER-LET_A2.html">er-let*</a>
             ((str1 (<a href="ACL2____GET-OUTPUT-STREAM-STRING_42.html">get-output-stream-string$</a>
                     channel state
                     nil))) ; keep the channel open
             (<a href="ACL2____PPROGN.html">pprogn</a> (print-object$-fn 23 nil channel state)
                     (print-object$-fn '((e f)) nil channel state)
                     (<a href="ACL2____ER-LET_A2.html">er-let*</a> ; close the channel
                       ((str2 (<a href="ACL2____GET-OUTPUT-STREAM-STRING_42.html">get-output-stream-string$</a> channel state)))
                       (<a href="ACL2____VALUE.html">value</a> (<a href="COMMON-LISP____CONS.html">cons</a> str1 str2)))))))
 ("
17
(A B (C D))" . "
23
((E F))")
ACL2 !&gt;</pre> 
 
 <p>Also see <a href="ACL2____PRINTING-TO-STRINGS.html">printing-to-strings</a> for a discussion of formatted printing 
 functions such as <span class="v">fmt-to-string</span> that do not take a channel or <span class="tt"><a href="ACL2____STATE.html">state</a></span> argument and return a string.</p> 
 
 <p>By default, symbols are printed in upper case when vertical bars are not 
 required, as specified by Common Lisp.  See <a href="ACL2____SET-PRINT-CASE.html">set-print-case</a> for how to 
 get ACL2 to print symbols in lower case.</p> 
 
 <p>By default, numbers are printed in radix 10 (base 10).  See <a href="ACL2____SET-PRINT-BASE-RADIX.html">set-print-base-radix</a> for how to get ACL2 to print numbers in radix 2, 8, or 
 16.</p> 
 
 <p>To see the <a href="ACL2____GUARD.html">guard</a> of an IO function, or indeed any function, see 
 <a href="ACL2____ARGS.html">args</a> or call the function <span class="v">guard</span>; but some built-in functions 
 (including some IO functions) will print the result using the variable 
 <span class="v">STATE-STATE</span>.  While that is logically correct, if you want to execute the 
 guard then you should replace that variable by <span class="v">STATE</span> and also replace 
 each built-in function symbol of the form <span class="v">xxx-p1</span> by corresponding 
 function symbol <span class="v">xxx-p</span>.  Consider the following example.</p> 
 
 <pre class="code">ACL2 !&gt;:args princ$

Function         PRINC$
Formals:         (X CHANNEL STATE-STATE)
Signature:       (<a href="ACL2____PRINC_42.html">PRINC$</a> * * STATE)
                 =&gt; STATE
Guard:           (<a href="COMMON-LISP____AND.html">AND</a> (<a href="COMMON-LISP____OR.html">OR</a> (<a href="ACL2____ACL2-NUMBERP.html">ACL2-NUMBERP</a> X)
                          (<a href="COMMON-LISP____CHARACTERP.html">CHARACTERP</a> X)
                          (<a href="COMMON-LISP____STRINGP.html">STRINGP</a> X)
                          (<a href="COMMON-LISP____SYMBOLP.html">SYMBOLP</a> X))
                      (STATE-P1 STATE-STATE)
                      (<a href="COMMON-LISP____SYMBOLP.html">SYMBOLP</a> CHANNEL)
                      (OPEN-OUTPUT-CHANNEL-P1 CHANNEL
                                              :CHARACTER STATE-STATE))
Guards Verified: T
Defun-Mode:      :logic
Type:            (<a href="COMMON-LISP____CONSP.html">CONSP</a> (<a href="ACL2____PRINC_42.html">PRINC$</a> X CHANNEL STATE-STATE))
Documentation available via :DOC
 PRINC$
ACL2 !&gt;(<a href="ACL2____UNTRANSLATE.html">untranslate</a> (<a href="ACL2____GUARD.html">guard</a> 'princ$ nil (<a href="ACL2____W.html">w</a> state)) t (<a href="ACL2____W.html">w</a> state))
(<a href="COMMON-LISP____AND.html">AND</a> (<a href="COMMON-LISP____OR.html">OR</a> (<a href="ACL2____ACL2-NUMBERP.html">ACL2-NUMBERP</a> X)
         (<a href="COMMON-LISP____CHARACTERP.html">CHARACTERP</a> X)
         (<a href="COMMON-LISP____STRINGP.html">STRINGP</a> X)
         (<a href="COMMON-LISP____SYMBOLP.html">SYMBOLP</a> X))
     (STATE-P1 STATE-STATE)
     (<a href="COMMON-LISP____SYMBOLP.html">SYMBOLP</a> CHANNEL)
     (OPEN-OUTPUT-CHANNEL-P1 CHANNEL
                             :CHARACTER STATE-STATE))
ACL2 !&gt;</pre> 
 
 <p>If you want to execute the guard for <span class="tt"><a href="ACL2____PRINC_42.html">princ$</a></span>, then according to the 
 suggestion above, you should consider the guard for <span class="v">(<a href="ACL2____PRINC_42.html">princ$</a> x channel
 state)</span> to be as follows.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____AND.html">AND</a> (<a href="COMMON-LISP____OR.html">OR</a> (<a href="ACL2____ACL2-NUMBERP.html">ACL2-NUMBERP</a> X)
         (<a href="COMMON-LISP____CHARACTERP.html">CHARACTERP</a> X)
         (<a href="COMMON-LISP____STRINGP.html">STRINGP</a> X)
         (<a href="COMMON-LISP____SYMBOLP.html">SYMBOLP</a> X))
     (STATE-P STATE)
     (<a href="COMMON-LISP____SYMBOLP.html">SYMBOLP</a> CHANNEL)
     (<a href="ACL2____OPEN-OUTPUT-CHANNEL-P.html">OPEN-OUTPUT-CHANNEL-P</a> CHANNEL :CHARACTER STATE))</pre> 
 
 <p>For example, we can check the guard for a given value and channel as 
 follows.</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="COMMON-LISP____LET.html">let</a> ((x 3) (channel *standard-co*))
         (<a href="COMMON-LISP____AND.html">AND</a> (<a href="COMMON-LISP____OR.html">OR</a> (<a href="ACL2____ACL2-NUMBERP.html">ACL2-NUMBERP</a> X)
                  (<a href="COMMON-LISP____CHARACTERP.html">CHARACTERP</a> X)
                  (<a href="COMMON-LISP____STRINGP.html">STRINGP</a> X)
                  (<a href="COMMON-LISP____SYMBOLP.html">SYMBOLP</a> X))
              (STATE-P STATE)
              (<a href="COMMON-LISP____SYMBOLP.html">SYMBOLP</a> CHANNEL)
              (<a href="ACL2____OPEN-OUTPUT-CHANNEL-P.html">OPEN-OUTPUT-CHANNEL-P</a> CHANNEL :CHARACTER STATE)))
T
ACL2 !&gt;</pre> 
 
 <p>Comment for advanced users: Function <span class="tt"><a href="ACL2____OPEN-OUTPUT-CHANNEL_12.html">open-output-channel!</a></span> is 
 identical as a function to <span class="v">open-output-channel</span>, except that the former 
 may be called even during <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> expansion and <span class="tt"><a href="ACL2____CLAUSE-PROCESSOR.html">clause-processor</a></span> <a href="ACL2____HINTS.html">hints</a>, but requires that there is an active trust tag 
 (see <a href="ACL2____DEFTTAG.html">defttag</a>).</p> 
 
 <p>Finally, we note that the <a href="ACL2____STD_F2IO.html">std/io</a> library contains useful file io 
 functions whose definitions illustrate some of the features described above, 
 as does the definition of <span class="tt"><a href="ACL2____WRITE-LIST.html">write-list</a></span> in <a href="ACL2____COMMUNITY-BOOK.html">community-book</a> 
 <span class="v">books/misc/file-io.lisp</span>.</p>
</body>
</html>
