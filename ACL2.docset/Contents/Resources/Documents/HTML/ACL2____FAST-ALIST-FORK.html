<html>
<head>
<meta charset="UTF-8">
<title>Fast-alist-fork</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____FAST-ALIST-FORK">Click for Fast-alist-fork in the Full Manual</a></h3>

<p><span class="v">(<a href="ACL2____FAST-ALIST-FORK.html">fast-alist-fork</a> alist ans)</span> can be used to eliminate 
"shadowed pairs" from an alist or to copy <a href="ACL2____FAST-ALISTS.html">fast-alists</a>.</p><p>This <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> topic assumes familiarity with fast 
 alists; see <a href="ACL2____FAST-ALISTS.html">fast-alists</a>.  See <span class="tt"><a href="ACL2____FAST-ALIST-FORK_12.html">fast-alist-fork!</a></span>, <span class="tt"><a href="ACL2____FAST-ALIST-CLEAN.html">fast-alist-clean</a></span>, and <span class="tt"><a href="ACL2____FAST-ALIST-CLEAN_12.html">fast-alist-clean!</a></span> for related utilities.</p> 
 
 <p>Logically, <span class="v">(<a href="ACL2____FAST-ALIST-FORK.html">fast-alist-fork</a> alist ans)</span> is defined as follows:</p> 
 
 <p><b>Function: </b>fast-alist-fork</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> fast-alist-fork (alist ans)
       (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t))
       (<a href="COMMON-LISP____COND.html">cond</a> ((<a href="COMMON-LISP____ATOM.html">atom</a> alist) ans)
             ((<a href="COMMON-LISP____ATOM.html">atom</a> (<a href="COMMON-LISP____CAR.html">car</a> alist))
              (<a href="ACL2____FAST-ALIST-FORK.html">fast-alist-fork</a> (<a href="COMMON-LISP____CDR.html">cdr</a> alist) ans))
             ((<a href="ACL2____HONS-ASSOC-EQUAL.html">hons-assoc-equal</a> (<a href="COMMON-LISP____CAR.html">car</a> (<a href="COMMON-LISP____CAR.html">car</a> alist)) ans)
              (<a href="ACL2____FAST-ALIST-FORK.html">fast-alist-fork</a> (<a href="COMMON-LISP____CDR.html">cdr</a> alist) ans))
             (t (<a href="ACL2____FAST-ALIST-FORK.html">fast-alist-fork</a> (<a href="COMMON-LISP____CDR.html">cdr</a> alist)
                                 (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CAR.html">car</a> alist) ans)))))</pre> 
 
 <p>The alist argument need not be a fast alist.</p> 
 
 <p>Typically ans is set to nil or some other atom.  In this case, shrinking 
 produces a new, fast alist which is like alist except that (1) any 
 "malformed," atomic entries have been removed, (2) all "shadowed pairs" 
 have been removed, and (3) incidentally, the surviving elements have been 
 reversed.  This can be useful as a way to clean up any unnecessary bindings in 
 alist, or as a way to obtain a "deep copy" of a fast alist that can extended 
 independently from the original while maintaining discipline.</p> 
 
 <p>Note that fast-alist-fork is potentially expensive, for the following two 
 reasons.</p> 
 
 <ul> 
 
 <li>The alist is copied, dropping any shadowed pairs.  This process will 
 require a hash table lookup for each entry in the alist; and it will require 
 creating a new alist, which uses additional memory.</li> 
 
 <li>Unless ans is a fast alist that is stolen (see below), a new hash table 
 is created, which uses additional memory.  This hash table is populated in 
 time that is linear in the number of unique keys in the 
 alist.</li> 
 
 </ul> 
 
 <p>When ans is not an atom, good discipline requires that it is a fast alist. 
 In this case, <span class="v">fast-alist-fork</span> steals the hash table for ans and extends 
 it with all of the bindings in alist that are not in ans.  From the 
 perspective of <span class="tt"><a href="ACL2____HONS-ASSOC-EQUAL.html">hons-assoc-equal</a></span>, you can think of the resulting alist 
 as being basically similar to <span class="v">(<a href="COMMON-LISP____APPEND.html">append</a> ans alist)</span>, but in a different 
 order.</p> 
 
 <p>Note that when ans is not a fast alist (e.g., ans is an atom) then such 
 stealing does not take place.</p> 
 
 <p>A common idiom is to replace an alist by the result of shrinking it, in 
 which case it is best to free the input alist, for example as follows.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____LET.html">let</a> ((alist (<a href="ACL2____FAST-ALIST-FREE-ON-EXIT.html">fast-alist-free-on-exit</a> alist
                                      (<a href="ACL2____FAST-ALIST-FORK.html">fast-alist-fork</a> alist nil))))
  ...)</pre> 
 
 <p>See <a href="ACL2____FAST-ALIST-FREE-ON-EXIT.html">fast-alist-free-on-exit</a> and see <a href="ACL2____FAST-ALIST-FREE.html">fast-alist-free</a>.</p> 
 
 
</body>
</html>
