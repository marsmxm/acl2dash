<html>
<head>
<meta charset="UTF-8">
<title>Atj-make-parallel-asg</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=JAVA____ATJ-MAKE-PARALLEL-ASG">Click for Atj-make-parallel-asg in the Full Manual</a></h3>

<p>Generate a block that performs a parallel assignment 
          of the given expressions to the given variables.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(atj-make-parallel-asg vars types exprs) → block</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">vars</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____STRING-LISTP.html">string-listp</a> vars)</span>.</font>
</dd> 
  <dd>
<span class="tt">types</span> — <font color="#606060">Guard <span class="v">(<a href="JAVA____JTYPE-LISTP.html">jtype-listp</a> types)</span>.</font>
</dd> 
  <dd>
<span class="tt">exprs</span> — <font color="#606060">Guard <span class="v">(<a href="JAVA____JEXPR-LISTP.html">jexpr-listp</a> exprs)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">block</span> — <font color="#606060">Type <span class="v">(<a href="JAVA____JBLOCKP.html">jblockp</a> block)</span>.</font>
</dd> 
 
</dl></div> 
<p>This is used in the context of turning tail-recursions into loops, 
     but it is more general.</p><p>A recursive method call performs, in substance, 
     a parallel assignment of the actual arguments to the formal parameters, 
     and then proceeds to re-execute the method's body. 
     When we turn such a recursive call into a <span class="v">continue</span> 
     so that we can re-execute the (loop's) body, 
     we first need to assign, to the method's formal parameters, 
     the expressions for the actual arguments. 
     This function generates that assignment.</p><p>As mentioned before, the assignment must be parallel: 
     in general we cannot assign the new values in order, 
     because earlier assignments may incorrectly change 
     the value of expressions for later assignments. 
     We first attempt to topologically sort the variables 
     according to their dependencies: 
     if there are no circularities, 
     we perform the assignments in the topological order 
     (note that we need to reverse the ordered list 
     returned by <span class="tt"><a href="DEPGRAPH____TOPOSORT.html">depgraph::toposort</a></span>, 
     which starts with variables that do not depend on other variables, 
     and which we must assign last). 
     If instead there are circularities, 
     for now we use a very simple strategy: 
     we create temporary variables for all the method's arguments, 
     we initialize them with the expressions, 
     and then we assign the temporary variables to the method's parameters. 
     This can be improved, 
     by reducing the number of temporary variables 
     to just where there are circular dependencies.</p><p>The temporary variables are called <span class="v">$1</span>, <span class="v">$2</span>, etc., 
     which does not conflict with any other variables 
     generated by ATJ's translation. 
     Their types are the same as the ones of the method's parameters, 
     which are passed to these function along with their names, 
     and the expressions to assign.</p><p>We use a recursive auxiliary function that produces 
     the block with the temporary variable declarations and initializations 
     separately from the block with the assignments to the parameters. 
     The main function concatenates them into an overall block.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>atj-make-parallel-asg-aux</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> atj-make-parallel-asg-aux
       (vars types exprs i)
       (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____STRING-LISTP.html">string-listp</a> vars)
                                   (<a href="JAVA____JTYPE-LISTP.html">jtype-listp</a> types)
                                   (<a href="JAVA____JEXPR-LISTP.html">jexpr-listp</a> exprs)
                                   (<a href="ACL2____POSP.html">posp</a> i))))
       (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP_____D3.html">=</a> (<a href="ACL2____LEN.html">len</a> vars) (<a href="ACL2____LEN.html">len</a> types))
                                   (<a href="COMMON-LISP_____D3.html">=</a> (<a href="ACL2____LEN.html">len</a> types) (<a href="ACL2____LEN.html">len</a> exprs)))))
       (<a href="COMMON-LISP____LET.html">let</a> ((__function__ 'atj-make-parallel-asg-aux))
            (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
            (<a href="ACL2____B_A2.html">b*</a> (((when (<a href="COMMON-LISP____ENDP.html">endp</a> vars)) (<a href="ACL2____MV.html">mv</a> nil nil))
                 (var (<a href="COMMON-LISP____CAR.html">car</a> vars))
                 (<a href="COMMON-LISP____TYPE.html">type</a> (<a href="COMMON-LISP____CAR.html">car</a> types))
                 (expr (<a href="COMMON-LISP____CAR.html">car</a> exprs))
                 (tmp (<a href="STR____CAT.html">str::cat</a> "$" (<a href="STR____NAT-TO-DEC-STRING.html">nat-to-dec-string</a> i)))
                 (first-tmp (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> type tmp expr))
                 (first-asg (<a href="JAVA____JBLOCK-ASG.html">jblock-asg</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> var)
                                        (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> tmp)))
                 ((<a href="ACL2____MV.html">mv</a> rest-tmp rest-asg)
                  (atj-make-parallel-asg-aux (<a href="COMMON-LISP____CDR.html">cdr</a> vars)
                                             (<a href="COMMON-LISP____CDR.html">cdr</a> types)
                                             (<a href="COMMON-LISP____CDR.html">cdr</a> exprs)
                                             (<a href="COMMON-LISP____1_B2.html">1+</a> i))))
                (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP____APPEND.html">append</a> first-tmp rest-tmp)
                    (<a href="COMMON-LISP____APPEND.html">append</a> first-asg rest-asg)))))</pre> 
<p><b>Theorem: </b>jblockp-of-atj-make-parallel-asg-aux.tmp-block</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> jblockp-of-atj-make-parallel-asg-aux.tmp-block
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?tmp-block ?asg-block)
              (atj-make-parallel-asg-aux vars types exprs i)))
            (<a href="JAVA____JBLOCKP.html">jblockp</a> tmp-block))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>jblockp-of-atj-make-parallel-asg-aux.asg-block</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> jblockp-of-atj-make-parallel-asg-aux.asg-block
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?tmp-block ?asg-block)
              (atj-make-parallel-asg-aux vars types exprs i)))
            (<a href="JAVA____JBLOCKP.html">jblockp</a> asg-block))
        :rule-classes :rewrite)</pre> 
<p><b>Function: </b>atj-make-parallel-asg</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 atj-make-parallel-asg (vars types exprs)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____STRING-LISTP.html">string-listp</a> vars)
                             (<a href="JAVA____JTYPE-LISTP.html">jtype-listp</a> types)
                             (<a href="JAVA____JEXPR-LISTP.html">jexpr-listp</a> exprs))))
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP_____D3.html">=</a> (<a href="ACL2____LEN.html">len</a> vars) (<a href="ACL2____LEN.html">len</a> types))
                             (<a href="COMMON-LISP_____D3.html">=</a> (<a href="ACL2____LEN.html">len</a> types) (<a href="ACL2____LEN.html">len</a> exprs)))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'atj-make-parallel-asg))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   ((graph (<a href="JAVA____ATJ-PARALLEL-ASG-DEPGRAPH.html">atj-parallel-asg-depgraph</a> vars exprs))
    ((<a href="ACL2____MV.html">mv</a> acyclicp serialization)
     (<a href="DEPGRAPH____TOPOSORT.html">depgraph::toposort</a> graph))
    ((unless (<a href="ACL2____STRING-LISTP.html">string-listp</a> serialization))
     (<a href="ACL2____RAISE.html">raise</a>
      "Internal error: ~
                topological sort of graph ~x0 of strings ~
                has generated non-strings ~x1."
      graph serialization))
    (serialization (<a href="ACL2____REV.html">rev</a> serialization))
    ((when acyclicp)
     (<a href="JAVA____ATJ-SERIALIZE-PARALLEL-ASG.html">atj-serialize-parallel-asg</a> serialization vars exprs))
    ((<a href="ACL2____MV.html">mv</a> tmp-block asg-block)
     (atj-make-parallel-asg-aux vars types exprs 1)))
   (<a href="COMMON-LISP____APPEND.html">append</a> tmp-block asg-block))))</pre> 
<p><b>Theorem: </b>jblockp-of-atj-make-parallel-asg</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> jblockp-of-atj-make-parallel-asg
        (<a href="ACL2____B_A2.html">b*</a> ((block (<a href="JAVA____ATJ-MAKE-PARALLEL-ASG.html">atj-make-parallel-asg</a> vars types exprs)))
            (<a href="JAVA____JBLOCKP.html">jblockp</a> block))
        :rule-classes :rewrite)</pre> 

</body>
</html>
