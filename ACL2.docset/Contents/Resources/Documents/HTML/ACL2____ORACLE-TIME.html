<html>
<head>
<meta charset="UTF-8">
<title>Oracle-time</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____ORACLE-TIME">Click for Oracle-time in the Full Manual</a></h3>

<p>Carry out a computation, returning (not just printing!) how long it 
took and (on supported Lisps) how many bytes were allocated.</p><p>The <span class="v">oracle-time</span> macro allows you to run a form and get the 
elapsed time and memory allocation back as real ACL2 values.</p> 
 
<p>In most cases, you don't really need to do this.  Instead, see <a href="ACL2____TIME_42.html">time$</a>, 
which is built into ACL2 and allows you to print the runtime and allocation of 
a form as a logically invisible side-effect.  Since <a href="ACL2____TIME_42.html">time$</a> doesn't return 
the elapsed time or allocation, it is simpler and doesn't need access to <a href="ACL2____STATE.html">state</a>.  It also has some nice features for controlling when timing information 
is printed.</p> 
 
<p>On the other hand, if you want to do things like collect up tables that 
describe how your functions perform on various inputs, then <a href="ACL2____TIME_42.html">time$</a> won't 
do what you want: it just prints the timing information to the terminal, 
leaving you with no way to collect and compare the times and allocations.  In 
this case, <span class="v">oracle-time</span> may be able to do what you want.  The main 
limitation is that it does need access to the state.</p> 
 
 
<h5>Basic Example</h5> 
 
<pre class="code">(<a href="ACL2____ORACLE-TIME.html">oracle-time</a> (fib 35))   ; Simple since it returns a single value
  --&gt;
(<a href="ACL2____MV.html">mv</a> time                 ; Rational, number of seconds
    bytes                ; Natural, bytes allocated
    ans                  ; Answer from (fib 35)
    state)               ; Updated state</pre> 
 
 
<h5>Example with Multiple Return Values</h5> 
 
<pre class="code">(<a href="ACL2____ORACLE-TIME.html">oracle-time</a> (<a href="ACL2____RANDOM_42.html">random$</a> 100 state)  ; Returns multiple values
   :ret (<a href="ACL2____MV.html">mv</a> ans state))           ; Explains the return type
  --&gt;
(<a href="ACL2____MV.html">mv</a> time                          ; Rational, number of seconds
    bytes                         ; Natural, bytes allocated
    ans                           ; The random number produced
    state)                        ; Updated state</pre> 
 
<p>See also the file <span class="v">[books]/tools/oracle-time-tests.lisp</span> for some 
additional tests and working examples.</p> 
 
<h5>General Form</h5> 
 
<pre class="code">(<a href="ACL2____ORACLE-TIME.html">oracle-time</a> form [:ret retspec])</pre> 
 
<p>The <span class="v">form</span> can be any arbitrary ACL2 form that you want to execute.  If 
the form returns an ordinary, single value, e.g., as in <span class="v">(fib 35)</span> then the 
<span class="v">:ret</span> argument is not needed.  Otherwise, <span class="v">:ret</span> should explain the 
return signature of <span class="v">form</span>.</p> 
 
<p>The return value of <span class="v">oracle-time</span> extends the return value of <span class="v">form</span> 
with multiple values.  The basic idea is that <span class="v">oracle-time</span> is going to 
macroexpand to something like this:</p> 
 
<pre class="code">(<a href="ACL2____MV-LET.html">mv-let</a> retspec
   form
   (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> &amp; time state) (<a href="ACL2____READ-ACL2-ORACLE.html">read-acl2-oracle</a> state))
        ((<a href="ACL2____MV.html">mv</a> &amp; bytes state) (<a href="ACL2____READ-ACL2-ORACLE.html">read-acl2-oracle</a> state)))
     (<a href="ACL2____MV.html">mv</a> time bytes retspec [state])))</pre> 
 
<p>You can see here that the <span class="v">retspec</span> is used to explain how to bind the 
results of executing the form.  It is also, essentially, spliced into the 
return value of the whole <span class="v">oracle-time</span> call.  The only twist is that if 
<span class="v">retspec</span> mentions <span class="v">state</span>, then we don't add an extra <span class="v">state</span> onto 
the end of the form.</p>
</body>
</html>
