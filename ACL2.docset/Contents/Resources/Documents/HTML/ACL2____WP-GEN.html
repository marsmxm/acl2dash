<html>
<head>
<meta charset="UTF-8">
<title>Wp-gen</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____WP-GEN">Click for Wp-gen in the Full Manual</a></h3>

<p>An algorithm for generating weakest preconditions as mutually 
recursive functions.</p><p>The directory <span class="v">projects/security/wp-gen</span> contains the ACL2 
source files for the WP-GEN project.  These ACL2 books may be built by running, 
e.g., <span class="v">make wp-gen</span> from the <span class="v">books/</span> directory.</p> 
 
<h3>Overview</h3> 
 
<p>This book generates weakest precondition predicates, which are admitted 
as (possibly mutually recursive) ACL2 functions as described in the paper <i>A 
Weakest Precondition Model for Assembly Language Programs</i> by Bill Legato, 
dated January 28, 2003.</p> 
 
<p>The input program is given in a variation of Legato's format for assembly 
language programs. In this format each node of the program (where node roughly 
corresponds to program line) is represetned as a sequential substitution 
defining updates to state. Presently, state variables are inferred from the 
given substitutions and predicates and all functions are given as functions of 
full state with <a href="ACL2____IRRELEVANT-FORMALS.html">irrelevant-formals</a> ignored.</p> 
 
<p>No particular program language is required. The right hand side of a 
substitution can be any function defined in the current ACL2 logical world, 
although we typically think of these operations as being low-level or 
primitive. Many of the examples provided with the book use pcode operations, 
for which a partial semantics has been provided in 
<span class="v">examples/pcode.lisp</span>.</p> 
 
<h3>General Form</h3> 
 
<pre class="code">(run-wp main)</pre> 
 
<p>Here main is the program to be analyzed, in the format as specified below in 
the section <i>Program Format</i>.  (Also, see examples directory for some 
sample programs).</p> 
 
<p>A user of this book will generally want to specify one or more of the 
following options.</p> 
 
<ul> 
 
<li>
<span class="v">:prefix</span> - a prefix for the generated function names, which is appended 
to the node label when the WP for the node is generated. This is generally 
useful for providing meaningful function names and for avoiding function naming 
conflicts. If no prefix is specified, the default prefix for each function is 
"wp-".</li> 
 
<li>
<span class="v">:count-var</span> - a count variable to be decremented by the substitution at 
each node. This allows ACL2 to automatically calculate a measure for 
the (possibly) mutually recursive WP definitions. If the count 
variable is not unique from the state variables in main, run-wp will 
generate an error.</li> 
 
<li>
<span class="v">:prog-mode</span> - Default value is nil. If prog-mode is set to t the WP 
functions are defined in prog-mode, which allows ACL2 to skip proofs.</li> 
 
<li>
<span class="v">:ccg</span> - Default value is nil. If the ccg books are available and 
included in the current ACL2 environment then setting :ccg to t will attempt to 
use CCG analysis to automatically calculate a measure.</li> 
 
<li>
<span class="v">:mutrec</span> - Default value is t. Uses a call tree analysis to determine 
which WP functions are mutually recursive, and defines those in a 
mutual-recursion form. The rest are defined as individual defuns. This should 
generally be on (unless it is acting buggy, in which case contact the author) 
as bogus mutual recursions can make ACL2 proofs more difficult.</li> 
 
</ul> 
 
 
<h3>Program Format</h3> 
 
<p>A program consists of a list of nodes in the following format.</p> 
 
<pre class="code">(:node :label    idx
       :pre      annot-pre
       :subst    sub
       :branches ((pred1 . idx1) ... (predn . idxn))
       :post     annot-post)</pre> 
 
<p>where:</p> 
 
<ul> 
 
<li>
<span class="v">idx</span> is a unique node label (possibly corresponding to a program line 
number, e.g. l_1, l_2,...)</li> 
 
<li>
<span class="v">annot-pre</span> is a predicate on state prior to execution of the 
line (i.e., before the given substituation on program state is applied)</li> 
 
<li>
<span class="v">sub</span> is a substitution representing execution as an alist</li> 
 
<li>
<span class="v">branches</span> specifies program control using <span class="v">(pred . idx)</span> pairs, 
where pred is a condition on state and idx is the label of a node</li> 
 
<li>
<span class="v">annot-post</span> is a predicate on state after execution of the line</li> 
 
</ul> 
 
<h3>Miscellany</h3> 
 
<p>To generate a list of WP functions without admitting them, use 
run-wp-list:</p> 
 
<pre class="code">(run-wp-list main prefix count-var mutrec prog-mode)</pre> 
 
<p>e.g.</p> 
 
<pre class="code">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "wp-gen")
(<a href="ACL2____LD.html">ld</a> "examples/new-program.lisp")
(run-wp-list (<a href="ACL2_____04.html">@</a> new-prog) 'wp-new1 'count t nil)</pre> 
 
<p>Generates:</p> 
 
<pre class="code">(MUT-REC (<a href="COMMON-LISP____DEFUN.html">DEFUN</a> WP-NEW1-L_1 (<a href="ACL2____U.html">U</a> V W COUNT)
           (<a href="COMMON-LISP____DECLARE.html">DECLARE</a> (<a href="ACL2____XARGS.html">XARGS</a> :MEASURE (<a href="ACL2____ACL2-COUNT.html">ACL2-COUNT</a> COUNT)))
           (<a href="COMMON-LISP____IF.html">IF</a> (<a href="ACL2____ZP.html">ZP</a> COUNT)
               NIL
               (WP-NEW1-L_2 U (INT_XOR U 12345 32)
                            W (<a href="COMMON-LISP____-.html">-</a> COUNT 1))))
         (<a href="COMMON-LISP____DEFUN.html">DEFUN</a> WP-NEW1-L_2 (<a href="ACL2____U.html">U</a> V W COUNT)
           (<a href="COMMON-LISP____DECLARE.html">DECLARE</a> (<a href="ACL2____XARGS.html">XARGS</a> :MEASURE (<a href="ACL2____ACL2-COUNT.html">ACL2-COUNT</a> COUNT)))
           (<a href="COMMON-LISP____IF.html">IF</a> (<a href="ACL2____ZP.html">ZP</a> COUNT)
               NIL
               (WP-NEW1-L_3 U V (INT_ADD V 2345345299 32)
                            (<a href="COMMON-LISP____-.html">-</a> COUNT 1))))
         (<a href="COMMON-LISP____DEFUN.html">DEFUN</a> WP-NEW1-L_3 (<a href="ACL2____U.html">U</a> V W COUNT)
           (<a href="COMMON-LISP____DECLARE.html">DECLARE</a> (<a href="ACL2____XARGS.html">XARGS</a> :MEASURE (<a href="ACL2____ACL2-COUNT.html">ACL2-COUNT</a> COUNT)))
           (<a href="COMMON-LISP____IF.html">IF</a> (<a href="ACL2____ZP.html">ZP</a> COUNT)
               NIL
               (<a href="COMMON-LISP____OR.html">OR</a> (<a href="COMMON-LISP____AND.html">AND</a> (<a href="COMMON-LISP____NOT.html">NOT</a> (<a href="COMMON-LISP_____D3.html">=</a> (INT_EQUAL W 8281919193 32) 1))
                        (WP-NEW1-L_END U V W (<a href="COMMON-LISP____-.html">-</a> COUNT 1)))
                   (<a href="COMMON-LISP____AND.html">AND</a> (<a href="COMMON-LISP_____D3.html">=</a> (INT_EQUAL W 8281919193 32) 1)
                        (WP-NEW1-L_BAD U V W (<a href="COMMON-LISP____-.html">-</a> COUNT 1))))))
         (<a href="COMMON-LISP____DEFUN.html">DEFUN</a> WP-NEW1-L_BAD (<a href="ACL2____U.html">U</a> V W COUNT)
           (<a href="COMMON-LISP____DECLARE.html">DECLARE</a> (<a href="ACL2____XARGS.html">XARGS</a> :MEASURE (<a href="ACL2____ACL2-COUNT.html">ACL2-COUNT</a> COUNT)))
           (<a href="COMMON-LISP____IF.html">IF</a> (<a href="ACL2____ZP.html">ZP</a> COUNT) NIL T))
         (<a href="COMMON-LISP____DEFUN.html">DEFUN</a> WP-NEW1-L_END (<a href="ACL2____U.html">U</a> V W COUNT)
           (<a href="COMMON-LISP____DECLARE.html">DECLARE</a> (<a href="ACL2____XARGS.html">XARGS</a> :MEASURE (<a href="ACL2____ACL2-COUNT.html">ACL2-COUNT</a> COUNT)))
           (<a href="COMMON-LISP____IF.html">IF</a> (<a href="ACL2____ZP.html">ZP</a> COUNT) NIL NIL)))</pre> 
 
<p>Note: This form will generate an error from ACL2 as given, because it 
contains irrelevant formals.</p> 
 
<p>Please direct questions/comments/bugs to Sarah Weissman (<a href="mailto:seweissman@gmail.com" target="_blank"><nobr>seweissman@gmail.com<img src="../Icon_External_Link.png" title="External link to mailto:seweissman@gmail.com"></nobr></a>).</p> 
 
 
<h3>Copyright Information</h3> 
 
<p>Except where otherwise specified this is a work of the U.S. Government and 
is not subject to copyright protection in the United States. Foreign copyrights 
may apply.</p> 
 
<p>This program is free software; you can redistribute it and/or modify it 
under the terms of the GNU General Public License as published by the Free 
Software Foundation; either version 2 of the License, or (at your option) any 
later version.</p> 
 
<p>This program is distributed in the hope that it will be useful, but WITHOUT 
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS 
FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more 
details.</p> 
 
<p>You should have received a copy of the GNU General Public License along with 
this program; if not, write to the Free Software Foundation, Inc., 51 Franklin 
Street, Fifth Floor, Boston, MA 02110-1301, USA.</p>
</body>
</html>
