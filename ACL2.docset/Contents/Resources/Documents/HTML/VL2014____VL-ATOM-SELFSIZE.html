<html>
<head>
<meta charset="UTF-8">
<title>Vl-atom-selfsize</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=VL2014____VL-ATOM-SELFSIZE">Click for Vl-atom-selfsize in the Full Manual</a></h3>

<p>Compute the self-determined size of an atom.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(vl-atom-selfsize x ss ctx warnings) → (mv warnings size)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">x</span> — <font color="#606060">Guard <span class="v">(<a href="VL2014____VL-EXPR-P.html">vl-expr-p</a> x)</span>.</font>
</dd> 
  <dd>
<span class="tt">ss</span> — <font color="#606060">Guard <span class="v">(<a href="VL2014____VL-SCOPESTACK-P.html">vl-scopestack-p</a> ss)</span>.</font>
</dd> 
  <dd>
<span class="tt">ctx</span> — <font color="#606060">Guard <span class="v">(<a href="VL2014____VL-CONTEXT-P.html">vl-context-p</a> ctx)</span>.</font>
</dd> 
  <dd>
<span class="tt">warnings</span> — <font color="#606060">Guard <span class="v">(<a href="VL2014____VL-WARNINGLIST-P.html">vl-warninglist-p</a> warnings)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">warnings</span> — <font color="#606060">Type <span class="v">(<a href="VL2014____VL-WARNINGLIST-P.html">vl-warninglist-p</a> warnings)</span>.</font>
</dd> 
<dd>
<span class="tt">size</span> — <font color="#606060">Type <span class="v">(<a href="ACL2____MAYBE-NATP.html">maybe-natp</a> size)</span>.</font>
</dd> 
 
</dl></div> 
<p><b>Warning</b>: this function should typically only be called by 
the <a href="VL2014____EXPRESSION-SIZING.html">expression-sizing</a> transform.</p> 
 
<p>We attempt to compute the "self-determined size" of the atom <span class="v">x</span>. 
Another way to look at this function is as an extension of "origwidth" from 
constint/weirdint atoms to include identifiers.</p> 
 
<p>We have taken special care in our <a href="VL2014____LEXER.html">lexer</a> to ensure that every 
constant, whether it is a <a href="VL2014____VL-WEIRDINT-P.html">vl-weirdint-p</a> or <a href="VL2014____VL-CONSTINT-P.html">vl-constint-p</a>, has a 
determined width.  As a result, it is easy to determine the self-determined 
size of a constant, and we never fail to do so.</p> 
 
<p>For identifiers, we must look up the identifier in the module to try to 
determine its size.  This can fail if the identifier is not declared in the 
module, or if its size is not resolved.  In these cases, we add a fatal warning 
to <span class="v">warnings</span> and return <span class="v">nil</span> as the size.</p> 
 
<p>We do not try to size other atoms, such as real numbers, individual HID 
pieces, function names, system function names, etc.; instead we just return 
<span class="v">nil</span> as the size.  But we do not issue a warning in this case, because it 
seems like these things are not really supposed to have sizes.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>vl-atom-selfsize</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> vl-atom-selfsize (x ss ctx warnings)
       (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="VL2014____VL-EXPR-P.html">vl-expr-p</a> x)
                                   (<a href="VL2014____VL-SCOPESTACK-P.html">vl-scopestack-p</a> ss)
                                   (<a href="VL2014____VL-CONTEXT-P.html">vl-context-p</a> ctx)
                                   (<a href="VL2014____VL-WARNINGLIST-P.html">vl-warninglist-p</a> warnings))))
       (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="VL2014____VL-ATOM-P.html">vl-atom-p</a> x)))
       (<a href="COMMON-LISP____LET.html">let</a> ((__function__ 'vl-atom-selfsize))
            (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
            (<a href="ACL2____B_A2.html">b*</a> ((x (<a href="VL2014____VL-EXPR-FIX.html">vl-expr-fix</a> x))
                 (<a href="ACL2____CTX.html">ctx</a> (<a href="VL2014____VL-CONTEXT-FIX.html">vl-context-fix</a> ctx))
                 (guts (<a href="VL2014____VL-ATOM-_E3GUTS.html">vl-atom-&gt;guts</a> x))
                 ((when (<a href="VL2014____VL-FAST-CONSTINT-P.html">vl-fast-constint-p</a> guts))
                  (<a href="ACL2____MV.html">mv</a> (<a href="VL2014____OK.html">ok</a>) (<a href="VL2014____VL-CONSTINT-_E3ORIGWIDTH.html">vl-constint-&gt;origwidth</a> guts)))
                 ((when (<a href="VL2014____VL-FAST-WEIRDINT-P.html">vl-fast-weirdint-p</a> guts))
                  (<a href="ACL2____MV.html">mv</a> (<a href="VL2014____OK.html">ok</a>) (<a href="VL2014____VL-WEIRDINT-_E3ORIGWIDTH.html">vl-weirdint-&gt;origwidth</a> guts)))
                 ((when (<a href="VL2014____VL-FAST-STRING-P.html">vl-fast-string-p</a> guts))
                  (<a href="ACL2____MV.html">mv</a> (<a href="VL2014____OK.html">ok</a>)
                      (<a href="COMMON-LISP_____A2.html">*</a> 8 (<a href="COMMON-LISP____LENGTH.html">length</a> (<a href="VL2014____VL-STRING-_E3VALUE.html">vl-string-&gt;value</a> guts)))))
                 ((when (<a href="COMMON-LISP____EQ.html">eq</a> (<a href="ACL2____TAG.html">tag</a> guts) :vl-extint))
                  (<a href="ACL2____MV.html">mv</a> (<a href="VL2014____OK.html">ok</a>) 1))
                 ((unless (<a href="COMMON-LISP____OR.html">or</a> (<a href="VL2014____VL-FAST-ID-P.html">vl-fast-id-p</a> guts)
                              (<a href="VL2014____VL-FAST-HIDPIECE-P.html">vl-fast-hidpiece-p</a> guts)))
                  (<a href="ACL2____MV.html">mv</a> (<a href="VL2014____OK.html">ok</a>) nil)))
                (vl-index-selfsize x ss ctx warnings))))</pre> 
<p><b>Theorem: </b>vl-warninglist-p-of-vl-atom-selfsize.warnings</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-warninglist-p-of-vl-atom-selfsize.warnings
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?warnings ?size)
              (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings)))
            (<a href="VL2014____VL-WARNINGLIST-P.html">vl-warninglist-p</a> warnings))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>maybe-natp-of-vl-atom-selfsize.size</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> maybe-natp-of-vl-atom-selfsize.size
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?warnings ?size)
              (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings)))
            (<a href="ACL2____MAYBE-NATP.html">maybe-natp</a> size))
        :rule-classes :type-prescription)</pre> 
<p><b>Theorem: </b>warning-irrelevance-of-vl-atom-selfsize</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> warning-irrelevance-of-vl-atom-selfsize
        (<a href="COMMON-LISP____LET.html">let</a> ((ret1 (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings))
              (ret2 (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss nil nil)))
             (<a href="ACL2____IMPLIES.html">implies</a> (<a href="ACL2____SYNTAXP.html">syntaxp</a> (<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> ctx ''nil)
                                         (<a href="COMMON-LISP____EQUAL.html">equal</a> warnings ''nil))))
                      (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 ret1)
                             (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 ret2)))))</pre> 
<p><b>Theorem: </b>vl-atom-selfsize-of-vl-expr-fix-x</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-atom-selfsize-of-vl-expr-fix-x
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> (<a href="VL2014____VL-EXPR-FIX.html">vl-expr-fix</a> x)
                                 ss ctx warnings)
               (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings)))</pre> 
<p><b>Theorem: </b>vl-atom-selfsize-vl-expr-equiv-congruence-on-x</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-atom-selfsize-vl-expr-equiv-congruence-on-x
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="VL2014____VL-EXPR-EQUIV.html">vl-expr-equiv</a> x x-equiv)
                 (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings)
                        (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x-equiv ss ctx warnings)))
        :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>vl-atom-selfsize-of-vl-scopestack-fix-ss</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-atom-selfsize-of-vl-scopestack-fix-ss
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x (<a href="VL2014____VL-SCOPESTACK-FIX.html">vl-scopestack-fix</a> ss)
                                 ctx warnings)
               (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings)))</pre> 
<p><b>Theorem: </b>vl-atom-selfsize-vl-scopestack-equiv-congruence-on-ss</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-atom-selfsize-vl-scopestack-equiv-congruence-on-ss
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="VL2014____VL-SCOPESTACK-EQUIV.html">vl-scopestack-equiv</a> ss ss-equiv)
                 (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings)
                        (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss-equiv ctx warnings)))
        :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>vl-atom-selfsize-of-vl-context-fix-ctx</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-atom-selfsize-of-vl-context-fix-ctx
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss (<a href="VL2014____VL-CONTEXT-FIX.html">vl-context-fix</a> ctx)
                                 warnings)
               (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings)))</pre> 
<p><b>Theorem: </b>vl-atom-selfsize-vl-context-equiv-congruence-on-ctx</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-atom-selfsize-vl-context-equiv-congruence-on-ctx
        (<a href="ACL2____IMPLIES.html">implies</a> (vl-context-equiv ctx ctx-equiv)
                 (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings)
                        (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx-equiv warnings)))
        :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>vl-atom-selfsize-of-vl-warninglist-fix-warnings</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
    vl-atom-selfsize-of-vl-warninglist-fix-warnings
    (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx (<a href="VL2014____VL-WARNINGLIST-FIX.html">vl-warninglist-fix</a> warnings))
           (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings)))</pre> 
<p><b>Theorem: </b>vl-atom-selfsize-vl-warninglist-equiv-congruence-on-warnings</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> vl-atom-selfsize-vl-warninglist-equiv-congruence-on-warnings
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="VL2014____VL-WARNINGLIST-EQUIV.html">vl-warninglist-equiv</a> warnings warnings-equiv)
                 (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings)
                        (<a href="VL2014____VL-ATOM-SELFSIZE.html">vl-atom-selfsize</a> x ss ctx warnings-equiv)))
        :rule-classes :congruence)</pre> 

</body>
</html>
