<html>
<head>
<meta charset="UTF-8">
<title>Onehot-rewriting</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____ONEHOT-REWRITING">Click for Onehot-rewriting in the Full Manual</a></h3>

<p>Conservatively rewrite <a href="ACL2____4V-SEXPRS.html">4v-sexprs</a> by assuming some variables 
are one-hot.</p><h3>Introduction</h3> 
 
<p>Sometimes you know that certain inputs to a module are supposed to be 
one-hot.  Using this information, it may be possible to simplify the sexprs 
produced during <a href="ACL2____ESIM.html">esim</a> runs.  For example, if we know that the variables 
<span class="v">A1</span> and <span class="v">A2</span> are one-hot, we might like to rewrite a sexpr like:</p> 
 
<pre class="code">(ITE A1 (<a href="COMMON-LISP____AND.html">AND</a> A2 FOO) BAR)</pre> 
 
<p>Here, we can "see" that <span class="v">A2</span> has to be false in the true-branch since 
to get there we must have that <span class="v">A1</span> is true.  Accordingly, we would like to 
replace the sexpr with something like:</p> 
 
<pre class="code">(<a href="COMMON-LISP____AND.html">AND</a> (<a href="COMMON-LISP____NOT.html">NOT</a> A1) BAR)</pre> 
 
<p>This sort of rewriting may occasionally help to avoid combinational loops 
that are only broken when the inputs are truly one-hot, e.g., notice how the 
variable <span class="v">FOO</span> has dropped out of the expression above.</p> 
 
 
<h3>The Basic Transformation</h3> 
 
<p>Our main function for onehot rewriting is <a href="ACL2____4V-ONEHOT-RW-SEXPR.html">4v-onehot-rw-sexpr</a>.  Given 
a list of variables <span class="v">A1...AN</span> that we think are one-hot, and an s-expression 
<span class="v">SEXPR</span> to rewrite, it basically constructs:</p> 
 
<pre class="code">(ITE* ONEHOT-P SEXPR' (X))</pre> 
 
<p>Where:</p> 
 
<ul> <li>
<span class="v">ONEHOT-P</span> is constructed by <a href="ACL2____4VS-ONEHOT.html">4vs-onehot</a> and evaluates to 
<span class="v">T</span> when the <span class="v">A1...N</span> are one-hot, and</li> <li>
<span class="v">SEXPR'</span> is formed 
from <span class="v">SEXPR</span> by assuming <span class="v">A1...N</span> are indeed one-hot; see <a href="ACL2____4V-ONEHOT-SEXPR-PRIME.html">4v-onehot-sexpr-prime</a> for details.</li> </ul> 
 
<p>We prove this conservatively approximates <span class="v">SEXPR</span>, but keep in mind that 
this approximation is <b>not an equivalent</b> term!  For instance, the 
rewritten expression will always produce <span class="v">X</span> if it turns out that the inputs 
were not really one-hot.  Accordingly, you should only use this rewrite when 
you are really are certain the variables will be one-hot.</p> 
 
 
<h3>The Alist Transformation</h3> 
 
<p>Our main use for onehot rewriting is in simplifiers for <a href="ACL2____ESIM-SIMPLIFY-UPDATE-FNS.html">esim-simplify-update-fns</a>, where the goal is to rewrite a whole alist binding 
names to sexprs.</p> 
 
<p>Our main function for this is <a href="ACL2____4V-ONEHOT-RW-SEXPR-ALIST.html">4v-onehot-rw-sexpr-alist</a>, which 
takes the list of one-hot variables and the alist to rewrite as arguments. 
This function is reasonably clever: it avoids changing sexprs that don't 
mention any of the onehot variables, and it has some other performance 
optimizations that are geared toward reusing memoized results across 
sexprs.</p>
</body>
</html>
