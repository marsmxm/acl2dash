<html>
<head>
<meta charset="UTF-8">
<title>Note-7-0</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____NOTE-7-0">Click for Note-7-0 in the Full Manual</a></h3>

<p>ACL2 Version  7.0 (January, 2015) Notes</p><p>NOTE!  New users can ignore these release notes, because the <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> has been updated to reflect all changes that are recorded 
 here.</p> 
 
 <p>Below we roughly organize the changes to ACL2 since Version 6.5 into the 
 following categories of changes: existing features, new features, efficiency 
 improvements, bug fixes, changes at the system level, Emacs support, and 
 experimental versions.  Each change is described in just one category, though 
 of course many changes could be placed in more than one category.</p> 
 
 <p>A particularly major change with this release is that by default, ACL2 
 executables are <a href="ACL2____HONS-ENABLED.html">hons-enabled</a>: see <a href="ACL2____HONS-AND-MEMOIZATION.html">hons-and-memoization</a>.  We 
 expect this change to be backward compatible for current ACL2 users, other 
 than a change to the name of the executable, as described below.</p> 
 
 <ul> 
 
 <li>As before, there are two ways to build ACL2: either <a href="ACL2____HONS-ENABLED.html">hons-enabled</a>, 
 to produce ACL2(h) with executable name <span class="v">saved_acl2h</span>; or not hons-enabled, 
 to produce ``classic ACL2'', which we now call ACL2(c), with executable name 
 <span class="v">saved_acl2</span>.  [Note: These defaults were changed after Version_7.0.]</li> 
 
 <li>Unlike before, the default build of ACL2 is now ACL2(h), hence with name 
 <span class="v">saved_acl2h</span> [after Version_7.0, once again <span class="v">saved_acl2</span>].  It is still 
 possible to build ACL2(c) (hence with name <span class="v">saved_acl2</span>) [after 
 Version_7.0, <span class="v">saved_acl2c</span>], but this is not the default.</li> 
 
 <li>The change to building ACL2(h) by default may require you to change 
 scripts and environment variables to point to <span class="v">saved_acl2h</span> rather than 
 <span class="v">saved_acl2</span>.  [This change is only for Version_7.0, not later 
 versions.]</li> 
 
 </ul> 
 
 <p>Note that after the next ACL2 release, we might only support <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> ACL2 builds.</p> 
 
 <p>See also <a href="ACL2____NOTE-7-0-BOOKS.html">note-7-0-books</a> for a summary of changes made to the ACL2 
 Community Books since ACL2 6.5, including the build system.</p> 
 
 <h3>Changes to Existing Features</h3> 
 
 <p>Three new theorems have been built into ACL2 to allow some additional 
 simple arithmetic reasoning.  For example, the following failed before this 
 change, typically causing the user to include an arithmetic book; but that is 
 no longer necessary.</p> 
 
 <pre class="code">(<a href="ACL2____THM.html">thm</a> (<a href="ACL2____IMPLIES.html">implies</a> (<a href="ACL2____NATP.html">natp</a> x)
              (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____EXPT.html">expt</a> 2 (<a href="COMMON-LISP_____B2.html">+</a> 1 -1 x))
                     (<a href="COMMON-LISP____EXPT.html">expt</a> 2 x))))</pre> 
 
 <p>Thanks to Jared Davis for suggesting these, and for providing seven small 
 modifications to the community books to keep proofs from failing after the 
 changes.  (So, if you have a proof failure involving `plus' (<span class="v">+</span>) that 
 formerly succeeded, consider disabling one or more of these rules.)  Here are 
 the three new built-in theorems.</p> 
 
 <p><b>Theorem: </b>commutativity-2-of-+</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> commutativity-2-of-+
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP_____B2.html">+</a> x (<a href="COMMON-LISP_____B2.html">+</a> y z)) (<a href="COMMON-LISP_____B2.html">+</a> y (<a href="COMMON-LISP_____B2.html">+</a> x z))))</pre> 
 
 <p><b>Theorem: </b>fold-consts-in-+</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> fold-consts-in-+
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____SYNTAXP.html">syntaxp</a> (<a href="ACL2____QUOTEP.html">quotep</a> x))
                      (<a href="ACL2____SYNTAXP.html">syntaxp</a> (<a href="ACL2____QUOTEP.html">quotep</a> y)))
                 (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP_____B2.html">+</a> x (<a href="COMMON-LISP_____B2.html">+</a> y z)) (<a href="COMMON-LISP_____B2.html">+</a> (<a href="COMMON-LISP_____B2.html">+</a> x y) z))))</pre> 
 
 <p><b>Theorem: </b>distributivity-of-minus-over-+</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> distributivity-of-minus-over-+
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____-.html">-</a> (<a href="COMMON-LISP_____B2.html">+</a> x y)) (<a href="COMMON-LISP_____B2.html">+</a> (<a href="COMMON-LISP____-.html">-</a> x) (<a href="COMMON-LISP____-.html">-</a> y))))</pre> 
 
 <p><a href="ACL2____TYPE-SET.html">Type-set</a> reasoning has been improved for a few built-in functions, 
 including <span class="v">first-n-ac</span>, <span class="tt"><a href="COMMON-LISP____SUBSTITUTE.html">substitute</a></span>, <span class="tt"><a href="COMMON-LISP____NTHCDR.html">nthcdr</a></span>, and <span class="tt"><a href="COMMON-LISP____SUBSEQ.html">subseq</a></span>, and thus for some functions whose computed type depends on one of 
 these: for example, <span class="tt"><a href="ACL2____TAKE.html">take</a></span> and therefore, also <span class="tt"><a href="COMMON-LISP____BUTLAST.html">butlast</a></span> and 
 <span class="tt"><a href="ACL2____SUBSEQ-LIST.html">subseq-list</a></span>, are now known to return <span class="tt"><a href="ACL2____TRUE-LISTP.html">true-listp</a></span> results. 
 Thanks to Jared Davis for a request that led us to these changes.  In 
 particular, the definitions of <span class="v">first-n-ac</span> and <span class="v">substitute-ac</span> have 
 been modified to call <span class="tt"><a href="COMMON-LISP____REVAPPEND.html">revappend</a></span> instead of <span class="tt"><a href="COMMON-LISP____REVERSE.html">reverse</a></span>, and the 
 following <span class="v">:</span><span class="tt"><a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a></span> rules have been added to source file 
 <span class="v">axioms.lisp</span> (and can be seen using <span class="v">:</span><a href="ACL2____PE.html">pe</a>).</p> 
 
 <ul> 
 
 <li>true-listp-first-n-ac-type-prescription</li> 
 <li>stringp-substitute-type-prescription</li> 
 <li>true-listp-substitute-type-prescription</li> 
 <li>true-listp-nthcdr-type-prescription</li> 
 <li>stringp-subseq-type-prescription</li> 
 <li>true-listp-subseq-type-prescription</li> 
 
 </ul> 
 
 <p>Technical note on the above change: in some cases, the built-in 
 <span class="v">:</span><span class="tt"><a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a></span> rule has been changed, essentially for the 
 better, but new rules have also been added.  Consider for example the 
 function, <span class="tt"><a href="COMMON-LISP____SUBSTITUTE.html">substitute</a></span>.  This function calls <span class="v">substitute-ac</span>, which 
 in turn now calls <span class="tt"><a href="COMMON-LISP____REVAPPEND.html">revappend</a></span> instead of <span class="tt"><a href="COMMON-LISP____REVERSE.html">reverse</a></span>, which allows 
 ACL2 to deduce a <span class="v">:type-prescription</span> rule saying that <span class="v">substitute</span> 
 returns a string or a true-list.  However, new <span class="v">:type-prescription</span> rules 
 <span class="v">stringp-substitute-type-prescription</span> and 
 <span class="v">true-listp-substitute-type-prescription</span> allow the stronger conclusion 
 that <span class="v">substitute</span> returns a string or true-list, respectively depending on 
 whether <a href="ACL2____TYPE-SET.html">type-set</a> reasoning can deduce that the given sequence is or is 
 not a string.  The deduced <span class="v">:type-prescription</span> rule can still be of some 
 use in cases that type-set reasoning cannot establish whether or not the input 
 sequence is a string.</p> 
 
 <p>We removed support for processing legacy <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> strings 
 (those starting with <span class="v">":Doc-Section"</span>), since the <a href="ACL2____XDOC.html">xdoc</a> system has 
 been stable for some time.  Thanks to Jared Davis for assisting in that effort 
 and to David Rager for his encouragement.  The ACL2 system and <a href="ACL2____COMMUNITY-BOOKS.html">community-books</a> still have code to support such processing, but it is 
 essentially commented out: specifically, each such piece of code is prefixed 
 by <span class="v">#+acl2-legacy-doc</span>.  We expect to delete such code entirely before the 
 next release.</p> 
 
 <p>The <span class="tt"><a href="ACL2____WITH-OUTPUT.html">with-output</a></span> macro now takes a new keyword, <span class="v">:evisc</span>, that 
 specifies <a href="ACL2____EVISC-TUPLE.html">evisc-tuple</a>s.  Thanks to Warren Hunt for requesting a way to 
 submit <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> forms in a way that avoids printing large <a href="ACL2____GUARD.html">guard</a> 
 goals during guard verification.  The following example illustrates a way to 
 arrange this.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFMACRO.html">defmacro</a> defun/ (<a href="COMMON-LISP_____62REST.html">&amp;rest</a> args)
 (<a href="ACL2____MV-LET.html">mv-let</a> (evisc args)
         (<a href="COMMON-LISP____COND.html">cond</a> ((<a href="COMMON-LISP____EQ.html">eq</a> (<a href="COMMON-LISP____CAR.html">car</a> args) :evisc)
                (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP____CADR.html">cadr</a> args) (<a href="COMMON-LISP____CDDR.html">cddr</a> args)))
               (t (<a href="ACL2____MV.html">mv</a> '(:gag-mode (<a href="ACL2____EVISC-TUPLE.html">evisc-tuple</a> 3 4 nil nil)) args)))
         `(<a href="ACL2____WITH-OUTPUT.html">with-output</a> :evisc ,evisc
                       (<a href="COMMON-LISP____DEFUN.html">defun</a> ,@args))))

; example:
(defun/ h (x)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard t))
 (<a href="COMMON-LISP____APPEND.html">append</a> (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____MAKE-LIST.html">make-list</a> 10) x) x))</pre> 
 
 <p>The utility <span class="v">:</span><span class="tt"><a href="ACL2____PL2.html">pl2</a></span> no longer automatically instantiates free 
 variables; similarly for calls of <span class="v">:</span><span class="tt"><a href="ACL2____PL.html">pl</a></span> on a term.  Thanks to Eric 
 Smith for sending an example showing the problem with the previous 
 implementation.</p> 
 
 <p>When the <a href="ACL2____LD-EVISC-TUPLE.html">ld-evisc-tuple</a> is non-<span class="v">nil</span>, the utilities <span class="v">:</span><span class="tt"><a href="ACL2____PE.html">pe</a></span>, <span class="v">:</span><span class="tt"><a href="ACL2____PC.html">pc</a></span>, and <span class="v">:</span><span class="tt"><a href="ACL2____PCB_12.html">pcb!</a></span> now abbreviate their output 
 accordingly.  See <a href="ACL2____SET-EVISC-TUPLE.html">set-evisc-tuple</a>.  Thanks to David Rager for bringing 
 the need for this change to our attention.</p> 
 
 <p>The utility <span class="tt"><a href="ACL2____DISABLEDP.html">disabledp</a></span> now accepts runic abbreviations such as 
 <span class="v">(:d append)</span>.  (See <a href="ACL2____THEORIES.html">theories</a> for a discussion of runic 
 abbreviations.)  Thanks to Shilpi Goel for requesting this enhancement.</p> 
 
 <p>Gc-verbose now takes an optional second argument, which is only relevant 
 when the host Lisp is CCL, where that argument specifies verbosity for 
 EGC.</p> 
 
 <p>Nests of <span class="tt"><a href="COMMON-LISP____CAR.html">car</a></span> and <span class="tt"><a href="COMMON-LISP____CDR.html">cdr</a></span> calls are now printed 
 (``untranslated'') differently.  The old method availed itself of all 28 of 
 the car-cdr macros.  The new method only introduces 6 of them: <span class="v">cadr</span>, 
 <span class="v">caddr</span>, <span class="v">cadddr</span>, <span class="v">cddr</span>, <span class="v">cdddr</span>, <span class="v">cddddr</span>.  It never 
 introduces such macros as <span class="v">caar</span> or <span class="v">cddaar</span>, preferring <span class="v">car</span>s and 
 <span class="v">cdr</span>s when necessary.  Lisp programmers tend to recognize <span class="v">cadr</span>, 
 <span class="v">caddr</span>, and <span class="v">cadddr</span> as the accessors for the 1st, 2nd, and 
 3rd (0-based) elements of a list.  See community book 
 <span class="v">books/system/untranslate-car-cdr.lisp</span> for further discussion and a 
 correctness proof.</p> 
 
 <p>It is now possible to create more efficient <span class="v">:</span><span class="tt"><a href="ACL2____META.html">meta</a></span> rules by 
 writing metafunctions that create ``implicit hypotheses.''  See 
 <a href="ACL2____META-IMPLICIT-HYPOTHESIS.html">meta-implicit-hypothesis</a>.</p> 
 
 <p>We improved a few built in rules: <span class="v">lower-case-p-char-downcase</span>, 
 <span class="v">upper-case-p-char-upcase</span>, <span class="v">lower-case-p-forward-to-alpha-char-p</span>, and 
 <span class="v">upper-case-p-forward-to-alpha-char-p</span>.  We also improved the rule 
 <span class="v">alpha-char-p-forward-to-characterp</span> by replacing it with two rules, 
 <span class="v">alpha-char-p-forward-to-standard-char-p</span> and 
 <span class="v">standard-char-p-forward-to-characterp</span>.  The new rules are, as before, in 
 ACL2 source file <span class="v">axioms.lisp</span>.</p> 
 
 <p>The reader macro sharp-comma (<span class="v">#,</span>), which has been deprecated 
 since ACL2 Version  3.5 (May, 2009), has been eliminated.  Use sharp-dot 
 (<span class="v">#.</span>) instead; see <a href="ACL2____SHARP-DOT-READER.html">sharp-dot-reader</a>.</p> 
 
 <p>A <span class="tt"><a href="ACL2____DEFTHM.html">defthm</a></span> or <span class="tt"><a href="ACL2____DEFAXIOM.html">defaxiom</a></span> event is now redundant when there is 
 already a syntactically identical event in the logical <a href="ACL2____WORLD.html">world</a>, even if 
 the rules suggested by the two <a href="ACL2____EVENTS.html">events</a> differ.  See <a href="ACL2____REDUNDANT-EVENTS.html">redundant-events</a>.  Thanks to Jared Davis and Sol Swords for sending the 
 following example, which illustrates the change.  Previously, the final event 
 was not redundant, and hence failed.  Now, it is redundant, even though the 
 <span class="v">:typed-term</span> suggested by the new <span class="tt"><a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a></span> rule is 
 <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> (foop x))</span> where the existing rule's <span class="v">:typed-term</span> is 
 <span class="v">(foop x)</span>.</p> 
 
 <pre class="code">(<a href="ACL2____DEFUND.html">defund</a> foop (x) (<a href="COMMON-LISP____CONSP.html">consp</a> x))

(<a href="ACL2____DEFTHM.html">defthm</a> booleanp-of-foop
  (<a href="ACL2____BOOLEANP.html">booleanp</a> (foop x))
  :rule-classes :type-prescription)

(<a href="ACL2____IN-THEORY.html">in-theory</a> (<a href="ACL2____DISABLE.html">disable</a> booleanp-compound-recognizer))

(<a href="ACL2____DEFTHM.html">defthm</a> booleanp-of-foop
  (<a href="ACL2____BOOLEANP.html">booleanp</a> (foop x))
  :rule-classes :type-prescription)</pre> 
 
 <p>In the case that summary output is inhibited but error output is not (see 
 <a href="ACL2____SET-INHIBITED-SUMMARY-TYPES.html">set-inhibited-summary-types</a>), failed <a href="ACL2____EVENTS.html">events</a> did not print an 
 error message.  Now they do.</p> 
 
 <p>When a call of <a href="ACL2____ENCAPSULATE.html">encapsulate</a> with empty <a href="ACL2____SIGNATURE.html">signature</a> introduces no 
 <a href="ACL2____EVENTS.html">events</a>, it now has no effect on the ACL2 logical <a href="ACL2____WORLD.html">world</a>. 
 Formerly, such an <a href="ACL2____ENCAPSULATE.html">encapsulate</a> form would create an event even in this 
 case.  For example, the form <span class="v">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a> nil (<a href="ACL2____LOCAL.html">local</a> (<a href="COMMON-LISP____DEFUN.html">defun</a> f (x) x)))</span> 
 formerly created an event in the world, as well as a <a href="ACL2____COMMAND.html">command</a> when 
 executed at the top-level; but now it is truly a no-op.  See <a href="ACL2____ENCAPSULATE.html">encapsulate</a>.  Note: An idiom sometimes used for testing is 
 <span class="v">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a> () (<a href="ACL2____LOCAL.html">local</a> ...) (<a href="ACL2____LOCAL.html">local</a> ...) ...)</span>, that is, a trivial 
 encapsulate where each sub-event is <a href="ACL2____LOCAL.html">local</a>.  With this change, that 
 idiom is now properly supported.  (Formerly, the second such encapsulate was 
 considered redundant with the first; but that is no longer the case, since the 
 first will not be stored in the <a href="ACL2____WORLD.html">world</a>.)</p> 
 
 <p>We replaced an error with a warning for cases where a classic <a href="ACL2____CONGRUENCE.html">congruence</a> rule is unnecessary.  Thanks to Jared Davis for sending us an 
 example suggesting the need for a change.  (See ACL2 source function 
 <span class="v">chk-acceptable-congruence-rule</span> for his example and more explanation.)</p> 
 
 <p>We removed support for three <span class="tt"><a href="COMMON-LISP____DECLARE.html">declare</a></span> forms that had been permitted 
 in ACL2(h) only, but were not advertised: <span class="v">dynamic-extent</span>, <span class="v">inline</span> and 
 <span class="v">notinline</span>, because they seem difficult or impossible to support 
 correctly.  For alternatives to using <span class="v">inline</span> and <span class="v">notinline</span> 
 declarations, see <a href="ACL2____DEFUN-INLINE.html">defun-inline</a> and  <a href="ACL2____DEFUN-NOTINLINE.html">defun-notinline</a>.</p> 
 
 <p>The nu-rewriter contained special provisions for rewriting expressions 
 composed of <span class="tt"><a href="COMMON-LISP____NTH.html">nth</a></span>, <span class="tt"><a href="ACL2____UPDATE-NTH.html">update-nth</a></span>, and <span class="tt"><a href="ACL2____UPDATE-NTH-ARRAY.html">update-nth-array</a></span>, 
 together with <span class="tt"><a href="COMMON-LISP____LET.html">let</a></span> expressions and other applications of non-recursive 
 functions or <span class="tt"><a href="COMMON-LISP____LAMBDA.html">lambda</a></span> expressions.  An email query was sent to the acl2 
 mailing list on 10/24/2014, giving people an opportunity to object to the 
 removal of this feature.  Nobody objected, so we have removed it in order to 
 simplify the ACL2 code base.  Thanks to David Rager for suggesting this sort 
 of code clean-up.  Note that some system functions, for example 
 <span class="v">all-equal</span>, have been deleted in support of this change.</p> 
 
 <p><a href="ACL2____GUARD.html">Guard</a>s have been added for some system functions that support the 
 implementation of the <a href="ACL2____TAU-SYSTEM.html">tau-system</a>: <span class="v">lower-bound-&lt;=</span>, 
 <span class="v">upper-bound-&gt;=</span>, <span class="v">lower-bound-&gt;</span>, <span class="v">upper-bound-&lt;</span>, and 
 <span class="v">squeeze-k</span>.  Thanks to Dmitry Nadezhin for supplying these improvements 
 (which he also used in modifications to the community book, 
 <span class="v">books/tau/bounders/elementary-bounders.lisp</span>).</p> 
 
 <h3>New Features</h3> 
 
 <p>The new command <span class="v">:btm</span> has been added to the list of valid <a href="ACL2____BRR-COMMANDS.html">brr-commands</a>, to show the bottom-most frame in the path.  Thanks to David 
 Rager for requesting this feature.</p> 
 
 <p>A new <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> keyword, <span class="v">:</span><span class="tt"><a href="ACL2____MEASURE-DEBUG.html">measure-debug</a></span>, decorates each 
 termination proof goal with <span class="tt"><a href="ACL2____EXTRA-INFO.html">extra-info</a></span> calls that show the source of 
 the goal.  Thanks to Jared Davis (first in 2008!), Sol Swords, and Anna 
 Slobodova for requesting this feature.</p> 
 
 <p>A new reader macro, <span class="v">#{"""..."""}</span>, has been contributed by Jared 
 Davis to support the writing of strings without escape characters.  See his 
 community book <span class="v">books/system/fancy-string-reader-test.lisp</span> for 
 examples.</p> 
 
 <p>(For those who program in raw Lisp) A new Lisp variable, 
 <span class="v">*hard-error-is-error*</span>, has a default of <span class="v">nil</span> that preserves existing 
 behavior; but it can be set to a non-<span class="v">nil</span> value in order to cause 
 so-called ACL2 ``hard errors'' to result in Lisp errors whose condition, when 
 printed with <span class="v">format</span> directive <span class="v">~a</span>, is the same error message that 
 ACL2 would otherwise print.  See <a href="ACL2____HARD-ERROR.html">hard-error</a>.  Thanks to Jared Davis for 
 requesting this feature.</p> 
 
 <p>A new value for <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> keyword argument <span class="v">:uncertified-okp</span> 
 is <span class="v">:ignore-certs</span>, which specifies that all certificate files are to be 
 ignored during inclusion of this book and all of its sub-books.  See <a href="ACL2____INCLUDE-BOOK.html">include-book</a>.  Thanks to Sol Swords for requesting this feature and for 
 helpful discussions on its details.</p> 
 
 <h3>Efficiency Improvements</h3> 
 
 <p>The heuristics have changed for guessing the <span class="v">:typed-term</span> field for a 
 <span class="v">:</span><span class="tt"><a href="ACL2____TYPE-PRESCRIPTION.html">type-prescription</a></span> rule when that field is not explicitly 
 specified.  Specifically, consider the case that the conclusion of the rule is 
 a function call <span class="v">(p u)</span> for some term <span class="v">u</span>, such that there is an enabled 
 <span class="tt"><a href="ACL2____COMPOUND-RECOGNIZER.html">compound-recognizer</a></span> rule for <span class="v">p</span>.  Formerly, the <span class="v">:typed-term</span> 
 was <span class="v">u</span> in this case.  Now, it must be the case that the most recent 
 enabled such <span class="tt"><a href="ACL2____COMPOUND-RECOGNIZER.html">compound-recognizer</a></span> rule is `strong', in the following 
 sense: if <span class="v">ts1</span> is the <a href="ACL2____TYPE-SET.html">type-set</a> implied by assuming the conclusion 
 true and if <span class="v">ts2</span> is the <a href="ACL2____TYPE-SET.html">type-set</a> implied by assuming the conclusion 
 false, then <span class="v">ts1</span> and <span class="v">ts2</span> are complementary.  Thanks to Jared Davis 
 for an email that prompted us to make this change.</p> 
 
 <p>We have made several efficiency improvements (arguably heuristic in 
 nature), which may apply in many settings but especially in handling of 
 several forms during the execution of <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> — most 
 notably <span class="v">with-output</span> forms, as <span class="tt">(with-output ... FORM)</span> is now 
 essentially just <span class="tt">FORM</span> during <span class="v">include-book</span>.  For some details, 
 including statistics showing up to 1/3 of <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> time eliminated 
 by these changes (and even significant time saved outside <span class="v">include-book</span>), 
 see the comment about ``efficiency improvements'' in Community Books file 
 <span class="tt">system/doc/acl2-doc.lisp</span>, form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-7-0 ...)</span>.  Thanks 
 to Sol Swords for noticing inefficiencies that led us to these improvements, 
 and for helpful discussions.</p> 
 
 <p>The <a href="ACL2____DMR.html">dmr</a> utility has been made much more efficient, yielding a 
 performance penalty of perhaps 10% instead of perhaps more than a factor of 
 30 (3000%).</p> 
 
 <p>We made a low-level implementation tweak that resulted in a speed-up of 
 2.6% in wall-clock time for a CCL-based regression (using ``<span class="v">make</span>'' with 
 <span class="v">-j 8</span> and target ``everything'').  (Technical note: We eliminated the Lisp 
 special variable <span class="v">*attached-fn-called*</span>, using another variable <span class="v">*aokp*</span> 
 instead.  Special variable bindings can apparently be expensive!)</p> 
 
 <p>Some space has been saved in ACL2 executables by avoiding the duplication 
 of certain constants.  Specifically: for each event <span class="v">(<a href="ACL2____DEFCONST.html">defconst</a> name (<a href="COMMON-LISP____QUOTE.html">quote</a>
 val))</span> in the ACL2 source files, <span class="v">val</span> is stored in the Lisp image in 
 several places, but not all of these had been identical: they were all <span class="tt"><a href="COMMON-LISP____EQUAL.html">equal</a></span>, but not all <span class="tt"><a href="COMMON-LISP____EQ.html">eq</a></span>.  (We believe that these were already all 
 <span class="v">eq</span> for user-defined <span class="tt"><a href="ACL2____DEFCONST.html">defconst</a></span> events.)  For example, in Linux 
 builds of ACL2(h) on host Lisp CCL, we have seen a space saving of 
 approximately 18.9 MB, which is 12.6%.  Thanks to Jared Davis for pointing out 
 duplicate strings that he noticed using his <a href="ACL2____SPACEWALK.html">spacewalk</a> tool.</p> 
 
 <h3>Bug Fixes</h3> 
 
 <p>We fixed two bugs in <span class="tt"><a href="ACL2____SPEC-MV-LET.html">spec-mv-let</a></span>.  The first was pointed out to us 
 by Jared Davis using essentially the following example, where the result 
 should be <span class="v">nil</span> given that <span class="v">spec-mv-let</span> is intended to have the 
 semantics of <span class="tt"><a href="ACL2____MV_F3-LET.html">mv?-let</a></span>.</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____SET-IGNORE-OK.html">set-ignore-ok</a> t)
 T
ACL2 !&gt;(<a href="COMMON-LISP____LET.html">let</a> ((a t)
             (xval nil))
         (<a href="ACL2____SPEC-MV-LET.html">spec-mv-let</a> (yval)
                      xval
                      (<a href="ACL2____MV_F3-LET.html">mv?-let</a> (xval)
                          a
                          (<a href="COMMON-LISP____IF.html">if</a> xval
                              yval
                            nil))))
T
ACL2 !&gt;</pre> 
 
 <p>The second <span class="tt"><a href="ACL2____SPEC-MV-LET.html">spec-mv-let</a></span> bug was to allow the two lists of bound 
 variables to intersect.  In the following example, given that <span class="v">spec-mv-let</span> 
 is semantically just <span class="v">mv?-let</span>, the result should have been 46, not 34. 
 This has been fixed.  Thanks to David Rager for encouraging these two fixes 
 and checking them over.</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____SET-IGNORE-OK.html">set-ignore-ok</a> t)
 T
ACL2 !&gt;(<a href="ACL2____SPEC-MV-LET.html">spec-mv-let</a>
        (x)
        17
        (<a href="ACL2____MV_F3-LET.html">mv?-let</a> (x)
            23
            (<a href="COMMON-LISP____IF.html">if</a> t
                (<a href="COMMON-LISP_____B2.html">+</a> x x)
              "bad")))
34
ACL2 !&gt;</pre> 
 
 <p>The guard for function <a href="COMMON-LISP____ALPHA-CHAR-P.html">alpha-char-p</a> was strengthened to require that 
 its argument is a standard character.  The previous guard required only that 
 the argument is a character, and was a soundness bug; for a proof of <span class="v">nil</span> 
 before this fix, see the comment about ``alpha-char-p'' in Community Books 
 file <span class="tt">system/doc/acl2-doc.lisp</span>, form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-7-0 ...)</span>.</p> 
 
 <p>Errors were possible when evaluating functions <span class="tt"><a href="ACL2____PKG-IMPORTS.html">pkg-imports</a></span> and 
 <span class="tt"><a href="ACL2____PKG-WITNESS.html">pkg-witness</a></span> while including a book with a compiled (or expansion) 
 file.  Such errors have been eliminated.</p> 
 
 <p>Fixed a bug in <span class="v">oracle-apply-raw</span>.</p> 
 
 <p>(GCL CLtL1 only) Fixed a bug that was preventing <span class="tt"><a href="ACL2____SET-DEBUGGER-ENABLE.html">set-debugger-enable</a></span> from taking full effect in non-ANSI GCL.</p> 
 
 <p>(GCL only) The utility <span class="tt"><a href="ACL2____GC-VERBOSE.html">gc-verbose</a></span> was broken, but has been 
 fixed.</p> 
 
 <p>Fixed a bug in <a href="ACL2____PROVISIONAL-CERTIFICATION.html">provisional-certification</a> that incorrectly caused an 
 error during the convert step for <span class="tt"><a href="ACL2____VERIFY-GUARDS_B2.html">verify-guards+</a></span> forms.  More 
 generally, this error occurred when encountering a <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> form 
 with a non-<span class="v">nil</span> value supplied for the <span class="v">:expansion?</span> keyword.  Thanks 
 to David Rager for reporting this bug.</p> 
 
 <p>A raw Lisp error could occur with <a href="ACL2____GUARD.html">guard</a>-checking turned off, because 
 type declarations were mistakenly left in the executable counterparts 
 (so-called ``*1* functions'') when ACL2 processed function definitions.  The 
 following example shows how a type violation could occur in some Lisps (we saw 
 this in SBCL but not in CCL, for example).</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> f (x)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="ACL2____NATP.html">natp</a> x)))
  (<a href="COMMON-LISP____LET.html">let</a> ((y (<a href="COMMON-LISP____1_B2.html">1+</a> x)))
    (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____TYPE.html">type</a> (integer 0 *) y))
    y))
(<a href="ACL2____SET-GUARD-CHECKING.html">set-guard-checking</a> nil)
; Possible raw Lisp error:
; "The value -2 is not of type UNSIGNED-BYTE."
(f -3)</pre> 
 
 <p>Thanks to Jared Davis for sending us an example that brought this bug to 
 our attention.</p> 
 
 <p>Fixed a bug that was causing a low-level assertion, saying: 
 ``Implementation error: see 'replace-free-rw-cache-entry.''  Thanks to Anna 
 Slobodova for bringing this bug to our attention via an example, and to Sol 
 Swords for simplifying that example.</p> 
 
 <p>The <a href="ACL2____IPRINT.html">iprint</a> feature, which allows abbreviated output to be read back 
 in, did not work as one might expect when using the <a href="ACL2____BREAK-REWRITE.html">break-rewrite</a> 
 feature (see <a href="ACL2____BRR.html">brr</a>).  Thanks to David Rager for reporting this problem. 
 More generally: the problem was that values associated with <a href="ACL2____IPRINT.html">iprint</a> 
 indices during a <a href="ACL2____WORMHOLE.html">wormhole</a>, for example after breaking on a <a href="ACL2____REWRITE.html">rewrite</a> rule, were forgotten when exiting the wormhole.  (Technical note for 
 those interested: the fix restores the main iprinting structure after exiting 
 a wormhole, just before reading the next top-level form.  That restoration 
 uses raw Lisp, with logic-only code based on <span class="tt"><a href="ACL2____READ-ACL2-ORACLE.html">read-ACL2-oracle</a></span>.)  The 
 example below failed before the fix but now works.</p> 
 
 <pre class="code">(<a href="ACL2____SET-EVISC-TUPLE.html">set-evisc-tuple</a> (<a href="ACL2____EVISC-TUPLE.html">evisc-tuple</a> 3 3 nil nil)
                 :iprint t
                 :sites :all)
(<a href="ACL2____DEFTHM.html">defthm</a> my-rule (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____CAR.html">car</a> (<a href="COMMON-LISP____CONS.html">cons</a> x x)) x))
(<a href="ACL2____BRR.html">brr</a> t)
(<a href="ACL2____MONITOR.html">monitor</a> '(:rewrite my-rule) t)
(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____CAR.html">car</a> (<a href="COMMON-LISP____CONS.html">cons</a> a a)) a) :hints (("Goal" :do-not '(preprocess))))
; Now entering a :brr break:
(<a href="COMMON-LISP____MAKE-LIST.html">make-list</a> 10) ; printed without evisceration
; Set evisceration with iprinting:
(<a href="ACL2____SET-EVISC-TUPLE.html">set-evisc-tuple</a> (<a href="ACL2____EVISC-TUPLE.html">evisc-tuple</a> 3 3 nil nil)
                 :iprint t
                 :sites :all)
(<a href="COMMON-LISP____MAKE-LIST.html">make-list</a> 10) ; printed with evisceration
(<a href="ACL2____A_12.html">a!</a>) ; quit break-rewrite
; The following formerly caused a hard Lisp error, because although #@3#
; was printed in the output from (<a href="COMMON-LISP____MAKE-LIST.html">make-list</a> 10) just above, iprint index 3
; was lost when exiting the break-rewrite wormhole.  Now, this works
; because iprinting information from the wormhole is retained.
'#@3#</pre> 
 
 <p>There was a bug in how so-called ``hidden packages'' were handled by <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> forms (see <a href="ACL2____HIDDEN-DEATH-PACKAGE.html">hidden-death-package</a>), which was preventing 
 package axioms from being visible in certain contexts.  (Technical remark: 
 packages that were hidden after the second pass but not the first were treated 
 as not-hidden, even though their package axioms were not introduced.)  That, 
 in turn, could cause an <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> form to fail when the book 
 contains a <span class="tt"><a href="ACL2____DEFTHEORY-STATIC.html">deftheory-static</a></span> form.  Here is an example failure.  First, 
 in a fresh ACL2 session evaluate the form <span class="v">(<a href="ACL2____DEFPKG.html">defpkg</a> "FOO" nil)</span> and then 
 evaluate the form <span class="v">(<a href="ACL2____CERTIFY-BOOK.html">certify-book</a> "foo" 1)</span>, where file <span class="v">foo.lisp</span> is 
 as follows.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "ACL2")
(<a href="COMMON-LISP____DEFUN.html">defun</a> foo::foo (x) x)
(<a href="ACL2____DEFTHEORY-STATIC.html">deftheory-static</a> foo-theory
  (<a href="ACL2____CURRENT-THEORY.html">current-theory</a> :here))</pre> 
 
 <p>Now evaluate the following sequence of forms.  In previous versions of 
 ACL2, the final (<span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span>) form failed.</p> 
 
 <pre class="code">(<a href="ACL2____ENCAPSULATE.html">encapsulate</a> () (<a href="ACL2____LOCAL.html">local</a> (<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "foo")) (<a href="COMMON-LISP____DEFUN.html">defun</a> h (x) x))
(<a href="ACL2____ENCAPSULATE.html">encapsulate</a> () (<a href="ACL2____LOCAL.html">local</a> (<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "foo")) (<a href="COMMON-LISP____DEFUN.html">defun</a> h2 (x) x))
(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "foo") ; failed before the fix</pre> 
 
 <p>We have cleaned up handling of interrupts and aborts when inside the <a href="ACL2____BREAK-REWRITE.html">break-rewrite</a> loop, or indeed any <a href="ACL2____WORMHOLE.html">wormhole</a>.  Thanks to David Russinoff 
 for bringing to our attention a case in which ACL2 quit a proof with 
 ``Aborting due to an interrupt'' when in fact no interrupts had taken place. 
 Here is an example where that no longer happens but did, previously.  (For a 
 different example, see the comment in the ACL2 sources definition of macro 
 <span class="v">bind-acl2-time-limit</span>.)</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x) (<a href="COMMON-LISP____CONS.html">cons</a> x x))
(<a href="ACL2____BRR.html">brr</a> t)
(<a href="ACL2____MONITOR.html">monitor</a> '(:definition foo) t)
(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (foo y) z))
(<a href="COMMON-LISP____DEFUN.html">defun</a> h (x) (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :mode :program)) (<a href="COMMON-LISP____CAR.html">car</a> x))
; Raw Lisp error:
(h 3)
; Previously, unexpected proof abort "due to interrupt":
(<a href="ACL2____THM.html">thm</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____APPEND.html">append</a> (<a href="COMMON-LISP____APPEND.html">append</a> x y) x y) (<a href="COMMON-LISP____APPEND.html">append</a> x y x y)))</pre> 
 
 <p>When aborting with <span class="v">:</span><span class="tt"><a href="ACL2____A_12.html">a!</a></span> inside the <a href="ACL2____BREAK-REWRITE.html">break-rewrite</a> loop 
 from within the <a href="ACL2____PROOF-BUILDER.html">proof-builder</a>, a raw Lisp error could subsequently 
 occur saying, ``Attempt to execute *wormhole-cleanup-form* twice!''.  This has 
 been fixed.  Thanks to Sol Swords for reporting a bug in our original fix. 
 Here is an example that formerly caused that behavior.</p> 
 
 <pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> silly (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____NULL.html">null</a> x) (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____APPEND.html">append</a> x y) y)))
(<a href="ACL2____DEFCONST.html">defconst</a> *c* (<a href="COMMON-LISP____MAKE-LIST.html">make-list</a> 10))
:brr t
:monitor (:rewrite silly) t
(<a href="ACL2____VERIFY.html">verify</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____APPEND.html">append</a> x (<a href="COMMON-LISP____APPEND.html">append</a> *c* y)) (<a href="COMMON-LISP____APPEND.html">append</a> y (<a href="COMMON-LISP____APPEND.html">append</a> *c* x))))
bash
:go
:a!
bash ; formerly caused error</pre> 
 
 <p>The utility <span class="tt"><a href="ACL2____REDO-FLAT.html">redo-flat</a></span> no longer worked when interrupting a 
 proof (with Control-c), due to a bug in Version 7.0.  This has been fixed. 
 Thanks to Dave Greve for reporting this problem.</p> 
 
 <h3>Changes at the System Level</h3> 
 
 <p>As mentioned near the top of this <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> topic, default 
 builds of ACL2 are now <a href="ACL2____HONS-ENABLED.html">hons-enabled</a>.</p> 
 
 <p>(GCL only) GCL Versions prior to 2.6.12 are no longer supported.</p> 
 
 <p>Modified code used in distributing Debian releases that allows books 
 certified in one directory to be distributed in another.  This change, 
 together with the fact that such relocation is <b>not</b> truly supported, is 
 explained in comments in source function <span class="v">make-certificate-file-relocated</span>. 
 Thanks to Camm Maguire for discussions leading to this change.</p> 
 
 <p>(GCL only) Modified how home directory is calculated.  Thanks to Camm 
 Maguire for help in making this change.</p> 
 
 <p>(SBCL only) Fixed a check done at build time that was preventing builds in 
 SBCL 1.2.2 because of its new backquote implementation.  Thanks to Harsh Raju 
 Chamarthi and Pete Manolios for bringing this issue to our attention.</p> 
 
 <p>Development snapshots of ACL2 (and of the <a href="ACL2____COMMUNITY-BOOKS.html">community-books</a>) are now 
 available between releases from <a href="https://github.com/acl2/acl2" target="_blank"><nobr>an ACL2 
 github repository<img src="../Icon_External_Link.png" title="External link to https://github.com/acl2/acl2"></nobr></a>; they are no longer available via svn.  Thanks to David 
 Rager and Jared Davis for taking the lead on this conversion.  As a result, 
 the banner printed at startup for those snapshots has changed slightly.  For a 
 quick start guide for using git with ACL2, see <a href="ACL2____GIT-QUICK-START.html">git-quick-start</a>.</p> 
 
 <p>(CCL only) Control-d now quits ACL2 in raw Lisp just as it has done for a 
 long time in the loop and, for ACL2(h) (i.e., <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> ACL2), even 
 in raw Lisp.</p> 
 
 <p>(Should essentially affect GCL only) Significant re-work has been done for 
 function proclaiming, which is still only done when the host Lisp is GCL.  In 
 particular, the build process now has extra steps even for other Lisps though 
 for them, the extra steps are trivial (technical details may be found in the 
 comment labeled ``Essay on Proclaiming'' in source file acl2-fns.lisp).  We 
 now use GCL's automatic proclaiming mechanism to calculate function types 
 during the build (boot-strap), as we have seen it perform better than our own. 
 Thanks to Camm Maguire for helpful discussions, in particular for explaining 
 that mechanism and for pointing out that the re-proclaiming that had been done 
 previously during the build could lead to buggy behavior.</p> 
 
 <p>For Makefile targets for testing such as <span class="v">regression</span>, the default ACL2 
 image used is now the same one that would be built for the same Makefile 
 variables.  In particular, the command <span class="v">make regression</span> is equivalent to 
 <span class="v">make regression ACL2_HONS=h</span>, which uses the executable <span class="v">saved_acl2h</span>, 
 not <span class="v">saved_acl2</span> as was formerly the case.  Thanks to Harsh Raju Chamarthi 
 for finding a bug in a first attempt to make this change.</p> 
 
 <h3>EMACS Support</h3> 
 
 <h3>Hons-enabled and Experimental Versions</h3> 
 
 <p>(For <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> executables only) Fixed a soundness bug related to 
 function memoization.  For a proof of <span class="v">nil</span> exploiting this bug in Version 
 6.5, see the comment about ``pons-addr-of-argument'' in Community Books file 
 <span class="tt">system/doc/acl2-doc.lisp</span>, form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-7-0 ...)</span>.  Thanks 
 to Jared Davis for improving our original fix: by noting its applicability to 
 <span class="tt"><a href="ACL2____HONS-CLEAR.html">hons-clear</a></span> (not just <span class="tt"><a href="ACL2____HONS-WASH.html">hons-wash</a></span>); by tweaking our fix so that 
 it works even if a <span class="v">control-c</span> interrupts (<span class="v">hons-clear</span> or) 
 <span class="v">hons-wash</span>; and later by finding another bug in source function 
 <span class="v">pons-addr-of-argument</span> and suggesting a fix, which we incorporated.</p> 
 
 <p>(For <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> executables only) Fixed a soundness bug due to the 
 fact that function <span class="v">never-memoize-fn</span> returned <span class="v">nil</span> in the logic but 
 returned <span class="v">t</span> in raw Lisp.  For a proof of <span class="v">nil</span> exploiting this bug in 
 Version 6.5, see the comment about ``never-memoize-fn'' in Community Books 
 file <span class="tt">system/doc/acl2-doc.lisp</span>, form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-7-0 ...)</span>.</p> 
 
 <p>Static honsing for <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> ACL2, an efficiency enhancement 
 formerly only available for CCL, is now incorporated into builds on 
 sufficiently recent GCL versions.</p> 
 
 <p>ACL2 executables that were <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> could fail to use 
 previously-compiled definitions for <span class="tt"><a href="ACL2____MEMOIZE.html">memoize</a></span>d functions when <span class="tt"><a href="ACL2____INCLUDE-BOOK.html">include-book</a></span> is invoked.  This has been fixed.</p> 
 
 <p>(For <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> executables only built on other than CCL or SBCL) 
 Calls of <span class="tt"><a href="ACL2____MEMOIZE.html">memoize</a></span> only compile the memoized definition when the 
 original function is compiled, rather than unconditionally as before.</p> 
 
 <p>Several changes been made to function memoization (see <a href="ACL2____MEMOIZE.html">memoize</a>). 
 Here is a list of changes visible at the user level; for implementation 
 details, see <a href="ACL2____NOTE-7-0-MEMOIZE.html">note-7-0-memoize</a>.</p> 
 
 <ul> 
 
 <li>It is now legal to call <span class="tt"><a href="ACL2____MEMOIZE.html">memoize</a></span> on functions with special raw-Lisp 
 code (such as <span class="tt"><a href="ACL2____LEN.html">len</a></span>) provided the value of the <span class="v">:inline</span> keyword 
 argument is <span class="v">nil</span>.</li> 
 
 <li>Bug fix: Fixed bug that was making <span class="tt"><a href="ACL2____MEMSUM.html">memsum</a></span> attribute the count of 
 making of hash tables to ``Heap bytes allocated'' instead of to ``Number of 
 calls to mht.''</li> 
 
 <li>Memoize keyword <span class="v">:trace</span> is no longer supported, as the <span class="tt"><a href="ACL2____TRACE_42.html">trace$</a></span> 
 utility provides much more flexibility.</li> 
 
 <li>Bug fix: Fixed a bug in handling of the <span class="v">:commutative</span> argument of 
 <span class="tt"><a href="ACL2____MEMOIZE.html">memoize</a></span> that could cause a hard Lisp error.  For a book that exhibits 
 this bug, see the comment about ``:commutative'' in Community Books file 
 <span class="tt">system/doc/acl2-doc.lisp</span>, in the form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-7-0
 ...)</span>.</li> 
 
 <li>When <span class="tt"><a href="ACL2____MEMOIZE.html">memoize</a></span> is called with keyword argument <span class="v">:commutative</span> 
 having value <span class="v">t</span>, the benefit of that argument can apply to rational number 
 arguments even when not using static honsing.  Moreover, now only one argument 
 needs to be a rational or to be ``static'' according to the 
 implementation (technically: to have an <span class="v">hl-staticp</span> value).</li> 
 
 <li>Bug fix: Calls of <span class="tt"><a href="ACL2____MEMOIZE.html">memoize</a></span> with keyword argument <span class="v">:commutative
 t</span> were sometimes inappropriately treated as redundant <a href="ACL2____REDUNDANT-EVENTS.html">redundant-events</a>.  This has been fixed.  Here is a simple example of what 
 formerly went wrong.</li> 
 
 <pre class="code">(<a href="ACL2____DEFN.html">defn</a> f (x y) (<a href="COMMON-LISP____EQUAL.html">equal</a> x y))
(<a href="ACL2____MEMOIZE.html">memoize</a> 'f :commutative t)
(<a href="ACL2____UNMEMOIZE.html">unmemoize</a> 'f)
(<a href="ACL2____MEMOIZE.html">memoize</a> 'f :commutative t) ; was redundant, so did not memoize</pre> 
 
 <li>(For those who memoized directly in raw Lisp) <span class="v">Memoize-fn</span> now requires 
 its first argument to be a defined (fboundp) function symbol.  (It seemed odd 
 and needlessly arcane to allow memoize-fn to define an undefined 
 function.)</li> 
 
 <li>(For those who memoized directly in raw Lisp) <span class="v">Memoize-fn</span> now causes 
 an error when it fails.</li> 
 
 <li>Bug fix: It had been possible to lose a memoization setting of <span class="v">:aokp
 t</span> when many functions were memoized.  For an example, see the comment about 
 ``rememoize-all'' in Community Books file <span class="tt">system/doc/acl2-doc.lisp</span>, in 
 the form <span class="v">(<a href="ACL2____DEFXDOC.html">defxdoc</a> note-7-0 ...)</span>.</li> 
 
 <li>We eliminated undocumented utilities <span class="v">memoize-on</span> and <span class="v">memoize-off</span>, 
 which were not used as far as we know.</li> 
 
 <li>When a memoized function call fails to satisfy the specified 
 condition, that call is no longer counted as a ``hit'', at least by 
 default.  This can be changed with raw Lisp variable, 
 <span class="v">*condition-nil-as-hit*</span>.</li> 
 
 <li>The utility <span class="tt"><a href="ACL2____MEMSUM.html">memsum</a></span> had reported one more pons call and (CCL only) 
 one more byte than was correct, and could perhaps report one call when there 
 were actually zero.  That has all been fixed.</li> 
 
 <li>Bug fix: Some sorting of results based on ``self'' time and ``other 
 functions'' time had been wrong.  (Technical remark: the problem was that the 
 implementation confused ``ticks'' with ``time''.)  This has been fixed.</li> 
 
 <li>Statistics reporting (see <a href="ACL2____MEMSUM.html">memsum</a>) often has a more uniform look. 
 It is now done with a right margin of 79 instead of 70.  For <span class="tt"><a href="ACL2____MEMSUM.html">memsum</a></span>, 
 thanks to a suggestion from Warren Hunt, the <span class="v">defun</span> formerly printed to 
 start each entry is now omitted, and after the name is printed at the start, a 
 newline is printed before the ``hits'' or ``hits/calls'' information is 
 printed.  A related change: when <span class="v">*report-hits*</span> and <span class="v">*report-calls*</span> 
 are both <span class="v">nil</span>, ``calls'' is no longer printed.  Other cosmetic changes 
 were also made to <span class="tt"><a href="ACL2____MEMSUM.html">memsum</a></span> output.</li> 
 
 <li>The output from <span class="tt"><a href="ACL2____MEMSUM.html">memsum</a></span> on the line ``Time of all outermost calls'' 
 no longer includes a percentage, which had been at best misleading and at 
 worse nonsensical.  Suppose for example that <span class="v">f</span> calls <span class="v">g</span>, which does 
 all the work.  Then <span class="v">memsum</span> had reported 50% of the ``Time of all 
 outermost calls'' for each of <span class="v">f</span> and <span class="v">g</span>, even though 100% of the time 
 was spent under each.</li> 
 
 <li>On Mac OS (Darwin), the physical memory is now accurately computed 
 (using shell command ``sysctl hw.memsize'', which works in some versions of 
 Mac OS, maybe all recent ones; tested on 10.6 and 10.7).  Before, the physical 
 memory value had been assumed to be 2^32 bytes.  The physical memory value is 
 used in CCL for triggering garbage collections.  (Technical remark: this is 
 implemented in function <span class="v">start-sol-gc</span>.)</li> 
 
 <li>Bug fix: in the pons summary, misses had been reported instead of hits on 
 the ``hits/calls'' line.</li> 
 
 <li>Fixed <span class="tt"><a href="ACL2____MEMSUM.html">memsum</a></span> so that package names are printed with the symbols. 
 Also, printing is done with respect to the current package, not the 
 <span class="v">"ACL2"</span> package.</li> 
 
 <li>It is now legal to <a href="ACL2____PROFILE.html">profile</a> functions that take <span class="tt"><a href="ACL2____STATE.html">state</a></span> as an 
 argument.  Thanks to Sol Swords for requesting this change.  In the course of 
 making this change, we took a conservative approach and put the same 
 requirement regarding illegal memoization of functions involving user-defined 
 <span class="tt"><a href="ACL2____STOBJ.html">stobj</a></span>s: that is, when memoization must have value <span class="v">nil</span> for the 
 <span class="v">:condition</span> keyword, it must also have value <span class="v">nil</span> for the <span class="v">:inline</span> 
 keyword.  We can perhaps remove this additional restriction if necessary.</li> 
 
 <li>For every built-in memoized function defined in the ACL2 logic, the 
 memoization is done in the usual way (during the ACL2 build), using the <span class="tt"><a href="ACL2____MEMOIZE.html">memoize</a></span> event during the ACL2 build.  Such functions can thus be <span class="tt"><a href="ACL2____UNMEMOIZE.html">unmemoize</a></span>d by users in the usual way.  Thanks to David Rager for requesting 
 this enhancement.</li> 
 
 <li>A new <span class="v">memoize</span> keyword, <span class="v">:stats</span>, can control whether statistics 
 will be saved for reporting with <span class="v">(<a href="ACL2____MEMSUM.html">memsum</a>)</span>.</li> 
 
 <li>Memoization in <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> ACL2(p) is no longer affected by calls 
 of <span class="tt"><a href="ACL2____SET-WATERFALL-PARALLELISM.html">set-waterfall-parallelism</a></span>.</li> 
 
 </ul> 
 
 <p>(ACL2(p) only, either <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> or not) The function <a href="ACL2____CPU-CORE-COUNT.html">Cpu-core-count</a> is now sensitive to environment variable <span class="v">ACL2_CORE_COUNT</span>. 
 See <a href="ACL2____CPU-CORE-COUNT.html">cpu-core-count</a>.  Thanks to Jared Davis for requesting this 
 enhancement.</p> 
 
 <p>Support for multi-threading has been added for memoization.  Thanks to 
 Jared Davis for contributing an initial implementation.  Note that this may 
 slow down <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> ACL2(p) by several percent on 
 memoization-intensive applications.  Undocumented function 
 <span class="v">mf-multiprocessing</span> is available for low-level system hackers to turn 
 on/off this feature, which by default is off for <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> ACL2 and 
 on for <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> ACL2(p).</p> 
 
 <p>(ACL2(p) only, either <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> or not) We fixed a bug in <span class="tt"><a href="ACL2____PAND.html">pand</a></span>, which we believe was also a bug in <span class="tt"><a href="ACL2____POR.html">por</a></span>, <span class="tt"><a href="ACL2____PARGS.html">pargs</a></span>, and 
 <span class="tt"><a href="ACL2____PLET.html">plet</a></span>. (Technical remark: this bug had a low-level cause, pertaining to 
 maintenance of a Lisp variable, <span class="v">*ld-level*</span>, that holds the number of 
 nested calls of <span class="tt"><a href="ACL2____LD.html">ld</a></span>.)  Thanks to Jared Davis for reporting this bug and 
 to David Rager for assisting in its repair.  Below is a slightly simplified 
 version of Jared's example, which formerly caused an assertion error but now 
 works as expected.</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFMACRO.html">defmacro</a> pand* (x y)
  `(<a href="ACL2____SPEC-MV-LET.html">spec-mv-let</a> (yval)
                ,y
                (<a href="ACL2____MV_F3-LET.html">mv?-let</a> (xval)
                         ,x
                         (<a href="COMMON-LISP____IF.html">if</a> xval
                             yval
                           nil))))
(<a href="ACL2____DEFN.html">defn</a> f3 (x)
  (pand* x x))
(<a href="ACL2____DEFN.html">defn</a> f4 (x)
  (<a href="ACL2____PAND.html">pand</a> x
        (f3 x)))
(<a href="ACL2____VALUE-TRIPLE.html">value-triple</a> (f4 5))</pre> 
 
 <p>(Only for <a href="ACL2____HONS-ENABLED.html">hons-enabled</a> executables on Windows) Certain memory 
 management is avoided on Windows (technically: by avoiding a call of source 
 function <span class="v">start-sol-gc</span>), where it was causing errors.  Thanks to Harsh 
 Raju Chamarthi and Sol Swords for testing on Windows that led us to this 
 change.</p> 
 
 
</body>
</html>
