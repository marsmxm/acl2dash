<html>
<head>
<meta charset="UTF-8">
<title>Add-to-*ip</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=X86ISA____ADD-TO-_A2IP">Click for Add-to-*ip in the Full Manual</a></h3>

<p>Add a specified amount to an instruction pointer.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(add-to-*ip proc-mode *ip delta x86) → (mv flg *ip+delta)</pre></dt>
<dt>Returns</dt>
<dd>
<span class="tt">*ip+delta</span> — <font color="#606060">Type <span class="v">(<a href="X86ISA____I48P.html">i48p</a> *ip+delta)</span>, given <span class="v">(<a href="COMMON-LISP____AND.html">and</a> (<a href="X86ISA____I48P.html">i48p</a> *ip) (<a href="X86ISA____I48P.html">i48p</a> delta))</span>.</font>
</dd> 
 
</dl></div> 
<p> 
     The amount may be positive (increment) or negative (decrement). 
     This just calculates the new instruction pointer value, 
     without storing it into the register RIP, EIP, or IP. 
     The starting value is the result of <span class="tt"><a href="X86ISA____READ-_A2IP.html">read-*ip</a></span> 
     or a previous invocation of <span class="tt"><a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a></span>. 
     </p> 
     <p> 
     In 64-bit mode, we check whether the result is a canonical address; 
     in 32-bit mode, we check whether the result is within the segment limit. 
     If these checks are not satisfied, 
     this function returns an error flag (and 0 as incremented address), 
     which causes the x86 model to stop execution with an error. 
     It is not clear whether these checks should be performed 
     when the instruction pointer is incremented 
     or when an instruction byte is eventually accessed; 
     the Intel and AMD manuals seem unclear in this respect. 
     But since the failure of these checks stops execution with an error, 
     and it is in a way always ``safe'' to stop execution with an error 
     (in the sense that the model provides no guarantees when this happens), 
     for now we choose to perform these checks here. 
     </p> 
     <p> 
     Note that a code segment is never expand-down, 
     so the valid effective addresses are always between 0 and the segment limit 
     (cf. <span class="tt"><a href="X86ISA____SEGMENT-BASE-AND-BOUNDS.html">segment-base-and-bounds</a></span>). 
     </p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>add-to-*ip$inline</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 add-to-*ip$inline
 (proc-mode *ip delta x86)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :stobjs (x86)))
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____TYPE.html">type</a> (integer 0 4) proc-mode)
          (<a href="COMMON-LISP____TYPE.html">type</a> (signed-byte 48) *ip)
          (<a href="COMMON-LISP____TYPE.html">type</a> (signed-byte 48) delta))
 (<a href="ACL2____B_A2.html">b*</a>
  ((*ip+delta (<a href="COMMON-LISP____THE.html">the</a> (signed-byte 49) (<a href="COMMON-LISP_____B2.html">+</a> *ip delta))))
  (<a href="COMMON-LISP____CASE.html">case</a>
      proc-mode
      (0 (<a href="COMMON-LISP____IF.html">if</a> (<a href="ACL2____MBE.html">mbe</a> :logic (<a href="X86ISA____CANONICAL-ADDRESS-P.html">canonical-address-p</a> *ip+delta)
                  :exec (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> -140737488355328 *ip+delta)
                             (<a href="COMMON-LISP_____C3.html">&lt;</a> *ip+delta 140737488355328)))
             (<a href="ACL2____MV.html">mv</a> nil *ip+delta)
             (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP____LIST.html">list</a> :non-canonical-instruction-pointer *ip+delta)
                 0)))
      (1 (<a href="ACL2____B_A2.html">b*</a> (((<a href="COMMON-LISP____THE.html">the</a> (unsigned-byte 32) cs.limit)
               (<a href="ACL2____MBE.html">mbe</a> :logic (<a href="ACL2____LOGHEAD.html">loghead</a> 32 (seg-hidden-limiti 1 x86))
                    :exec (seg-hidden-limiti 1 x86))))
             (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> 0 *ip+delta)
                      (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> *ip+delta cs.limit))
                 (<a href="ACL2____MV.html">mv</a> nil (<a href="COMMON-LISP____THE.html">the</a> (unsigned-byte 32) *ip+delta))
                 (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP____LIST.html">list</a> :out-of-segment-instruction-pointer
                           cs.limit *ip+delta)
                     0))))
      (otherwise (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP____LIST.html">list</a> :unimplemented-proc-mode proc-mode)
                     0)))))</pre> 
<p><b>Theorem: </b>i48p-of-add-to-*ip.*ip+delta</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> i48p-of-add-to-*ip.*ip+delta
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="X86ISA____I48P.html">i48p</a> *ip) (<a href="X86ISA____I48P.html">i48p</a> delta))
                 (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?flg ?*ip+delta)
                       (add-to-*ip$inline proc-mode *ip delta x86)))
                     (<a href="X86ISA____I48P.html">i48p</a> *ip+delta)))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>add-to-*ip-is-i48p</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 add-to-*ip-is-i48p
 (<a href="ACL2____IMPLIES.html">implies</a>
      (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____INTEGERP.html">integerp</a> *ip)
           (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> -140737488355328 *ip)
           (<a href="COMMON-LISP_____C3.html">&lt;</a> *ip 140737488355328)
           (<a href="COMMON-LISP____INTEGERP.html">integerp</a> delta))
      (<a href="ACL2____SIGNED-BYTE-P.html">signed-byte-p</a> 48
                     (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                             (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))))
 :rule-classes
 (:rewrite
  (:type-prescription
      :corollary
      (<a href="ACL2____IMPLIES.html">implies</a>
           (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____INTEGERP.html">integerp</a> *ip)
                (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> -140737488355328 *ip)
                (<a href="COMMON-LISP_____C3.html">&lt;</a> *ip 140737488355328)
                (<a href="COMMON-LISP____INTEGERP.html">integerp</a> delta))
           (<a href="COMMON-LISP____INTEGERP.html">integerp</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                             (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))))
      :hints (("Goal" :in-theory '(<a href="ACL2____SIGNED-BYTE-P.html">signed-byte-p</a> integer-range-p))))
  (:linear
    :corollary
    (<a href="ACL2____IMPLIES.html">implies</a>
         (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____INTEGERP.html">integerp</a> *ip)
              (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> -140737488355328 *ip)
              (<a href="COMMON-LISP_____C3.html">&lt;</a> *ip 140737488355328)
              (<a href="COMMON-LISP____INTEGERP.html">integerp</a> delta))
         (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> -140737488355328
                  (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86)))
              (<a href="COMMON-LISP_____C3.html">&lt;</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))
                 140737488355328)))
    :hints
    (("Goal"
          :in-theory '(<a href="ACL2____SIGNED-BYTE-P.html">signed-byte-p</a> integer-range-p (:e expt)))))))</pre> 
<p><b>Theorem: </b>add-to-*ip-is-i48p-rewrite-rule</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 add-to-*ip-is-i48p-rewrite-rule
 (<a href="ACL2____IMPLIES.html">implies</a>
  (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____INTEGERP.html">integerp</a> *ip)
       (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> -140737488355328 *ip)
       (<a href="COMMON-LISP_____C3.html">&lt;</a> *ip 140737488355328)
       (<a href="COMMON-LISP____INTEGERP.html">integerp</a> delta))
  (<a href="COMMON-LISP____AND.html">and</a>
    (<a href="COMMON-LISP____INTEGERP.html">integerp</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86)))
    (<a href="COMMON-LISP____RATIONALP.html">rationalp</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86)))
    (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> -140737488355328
        (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86)))
    (<a href="COMMON-LISP_____C3.html">&lt;</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))
       140737488355328)
    (<a href="ACL2____SIGNED-BYTE-P.html">signed-byte-p</a> 48
                   (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86)))
    (<a href="ACL2____SIGNED-BYTE-P.html">signed-byte-p</a> 64
                   (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                           (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))))))</pre> 
<p><b>Theorem: </b>add-to-*ip-rationalp-type</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 add-to-*ip-rationalp-type
 (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____RATIONALP.html">rationalp</a> *ip) (<a href="COMMON-LISP____RATIONALP.html">rationalp</a> delta))
          (<a href="COMMON-LISP____RATIONALP.html">rationalp</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                             (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))))
 :rule-classes :type-prescription)</pre> 
<p><b>Theorem: </b>mv-nth-0-of-add-to-*ip-when-64-bit-modep</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 mv-nth-0-of-add-to-*ip-when-64-bit-modep
 (<a href="COMMON-LISP____EQUAL.html">equal</a>
      (<a href="ACL2____MV-NTH.html">mv-nth</a> 0 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> 0 *ip delta x86))
      (<a href="COMMON-LISP____IF.html">if</a> (<a href="X86ISA____CANONICAL-ADDRESS-P.html">canonical-address-p</a> (<a href="COMMON-LISP_____B2.html">+</a> *ip delta))
          nil
          (<a href="COMMON-LISP____LIST.html">list</a> :non-canonical-instruction-pointer (<a href="COMMON-LISP_____B2.html">+</a> *ip delta)))))</pre> 
<p><b>Theorem: </b>mv-nth-1-of-add-to-*ip-when-64-bit-modep</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> mv-nth-1-of-add-to-*ip-when-64-bit-modep
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> 0 *ip delta x86))
               (<a href="COMMON-LISP____IF.html">if</a> (<a href="X86ISA____CANONICAL-ADDRESS-P.html">canonical-address-p</a> (<a href="COMMON-LISP_____B2.html">+</a> *ip delta))
                   (<a href="COMMON-LISP_____B2.html">+</a> *ip delta)
                   0)))</pre> 
<p><b>Theorem: </b>mv-nth-1-of-add-to-*ip-when-compatibility-modep</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
 mv-nth-1-of-add-to-*ip-when-compatibility-modep
 (<a href="ACL2____IMPLIES.html">implies</a>
    (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> proc-mode 0))
         (<a href="COMMON-LISP____INTEGERP.html">integerp</a> (<a href="COMMON-LISP_____B2.html">+</a> *ip delta))
         (<a href="COMMON-LISP____NOT.html">not</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 0
                      (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))))
    (<a href="ACL2____UNSIGNED-BYTE-P.html">unsigned-byte-p</a> 32
                     (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                             (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))))
 :rule-classes
 (:rewrite
  (:type-prescription
      :corollary
      (<a href="ACL2____IMPLIES.html">implies</a>
           (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> proc-mode 0))
                (<a href="COMMON-LISP____INTEGERP.html">integerp</a> (<a href="COMMON-LISP_____B2.html">+</a> *ip delta))
                (<a href="COMMON-LISP____NOT.html">not</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 0
                             (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))))
           (<a href="ACL2____NATP.html">natp</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1
                         (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))))
      :hints
      (("Goal" :in-theory '(<a href="ACL2____UNSIGNED-BYTE-P.html">unsigned-byte-p</a> integer-range-p natp))))
  (:linear
   :corollary
   (<a href="ACL2____IMPLIES.html">implies</a>
        (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____EQUAL.html">equal</a> proc-mode 0))
             (<a href="COMMON-LISP____INTEGERP.html">integerp</a> (<a href="COMMON-LISP_____B2.html">+</a> *ip delta))
             (<a href="COMMON-LISP____NOT.html">not</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 0
                          (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))))
        (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP_____C3_D3.html">&lt;=</a> 0
                 (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86)))
             (<a href="COMMON-LISP_____C3.html">&lt;</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="X86ISA____ADD-TO-_A2IP.html">add-to-*ip</a> proc-mode *ip delta x86))
                4294967296)))
   :hints
   (("Goal"
        :in-theory '(<a href="ACL2____UNSIGNED-BYTE-P.html">unsigned-byte-p</a> integer-range-p (:e expt)))))))</pre> 

</body>
</html>
