<html>
<head>
<meta charset="UTF-8">
<title>Rlp-decodex-tree</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ETHEREUM____RLP-DECODEX-TREE">Click for Rlp-decodex-tree in the Full Manual</a></h3>

<p>Executable RLP decoding of a tree.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(rlp-decodex-tree encoding) → (mv error? tree)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">encoding</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BYTE-LISTP.html">byte-listp</a> encoding)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">error?</span> — <font color="#606060">Type <span class="v">(<a href="ETHEREUM____MAYBE-RLP-ERROR-P.html">maybe-rlp-error-p</a> error?)</span>.</font>
</dd> 
<dd>
<span class="tt">tree</span> — <font color="#606060">Type <span class="v">(<a href="ETHEREUM____RLP-TREEP.html">rlp-treep</a> tree)</span>.</font>
</dd> 
 
</dl></div> 
<p>We simply parse the tree 
     and ensure that there are no remaining bytes. 
     In case of error, we return an irrelevant tree as second result.</p><p>The <span class="v">x</span> in the name of this function stands for `executable', 
     in contrast with the declaratively specified <span class="tt"><a href="ETHEREUM____RLP-DECODE-TREE.html">rlp-decode-tree</a></span>.</p><p>The left inverse theorem <span class="v">rlp-decodex-tree-of-rlp-encode-tree</span> 
     readily follows from <span class="v">rlp-parse-tree-of-rlp-encode-tree</span>.</p><p>The right inverse theorem <span class="v">rlp-encode-tree-of-rlp-decodex-tree</span> 
     easily follows from <span class="v">rlp-encode-tree-of-rlp-parse-tree</span>, 
     but the latter theorem involves <span class="tt"><a href="COMMON-LISP____APPEND.html">append</a></span> 
     and so we use it with a <span class="v">:use</span> hint.</p><p>Using these left and right inverse theorems, 
     we prove that the executable decoder 
     is equivalent to <span class="tt"><a href="ETHEREUM____RLP-DECODE-TREE.html">rlp-decode-tree</a></span>, 
     i.e. the executable decoder is correct. 
     The equivalence is <span class="tt"><a href="ACL2____IFF.html">iff</a></span> for the error result, 
     because the executable decoder returns various kinds of errors, 
     while the declaratively defined decoder returns just one kind.</p><p>Since <span class="tt"><a href="ETHEREUM____RLP-DECODE-TREE.html">rlp-decode-tree</a></span> is defined 
     as a case split on <span class="tt"><a href="ETHEREUM____RLP-TREE-ENCODING-P.html">rlp-tree-encoding-p</a></span>, 
     we first show that the latter is equivalent to 
     <span class="tt"><a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a></span> not returning an error 
     (not that this equivalence does not hold for <span class="tt"><a href="ETHEREUM____RLP-PARSE-TREE.html">rlp-parse-tree</a></span>, 
     which accepts any extensions of the valid encodings). 
     The `if' part is proved via the right inverse theorem, 
     which says that the encoding is in the image of <span class="tt"><a href="ETHEREUM____RLP-ENCODE-TREE.html">rlp-encode-tree</a></span>. 
     The `only if' part is proved via the part of the left inverse theorem 
     that says that if the encoding returns no error 
     then decoding on the encoding returns no error 
     (roughly speaking, <span class="v">encode /= error ==&gt; decode o encode /= error</span>), 
     with the argument instantiated to the <span class="v">rlp-tree-encoding-witness</span> 
     (i.e. 
     <span class="v">encode o witness /= error ==&gt; decode o encode o witness /= error</span>). 
     The <span class="tt"><a href="ETHEREUM____RLP-TREE-ENCODING-P.html">rlp-tree-encoding-p</a></span> hypothesis establishes the antecedent, 
     and the right inverse property of the witness reduces the consequent 
     to just <span class="v">decode /= error</span>.</p><p>With the above equivalence in hand, 
     the equality of <span class="tt"><a href="ETHEREUM____RLP-DECODE-TREE.html">rlp-decode-tree</a></span> and <span class="tt"><a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a></span> 
     is proved by case splitting on <span class="tt"><a href="ETHEREUM____RLP-TREE-ENCODING-P.html">rlp-tree-encoding-p</a></span>. 
     If that predicate is false, 
     both definitions immediately return the same result. 
     Otherwise, 
     the error results are the same because of the above equivalence, 
     and the fact that the tree results are the same is proved 
     from the injectivity of <span class="tt"><a href="ETHEREUM____RLP-ENCODE-TREE.html">rlp-encode-tree</a></span> 
     and the fact that both <span class="tt"><a href="ETHEREUM____RLP-DECODE-TREE.html">rlp-decode-tree</a></span> and <span class="tt"><a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a></span> 
     are right inverses of <span class="tt"><a href="ETHEREUM____RLP-ENCODE-TREE.html">rlp-encode-tree</a></span>.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>rlp-decodex-tree</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> rlp-decodex-tree (encoding)
       (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="ACL2____BYTE-LISTP.html">byte-listp</a> encoding)))
       (<a href="COMMON-LISP____LET.html">let</a> ((__function__ 'rlp-decodex-tree))
            (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
            (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> error? tree rest)
                  (<a href="ETHEREUM____RLP-PARSE-TREE.html">rlp-parse-tree</a> encoding))
                 ((when error?)
                  (<a href="ACL2____MV.html">mv</a> error? (<a href="ETHEREUM____RLP-TREE-LEAF.html">rlp-tree-leaf</a> nil)))
                 ((when (<a href="COMMON-LISP____CONSP.html">consp</a> rest))
                  (<a href="ACL2____MV.html">mv</a> (<a href="ETHEREUM____RLP-ERROR-EXTRA-BYTES.html">rlp-error-extra-bytes</a> rest)
                      (<a href="ETHEREUM____RLP-TREE-LEAF.html">rlp-tree-leaf</a> nil))))
                (<a href="ACL2____MV.html">mv</a> nil tree))))</pre> 
<p><b>Theorem: </b>maybe-rlp-error-p-of-rlp-decodex-tree.error?</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> maybe-rlp-error-p-of-rlp-decodex-tree.error?
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?error? ?tree)
              (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> encoding)))
            (<a href="ETHEREUM____MAYBE-RLP-ERROR-P.html">maybe-rlp-error-p</a> error?))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>rlp-treep-of-rlp-decodex-tree.tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> rlp-treep-of-rlp-decodex-tree.tree
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?error? ?tree)
              (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> encoding)))
            (<a href="ETHEREUM____RLP-TREEP.html">rlp-treep</a> tree))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>rlp-decodex-tree-of-byte-list-fix-encoding</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> rlp-decodex-tree-of-byte-list-fix-encoding
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> (<a href="ACL2____BYTE-LIST-FIX.html">byte-list-fix</a> encoding))
               (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> encoding)))</pre> 
<p><b>Theorem: </b>rlp-decodex-tree-byte-list-equiv-congruence-on-encoding</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> rlp-decodex-tree-byte-list-equiv-congruence-on-encoding
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="ACL2____BYTE-LIST-EQUIV.html">byte-list-equiv</a> encoding encoding-equiv)
                 (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> encoding)
                        (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> encoding-equiv)))
        :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>rlp-decodex-tree-of-rlp-encode-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> rlp-decodex-tree-of-rlp-encode-tree
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> e-error? encoding)
              (<a href="ETHEREUM____RLP-ENCODE-TREE.html">rlp-encode-tree</a> tree))
             ((<a href="ACL2____MV.html">mv</a> d-error? tree1)
              (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> encoding)))
            (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____NOT.html">not</a> e-error?)
                     (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____NOT.html">not</a> d-error?)
                          (<a href="COMMON-LISP____EQUAL.html">equal</a> tree1 (<a href="ETHEREUM____RLP-TREE-FIX.html">rlp-tree-fix</a> tree))))))</pre> 
<p><b>Theorem: </b>rlp-encode-tree-of-rlp-decodex-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
    rlp-encode-tree-of-rlp-decodex-tree
    (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> d-error? tree)
          (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> encoding))
         ((<a href="ACL2____MV.html">mv</a> e-error? encoding1)
          (<a href="ETHEREUM____RLP-ENCODE-TREE.html">rlp-encode-tree</a> tree)))
        (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____NOT.html">not</a> d-error?)
                 (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____NOT.html">not</a> e-error?)
                      (<a href="COMMON-LISP____EQUAL.html">equal</a> encoding1 (<a href="ACL2____BYTE-LIST-FIX.html">byte-list-fix</a> encoding))))))</pre> 
<p><b>Theorem: </b>rlp-tree-encoding-p-iff-rlp-decodex-tree-not-error</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> rlp-tree-encoding-p-iff-rlp-decodex-tree-not-error
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ETHEREUM____RLP-TREE-ENCODING-P.html">rlp-tree-encoding-p</a> encoding)
               (<a href="COMMON-LISP____NOT.html">not</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 0 (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> encoding)))))</pre> 
<p><b>Theorem: </b>rlp-decode-tree-is-rlp-decodex-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> rlp-decode-tree-is-rlp-decodex-tree
        (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____IFF.html">iff</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 0 (<a href="ETHEREUM____RLP-DECODE-TREE.html">rlp-decode-tree</a> encoding))
                  (<a href="ACL2____MV-NTH.html">mv-nth</a> 0 (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> encoding)))
             (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="ETHEREUM____RLP-DECODE-TREE.html">rlp-decode-tree</a> encoding))
                    (<a href="ACL2____MV-NTH.html">mv-nth</a> 1 (<a href="ETHEREUM____RLP-DECODEX-TREE.html">rlp-decodex-tree</a> encoding)))))</pre> 

</body>
</html>
