<html>
<head>
<meta charset="UTF-8">
<title>Forward-chaining-reports</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____FORWARD-CHAINING-REPORTS">Click for Forward-chaining-reports in the Full Manual</a></h3>

<p>To see reports about the forward chaining process</p><p>Debugging forward-chaining rules can be hard because their effects 
 are not directly visible on the goal.  In this documentation we tell you how 
 to get reports on the forward chaining activity occurring in your proof 
 attempts.  This documentation is written in several parts.  The first part is 
 an introduction for the first-time user of forward chaining reports.  The next 
 two parts describe how to read reports.  The last part describes how to 
 monitor forward chaining activity only for selected runes, etc.  We recommend 
 the new user of these reports read everything!</p> 
 
 <p><i>A Quick Introduction to Forward Chaining Reports</i></p> 
 
 <p>Caution: The reporting mechanism maintains some state, and if you have 
 already used forward chaining reporting in a session, the directions below may 
 not work as advertised!  To return to the default forward chaining reporting 
 state, execute this form at the top level:</p> 
 
 <pre class="code">(<a href="ACL2____RESET-FC-REPORTING.html">reset-fc-reporting</a>)</pre> 
 
 <p>You can get a report about all forward chaining activity in subsequent 
 proofs by doing:</p> 
 
 <pre class="code">(<a href="ACL2____SET-FC-CRITERIA.html">set-fc-criteria</a> t)</pre> 
 
 <p>Options will be discussed later that allow you to monitor the activity 
 caused by particular <span class="v">:forward-chaining</span> rules or terms.</p> 
 
 <p>Then do a proof that is expected to cause some forward chaining.  In the 
 proof output you will see lines like this:</p> 
 
 <pre class="code">(Forward Chaining on behalf of PREPROCESS-CLAUSE:  (<a href="ACL2____FC-REPORT.html">FC-Report</a> 1))</pre> 
 
 <p>This is the only difference you should see in the proof output.</p> 
 
 <p>After the proof attempt has terminated, you can execute:</p> 
 
 <pre class="code">(<a href="ACL2____FC-REPORT.html">fc-report</a> k)</pre> 
 
 <p>for any <span class="v">k</span> printed during the immediately preceding proof attempt. 
 That will print a much longer report describing the activity that occurred 
 during the <span class="v">k</span>th use of forward chaining in that proof attempt.</p> 
 
 <p>If you want to see these reports in real time (embedded in the proof 
 output), do this before invoking the prover:</p> 
 
 <pre class="code">(<a href="ACL2____SET-FC-REPORT-ON-THE-FLY.html">set-fc-report-on-the-fly</a> t)</pre> 
 
 <p>Collecting the data used to generate these reports slows down the prover. 
 If you no longer wish to see such reports, do</p> 
 
 <pre class="code">(<a href="ACL2____SET-FC-CRITERIA.html">set-fc-criteria</a> nil)</pre> 
 
 <p><i>How To Read FC Reports</i></p> 
 
 <p>The report printed by <span class="v">(<a href="ACL2____FC-REPORT.html">fc-report</a> k)</span> is of the form:</p> 
 
 <pre class="code">Forward Chaining Report <i>k</i>: 
Caller: <i>token</i> 
Clause: (<i>lit1</i> <i>lit2</i> ... <i>litn</i>) 
Number of Rounds: <i>m</i> 
Contradictionp: <i>bool</i> 
Activations: (<i>act1</i> <i>act2</i> ...) 
</pre> 
 
 <p>This report means that the <i>k</i>th use of forward chaining in the most 
 recent proof attempt was done on behalf of <i>token</i> (see below).  The 
 initial context (set of assumptions) consisted of the negations of the 
 literals listed in the clause shown and the initial candidate trigger terms 
 are all those appearing in that clause.  This invocation of forward chaining 
 proceeded to do <i>m</i> rounds of successive extensions of the initial 
 context and ultimately either reached a contradiction (<i>bool</i> = <span class="v">T</span>) 
 or returned an extended context (<i>bool</i> = <span class="v">NIL</span>).  Note that reaching 
 a contradiction from the negations of all the literals in a clause is ``good'' 
 because it means the clause is true.  The report concludes with the final 
 status of all the forward chaining rules fired during the process.  We explain 
 how to read one of these activation reports in the next section.</p> 
 
 <p>Forward chaining is done on behalf of many proof techniques in the system. 
 Each is associated with a <i>token</i>.  The main proof technique that uses 
 forward chaining is <span class="v">SIMPLIFY-CLAUSE</span>.  This is the call of forward 
 chaining that sets up the context used by the rewriter to relieve hypotheses 
 during backchaining.  Another common caller of forward chaining is 
 <span class="v">PREPROCESS-CLAUSE</span>, the first process in the ACL2 waterfall (see <a href="ACL2____HINTS-AND-THE-WATERFALL.html">hints-and-the-waterfall</a>).  Forward chaining often proves ``near 
 propositional'' goals (those depending just on boolean implications between 
 basic predicates).  Other tokens you may see include <span class="v">INDUCT</span>, which uses 
 forward chaining to set up a context for applying <span class="v">:</span><span class="tt"><a href="ACL2____INDUCTION.html">induction</a></span> 
 rules, and the definitional principle (and related utilities such as <span class="tt"><a href="ACL2____VERIFY-TERMINATION.html">verify-termination</a></span> and <span class="tt"><a href="ACL2____VERIFY-GUARDS.html">verify-guards</a></span>) which uses forward chaining 
 during the construction of both measure conjectures and guard conjectures. 
 When used this way, the <i>token</i> is <span class="v">defun-or-guard-verification</span>.</p> 
 
 <p><i>How to Read Activation Reports</i></p> 
 
 <p>The forward chaining report concludes with a list of activation 
 reports.</p> 
 
 <pre class="code">Activations: (<i>act1</i> <i>act2</i> ...) 
</pre> 
 
 <p>Each <i>acti</i> is of the form:</p> 
 
 <pre class="code">(<i>rune</i> 
 (:TRIGGER <i>inst-trig</i>) 
 ((:UNIFY-SUBST <i>subst</i>) 
  (:DISPOSITION <i>outcome-part1</i> <i>outcome-part2</i> <i>inst-term</i>)) 
 ...) 
</pre> 
 
 <p>where the <span class="v">...</span> indicates that the rest of the report consists of more 
 of those tuples listing a <span class="v">:UNIFY-SUBST</span> and <span class="v">:DISPOSITION</span>.  We call 
 each tuple a <i>disposition</i> of the activation and each disposition 
 describes a substitution <i>subst</i> identifying the final instantiation of 
 the rule and how the activation fared.  Suppose there are <i>n</i> 
 dispositions.  (If the rule in question contains no free variables, <i>n</i> 
 will be 1.)</p> 
 
 <p>This activation report means that during the forward chaining process in 
 question, the <span class="v">:</span><span class="tt"><a href="ACL2____FORWARD-CHAINING.html">forward-chaining</a></span> <a href="ACL2____RUNE.html">rune</a> <i>rune</i> was fired 
 due to the presence in the evolving context of the trigger term 
 <i>inst-trig</i>.  (Note that <i>inst-trig</i> is an instantiation of the 
 trigger term of the named rule.  That is, the variable symbols you see in 
 <i>inst-trig</i> are those of the clause printed in the forward chaining 
 report.)  The activation of <i>rune</i> by <i>inst-trig</i> proceeded to split 
 <i>n</i> ways as different choices were made for the <a href="ACL2____FREE-VARIABLES.html">free-variables</a> 
 occurring among the hypotheses.  Each of those <i>n</i> choices gave rise to a 
 different substitution <i>subst</i>, and each succeeded or failed as described 
 by the corresponding <span class="v">:DISPOSITION</span>.</p> 
 
 <p>The <span class="v">:DISPOSITION</span> of an activation is described in three parts, 
 <i>outcome-part1</i>, <i>outcome-part2</i>, and <i>inst-term</i>. 
 <i>Outcome-part1</i> is either <span class="v">SUCCESS</span> or <span class="v">BLOCKED</span>, meaning that the 
 instance given by <i>subst</i> either succeeded in the sense that all of its 
 instantiated hypotheses were found in the context, or failed because some 
 instantiated hypothesis was not found.</p> 
 
 <p>If <span class="v">outcome-part1</span> is <span class="v">SUCCESS</span> then <i>inst-term</i> is the 
 instantiated conclusion produced by the rule.  <i>Outcome-part2</i> is 
 <span class="v">APPROVED</span> if the instantiated conclusion was acceptable to our heuristics 
 designed to prevent looping and not already known in the evolving context. 
 <i>Outcome-part2</i> is <span class="v">REJECTED</span> if the instantiated conclusion was not 
 approved by our heuristics.  <i>Outcome-part2</i> is <span class="v">REDUNDANT</span> if the 
 instantiated conclusion was approved by the heuristics but already known true 
 in the current evolving context.  If <span class="v">APPROVED</span>, the truth of the 
 instantiated conclusion is added to the evolving context.  Otherwise, it is 
 not.</p> 
 
 <p>If <span class="v">outcome-part1</span> is <span class="v">BLOCKED</span> then <span class="v">outcome-part2</span> is one of 
 three possible things: <span class="v">FALSE</span>, in which case <i>inst-term</i> is an 
 instantiated hypothesis of the rule that is assumed false in the current 
 context, <span class="v">UNRELIEVED-HYP</span>, in which case <i>inst-term</i> is an 
 instantiated hypothesis whose truth value is not determined by the context, or 
 <span class="v">UNRELIEVED-HYP-FREE</span>, in which case <i>inst-term</i> is an oddly 
 instantiated hypothesis whose truth value is not determined by the context and 
 which also contains free variables.  In the last case, the ``odd'' 
 instantiation was by the substitution <i>subst</i> but extended so that free 
 variables in the hypothesis are renamed to start with the prefix 
 <span class="v">UNBOUND-FREE-</span> to draw your attention to them.</p> 
 
 <p>Note: All of the terms printed in the report are instantiated with the 
 relevant unifying substitution (possibly extended to bind free variables).</p> 
 
 <p><i>Specifying the Tracking Criteria</i></p> 
 
 <p>During a proof attempt, the forward chaining module stores information 
 about the activations satisfying certain criteria.  The <i>criteria</i> is a 
 list of triples.  Each triple consists of a forward chaining rune, an 
 instantiated trigger term, and an instantiated conclusion to watch for. 
 However, any or all of the components of such a triple may be <span class="v">t</span> and that 
 is given special significance.</p> 
 
 <p>An activation <span class="v">satisfies</span> a criteria if it satisfies at least one of the 
 triples.  An activation satisfies a triple if it satisfies all three of the 
 components.  Every activation satisfies the component <span class="v">t</span>.  An activation 
 satisfies a rune if the activation describes a firing of the named rule.  An 
 activation satisfies an instantiated trigger term if the activation was 
 created by that trigger being present in the context.  An activation satisfies 
 an instantiated conclusion if the activation <i>could</i> produce the 
 instantiated conclusion (with the right choice of any free variables).</p> 
 
 <p>Thus, the criteria is interpreted as a disjunction of conjunctions, making 
 it possible to track a specific set of runes, triggers, and conclusions.</p> 
 
 <p>For example, here is a triple that might appear in the criteria:</p> 
 
 <pre class="code">((:FORWARD-CHAINING ALISTP-FORWARD-TO-TRUE-LISTP)
 t
 t).</pre> 
 
 <p>This triple would cause every activation of the given rule to be tracked. 
 However, the triple</p> 
 
 <pre class="code">((:FORWARD-CHAINING ALISTP-FORWARD-TO-TRUE-LISTP)
 (<a href="ACL2____ALISTP.html">ALISTP</a> (MAKE-BINDINGS VARS (TOP-N (OP1 INST) (STACK S))))
 t)</pre> 
 
 <p>would only track activations of that rule fired by the specific term shown 
 as the second element of the triple.  Furthermore</p> 
 
 <pre class="code">(t
 (<a href="ACL2____ALISTP.html">ALISTP</a> (MAKE-BINDINGS VARS (TOP-N (OP1 INST) (STACK S))))
 t)</pre> 
 
 <p>would track any forward chaining rule triggered by that term, and</p> 
 
 <pre class="code">(t
 t
 (<a href="ACL2____TRUE-LISTP.html">TRUE-LISTP</a> (MAKE-BINDINGS VARS (TOP-N (OP1 INST) (STACK S)))))</pre> 
 
 <p>would track any rule fired by any trigger that might lead to the specific 
 term given as the third component above.</p> 
 
 <p>Note: The condition on how an activation satisfies an instantiated 
 conclusion is a little subtle.  Consider the activation of the forward 
 chaining rule</p> 
 
 <pre class="code">(<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> x)
              (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="ACL2____LEN.html">len</a> x) (<a href="ACL2____LEN.html">len</a> y)))
         (<a href="ACL2____TRUE-LISTP.html">true-listp</a> (make-bindings x y)))</pre> 
 
 <p>triggered by <span class="v">(<a href="ACL2____SYMBOL-LISTP.html">SYMBOL-LISTP</a> VARS)</span> arising in the current context.  This 
 activation <i>could</i> produce the specific conclusion shown in the last 
 triple above, if it just happened that <span class="v">(TOP-N (OP1 INST) (STACK S))</span> were 
 chosen as the binding of the free variable <span class="v">y</span>.  Thus, the activation of 
 this rule triggered by <span class="v">(<a href="ACL2____SYMBOL-LISTP.html">SYMBOL-LISTP</a> VARS)</span> satisfies the last triple 
 above.</p> 
 
 <p>Observe that the triple</p> 
 
 <pre class="code">(t t t)</pre> 
 
 <p>is satisfied by every activation of any rule by any trigger term producing 
 any conclusion.</p> 
 
 <p>The function <span class="v">set-fc-criteria</span> sets the criteria describing which 
 activations are to be tracked.  For example, if you execute:</p> 
 
 <pre class="code">(<a href="ACL2____SET-FC-CRITERIA.html">set-fc-criteria</a> ((:FORWARD-CHAINING LEMMA1)
                  t t)
                 ((:FORWARD-CHAINING LEMMA2)
                  (<a href="ACL2____ALISTP.html">ALISTP</a> (BASIC-MAPPER A B))
                  t)
                 (t t (<a href="ACL2____TRUE-LISTP.html">TRUE-LISTP</a> (DLT D)))),</pre> 
 
 <p>the system would track all activations of the forward-chaining rule 
 <span class="v">LEMMA1</span>, plus those activations of forward-chaining rule <span class="v">LEMMA2</span> 
 triggered by the term given in the second triple, plus any activation of any 
 rule that might derive <span class="v">(<a href="ACL2____TRUE-LISTP.html">TRUE-LISTP</a> (DLT D))</span>.</p> 
 
 <p>Because criteria generally mention variable symbols used in a specific 
 conjecture, it is probably best to reconsider your criteria every time you 
 want to track forward chaining.</p> 
 
 <p>If the criteria is <span class="v">nil</span>, then nothing is tracked.  Setting the criteria 
 to <span class="v">nil</span> is the way you turn off tracking and reporting of forward chaining 
 activity.  You may do this either by <span class="v">(<a href="ACL2____SET-FC-CRITERIA.html">set-fc-criteria</a>)</span> or by 
 <span class="v">(<a href="ACL2____SET-FC-CRITERIA.html">set-fc-criteria</a> nil)</span>.  (Technically the second form is an odd use of 
 <span class="v">set-fc-criteria</span>, which expects any supplied arguments to be triples; if 
 the ``triple'' <span class="v">nil</span> is the only one supplied, we take it to mean that the 
 entire criteria should be <span class="v">nil</span>.)</p> 
 
 <p>To track every forward chaining activation you may set the criteria with 
 either <span class="v">(<a href="ACL2____SET-FC-CRITERIA.html">set-fc-criteria</a> (t t t))</span> or use the abbreviation 
 <span class="v">(<a href="ACL2____SET-FC-CRITERIA.html">set-fc-criteria</a> t)</span>.</p> 
 
 <p>If, when you read a forward chaining report, you see no mention of an 
 activation you have in mind, e.g., of a certain rune or deriving a certain 
 conclusion, and you have set the criteria correctly, then the activation never 
 happened.  (This is akin to using <span class="v">:</span><span class="tt"><a href="ACL2____BRR.html">brr</a></span> and <span class="v">:</span><span class="tt"><a href="ACL2____MONITOR.html">monitor</a></span> 
 to monitor the application of a rewrite rule and then seeing no interactive 
 break.)</p> 
 
 <p>For some relevant functions to help you manage criteria and when the full 
 reports are printed see <span class="tt"><a href="ACL2____FC-REPORT.html">fc-report</a></span>, <span class="tt"><a href="ACL2____SHOW-FC-CRITERIA.html">show-fc-criteria</a></span>, <span class="tt"><a href="ACL2____SET-FC-CRITERIA.html">set-fc-criteria</a></span>, <span class="tt"><a href="ACL2____RESET-FC-REPORTING.html">reset-fc-reporting</a></span>, and <span class="tt"><a href="ACL2____SET-FC-REPORT-ON-THE-FLY.html">set-fc-report-on-the-fly</a></span>.</p>
</body>
</html>
