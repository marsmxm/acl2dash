<html>
<head>
<meta charset="UTF-8">
<title>Note-3-2</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____NOTE-3-2">Click for Note-3-2 in the Full Manual</a></h3>

<p>ACL2 Version  3.2 (April, 2007) Notes</p><p>NOTE!  New users can ignore these release notes, because the <a href="COMMON-LISP____DOCUMENTATION.html">documentation</a> has been updated to reflect all changes that are recorded 
 here.</p> 
 
 <p>Before this release, a raw Lisp error could put the ACL2 user into the 
 debugger of the host Common Lisp.  Now, such cases will generally put the user 
 back at the top-level loop after an informative message.  For details, see 
 <a href="ACL2____SET-DEBUGGER-ENABLE.html">set-debugger-enable</a>; also see <a href="ACL2____BREAK_42.html">break$</a>.</p> 
 
 <p>Fixed a soundness bug that was allowing unknown packages to sneak into a 
 book and wreak havoc.  Thanks to Peter Dillinger for sending an interesting 
 example that led us to an exploration resulting in finding this bug.  (A 
 comment in the source code for <span class="v">note-3-2</span> shows such an example.)  That 
 example led us to fix a couple of other bugs related to packages.  See <a href="ACL2____HIDDEN-DEATH-PACKAGE.html">hidden-death-package</a> if you are generally interested in such issues, and for 
 associated examples, see comments in <span class="v">note-3-2</span> in the ACL2 source 
 code.</p> 
 
 <p>Fixed subtle soundness bugs related to <span class="v">:</span><span class="tt"><a href="ACL2____META.html">meta</a></span> rules by 
 restricting evaluators (see <a href="ACL2____DEFEVALUATOR.html">defevaluator</a>), as discussed in a new 
 documentation topic: see <a href="ACL2____EVALUATOR-RESTRICTIONS.html">evaluator-restrictions</a>.</p> 
 
 <p>Fixed a soundness bug that was allowing redefinition from <span class="v">:</span><span class="tt"><a href="ACL2____LOGIC.html">logic</a></span> to <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode.  This prohibition had been in ACL2 for 
 awhile but was accidentally removed in the preceding version.</p> 
 
 <p>Fixed a soundness bug related to <span class="tt"><a href="ACL2____TRACE_42.html">trace$</a></span>.  Thanks to Peter Dillinger 
 for bringing it to our attention and for useful discussions, and providing a 
 proof of <span class="v">nil</span>, the essence of which is illustrated as follows:</p> 
 
 <pre class="code">(<a href="ACL2____VALUE-TRIPLE.html">value-triple</a> (<a href="ACL2____TRACE_42.html">trace$</a> (bar :entry (<a href="COMMON-LISP____DEFUN.html">defun</a> foo () 17))))</pre> 
 
 <p>Thus, <span class="tt"><a href="ACL2____TRACE_42.html">trace$</a></span> could be used to cause destructive raw Lisp behavior. 
 Now, <span class="v">trace$</span> fails unless it is either given a list of symbols or else 
 there is an active trust tag (see <a href="ACL2____DEFTTAG.html">defttag</a>); otherwise, consider using 
 <span class="v">trace!</span> instead.</p> 
 
 <p>Closed a loophole that could be viewed as compromising soundness.  It was 
 possible to write files during book certification by exploiting <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> expansion, but that is no longer the case by default.  A new 
 function <span class="tt"><a href="ACL2____OPEN-OUTPUT-CHANNEL_12.html">open-output-channel!</a></span> is identical as a function to 
 <span class="v">open-output-channel</span>, except that the new function may be called even 
 during <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> expansion and <span class="tt"><a href="ACL2____CLAUSE-PROCESSOR.html">clause-processor</a></span> <a href="ACL2____HINTS.html">hints</a>, 
 but requires that there is an active trust tag (see <a href="ACL2____DEFTTAG.html">defttag</a>).  Thanks 
 to Peter Dillinger for producing a convincing example (forging a <a href="ACL2____CERTIFICATE.html">certificate</a> during book certification; see <a href="ACL2____OPEN-OUTPUT-CHANNEL_12.html">open-output-channel!</a>) and 
 to him, Sandip Ray, and Jared Davis for useful discussions on the topic.</p> 
 
 <p>Added book <span class="v">books/defexec/reflexive/reflexive.lisp</span> to illustrate 
 reflexive functions.</p> 
 
 <p>ACL2 now generate scripts that invoke the saved image with <span class="v">exec</span>. 
 (Previously this was only done for GCL and CLISP.)  The benefit of this change 
 can be to avoid the lingering of ACL2 processes after enclosing processes have 
 exited.  Thanks to Peter Dillinger for pointing out this issue.</p> 
 
 <p>ACL2 has a better implementation of <span class="v">(</span><span class="tt"><a href="ACL2____GOOD-BYE.html">good-bye</a></span><span class="v">)</span> (hence of 
 synonyms <span class="v">(</span><span class="tt"><a href="ACL2____QUIT.html">quit</a></span><span class="v">)</span> and <span class="v">(</span><span class="tt"><a href="ACL2____EXIT.html">exit</a></span><span class="v">)</span>).  As a result, 
 you should now be able to exit ACL2 and Lisp from within the ACL2 
 read-eval-print loop with any of the above; formerly, this was not supported 
 for some Lisp implementations, and was slow in OpenMCL.  Thanks to SBCL 
 developer Harald Hanche-Olsen for useful advice.</p> 
 
 <p>Fixed a bug in raw-mode (see <a href="ACL2____SET-RAW-MODE.html">set-raw-mode</a>) that was causing hard 
 errors when evaluating calls of <span class="tt"><a href="ACL2____ER-PROGN.html">er-progn</a></span>, or of macros expanding to 
 such calls.</p> 
 
 <p>Fixed a few Makefile dependencies, necessary only for parallel `make'.</p> 
 
 <p>A new book, <span class="v">misc/defpun-exec-domain-example.lisp</span>, provides an example 
 showing how partial functions which return a unique value for arguments in a 
 specified domain can be efficiently executed with ACL2.  Execution is achieved 
 using the <span class="tt"><a href="ACL2____MBE.html">mbe</a></span> construct.  Thanks to Sandip Ray for providing this 
 example.</p> 
 
 <p>Existing function <span class="tt"><a href="ACL2____MOD-EXPT.html">mod-expt</a></span> computes <span class="v">(<a href="COMMON-LISP____MOD.html">mod</a> (<a href="COMMON-LISP____EXPT.html">expt</a> base exp) mod)</span> 
 with great efficiency in GCL, but not in other Lisps.  Now, the book 
 <span class="v">arithmetic-3/floor-mod/mod-expt-fast.lisp</span> defines a function 
 <span class="v">mod-expt-fast</span> that should provide significantly improved performance for 
 such expressions in other Lisps as well, though still probably not as fast as 
 when using <span class="v">mod-expt</span> in GCL.  Thanks to Warren Hunt, with contributions 
 from Robert Krug, for providing this book,</p> 
 
 <p>Modified macro <a href="ACL2____BREAK-ON-ERROR.html">break-on-error</a> to print of an error message before 
 entering a break, and to cause a hard error if the underlying Lisp cannot 
 handle it (formerly, a raw Lisp break would occur).  Thanks to Bob Boyer for 
 bringing these issues to our attention.</p> 
 
 <p>The book <span class="v">books/misc/defpun.lisp</span>, as well as other books related to the 
 <span class="v">defpun</span> macro, has been modified to avoid namespace collisions by 
 prefixing function symbol names with <span class="v">"DEFPUN-"</span>; for example <span class="v">base</span> 
 has been replaced by <span class="v">defpun-base</span>.  Thanks to Dave Greve for providing a 
 first version of this update to <span class="v">defpun.lisp</span>.</p> 
 
 <p>A theory, <span class="v">base</span>, in <span class="v">books/arithmetic-3/bind-free/top.lisp</span>, has 
 been renamed <span class="v">arithmetic-3-bind-free-base</span>, to avoid potential name 
 conflicts.</p> 
 
 <p>Fixed <span class="v">books/arithmetic-3/bind-free/banner.lisp</span> to print (as before) a 
 message about how to turn on non-linear arithmetic, by modifying the call of 
 <span class="v">value-triple</span> to use <span class="v">:on-skip-proofs t</span>.  Thanks to Robert Krug for 
 bringing this issue to our attention.</p> 
 
 <p>Modified <span class="v">books/Makefile-subdirs</span> and <span class="v">books/Makefile-psubdirs</span> so 
 that they can be used with <span class="v">books/Makefile-generic</span>.  Thus, one can set 
 things up so that `make' can be used to certify books both in the current 
 directory and subdirectories, for example as follows.</p> 
 
 <pre class="code">ACL2 = ../../saved_acl2

arith-top: top all
all: top

DIRS = pass1 bind-free floor-mod
include ../Makefile-subdirs
include ../Makefile-generic

top.cert: top.lisp
top.cert: bind-free/top.cert
top.cert: floor-mod/floor-mod.cert
top.cert: floor-mod/mod-expt-fast.cert</pre> 
 
 <p>An experimental extension of ACL2 is under development by Bob Boyer and 
 Warren Hunt to support function memoization, hash conses, and an applicative 
 version of hash tables.  The default build of ACL2 does not include this 
 extension, other than simple logic definitions of functions in new source file 
 <span class="v">hons.lisp</span>.  Future versions of ACL2 may fully incorporate this 
 experimental extension.</p> 
 
 <p>The <span class="tt"><a href="ACL2____DEFEVALUATOR.html">defevaluator</a></span> event macro has been modified primarily by adding 
 a new constraint as follows, where <span class="v">evl</span> is the evaluator.  The idea is 
 that for the evaluation of a function call, one may replace each argument by 
 the quotation of its evaluation and then also replace the alist environment 
 with <span class="v">nil</span>.</p> 
 
 <pre class="code">(<a href="ACL2____DEFTHMD.html">DEFTHMD</a> UNHIDE-evl-CONSTRAINT-0
  (<a href="ACL2____IMPLIES.html">IMPLIES</a> (<a href="COMMON-LISP____AND.html">AND</a> (<a href="COMMON-LISP____CONSP.html">CONSP</a> X)
                (<a href="ACL2____SYNTAXP.html">SYNTAXP</a> (<a href="COMMON-LISP____NOT.html">NOT</a> (<a href="COMMON-LISP____EQUAL.html">EQUAL</a> A ''NIL)))
                (<a href="COMMON-LISP____NOT.html">NOT</a> (<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (<a href="COMMON-LISP____CAR.html">CAR</a> X) 'QUOTE)))
           (<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (evl X A)
                  (evl (<a href="COMMON-LISP____CONS.html">CONS</a> (<a href="COMMON-LISP____CAR.html">CAR</a> X)
                             (<a href="ACL2____KWOTE-LST.html">KWOTE-LST</a> (UNHIDE-evl-LIST (<a href="COMMON-LISP____CDR.html">CDR</a> X) A)))
                       NIL))))</pre> 
 
 <p>In order to support this change, there is another change: an evaluator maps 
 <span class="v">nil</span> to <span class="v">nil</span> (note <span class="v">(<a href="COMMON-LISP____AND.html">AND</a> X (<a href="COMMON-LISP____CDR.html">CDR</a> (<a href="ACL2____ASSOC-EQ.html">ASSOC-EQ</a> X A)))</span> in place of 
 <span class="v">(<a href="COMMON-LISP____CDR.html">CDR</a> (<a href="ACL2____ASSOC-EQ.html">ASSOC-EQ</a> X A))</span> below).</p> 
 
 <pre class="code">(<a href="ACL2____DEFTHM.html">DEFTHM</a> UNHIDE-evl-CONSTRAINT-1
  (<a href="ACL2____IMPLIES.html">IMPLIES</a> (<a href="COMMON-LISP____SYMBOLP.html">SYMBOLP</a> X)
           (<a href="COMMON-LISP____EQUAL.html">EQUAL</a> (UNHIDE-evl X A)
                  (<a href="COMMON-LISP____AND.html">AND</a> X (<a href="COMMON-LISP____CDR.html">CDR</a> (<a href="ACL2____ASSOC-EQ.html">ASSOC-EQ</a> X A))))))</pre> 
 
 <p>With the new <span class="tt"><a href="ACL2____DEFEVALUATOR.html">defevaluator</a></span>, Dave Greve has been able to do a proof 
 about beta reduction that seemed impossible before (see 
 <span class="v">books/misc/beta-reduce.lisp</span>).  Thanks to Dave for suggesting an initial 
 version of this change.</p> 
 
 <p>Explicit compilation is now avoided for OpenMCL, resulting in fewer files 
 to manage (no more files resulting from compilation) and, according to some 
 tests, slightly faster run times.  See <a href="ACL2____COMPILATION.html">compilation</a>.  Thanks to Bob 
 Boyer and Warren Hunt for suggesting this possibility.</p> 
 
 <p>Now, the <span class="v">term-evisc-tuple</span> (see <a href="ACL2____LD-EVISC-TUPLE.html">ld-evisc-tuple</a>) is overridden by 
 state global <span class="v">user-term-evisc-tuple</span> in all cases.  Formerly, this was only 
 the case when <span class="v">term-evisc-tuple</span> was called with non-<span class="v">nil</span> first 
 argument.</p> 
 
 <p>Symbols with the dot (<span class="v">.</span>) character are generally no longer printed 
 with vertical bars.  For example, before this change:</p> 
 
 <pre class="code">ACL2 !&gt;'ab.c
|AB.C|
ACL2 !&gt;</pre> 
 
 <p>After this change:</p> 
 
 <pre class="code">ACL2 !&gt;'ab.c
AB.C
ACL2 !&gt;</pre> 
 
 <p>Thanks to Jared Davis for suggesting this improvement.</p> 
 
 <p>Fixed bugs in <span class="v">guard</span> verification for theorems.  The following examples 
 illustrate these bugs.  If either theorem's body is executed in raw Lisp there 
 is likely to be a hard Lisp error, even though <span class="tt"><a href="ACL2____VERIFY-GUARDS.html">verify-guards</a></span> was 
 supposed to ensure against that behavior.</p> 
 
 <pre class="code">; Example: Verify-guards failed to check that all functions in the theorem
; had already been guard-verified.
(<a href="COMMON-LISP____DEFUN.html">defun</a> my-car (x) (<a href="COMMON-LISP____CAR.html">car</a> x))
(<a href="ACL2____DEFTHM.html">defthm</a> my-car-compute-example (<a href="COMMON-LISP____EQUAL.html">equal</a> (my-car 3) (my-car 3)))
(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> my-car-compute-example)

; Example: Verify guards of a theorem whose body uses state improperly.
(<a href="ACL2____DEFTHM.html">defthm</a> bad-state-handler
  (<a href="COMMON-LISP____IF.html">if</a> (state-p state)
      (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____CAR.html">car</a> state) (<a href="COMMON-LISP____CAR.html">car</a> state))
    t)
  :rule-classes nil)
(<a href="ACL2____VERIFY-GUARDS.html">verify-guards</a> bad-state-handler)</pre> 
 
 <p>See <a href="ACL2____GCL.html">gcl</a> for an example, developed with Warren Hunt and Serita 
 Nelesen, that shows how to get fast fixnum (small integer) arithmetic 
 operations in GCL.</p> 
 
 <p>Fixnum declarations are now realized as <span class="v">(signed-byte 30)</span> and 
 <span class="v">(unsigned-byte 29)</span> instead of what was generally <span class="v">(signed-byte 29)</span> 
 and <span class="v">(unsigned-byte 28)</span>.  MCL users may thus find better performance if 
 they switch to OpenMCL.  Note that some definitions have changed 
 correspondingly; for example, <span class="tt"><a href="ACL2____ZPF.html">zpf</a></span> now <span class="tt"><a href="COMMON-LISP____DECLARE.html">declare</a></span>s its argument to 
 be of type <span class="v">(unsigned-byte 29)</span> instead of <span class="v">(unsigned-byte 28)</span>.  A few 
 <a href="ACL2____BOOKS.html">books</a> may thus need to be adjusted; for example, changes were made to 
 books in <span class="v">books/data-structures/memories/</span>.</p> 
 
 <p>ACL2's rewriter now avoids removing certain true hypotheses and false 
 conclusions.  When a hypothesis rewrites to true or a conclusion rewrites to 
 false, ACL2 formerly removed that hypothesis or conclusion.  Now, it only does 
 such removal when the hypothesis or conclusion is either a call of <span class="tt"><a href="COMMON-LISP____EQUAL.html">equal</a></span> or an equivalence relation (see <a href="ACL2____EQUIVALENCE.html">equivalence</a>), or else is 
 sufficiently trivial (roughly, either redundant with another hypothesis or 
 conclusion or else trivially true without considering the rest of the goal). 
 A specific example may be found in source file <span class="v">simplify.lisp</span>; search for 
 ``; But we need to do even more work''.  Thanks to Robert Krug for providing 
 the idea for this improvement and its initial implementation.  As is common 
 with heuristic changes, you may find it necessary on occasion to rename some 
 subgoals in your <a href="ACL2____HINTS.html">hints</a>.  And in this case, you might also find it 
 necessary on rare occasions to add <span class="v">:do-not '(<a href="ACL2____GENERALIZE.html">generalize</a>)</span> <a href="ACL2____HINTS.html">hints</a>.</p> 
 
 <p>A new function, <span class="v">mfc-relieve-hyp</span>, allows (for example) for more 
 powerful <span class="tt"><a href="ACL2____BIND-FREE.html">bind-free</a></span> hypotheses, by providing an interface to the 
 rewriter's routine for relieving hypotheses.  See <a href="ACL2____EXTENDED-METAFUNCTIONS.html">extended-metafunctions</a>.  Thanks to Robert Krug for providing the idea for 
 this feature and its initial implementation.</p> 
 
 <p>Two improvements have been made to non-linear arithmetic (see <a href="ACL2____NON-LINEAR-ARITHMETIC.html">non-linear-arithmetic</a>).  One allows for deducing strict inequality (<span class="v">&lt;</span>) 
 for the result of certain polynomial multiplications, where previously only 
 non-strict inequality (<span class="v">&lt;=</span>) was deduced.  A second allows the use of the 
 product of two polynomials when at least one of them is known to be rational. 
 We had previously restricted the use of the product to the case where both 
 were known to be rational.  Thanks to Robert Krug for these improvements.</p> 
 
 <p>(OpenMCL and Allegro CL only) Fixed ACL2's redefinitions of raw Lisp 
 <span class="v">trace</span> and <span class="v">untrace</span> in OpenMCL and Allegro CL so that when given no 
 arguments, they return the list of traced functions.  For <span class="v">trace</span>, this is 
 an ANSI spec requirement.  Note that <span class="tt"><a href="ACL2____TRACE_42.html">trace$</a></span> and <span class="tt"><a href="ACL2____UNTRACE_42.html">untrace$</a></span> 
 continue to return <span class="v">nil</span> in the ACL2 loop.</p> 
 
 <p>Fixed a bug that was allowing the symbol <span class="v">&amp;whole</span> to appear in other 
 than the first argument position for a <span class="tt"><a href="COMMON-LISP____DEFMACRO.html">defmacro</a></span> event, in violation of 
 the Common Lisp spec (and leading to potentially surprising behavior).  Thanks 
 to Peter Dillinger for bringing this bug to our attention.</p> 
 
 <p>It had been illegal to use <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> under some calls of <span class="tt"><a href="ACL2____LD.html">ld</a></span>.  This has been fixed.  Thanks to Jared Davis for bringing this issue to 
 our attention with a simple example, in essence:</p> 
 
 <pre class="code">(<a href="ACL2____LD.html">ld</a> '((<a href="COMMON-LISP____DEFMACRO.html">defmacro</a> my-defun (<a href="COMMON-LISP_____62REST.html">&amp;rest</a> args) `(<a href="ACL2____MAKE-EVENT.html">make-event</a> '(<a href="COMMON-LISP____DEFUN.html">defun</a> ,@args)))
      (my-defun f (x) x)))</pre> 
 
 <p>ACL2 no longer prohibits certain <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span> forms when including 
 uncertified <a href="ACL2____BOOKS.html">books</a>.  Thanks to Peter Dillinger for first bringing this 
 issue to our attention.</p> 
 
 <p>Hard errors arose when using <a href="ACL2____BREAK-REWRITE.html">break-rewrite</a> stack display commands, 
 in particular <span class="v">:path</span> and <span class="v">:frame</span>, from inside the <a href="ACL2____PROOF-BUILDER.html">proof-builder</a>.  This has been fixed.</p> 
 
 <p>Fixed a bug that could cause functions that call system built-ins 
 <span class="v">f-put-global</span>, <span class="v">f-get-global</span>, or <span class="v">f-boundp-global</span> to cause a raw 
 Lisp error even when proving theorems.  Thanks to Peter Dillinger, for 
 reporting such a failure for the form <span class="v">(<a href="ACL2____THM.html">thm</a> (<a href="ACL2____W.html">w</a> '(1 2 3)))</span>.</p> 
 
 <p>Renamed the formal parameters of function <span class="v">set-equal</span> in distributed 
 book <span class="v">books/arithmetic-3/bind-free/normalize.lisp</span> so that more distributed 
 books can be included together in the same session.  In particular books 
 <span class="v">books/data-structures/set-theory</span> and 
 <span class="v">books/arithmetic-3/extra/top-ext</span> can now be included together.  Thanks to 
 Carl Eastlund for bringing this problem to our attention and to Robert Krug 
 for suggesting the formals renaming as a fix.</p> 
 
 <p>Metafunctions must now be executable.  See <a href="ACL2____META.html">meta</a>.</p> 
 
 <p>New utilities allow for user-defined simplifiers at the goal level, both 
 verified and unverified (``trusted''), where the latter can even be defined by 
 programs outside ACL2.  See <a href="ACL2____CLAUSE-PROCESSOR.html">clause-processor</a>, which points to a new 
 directory <span class="v">books/clause-processors/</span> that contains examples of these new 
 utilities, including for example a system (``SULFA'') contributed by Erik 
 Reeber that implements a decision procedure (thanks, Erik).  Also see <a href="ACL2____PROOF-BUILDER-COMMANDS.html">proof-builder-commands</a> for the new <a href="ACL2____PROOF-BUILDER.html">proof-builder</a> command 
 <span class="v">clause-processor</span> (or for short, <span class="v">cl-proc</span>).</p> 
 
 <p>The rewriter has been tweaked to run faster in some cases involving very 
 large terms.  Thanks to Eric Smith and Jared Davis for providing a helpful 
 example that helped us locate the source of this inefficiency.</p> 
 
 <p>Added <span class="v">books/make-event/defspec.lisp</span>.  This book shows how one can 
 mimic certain limited forms of higher-order statements in ACL2 by use of 
 macros, <span class="tt"><a href="ACL2____MAKE-EVENT.html">make-event</a></span>, and <span class="tt"><a href="ACL2____TABLE.html">table</a></span> events.  Thanks to Sandip Ray 
 for his contribution.</p> 
 
 <p>A new release of the RTL library, <span class="v">books/rtl/rel7/</span>, replaces the 
 previous version, <span class="v">books/rtl/rel6/</span>.  Thanks to Hanbing Liu and David 
 Russinoff for providing this new version.</p> 
 
 <p>We thank David Russinoff for providing a proof of the law of quadratic 
 reciprocity.  See <span class="v">books/quadratic-reciprocity/Readme.lsp</span>.</p> 
 
 <p>Eliminated a slow array warning (see <a href="ACL2____SLOW-ARRAY-WARNING.html">slow-array-warning</a>) that could 
 occur when exiting a <a href="ACL2____WORMHOLE.html">wormhole</a> after executing an <span class="tt"><a href="ACL2____IN-THEORY.html">in-theory</a></span> 
 event in that wormhole.  Thanks to Dave Greve for bringing this problem to our 
 attention.</p> 
 
 <p>A new accessor, <span class="v">(<a href="ACL2____MFC-RDEPTH.html">mfc-rdepth</a> mfc)</span>, provides a new field, the remaining 
 rewrite stack depth, which has been added to metafunction context structures; 
 see <a href="ACL2____EXTENDED-METAFUNCTIONS.html">extended-metafunctions</a>.  Thanks to Eric Smith for suggesting this 
 addition.</p> 
 
 <p>The algorithms were modified for collecting up rule names and other 
 information used in proofs, into so-called ``tag-trees''.  Tag-trees are now 
 free of duplicate objects, and this change can dramatically speed up some 
 proofs that involve many different rules.  Thanks to Eric Smith for doing some 
 profiling that brought this issue to our attention, and for reporting that 
 this change reduced proof time on an example by about 47% (from 3681.46 
 reported seconds down to 1954.69).</p> 
 
 <p>All legal <span class="v">xargs</span> keywords may now be used in <span class="tt"><a href="ACL2____VERIFY-TERMINATION.html">verify-termination</a></span> 
 <a href="ACL2____EVENTS.html">events</a>.  In particular, this is the case for <span class="v">:normalize</span>.</p> 
 
 <p>(SBCL and CMUCL only) Fixed a problem with stobj array resizing functions 
 that was causing a hard error in ACL2 images built on SBCL or CMUCL.</p> 
 
 <p>A new <a href="ACL2____TABLE.html">table</a>, <span class="tt"><a href="ACL2____EVISC-TABLE.html">evisc-table</a></span>, allows you to introduce print 
 abbreviations, for example for large constants.  Moreover, a new reader macro 
 — <span class="v">#,</span> — makes it convenient to reference constants even inside 
 a quote.  See <a href="ACL2____EVISC-TABLE.html">evisc-table</a>.  Thanks to Bob Boyer and Warren Hunt for 
 useful discussions leading to this feature.</p> 
 
 <p>The macros in <span class="v">books/misc/expander.lisp</span> now have a new keyword 
 argument, <span class="v">:simplify-hyps-p</span>.  The default behavior is as before, but now 
 case splitting from hypothesis simplification can be avoided.  For details, 
 evaluate <span class="v">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "misc/expander" :dir :system)</span> and then <span class="v">:doc!
 defthm?</span> and <span class="v">:doc! symsym</span>.  Thanks to Daron Vroon for sending a question 
 that prompted this additional functionality.</p> 
 
 <p>ACL2 failed to apply <span class="v">:</span><span class="tt"><a href="ACL2____RESTRICT.html">restrict</a></span> hints to rules of class 
 <span class="v">:</span><span class="tt"><a href="ACL2____DEFINITION.html">definition</a></span>, except for the simplest sorts (see <a href="ACL2____SIMPLE.html">simple</a>). 
 This has been fixed.  Thanks to Jared Davis for pointing out this bug by 
 sending a small example.</p> 
 
 <p>Added a new <span class="v">:msg</span> argument to <span class="v">assert-event</span>; see <a href="ACL2____ASSERT-EVENT.html">assert-event</a>.  The implementation of <span class="v">value-triple</span> has been modified to 
 support this change.</p> 
 
 <p>Fixed a bug in macro <span class="v">io?</span> that now allows the <span class="v">commentp</span> argument to 
 be <span class="v">t</span>.  This provides a way other than <span class="v">cw</span> to print without modifying 
 state, for example as follows.  (Warning: Certain errors may leave you in a 
 <a href="ACL2____WORMHOLE.html">wormhole</a>, in which case use <span class="v">:a!</span> to abort.)</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____PROG2_42.html">prog2$</a> (<a href="ACL2____IO_F3.html">io?</a> event t state
                    ()
                    (<a href="ACL2____FMS.html">fms</a> "Howdy~%" nil *standard-co* state nil))
               (<a href="COMMON-LISP_____B2.html">+</a> 3 4))

Howdy
7
ACL2 !&gt;:set-inhibit-output-lst (<a href="ACL2____PROOF-TREE.html">proof-tree</a> event)
 (<a href="ACL2____PROOF-TREE.html">PROOF-TREE</a> EVENT)
ACL2 !&gt;(<a href="ACL2____PROG2_42.html">prog2$</a> (<a href="ACL2____IO_F3.html">io?</a> event t state
                    ()
                    (<a href="ACL2____FMS.html">fms</a> "Howdy~%" nil *standard-co* state nil))
               (<a href="COMMON-LISP_____B2.html">+</a> 3 4))
7
ACL2 !&gt;</pre> 
 
 <p>ACL2 now disallows calls of <span class="tt"><a href="ACL2____PROGN_12.html">progn!</a></span> inside function bodies, just as 
 it already disallowed such calls of <span class="tt"><a href="COMMON-LISP____PROGN.html">progn</a></span>, since in both cases the 
 Common Lisp meaning differs from the ACL2 meaning.</p> 
 
 <p>Redefinition of system functions now always requires an active trust tag 
 (see <a href="ACL2____DEFTTAG.html">defttag</a>).  This restriction was intended before, but there was a 
 hole that allowed a second redefinition without an active trust tag.  Thanks 
 to Peter Dillinger for pointing out this bug.</p> 
 
 <p><span class="tt"><a href="ACL2____VERIFY-TERMINATION.html">Verify-termination</a></span> has been disabled for a few more built-in 
 functions that are in <span class="v">:</span><span class="tt"><a href="ACL2____PROGRAM.html">program</a></span> mode.  (If you are curious about 
 which ones they are, evaluate <span class="v">(<a href="ACL2____F-GET-GLOBAL.html">f-get-global</a> 'built-in-program-mode-fns
 state)</span>.)  [Note added for Version_3.4: This state global has been changed to 
 'program-fns-with-raw-code.]  Moreover, such functions now will execute only 
 their raw Lisp code, so for example they cannot be called during 
 macroexpansion.  Thanks to Peter Dillinger and Sandip Ray for useful 
 discussions on details of the implementation of this restriction.</p> 
 
 <p>New untouchable state global variables, <span class="v">temp-touchable-vars</span> and 
 <span class="v">temp-touchable-fns</span>, can control the enforcement of untouchability.  See 
 <a href="ACL2____REMOVE-UNTOUCHABLE.html">remove-untouchable</a>.  Thanks to Peter Dillinger for suggesting these 
 features.</p> 
 
 <p>The ``TTAG NOTE'' string was being printed by <span class="tt"><a href="ACL2____ENCAPSULATE.html">encapsulate</a></span> events 
 whenever an active trust tag was already in effect (see <a href="ACL2____DEFTTAG.html">defttag</a>), even 
 if the encapsulate event contained no <span class="tt"><a href="ACL2____DEFTTAG.html">defttag</a></span> event.  This has been 
 fixed.  Thanks to Peter Dillinger for a query leading to this fix.</p> 
 
 <p>Fixed a bug in <span class="tt"><a href="ACL2____PROGN_12.html">progn!</a></span> that could leave the user in raw-mode (see 
 <a href="ACL2____SET-RAW-MODE.html">set-raw-mode</a>).  This could occur when certifying a book with a 
 <span class="v">compile-flg</span> value of <span class="v">t</span> (see <a href="ACL2____CERTIFY-BOOK.html">certify-book</a>), when that book 
 contained a <span class="tt"><a href="ACL2____PROGN_12.html">progn!</a></span> event setting raw-mode to <span class="v">t</span> without setting 
 raw-mode back to <span class="v">nil</span>:</p> 
 
 <pre class="code">(<a href="ACL2____PROGN_12.html">progn!</a> (<a href="ACL2____SET-RAW-MODE.html">set-raw-mode</a> t) ...)</pre>
</body>
</html>
