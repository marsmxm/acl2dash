<html>
<head>
<meta charset="UTF-8">
<title>Bip32-export-key</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=BITCOIN____BIP32-EXPORT-KEY">Click for Bip32-export-key in the Full Manual</a></h3>

<p>Export a key from a tree.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(bip32-export-key tree path mainnet? public?) → exported</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">tree</span> — <font color="#606060">Guard <span class="v">(<a href="BITCOIN____BIP32-KEY-TREEP.html">bip32-key-treep</a> tree)</span>.</font>
</dd> 
  <dd>
<span class="tt">path</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____UBYTE32-LISTP.html">ubyte32-listp</a> path)</span>.</font>
</dd> 
  <dd>
<span class="tt">mainnet?</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> mainnet?)</span>.</font>
</dd> 
  <dd>
<span class="tt">public?</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____BOOLEANP.html">booleanp</a> public?)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">exported</span> — <font color="#606060">Type <span class="v">(<a href="ACL2____BYTE-LISTP.html">byte-listp</a> exported)</span>.</font>
</dd> 
 
</dl></div> 
<p>The key to export is designated by a path, 
     which must be a valid path in the tree.</p><p>A boolean argument specifies whether the key is 
     for the mainnet or for the testnet.</p><p>Another boolean argument specified whether the key should be public. 
     If this is <span class="v">nil</span>, then the tree must consist of private keys, 
     as expressed by the guard. 
     If this is <span class="v">t</span> instead, the tree may consist of private or public keys; 
     if it consists of private keys, 
     we use <span class="tt"><a href="BITCOIN____BIP32-N.html">bip32-n</a></span> to turn the extended private key at the path 
     into the corresponding extended public key, 
     prior to serializing it.</p><p>We first derive the key at the path from the root, via <span class="tt"><a href="BITCOIN____BIP32-CKD_A2.html">bip32-ckd*</a></span>. 
     Since the key tree satisfies <span class="tt"><a href="BITCOIN____BIP32-VALID-KEYS-P.html">bip32-valid-keys-p</a></span> 
     and the path is in the tree, 
     this never returns an error, as proved via <span class="tt"><a href="ACL2____MBT.html">mbt</a></span> below.</p><p>We calculate the total depth of the key 
     by adding the length of the path to the root's depth. 
     Since the key tree satisfies <span class="tt"><a href="BITCOIN____BIP32-VALID-DEPTHS-P.html">bip32-valid-depths-p</a></span> 
     and the path is in the tree, 
     this never exceeds 255 (i.e. always fits in a byte), 
     as proved via <span class="tt"><a href="ACL2____MBT.html">mbt</a></span> below.</p><p>The index of the key is 
     the last element of the path if the path is not empty. 
     Otherwise, it is the index of the root.</p><p>The parent key's fingerprint is 
     calculated from the parent key if the path is not empty. 
     The path of the parent is obtained 
     by removing the last element from the path of the key: 
     since this is also a path in the tree, 
     the call of <span class="tt"><a href="BITCOIN____BIP32-CKD_A2.html">bip32-ckd*</a></span> on the parent's path 
     does not return an error either, as proved via <span class="tt"><a href="ACL2____MBT.html">mbt</a></span> below. 
     Otherwise, if the path is empty, 
     we obtain the parent's fingerprint from the root of the tree.</p><p>With all the above pieces of data in hand, 
     we serialize the key, completing the export.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>bip32-export-key</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 bip32-export-key
 (tree path mainnet? public?)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="BITCOIN____BIP32-KEY-TREEP.html">bip32-key-treep</a> tree)
                             (<a href="ACL2____UBYTE32-LISTP.html">ubyte32-listp</a> path)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> mainnet?)
                             (<a href="ACL2____BOOLEANP.html">booleanp</a> public?))))
 (<a href="COMMON-LISP____DECLARE.html">declare</a>
     (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="BITCOIN____BIP32-PATH-IN-TREE-P.html">bip32-path-in-tree-p</a> path tree)
                        (<a href="COMMON-LISP____OR.html">or</a> public? (<a href="BITCOIN____BIP32-KEY-TREE-PRIV-P.html">bip32-key-tree-priv-p</a> tree)))))
 (<a href="ACL2____B_A2.html">b*</a>
  ((path (<a href="ACL2____MBE.html">mbe</a> :logic (<a href="ACL2____UBYTE32-LIST-FIX.html">ubyte32-list-fix</a> path)
              :exec path))
   ((<a href="BITCOIN____BIP32-KEY-TREE.html">bip32-key-tree</a> tree) tree)
   ((<a href="ACL2____MV.html">mv</a> error? key)
    (<a href="BITCOIN____BIP32-CKD_A2.html">bip32-ckd*</a> tree.root-key path))
   ((unless (<a href="ACL2____MBT.html">mbt</a> (<a href="COMMON-LISP____NOT.html">not</a> error?))) nil)
   (key
     (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____AND.html">and</a> public? (<a href="BITCOIN____BIP32-KEY-TREE-PRIV-P.html">bip32-key-tree-priv-p</a> tree))
         (<a href="BITCOIN____BIP32-EXT-KEY-PUB.html">bip32-ext-key-pub</a> (<a href="BITCOIN____BIP32-N.html">bip32-n</a> (<a href="BITCOIN____BIP32-EXT-KEY-PRIV-_E3GET.html">bip32-ext-key-priv-&gt;get</a> key)))
         key))
   (depth (<a href="COMMON-LISP_____B2.html">+</a> tree.root-depth (<a href="ACL2____LEN.html">len</a> path)))
   ((unless (<a href="ACL2____MBT.html">mbt</a> (<a href="ACL2____BYTEP.html">bytep</a> depth))) nil)
   (index (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____CONSP.html">consp</a> path)
              (<a href="COMMON-LISP____CAR.html">car</a> (<a href="COMMON-LISP____LAST.html">last</a> path))
              tree.root-index))
   (parent (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____CONSP.html">consp</a> path)
               (<a href="ACL2____B_A2.html">b*</a> ((parent-path (<a href="COMMON-LISP____BUTLAST.html">butlast</a> path 1))
                    ((<a href="ACL2____MV.html">mv</a> error? parent-key)
                     (<a href="BITCOIN____BIP32-CKD_A2.html">bip32-ckd*</a> tree.root-key parent-path))
                    ((unless (<a href="ACL2____MBT.html">mbt</a> (<a href="COMMON-LISP____NOT.html">not</a> error?))) nil))
                   (<a href="BITCOIN____BIP32-KEY-FINGERPRINT.html">bip32-key-fingerprint</a> parent-key))
               tree.root-parent)))
  (<a href="BITCOIN____BIP32-SERIALIZE-KEY.html">bip32-serialize-key</a> key depth index parent mainnet?)))</pre> 
<p><b>Theorem: </b>byte-listp-of-bip32-export-key</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
     byte-listp-of-bip32-export-key
     (<a href="ACL2____B_A2.html">b*</a> ((exported (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet? public?)))
         (<a href="ACL2____BYTE-LISTP.html">byte-listp</a> exported))
     :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>bip32-export-key-of-bip32-key-tree-fix-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> bip32-export-key-of-bip32-key-tree-fix-tree
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> (<a href="BITCOIN____BIP32-KEY-TREE-FIX.html">bip32-key-tree-fix</a> tree)
                                 path mainnet? public?)
               (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet? public?)))</pre> 
<p><b>Theorem: </b>bip32-export-key-bip32-key-tree-equiv-congruence-on-tree</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
   bip32-export-key-bip32-key-tree-equiv-congruence-on-tree
   (<a href="ACL2____IMPLIES.html">implies</a>
        (<a href="BITCOIN____BIP32-KEY-TREE-EQUIV.html">bip32-key-tree-equiv</a> tree tree-equiv)
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet? public?)
               (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree-equiv path mainnet? public?)))
   :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>bip32-export-key-of-ubyte32-list-fix-path</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> bip32-export-key-of-ubyte32-list-fix-path
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree (<a href="ACL2____UBYTE32-LIST-FIX.html">ubyte32-list-fix</a> path)
                                 mainnet? public?)
               (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet? public?)))</pre> 
<p><b>Theorem: </b>bip32-export-key-ubyte32-list-equiv-congruence-on-path</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
   bip32-export-key-ubyte32-list-equiv-congruence-on-path
   (<a href="ACL2____IMPLIES.html">implies</a>
        (<a href="ACL2____UBYTE32-LIST-EQUIV.html">acl2::ubyte32-list-equiv</a> path path-equiv)
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet? public?)
               (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path-equiv mainnet? public?)))
   :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>bip32-export-key-of-bool-fix-mainnet?</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> bip32-export-key-of-bool-fix-mainnet?
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path (<a href="ACL2____BOOL-FIX.html">acl2::bool-fix</a> mainnet?)
                                 public?)
               (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet? public?)))</pre> 
<p><b>Theorem: </b>bip32-export-key-iff-congruence-on-mainnet?</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
   bip32-export-key-iff-congruence-on-mainnet?
   (<a href="ACL2____IMPLIES.html">implies</a>
        (<a href="ACL2____IFF.html">iff</a> mainnet? mainnet?-equiv)
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet? public?)
               (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet?-equiv public?)))
   :rule-classes :congruence)</pre> 
<p><b>Theorem: </b>bip32-export-key-of-bool-fix-public?</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
    bip32-export-key-of-bool-fix-public?
    (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree
                             path mainnet? (<a href="ACL2____BOOL-FIX.html">acl2::bool-fix</a> public?))
           (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet? public?)))</pre> 
<p><b>Theorem: </b>bip32-export-key-iff-congruence-on-public?</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
   bip32-export-key-iff-congruence-on-public?
   (<a href="ACL2____IMPLIES.html">implies</a>
        (<a href="ACL2____IFF.html">iff</a> public? public?-equiv)
        (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet? public?)
               (<a href="BITCOIN____BIP32-EXPORT-KEY.html">bip32-export-key</a> tree path mainnet? public?-equiv)))
   :rule-classes :congruence)</pre> 

</body>
</html>
