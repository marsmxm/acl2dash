<html>
<head>
<meta charset="UTF-8">
<title>Well-founded-relation-rule</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____WELL-FOUNDED-RELATION-RULE">Click for Well-founded-relation-rule in the Full Manual</a></h3>

<p>Show that a relation is well-founded on a set</p><p>See <a href="ACL2____RULE-CLASSES.html">rule-classes</a> for a general discussion of rule classes, 
 including how they are used to build rules from formulas and a discussion of 
 the various keywords in a rule class description.</p> 
 
 <pre class="code">Example:
(<a href="ACL2____DEFTHM.html">defthm</a> lex2p-is-well-founded-relation
  (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____IMPLIES.html">implies</a> (pairp x) (<a href="ACL2____O-P.html">o-p</a> (ordinate x)))
       (<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____AND.html">and</a> (pairp x)
                     (pairp y)
                     (lex2p x y))
                (<a href="ACL2____O_C3.html">o&lt;</a> (ordinate x) (ordinate y))))
  :rule-classes :well-founded-relation)</pre> 
 
 <p>The example above creates a <span class="v">:well-founded-relation</span> rule, where of 
 course the functions <span class="v">pairp</span>, <span class="v">lex2p</span>, and <span class="v">ordinate</span> would have to 
 be defined first.  It establishes that <span class="v">lex2p</span> is a well-founded relation 
 on <span class="v">pairp</span>s.  We explain and give details below.</p> 
 
 <p>Exactly two general forms are recognized:</p> 
 
 <pre class="code">General Forms
(<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____IMPLIES.html">IMPLIES</a> (mp x) (<a href="ACL2____O-P.html">O-P</a> (fn x)))              ; Property 1
     (<a href="ACL2____IMPLIES.html">IMPLIES</a> (<a href="COMMON-LISP____AND.html">AND</a> (mp x)                       ; Property 2
                   (mp y)
                   (rel x y))
              (<a href="ACL2____O_C3.html">O&lt;</a> (fn x) (fn y)))),</pre> 
 
 <p>or</p> 
 
 <pre class="code">(<a href="COMMON-LISP____AND.html">AND</a> (<a href="ACL2____O-P.html">O-P</a> (fn x))                               ; Property 1
     (<a href="ACL2____IMPLIES.html">IMPLIES</a> (rel x y)                         ; Property 2
              (<a href="ACL2____O_C3.html">O&lt;</a> (fn x) (fn y))))</pre> 
 
 <p>where <span class="v">mp</span>, <span class="v">fn</span>, and <span class="v">rel</span> are function symbols, <span class="v">x</span> and 
 <span class="v">y</span> are distinct variable symbols, and no other <span class="v">:well-founded-relation</span> 
 theorem about <span class="v">fn</span> has been proved.  When the second general form is used, 
 we act as though the first form were used with <span class="v">mp</span> being the function that 
 ignores its argument and returns <span class="v">t</span>.  The discussion below therefore 
 considers only the first general form.</p> 
 
 <p>Note: We are very rigid when checking that the submitted formula is of one 
 of these forms.  For example, in the first form, we insist that all the 
 conjuncts appear in the order shown above.  Thus, interchanging the two 
 properties in the top-level conjunct or rearranging the hypotheses in the 
 second conjunct both produce unrecognized forms.  The requirement that each 
 <span class="v">fn</span> be proved well-founded at most once ensures that for each well-founded 
 relation, <span class="v">fn</span>, there is a unique <span class="v">mp</span> that recognizes the domain on 
 which <span class="v">rel</span> is well-founded.  We impose this requirement simply so that 
 <span class="v">rel</span> can be used as a short-hand when specifying the well-founded 
 relations to be used in definitions; otherwise the specification would have to 
 indicate which <span class="v">mp</span> was to be used.</p> 
 
 <p>We also insist that the new ordering be embedded into the ordinals as 
 handled by <span class="tt"><a href="ACL2____O-P.html">o-p</a></span> and <span class="tt"><a href="ACL2____O_C3.html">o&lt;</a></span> and not some into previously admitted 
 user-defined well-founded set and relation.  This restriction should pose no 
 hardship.  If <span class="v">mp</span> and <span class="v">rel</span> were previously shown to be well-founded 
 via the embedding <span class="v">fn</span>, and you know how to embed some new set and relation 
 into <span class="v">mp</span> and <span class="v">rel</span>, then by composing <span class="v">fn</span> with your new embedding 
 and using the previously proved well-founded relation lemma you can embed the 
 new set and relation into the ordinals.</p> 
 
 <p><span class="v">Mp</span> is a predicate that recognizes the objects that are supposedly 
 ordered in a well-founded way by <span class="v">rel</span>.  We call such an object an 
 ``<span class="v">mp</span>-measure'' or simply a ``measure'' when <span class="v">mp</span> is understood. 
 Property 1 tells us that every measure can be mapped into an ACL2 ordinal. 
 (See <a href="ACL2____O-P.html">o-p</a>.)  This mapping is performed by <span class="v">fn</span>.  Property 2 tells us 
 that if the measure <span class="v">x</span> is smaller than the measure <span class="v">y</span> according to 
 <span class="v">rel</span> then the image of <span class="v">x</span> under <span class="v">fn</span> is a smaller than that of 
 <span class="v">y</span>, according to the well-founded relation <span class="tt"><a href="ACL2____O_C3.html">o&lt;</a></span>.  (See <a href="ACL2____O_C3.html">o&lt;</a>.) 
 Thus, the general form of a <span class="v">:well-founded-relation</span> formula establishes 
 that there exists a <span class="v">rel</span>-order preserving embedding (namely via <span class="v">fn</span>) 
 of the <span class="v">mp</span>-measures into the ordinals.  We can thus conclude that <span class="v">rel</span> 
 is well-founded on <span class="v">mp</span>-measures.</p> 
 
 <p>Such well-founded relations are used in the admissibility test for 
 recursive functions, in particular, to show that the recursion terminates.  To 
 illustrate how such information may be used, consider a generic function 
 definition</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> g (x) (<a href="COMMON-LISP____IF.html">if</a> (test x) (<a href="ACL2____G.html">g</a> (step x)) (base x))).</pre> 
 
 <p>If <span class="v">rel</span> has been shown to be well-founded on <span class="v">mp</span>-measures, then 
 <span class="v">g</span>'s termination can be ensured by finding a measure, <span class="v">(m x)</span>, with the 
 property that <span class="v">m</span> produces a measure:</p> 
 
 <pre class="code">(mp (m x)),                                     ; Defun-goal-1</pre> 
 
 <p>and that the argument to <span class="v">g</span> gets smaller (when measured by <span class="v">m</span> and 
 compared by <span class="v">rel</span>) in the recursion,</p> 
 
 <pre class="code">(<a href="ACL2____IMPLIES.html">implies</a> (test x) (rel (m (step x)) (m x))).    ; Defun-goal-2</pre> 
 
 <p>If <span class="v">rel</span> is selected as the <span class="v">:well-founded-relation</span> to be used in 
 the definition of <span class="v">g</span>, the definitional principal will generate and attempt 
 to prove <span class="v">defun-goal-1</span> and <span class="v">defun-goal-2</span> to justify <span class="v">g</span>.  We show 
 later why these two goals are sufficient to establish the termination of 
 <span class="v">g</span>.  Observe that neither the ordinals nor the embedding, <span class="v">fn</span>, of the 
 <span class="v">mp</span>-measures into the ordinals is involved in the goals generated by the 
 definitional principal.</p> 
 
 <p>Suppose now that a <span class="v">:well-founded-relation</span> theorem has been proved for 
 <span class="v">mp</span> and <span class="v">rel</span>.  How can <span class="v">rel</span> be ``selected as the 
 <span class="v">:well-founded-relation</span>'' by <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span>?  There are two ways.  First, 
 an <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> keyword to the <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> event allows the specification 
 of a <span class="v">:well-founded-relation</span>.  Thus, the definition of <span class="v">g</span> above might 
 be written</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> g (x)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :well-founded-relation rel))
 (<a href="COMMON-LISP____IF.html">if</a> (test x) (<a href="ACL2____G.html">g</a> (step x)) (base x)))</pre> 
 
 <p>Alternatively, <span class="v">rel</span> may be specified as the 
 <span class="v">:default-well-founded-relation</span> in <span class="tt"><a href="ACL2____ACL2-DEFAULTS-TABLE.html">ACL2-defaults-table</a></span> by 
 executing the event</p> 
 
 <pre class="code">(<a href="ACL2____SET-WELL-FOUNDED-RELATION.html">set-well-founded-relation</a> rel).</pre> 
 
 <p>When a <span class="tt"><a href="COMMON-LISP____DEFUN.html">defun</a></span> event does not explicitly specify the relation in its 
 <span class="tt"><a href="ACL2____XARGS.html">xargs</a></span> the default relation is used.  When ACL2 is initialized, the 
 default relation is <span class="tt"><a href="ACL2____O_C3.html">o&lt;</a></span>.</p> 
 
 <p>Finally, though it is probably obvious, we now show that <span class="v">defun-goal-1</span> 
 and <span class="v">defun-goal-2</span> are sufficient to ensure the termination of <span class="v">g</span> 
 provided <span class="v">property-1</span> and <span class="v">property-2</span> of <span class="v">mp</span> and <span class="v">rel</span> have been 
 proved.  To this end, assume we have proved <span class="v">defun-goal-1</span> and 
 <span class="v">defun-goal-2</span> as well as <span class="v">property-1</span> and <span class="v">property-2</span> and we show 
 how to admit <span class="v">g</span> under the primitive ACL2 definitional principal (i.e., 
 using only the ordinals).  In particular, consider the definition event</p> 
 
 <pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a> g (x)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :well-founded-relation o&lt;
                 :measure (fn (m x))))
 (<a href="COMMON-LISP____IF.html">if</a> (test x) (<a href="ACL2____G.html">g</a> (step x)) (base x)))</pre> 
 
 <p>Proof that <span class="v">g</span> is admissible: To admit the definition of <span class="v">g</span> above we 
 must prove</p> 
 
 <pre class="code">(<a href="ACL2____O-P.html">o-p</a> (fn (m x)))                        ; *1</pre> 
 
 <p>and</p> 
 
 <pre class="code">(<a href="ACL2____IMPLIES.html">implies</a> (test x)                               ; *2
         (<a href="ACL2____O_C3.html">o&lt;</a> (fn (m (step x))) (fn (m x)))).</pre> 
 
 <p>But *1 can be proved by instantiating <span class="v">property-1</span> to get</p> 
 
 <pre class="code">(<a href="ACL2____IMPLIES.html">implies</a> (mp (m x)) (<a href="ACL2____O-P.html">o-p</a> (fn (m x)))),</pre> 
 
 <p>and then relieving the hypothesis with <span class="v">defun-goal-1</span>, <span class="v">(mp (m
 x))</span>.</p> 
 
 <p>Similarly, *2 can be proved by instantiating <span class="v">property-2</span> to get</p> 
 
 <pre class="code">(<a href="ACL2____IMPLIES.html">implies</a> (<a href="COMMON-LISP____AND.html">and</a> (mp (m (step x)))
              (mp (m x))
              (rel (m (step x)) (m x)))
         (<a href="ACL2____O_C3.html">o&lt;</a> (fn (m (step x))) (fn (m x))))</pre> 
 
 <p>and relieving the first two hypotheses by appealing to two instances of 
 <span class="v">defun-goal-1</span>, thus obtaining</p> 
 
 <pre class="code">(<a href="ACL2____IMPLIES.html">implies</a> (rel (m (step x)) (m x))
         (<a href="ACL2____O_C3.html">o&lt;</a> (fn (m (step x))) (fn (m x)))).</pre> 
 
 <p>By chaining this together with <span class="v">defun-goal-2</span>,</p> 
 
 <pre class="code">(<a href="ACL2____IMPLIES.html">implies</a> (test x)
         (rel (m (step x)) (m x)))</pre> 
 
 <p>we obtain *2.  Q.E.D.</p>
</body>
</html>
