<html>
<head>
<meta charset="UTF-8">
<title>Quicklisp</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____QUICKLISP">Click for Quicklisp in the Full Manual</a></h3>

<p>An ACL2 connection to the <a href="http://www.quicklisp.org" target="_blank"><nobr>Quicklisp<img src="../Icon_External_Link.png" title="External link to http://www.quicklisp.org"></nobr></a> system for installing Lisp 
libraries.</p><h3>About Quicklisp</h3> 
 
<p>Quicklisp is a Common Lisp equivalent to tools like <a href="http://www.cpan.org/" target="_blank"><nobr>CPAN<img src="../Icon_External_Link.png" title="External link to http://www.cpan.org/"></nobr></a> for <a href="http://www.perl.org/" target="_blank"><nobr>Perl<img src="../Icon_External_Link.png" title="External link to http://www.perl.org/"></nobr></a>, or <a href="http://rubygems.org/" target="_blank"><nobr>RubyGems<img src="../Icon_External_Link.png" title="External link to http://rubygems.org/"></nobr></a> for <a href="http://www.ruby-lang.org/" target="_blank"><nobr>Ruby<img src="../Icon_External_Link.png" title="External link to http://www.ruby-lang.org/"></nobr></a>.  It lets you to easily install and 
load the latest versions of Common Lisp libraries (and their dependencies).</p> 
 
<p>To make it easy to use Quicklisp from ACL2 we have developed some wrapper 
books in the <span class="v">books/quicklisp</span> directory.  These books serve as the 
basis for other libraries such as <a href="ACL2____OSLIB.html">oslib</a> and the ACL2 <a href="ACL2____BRIDGE.html">bridge</a>. 
Naturally, all of these books require <a href="ACL2____TRUST-TAG.html">trust-tag</a>s.</p> 
 
<p>Every ANSI-compliant host Common Lisp suitable for ACL2 should support the 
use of Quicklisp, where occasionally libraries may need to be installed.  As of 
late 2016, all host Common Lisp implementations suitable for ACL2 are 
sufficiently ANSI-compliant for the use of Quicklisp except for GCL.</p> 
 
<p>Because of this, if you want to use the Quicklisp books or any libraries 
that depend on them, you may <b>need to manually enable</b> the Quicklisp 
build.  Please see the instructions in <a href="ACL2____BOOKS-CERTIFICATION.html">books-certification</a> for the most 
up-to-date details about how to do this.</p> 
 
<p>In order to certify the Quicklisp books, OpenSSL may need to be installed in 
the system.  At least one instance was observed in which the certification of 
the Quicklisp books on MacOS Catalina with SBCL failed initially, but worked 
after installing OpenSSL via Homebrew (using the command <span class="v">brew install
openssl</span>).  The initial certification error did not explicitly mention 
OpenSSL, but rather a <span class="v">SIGABRT</span>; thus, if this kind of certification error 
is observed, installing OpenSSL may solve the problem.  Additionally, on a Mac 
Arm64 (e.g. M1) machine, you may need to create symlinks to Homebrew's OpenSSL 
library files in <span class="v">/usr/local/lib</span> (using the command ``<span class="v">ln -s
/opt/homebrew/opt/openssl/lib/*.dylib /usr/local/lib</span>'').  Note that Homebrew, 
which is a package/application manager for Mac, can be installed from <a href="https://brew.sh" target="_blank"><nobr>https://brew.sh<img src="../Icon_External_Link.png" title="External link to https://brew.sh"></nobr></a>, following the simple instructions 
there.</p> 
 
<h3>Using the Quicklisp Books</h3> 
 
<p>Most ACL2 users will have no reason to <i>directly</i> load the Quicklisp 
books in <span class="v">books/quicklisp</span>.  Instead, you will want to load 
higher-level ACL2 libraries like <a href="ACL2____OSLIB.html">oslib</a> or the ACL2 <a href="ACL2____BRIDGE.html">bridge</a>.  This 
is because the Quicklisp books only deal with getting the appropriate Common 
Lisp libraries loadedâ€”they do not, by themselves, introduce ACL2 wrapper 
functions for actually using the associated Lisp libraries.</p> 
 
<p>However, if you are an advanced user who wants to use Common Lisp libraries 
to develop your own ACL2 extensions, then you will typically want to:</p> 
 
<ol> 
 
<li>Include the books for whichever libraries you want to use.  For instance, 
to load <a href="http://weitz.de/cl-fad/" target="_blank"><nobr>CL-FAD<img src="../Icon_External_Link.png" title="External link to http://weitz.de/cl-fad/"></nobr></a> and <a href="https://common-lisp.net/project/osicat/" target="_blank"><nobr>OSICAT<img src="../Icon_External_Link.png" title="External link to https://common-lisp.net/project/osicat/"></nobr></a> you could do: 
 
<pre class="code">(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "quicklisp/cl-fad" :dir :system)
(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "quicklisp/osicat" :dir :system)</pre>
</li> 
 
<li>Add your own <a href="ACL2____TRUST-TAG.html">trust-tag</a>s, drop into raw Lisp with <a href="ACL2____INCLUDE-RAW.html">include-raw</a>, 
and implement your extension.  How exactly to do this is, alas, far beyond the 
scope of this documentation, but we do try to give some hints below.</li> 
 
</ol> 
 
 
<h3>Finding Quicklisp Libraries</h3> 
 
<p>If you don't know much about Quicklisp and are wanting to find out about the 
available libraries, the following may be useful:</p> 
 
<ul> 
 
<li>
<a href="http://www.cliki.net/" target="_blank"><nobr>CLiki<img src="../Icon_External_Link.png" title="External link to http://www.cliki.net/"></nobr></a> is a Common Lisp wiki.  See 
especially the page about <a href="http://www.cliki.net/Current%20recommended%20libraries" target="_blank"><nobr>recommended 
libraries<img src="../Icon_External_Link.png" title="External link to http://www.cliki.net/Current%20recommended%20libraries"></nobr></a>.</li> 
 
<li>
<a href="http://quickdocs.org/" target="_blank"><nobr>Quickdocs<img src="../Icon_External_Link.png" title="External link to http://quickdocs.org/"></nobr></a> purports to provide 
documentation for all of the libraries in Quicklisp.</li> 
 
</ul> 
 
 
<h3>Adding Quicklisp Libraries</h3> 
 
<p>The books in <span class="v">quicklisp</span> only wrap up a few Common Lisp libraries 
that we have found to be useful.  But it should be very easy to experiment with 
any other Quicklisp libraries.</p> 
 
<p>Basic steps:</p> 
 
<ul> 
 
<li>Edit <span class="v">quicklisp/update-libs.lsp</span> and add the libraries you want 
to the list.</li> 
 
<li>Run the <span class="v">update-libs.sh</span> script.  This should download the new libraries 
into your <span class="v">quicklisp/bundle</span> directory.</li> 
 
<li>Extend <span class="v">quicklisp/base-raw.lsp</span> to load the new library and 
certify it.  This <span class="v">base</span> book really is just a way to get the bundle loaded 
into an ACL2 session so that the libraries can be found as needed.  It 
also (locally) loads the libraries that we expect to use, which ensures 
everything gets downloaded at the same time, and avoids potential problems with 
simultaneously compiling Common Lisp libraries during parallel builds.</li> 
 
<li>Add a new <span class="v">quicklisp/yourlib.lisp</span> book, styled after the other 
books in the Quicklisp directory.  The book doesn't really need to live in the 
<span class="v">quicklisp</span> directory, but keeping them there makes it easy to see what we 
are depending on and, if necessary, to change the way the wrappers work.</li> 
 
<li>Include your new book in <span class="v">quicklisp/top.lisp</span>, just for 
completeness.  (Hrmn, actually this book probably isn't very useful for 
anything.)</li> 
 
</ul> 
 
<p>Note that you can also develop your own Common Lisp libraries or do one-off 
hacking using the <span class="v">local-projects</span> feature of the bundle directory.  See the 
documentation for <a href="http://www.quicklisp.org/beta/bundles.html" target="_blank"><nobr>Quicklisp Bundles<img src="../Icon_External_Link.png" title="External link to http://www.quicklisp.org/beta/bundles.html"></nobr></a> for 
more information.</p> 
 
 
<h3>Developing ACL2 Extensions</h3> 
 
<p>After you've added a Common Lisp library, how do you actually use it from 
ACL2?  As an example, say we want to make use of the <a href="http://common-lisp.net/project/cl-json/" target="_blank"><nobr>CL-JSON<img src="../Icon_External_Link.png" title="External link to http://common-lisp.net/project/cl-json/"></nobr></a> library.</p> 
 
<p>Normally you would do something like this:</p> 
 
<pre class="code">; ** my-book.lisp
(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "MY-PKG")

; ** Load the library (after adding it as described above)
(<a href="ACL2____INCLUDE-BOOK.html">include-book</a> "quicklisp/cl-json" :dir :system)

; ** [OPTIONAL] develop a logical story so you can use the
; ** library from proper ACL2 functions...
(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x y z)
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard ...))
  (<a href="ACL2____PROGN_42.html">progn$</a>
   (<a href="ACL2____ER.html">er</a> hard? 'foo "Raw lisp definition not installed?")
   (logical-story-of-foo x y z)))

; ** Add a ttag since we're going to use include-raw
(<a href="ACL2____DEFTTAG.html">defttag</a> :my-book)

; ** Tell cert.pl that we're going to be loading raw Lisp code
;; (depends-on "my-book-raw.lsp")

; ** Actually include the raw Lisp code for our book
(<a href="ACL2____INCLUDE-RAW.html">include-raw</a> "my-book-raw.lsp"
             :do-not-compile t
             :host-readtable t)</pre> 
 
<p>You usually need to use the <span class="v">:host-readtable</span> option because real Common 
Lisp libraries will use things (packages, floats, etc.) that ACL2's reader will 
reject.  You usually need to use <span class="v">:do-not-compile</span> because otherwise you 
tend to not have the right packages around at compile time.  You may be able to 
work around that using <span class="v">eval-when</span>.</p> 
 
<p>The corresponding raw file, then would look something like this:</p> 
 
<pre class="code">; ** my-book-raw.lsp
(<a href="COMMON-LISP____IN-PACKAGE.html">in-package</a> "MY-PKG")

; ** Redefine our interface functions, freely using cl-json
; ** functionality
(<a href="COMMON-LISP____DEFUN.html">defun</a> foo (x y z)
  (cl-json:...))</pre> 
 

</body>
</html>
