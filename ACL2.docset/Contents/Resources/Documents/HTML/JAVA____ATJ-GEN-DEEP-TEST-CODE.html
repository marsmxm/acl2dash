<html>
<head>
<meta charset="UTF-8">
<title>Atj-gen-deep-test-code</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=JAVA____ATJ-GEN-DEEP-TEST-CODE">Click for Atj-gen-deep-test-code in the Full Manual</a></h3>

<p>Generate the code of a test method 
          that is specific to the deep embedding approach.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(atj-gen-deep-test-code test-function test-inputs 
                        test-outputs comp-var java-class$) 
 
   
(mv arg-block ares-block call-block jres-block comp-block)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">test-function</span>  <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> test-function)</span>.</font>
</dd> 
  <dd>
<span class="tt">test-inputs</span>  <font color="#606060">Guard <span class="v">(<a href="JAVA____ATJ-TEST-VALUE-LISTP.html">atj-test-value-listp</a> test-inputs)</span>.</font>
</dd> 
  <dd>
<span class="tt">test-outputs</span>  <font color="#606060">Guard <span class="v">(<a href="JAVA____ATJ-TEST-VALUE-LISTP.html">atj-test-value-listp</a> test-outputs)</span>.</font>
</dd> 
  <dd>
<span class="tt">comp-var</span>  <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____STRINGP.html">stringp</a> comp-var)</span>.</font>
</dd> 
  <dd>
<span class="tt">java-class$</span>  <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____STRINGP.html">stringp</a> java-class$)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">arg-block</span>  <font color="#606060">Type <span class="v">(<a href="JAVA____JBLOCKP.html">jblockp</a> arg-block)</span>.</font>
</dd> 
<dd>
<span class="tt">ares-block</span>  <font color="#606060">Type <span class="v">(<a href="JAVA____JBLOCKP.html">jblockp</a> ares-block)</span>.</font>
</dd> 
<dd>
<span class="tt">call-block</span>  <font color="#606060">Type <span class="v">(<a href="JAVA____JBLOCKP.html">jblockp</a> call-block)</span>.</font>
</dd> 
<dd>
<span class="tt">jres-block</span>  <font color="#606060">Type <span class="v">(<a href="JAVA____JBLOCKP.html">jblockp</a> jres-block)</span>.</font>
</dd> 
<dd>
<span class="tt">comp-block</span>  <font color="#606060">Type <span class="v">(<a href="JAVA____JBLOCKP.html">jblockp</a> comp-block)</span>.</font>
</dd> 
 
</dl></div> 
<p>This is used by <span class="tt"><a href="JAVA____ATJ-GEN-TEST-METHOD.html">atj-gen-test-method</a></span>, 
     which generates a Java method 
     to run one of the tests specified in the <span class="v">:tests</span> input to ATJ. 
     Most of that method's code is the same for deep and shallow embedding. 
     The only varying parts are the ones returned by this function, 
     and by <span class="tt"><a href="JAVA____ATJ-GEN-SHALLOW-TEST-CODE.html">atj-gen-shallow-test-code</a></span> for the shallow embedding.</p><p>The first block returned by this function 
     builds the input values of the test, 
     and assigns them to an array variable. 
     The block also assigns the function's name to a variable. 
     The array and function name are both arguments to the <span class="v">call</span> method 
     (see below). 
     They are both stored in variables, 
     instead of passing their expressions directly to the method call, 
     in order to accurately measure just the time of each call 
     (see <span class="tt"><a href="JAVA____ATJ-GEN-TEST-METHOD.html">atj-gen-test-method</a></span> for details), 
     without the time needed to compute the expressions.</p><p>The second block returned by this function 
     builds the output value of the test and assigns it to a variable. 
     If the test has multiple values, they are grouped into a list: 
     in the deep embedding, <span class="tt"><a href="ACL2____MV.html">mv</a></span> values are always treated as lists.</p><p>The third block returned by this function 
     calls the <span class="v">call</span> method generated by ATJ 
     (which uses the AIJ interpreter), 
     assigning the result to a variable. 
     Again, in the deep embedding 
     multi-valued functions always return a single Java value.</p><p>The fourth block returned by this function is always empty. 
     But we return it for uniformity with <span class="tt"><a href="JAVA____ATJ-GEN-SHALLOW-TEST-CODE.html">atj-gen-shallow-test-code</a></span>.</p><p>The fifth block returned by this function 
     compares the test output with the call output for equality, 
     assigning the boolean result to a variable. 
     The name of this variable is passed as argument to this function, 
     since it is also used in <span class="tt"><a href="JAVA____ATJ-GEN-TEST-METHOD.html">atj-gen-test-method</a></span>, 
     thus preventing this and that function to go out of sync 
     in regard to this shared variable name.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>atj-gen-deep-test-code</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 atj-gen-deep-test-code
 (test-function test-inputs
                test-outputs comp-var java-class$)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> test-function)
                             (<a href="JAVA____ATJ-TEST-VALUE-LISTP.html">atj-test-value-listp</a> test-inputs)
                             (<a href="JAVA____ATJ-TEST-VALUE-LISTP.html">atj-test-value-listp</a> test-outputs)
                             (<a href="COMMON-LISP____STRINGP.html">stringp</a> comp-var)
                             (<a href="COMMON-LISP____STRINGP.html">stringp</a> java-class$))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'atj-gen-deep-test-code))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   (((<a href="ACL2____MV.html">mv</a> arg-block arg-exprs &amp; jvar-value-index)
     (<a href="JAVA____ATJ-GEN-TEST-VALUES.html">atj-gen-test-values</a> test-inputs "value" 1 t nil))
    (arg-block
      (<a href="COMMON-LISP____APPEND.html">append</a> arg-block
              (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a>
                   (<a href="JAVA____JTYPE-ARRAY.html">jtype-array</a> *aij-type-value*)
                   "functionArguments"
                   (<a href="JAVA____JEXPR-NEWARRAY-INIT.html">jexpr-newarray-init</a> *aij-type-value* arg-exprs))
              (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> *aij-type-symbol* "functionName"
                             (<a href="JAVA____ATJ-GEN-SYMBOL.html">atj-gen-symbol</a> test-function t nil))))
    ((<a href="ACL2____MV.html">mv</a> ares-block ares-exprs &amp; &amp;)
     (<a href="JAVA____ATJ-GEN-TEST-VALUES.html">atj-gen-test-values</a> test-outputs
                          "value" jvar-value-index t nil))
    (ares-expr (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____CONSP.html">consp</a> ares-exprs)
                        (<a href="COMMON-LISP____NOT.html">not</a> (<a href="COMMON-LISP____CONSP.html">consp</a> (<a href="COMMON-LISP____CDR.html">cdr</a> ares-exprs))))
                   (<a href="COMMON-LISP____CAR.html">car</a> ares-exprs)
                   (<a href="JAVA____JEXPR-SMETHOD.html">jexpr-smethod</a> *aij-type-value*
                                  "makeList" ares-exprs)))
    (ares-block (<a href="COMMON-LISP____APPEND.html">append</a> ares-block
                        (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> *aij-type-value*
                                       "acl2Result" ares-expr)))
    (call-expr
         (<a href="JAVA____JEXPR-SMETHOD.html">jexpr-smethod</a> (<a href="JAVA____JTYPE-CLASS.html">jtype-class</a> java-class$)
                        "call"
                        (<a href="COMMON-LISP____LIST.html">list</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "functionName")
                              (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "functionArguments"))))
    (call-block (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> *aij-type-value*
                               "javaResult" call-expr))
    (comp-expr (<a href="JAVA____JEXPR-METHOD.html">jexpr-method</a> "acl2Result.equals"
                             (<a href="COMMON-LISP____LIST.html">list</a> (<a href="JAVA____JEXPR-NAME.html">jexpr-name</a> "javaResult"))))
    (comp-block (<a href="JAVA____JBLOCK-LOCVAR.html">jblock-locvar</a> (<a href="JAVA____JTYPE-BOOLEAN.html">jtype-boolean</a>)
                               comp-var comp-expr)))
   (<a href="ACL2____MV.html">mv</a> arg-block
       ares-block call-block nil comp-block))))</pre> 
<p><b>Theorem: </b>jblockp-of-atj-gen-deep-test-code.arg-block</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
  jblockp-of-atj-gen-deep-test-code.arg-block
  (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?arg-block ?ares-block
            ?call-block ?jres-block ?comp-block)
        (<a href="JAVA____ATJ-GEN-DEEP-TEST-CODE.html">atj-gen-deep-test-code</a> test-function test-inputs
                                test-outputs comp-var java-class$)))
      (<a href="JAVA____JBLOCKP.html">jblockp</a> arg-block))
  :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>jblockp-of-atj-gen-deep-test-code.ares-block</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
  jblockp-of-atj-gen-deep-test-code.ares-block
  (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?arg-block ?ares-block
            ?call-block ?jres-block ?comp-block)
        (<a href="JAVA____ATJ-GEN-DEEP-TEST-CODE.html">atj-gen-deep-test-code</a> test-function test-inputs
                                test-outputs comp-var java-class$)))
      (<a href="JAVA____JBLOCKP.html">jblockp</a> ares-block))
  :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>jblockp-of-atj-gen-deep-test-code.call-block</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
  jblockp-of-atj-gen-deep-test-code.call-block
  (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?arg-block ?ares-block
            ?call-block ?jres-block ?comp-block)
        (<a href="JAVA____ATJ-GEN-DEEP-TEST-CODE.html">atj-gen-deep-test-code</a> test-function test-inputs
                                test-outputs comp-var java-class$)))
      (<a href="JAVA____JBLOCKP.html">jblockp</a> call-block))
  :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>jblockp-of-atj-gen-deep-test-code.jres-block</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
  jblockp-of-atj-gen-deep-test-code.jres-block
  (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?arg-block ?ares-block
            ?call-block ?jres-block ?comp-block)
        (<a href="JAVA____ATJ-GEN-DEEP-TEST-CODE.html">atj-gen-deep-test-code</a> test-function test-inputs
                                test-outputs comp-var java-class$)))
      (<a href="JAVA____JBLOCKP.html">jblockp</a> jres-block))
  :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>jblockp-of-atj-gen-deep-test-code.comp-block</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a>
  jblockp-of-atj-gen-deep-test-code.comp-block
  (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?arg-block ?ares-block
            ?call-block ?jres-block ?comp-block)
        (<a href="JAVA____ATJ-GEN-DEEP-TEST-CODE.html">atj-gen-deep-test-code</a> test-function test-inputs
                                test-outputs comp-var java-class$)))
      (<a href="JAVA____JBLOCKP.html">jblockp</a> comp-block))
  :rule-classes :rewrite)</pre> 

</body>
</html>
