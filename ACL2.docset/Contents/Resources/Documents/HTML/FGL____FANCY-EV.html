<html>
<head>
<meta charset="UTF-8">
<title>Fancy-ev</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=FGL____FANCY-EV">Click for Fancy-ev in the Full Manual</a></h3>

<p>Term evaluator used by FGL for syntaxp, bind-free, and syntax-bind interpretation.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(fancy-ev x alist reclimit interp-st state hard-errp aokp) 
  → 
(mv errmsg val new-interp-st new-state)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">x</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> x)</span>.</font>
</dd> 
  <dd>
<span class="tt">alist</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____SYMBOL-ALISTP.html">symbol-alistp</a> alist)</span>.</font>
</dd> 
  <dd>
<span class="tt">reclimit</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____NATP.html">natp</a> reclimit)</span>.</font>
</dd> 
  <dd>
<span class="tt">interp-st</span> — <font color="#606060">Guard <span class="v">(interp-st-bfrs-ok interp-st)</span>.</font>
</dd> 
 
</dl></div> 
 
<p>Fancy-ev is a term evaluator capable of running terms that include functions 
that access the FGL interpreter state and the ACL2 state, and even may modify 
the FGL interpreter state in limited ways.  It is used for evaluating syntaxp, 
bind-free, and syntax-bind forms in the FGL rewriter.</p> 
 
<p>Fancy-ev uses <a href="ACL2____MAGIC-EV-FNCALL.html">magic-ev-fncall</a> to allow it to run most functions that 
do not access stobjs.  When magic-ev-fncall fails, it can also expand function 
definitions and interpret their bodies.  But additionally, it calls an 
attachable function <span class="v">fancy-ev-primitive</span> to allow it to directly execute 
functions that access and/or modify the ACL2 state and FGL <span class="v">interp-st</span>.</p> 
 
<p>To allow a function <span class="v">my-fn</span> that accesses/updates <span class="v">interp-st</span> or 
<span class="v">state</span> to be executable by <span class="v">fancy-ev</span>, there are two steps:</p> 
 
<ul> 
 
<li>
<span class="v">(fancy-ev-add-primitive my-fn guard-form)</span> checks that the function 
is valid as a fancy-ev primitive and that guard-form suffices to check that the 
function's guard is satisfied when provided an interp-st satisfying 
<span class="v">interp-st-bfrs-ok</span>.  If so, the function/guard pair is recorded in the 
table <span class="v">fancy-ev-primitives</span> for later use by 
<span class="v">def-fancy-ev-primitives</span>.</li> 
 
<li>
<span class="v">(def-fancy-ev-primitives my-fancy-ev-primitives-impl)</span> defines a 
function named <span class="v">my-fancy-ev-primitives-impl</span> and attaches it to 
<span class="v">fancy-ev-primitive</span>.  The function is defined as a case statement on the 
input function symbol where for each function/guard pair in the 
<span class="v">fancy-ev-primitives</span> table, if the input function symbol matches that 
function, it checks the given guard form and then executes the function on the 
input arguments, returning its return value list and modified interp-st (if 
any).  This allows all functions that were added using 
<span class="v">fancy-ev-add-primitive</span> to be executed by <span class="v">fancy-ev</span>.</li> 
</ul> 
 

</body>
</html>
