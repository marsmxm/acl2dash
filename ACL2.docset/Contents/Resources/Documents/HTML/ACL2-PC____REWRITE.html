<html>
<head>
<meta charset="UTF-8">
<title>ACL2-pc::rewrite</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2-PC____REWRITE">Click for ACL2-pc::rewrite in the Full Manual</a></h3>

<p>(primitive) 
apply a rewrite rule</p><pre class="code">Examples:
(<a href="ACL2____REWRITE.html">rewrite</a> reverse-reverse)
   -- apply the rewrite rule `reverse-reverse'
(<a href="ACL2____REWRITE.html">rewrite</a> (:rewrite reverse-reverse))
   -- same as above
(<a href="ACL2____REWRITE.html">rewrite</a> 2)
   -- apply the second rewrite rule, as displayed by show-rewrites
rewrite
   -- apply the first rewrite rule, as displayed by show-rewrites
(<a href="ACL2____REWRITE.html">rewrite</a> transitivity-of-&lt; ((y 7)))
   -- apply the rewrite rule transitivity-of-&lt; with the substitution
      that associates 7 to the ``free variable'' y
(<a href="ACL2____REWRITE.html">rewrite</a> foo ((x 2) (y 3)) t)
   -- apply the rewrite rule foo by substituting 2 and 3 for free
      variables x and y, respectively, and also binding all other
      free variables possible by using the current context
      (hypotheses and governors)

General Form:
(<a href="ACL2____REWRITE.html">rewrite</a> &amp;optional rule-id substitution instantiate-free)</pre> 
 
 <p>Replace the current subterm with a new term by applying a <a href="ACL2____REWRITE.html">rewrite</a> or 
 <a href="ACL2____DEFINITION.html">definition</a> rule.  The replacement will be done according to the 
 information provided by the <span class="v">show-rewrites</span> (<span class="v">sr</span>) command.</p> 
 
 <p>If <span class="v">rule-id</span> is a positive integer <span class="v">n</span>, then the <span class="v">n</span>th rule as 
 displayed by <span class="v">show-rewrites</span> is the one that is applied.  If <span class="v">rule-id</span> 
 is <span class="v">nil</span> or is not supplied, then it is treated as the number 1. 
 Otherwise, <span class="v">rule-id</span> should be either a symbol or else a <span class="v">:rewrite</span> or 
 <span class="v">:definition</span> <a href="ACL2____RUNE.html">rune</a>.  If a symbol is supplied, then any 
 (<span class="v">:rewrite</span> or <span class="v">:definition</span>) rule of that name may be used.  We say 
 more about this, and describe the other optional arguments, below.</p> 
 
 <p>Consider first the following example.  Suppose that the current subterm is 
 <span class="v">(<a href="COMMON-LISP____REVERSE.html">reverse</a> (<a href="COMMON-LISP____REVERSE.html">reverse</a> y))</span> and that there is a <a href="ACL2____REWRITE.html">rewrite</a> rule called 
 <span class="v">reverse-reverse</span> of the form</p> 
 
 <pre class="code">(<a href="ACL2____IMPLIES.html">implies</a> (<a href="ACL2____TRUE-LISTP.html">true-listp</a> x)
         (<a href="COMMON-LISP____EQUAL.html">equal</a> (<a href="COMMON-LISP____REVERSE.html">reverse</a> (<a href="COMMON-LISP____REVERSE.html">reverse</a> x)) x)) .</pre> 
 
 <p>Then the instruction <span class="v">(<a href="ACL2____REWRITE.html">rewrite</a> reverse-reverse)</span> causes the current 
 subterm to be replaced by <span class="v">y</span> and creates a new goal with conclusion 
 <span class="v">(<a href="ACL2____TRUE-LISTP.html">true-listp</a> y)</span>.  An exception is that if the top-level hypotheses imply 
 <span class="v">(<a href="ACL2____TRUE-LISTP.html">true-listp</a> y)</span> using only ``trivial reasoning'' (more on this below), 
 then no new goal is created.</p> 
 
 <p>If the <span class="v">rule-id</span> argument is a number or is not supplied, then the 
 system will store an instruction of the form <span class="v">(<a href="ACL2____REWRITE.html">rewrite</a> name ...)</span>, where 
 <span class="v">name</span> is the name of a rewrite rule; this is in order to make it easier to 
 replay instructions when there have been changes to the history.  Except: 
 instead of the name (whether the name is supplied or calculated), the system 
 stores the <a href="ACL2____RUNE.html">rune</a> if there is any chance of ambiguity.  (Formally, 
 ``ambiguity'' here means that the rune being applied is of the form 
 <span class="v">(:rewrite name . index)</span>, where index is not <span class="v">nil</span>.)</p> 
 
 <p>Speaking in general, then, a <span class="v">rewrite</span> instruction works as follows:</p> 
 
 <p>First, a <a href="ACL2____REWRITE.html">rewrite</a> or <a href="ACL2____DEFINITION.html">definition</a> rule is selected according to 
 the arguments of the <span class="v">rewrite</span> instruction.  The selection is made as 
 explained under ``General Form'' above.</p> 
 
 <p>Next, the left-hand side of the rule is matched with the current subterm, 
 i.e., a substitution <span class="v">unify-subst</span> is found such that if one instantiates 
 the left-hand side of the rule with <span class="v">unify-subst</span>, then one obtains the 
 current subterm.  If this match fails, then the instruction fails.</p> 
 
 <p>Next, an attempt is made to relieve (discharge) the hypotheses, much as the 
 theorem prover relieves hypotheses except that there is no call to the 
 rewriter.  First, the substitution <span class="v">unify-subst</span> is extended with the 
 <span class="v">substitution</span> argument, which may bind free variables (see <a href="ACL2____FREE-VARIABLES.html">free-variables</a>).  Each hypothesis of the rule is then considered in turn, 
 from first to last.  For each hypothesis, first the current substitution is 
 applied, and then the system checks whether the hypothesis is ``clearly'' true 
 in the current context.  If there are variables in the hypotheses of the rule 
 that are not bound by the current substitution, then a weak attempt is made to 
 extend that substitution so that the hypothesis is present in the current 
 context (see <a href="ACL2-PC____HYPS.html">ACL2-pc::hyps</a>), much as would be done by the theorem 
 prover's rewriter.</p> 
 
 <p>If in the process above there are free variables (see <a href="ACL2____FREE-VARIABLES.html">free-variables</a>), but the interactive proof-builder can see how to bind them 
 to relieve all hypotheses, then it will do so in both the 
 <span class="v">show-rewrites</span> (<span class="v">sr</span>) and <span class="v">rewrite</span> commands.  But normally, if even 
 one hypothesis remains unrelieved, then no automatic extension of the 
 substitution is made.  Except, if <span class="v">instantiate-free</span> is not <span class="v">nil</span>, then 
 that extension to the substitution is kept.  (Technical note: in the case of 
 an unrelieved hypothesis and a non-<span class="v">nil</span> value of <span class="v">instantiate-free</span>, if 
 a <span class="tt"><a href="ACL2____BIND-FREE.html">bind-free</a></span> hypothesis produces a list of binding alists, then the 
 last of those alists is the one that is used to extend the substitution.)</p> 
 
 <p>Finally, the instruction is applied as follows.  The current subterm is 
 replaced by applying the final substitution described above to the right-hand 
 side of the selected rule.  And, one new subgoal is created for each 
 unrelieved hypothesis of the rule, whose top-level hypotheses are the 
 governors and top-level hypotheses of the current goal and whose conclusion 
 and current subterm are the instance, by that same final substitution, of that 
 unrelieved hypothesis.</p> 
 
 <p><b>Remark:</b> The substitution argument should be a list whose elements 
 have the form <span class="v">(variable term)</span>, where <span class="v">term</span> may contain 
 abbreviations.</p>
</body>
</html>
