<html>
<head>
<meta charset="UTF-8">
<title>Atc-gen-cfun-correct-thm</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=C____ATC-GEN-CFUN-CORRECT-THM">Click for Atc-gen-cfun-correct-thm in the Full Manual</a></h3>

<p>Generate the correctness theorem for a C function.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(atc-gen-cfun-correct-thm fn typed-formals 
                          type affect prec-fns prog-const 
                          fn-thms fn-fun-env-thm limit wrld) 
 
  → 
(mv local-events exported-events name)</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">fn</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn)</span>.</font>
</dd> 
  <dd>
<span class="tt">typed-formals</span> — <font color="#606060">Guard <span class="v">(<a href="C____ATC-SYMBOL-TYPE-ALISTP.html">atc-symbol-type-alistp</a> typed-formals)</span>.</font>
</dd> 
  <dd>
<span class="tt">type</span> — <font color="#606060">Guard <span class="v">(<a href="C____TYPEP.html">typep</a> type)</span>.</font>
</dd> 
  <dd>
<span class="tt">affect</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> affect)</span>.</font>
</dd> 
  <dd>
<span class="tt">prec-fns</span> — <font color="#606060">Guard <span class="v">(<a href="C____ATC-SYMBOL-FNINFO-ALISTP.html">atc-symbol-fninfo-alistp</a> prec-fns)</span>.</font>
</dd> 
  <dd>
<span class="tt">prog-const</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> prog-const)</span>.</font>
</dd> 
  <dd>
<span class="tt">fn-thms</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____SYMBOL-SYMBOL-ALISTP.html">symbol-symbol-alistp</a> fn-thms)</span>.</font>
</dd> 
  <dd>
<span class="tt">fn-fun-env-thm</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn-fun-env-thm)</span>.</font>
</dd> 
  <dd>
<span class="tt">limit</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> limit)</span>.</font>
</dd> 
  <dd>
<span class="tt">wrld</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PLIST-WORLDP.html">plist-worldp</a> wrld)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">local-events</span> — A <span class="tt"><a href="ACL2____PSEUDO-EVENT-FORM-LISTP.html">pseudo-event-form-listp</a></span>.</dd> 
<dd>
<span class="tt">exported-events</span> — A <span class="tt"><a href="ACL2____PSEUDO-EVENT-FORM-LISTP.html">pseudo-event-form-listp</a></span>.</dd> 
<dd>
<span class="tt">name</span> — A <span class="tt"><a href="COMMON-LISP____SYMBOLP.html">symbolp</a></span>.</dd> 
 
</dl></div> 
<p>In a computation state <span class="v">compst</span>, 
     the execution of the C function is expressed by calling <span class="tt"><a href="C____EXEC-FUN.html">exec-fun</a></span> 
     on the name of <span class="v">fn</span>, 
     the formals of <span class="v">fn</span>, 
     the computation state <span class="v">compst</span>, 
     the function environment for the translation unit, 
     and a suitably large limit (more on this below). 
     In this generated theorem, 
     the first result of <span class="tt"><a href="C____EXEC-FUN.html">exec-fun</a></span> is equated to 
     either (i) the first (possibly only) result of 
     a call of <span class="v">fn</span> when it represents a non-<span class="v">void</span> C function, 
     or (ii) <span class="v">nil</span> when <span class="v">fn</span> represents a <span class="v">void</span> C function. 
     The second result of <span class="tt"><a href="C____EXEC-FUN.html">exec-fun</a></span> is equated to 
     the computation state 
     calculated by <span class="tt"><a href="C____ATC-GEN-CFUN-FINAL-COMPUSTATE.html">atc-gen-cfun-final-compustate</a></span>.</p><p>The function <span class="v">fn</span> returns 
     an optional C result and zero or more modified arrays. 
     If it returns a C result (i.e. if the C function is not <span class="v">void</span>), 
     we bind a result variable to it; 
     this is <span class="v">nil</span> if the C function is <span class="v">void</span>. 
     We also bind the formals that are arrays 
     to the (other or only) results of <span class="v">fn</span> (if any).</p><p>The guard of <span class="v">fn</span> is used as hypothesis, 
     along with the fact that <span class="v">compst</span> is a computation state.</p><p>We use a variable for the function environment, 
     which we equate to the translation unit's function environment 
     in a hypothesis. 
     Note that, when we execute the ACL2 code in this function, 
     we do not have the function environment 
     of the generated translation unit yet, 
     because we generate these correctness theorems 
     along with the function definitions that form the translation unit 
     (currently we could generate these theorems after the translation unit, 
     but we prefer to do them at the same time for easier future extensions, 
     in which we may generate ``smaller'' theorems, 
     possibly for subterms/subexpressions/substatements). 
     Thus, we cannot use a quoted constant for the function environment here. 
     The reason why we introduce a variable and equate it in the hypothesis, 
     as opposed to using <span class="v">(<a href="C____INIT-FUN-ENV.html">init-fun-env</a> &lt;program&gt;)</span> 
     directly as argument of <span class="tt"><a href="C____EXEC-FUN.html">exec-fun</a></span>, 
     is that we want to use this theorem as a rewrite rule, 
     and using a variable makes the rule easier to match with, 
     in particular since the <span class="tt"><a href="C____INIT-FUN-ENV.html">init-fun-env</a></span> call gets rewritten 
     via the theorem about <span class="tt"><a href="C____INIT-FUN-ENV.html">init-fun-env</a></span>.</p><p>The limit passed to <span class="tt"><a href="C____EXEC-FUN.html">exec-fun</a></span> is a variable, 
     which is assumed (in a hypothesis of the generated theorem) 
     to be no smaller than a value 
     that is calculated by the code generation code 
     as sufficient to run <span class="tt"><a href="C____EXEC-FUN.html">exec-fun</a></span> to completion.</p><p>The proof is a symbolic execution of the generated translation unit, 
     which is a constant: see <a href="C____ATC-PROOF-SUPPORT.html">atc-proof-support</a>. 
     The proof is carried out in the theory that consists of 
     exactly the general rules listed there, 
     plus the definition of <span class="v">fn</span> (clearly), 
     plus the theorems about the results of the functions called by <span class="v">fn</span>, 
     plust the type prescriptions of the functions called by <span class="v">fn</span>, 
     plus the correctness theorems of the functions called by <span class="v">fn</span>; 
     here `called' means `directly called'. 
     During symbolic execution, the initial limit for <span class="v">fn</span> 
     is progressively decremented, 
     so by the time we get to functions called by <span class="v">fn</span> 
     it will have different symbolic values from the initial variable; 
     thus, we need to match that to the variable <span class="v">limit</span> 
     in the correctness theorems for the callees, 
     which are used as rewrite rules to turn calls of <span class="tt"><a href="C____EXEC-FUN.html">exec-fun</a></span> 
     into calls of the corresponding ACL2 functions. 
     These will thus match the calls in the definition of <span class="v">fn</span>, 
     and the called functions can stay disabled in the proof. 
     The theorems about the called functions' results 
     are needed to exclude, in the proof, the case that 
     these functions return errors. 
     The type prescriptions of the callable functions 
     are needed to discharge some proof subgoal that arise. 
     We also enable <span class="tt"><a href="COMMON-LISP____NOT.html">not</a></span>, 
     because without it we have found at least one case 
     in which some ACL2 heuristic defeats 
     what should be a propositional inference; 
     the issue is related to clausification, 
     and enabling <span class="tt"><a href="COMMON-LISP____NOT.html">not</a></span> seems to overcome the issue, 
     at least in that case we found.</p><p>Furthermore, we generate a <span class="v">:use</span> hint 
     to augment the theorem's formula with the guard theorem of <span class="v">fn</span>, 
     with the pointer arguments replaced by the dereferenced arrays. 
     This is critical to ensure that the symbolic execution of the C operators 
     does not split on the error cases: 
     the fact that <span class="v">fn</span> is guard-verified 
     ensures that <span class="tt"><a href="C____ADD-SINT-SINT.html">add-sint-sint</a></span> and similar functions are always called 
     on values such that the exact result fit into the type, 
     which is the same condition under which the dynamic semantics 
     does not error on the corresponding operators.</p><p>We also generate a hint to expand all lambdas (i.e. beta reduction). 
     We found at least one instance in which ACL2's heuristics 
     were preventing a lambda expansion that was preventing a proof.</p><p>Given that we pass correctness theorems for the called functions, 
     we expect that the opener rule for <span class="tt"><a href="C____EXEC-FUN.html">exec-fun</a></span> 
     only applies to the call of the function that this theorem refers to, 
     because the correctness theorems come later in the ACL2 history 
     and thus are tried first.</p><p>We use <span class="tt"><a href="ACL2____B_A2.html">b*</a></span> bindings in parts of the theorem 
     to make certain variable substitution. 
     Using bindings results in more readable formulas, in general, 
     than generating terms with the substitutions applied, 
     particularly if the same substituted variable occurs more than once. 
     With the bindings, we let ACL2 perform the substitution at proof time.</p><p>This theorem is not generated if <span class="v">:proofs</span> is <span class="v">nil</span>.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>atc-gen-cfun-correct-thm</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 atc-gen-cfun-correct-thm
 (fn typed-formals
     type affect prec-fns prog-const
     fn-thms fn-fun-env-thm limit wrld)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn)
                             (<a href="C____ATC-SYMBOL-TYPE-ALISTP.html">atc-symbol-type-alistp</a> typed-formals)
                             (<a href="C____TYPEP.html">typep</a> type)
                             (<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> affect)
                             (<a href="C____ATC-SYMBOL-FNINFO-ALISTP.html">atc-symbol-fninfo-alistp</a> prec-fns)
                             (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> prog-const)
                             (<a href="ACL2____SYMBOL-SYMBOL-ALISTP.html">symbol-symbol-alistp</a> fn-thms)
                             (<a href="COMMON-LISP____SYMBOLP.html">symbolp</a> fn-fun-env-thm)
                             (<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> limit)
                             (<a href="ACL2____PLIST-WORLDP.html">plist-worldp</a> wrld))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'atc-gen-cfun-correct-thm))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   ((name (<a href="COMMON-LISP____CDR.html">cdr</a> (<a href="ACL2____ASSOC-EQ.html">assoc-eq</a> fn fn-thms)))
    (formals (<a href="ACL2____STRIP-CARS.html">strip-cars</a> typed-formals))
    (compst-var (<a href="ACL2____GENVAR.html">genvar</a> 'atc "COMPST" nil formals))
    (fenv-var (<a href="ACL2____GENVAR.html">genvar</a> 'atc "FENV" nil formals))
    (limit-var (<a href="ACL2____GENVAR.html">genvar</a> 'atc "LIMIT" nil formals))
    (result-var (<a href="COMMON-LISP____IF.html">if</a> (<a href="C____TYPE-CASE.html">type-case</a> type :void)
                    nil (<a href="ACL2____GENVAR.html">genvar</a> 'atc "RESULT" nil formals)))
    ((<a href="ACL2____MV.html">mv</a> formals-bindings pointer-hyps
         pointer-subst instantiation)
     (<a href="C____ATC-GEN-OUTER-BINDINGS-AND-HYPS.html">atc-gen-outer-bindings-and-hyps</a> typed-formals compst-var nil))
    (diff-pointer-hyps
         (<a href="C____ATC-GEN-DIFF-ADDRESS-HYPS.html">atc-gen-diff-address-hyps</a> (<a href="ACL2____STRIP-CDRS.html">strip-cdrs</a> pointer-subst)))
    (hyps
     (<a href="COMMON-LISP____CONS.html">cons</a>
      'and
      (<a href="COMMON-LISP____CONS.html">cons</a>
       (<a href="COMMON-LISP____CONS.html">cons</a> 'compustatep
             (<a href="COMMON-LISP____CONS.html">cons</a> compst-var 'nil))
       (<a href="COMMON-LISP____CONS.html">cons</a>
        (<a href="COMMON-LISP____CONS.html">cons</a> 'equal
              (<a href="COMMON-LISP____CONS.html">cons</a> fenv-var
                    (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'init-fun-env
                                (<a href="COMMON-LISP____CONS.html">cons</a> prog-const 'nil))
                          'nil)))
        (<a href="COMMON-LISP____CONS.html">cons</a>
         (<a href="COMMON-LISP____CONS.html">cons</a> 'integerp (<a href="COMMON-LISP____CONS.html">cons</a> limit-var 'nil))
         (<a href="COMMON-LISP____CONS.html">cons</a>
          (<a href="COMMON-LISP____CONS.html">cons</a> '&gt;=
                (<a href="COMMON-LISP____CONS.html">cons</a> limit-var (<a href="COMMON-LISP____CONS.html">cons</a> limit 'nil)))
          (<a href="COMMON-LISP____APPEND.html">append</a>
              pointer-hyps
              (<a href="COMMON-LISP____APPEND.html">append</a> diff-pointer-hyps
                      (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="ACL2____UNTRANSLATE.html">untranslate</a> (<a href="ACL2____UGUARD_B2.html">uguard+</a> fn wrld) nil wrld)
                            'nil)))))))))
    (exec-fun-args (<a href="ACL2____FSUBLIS-VAR-LST.html">fsublis-var-lst</a> pointer-subst formals))
    (fn-results (<a href="COMMON-LISP____APPEND.html">append</a> (<a href="COMMON-LISP____IF.html">if</a> (<a href="C____TYPE-CASE.html">type-case</a> type :void)
                            nil (<a href="COMMON-LISP____LIST.html">list</a> result-var))
                        affect))
    (fn-binder (<a href="COMMON-LISP____IF.html">if</a> (<a href="COMMON-LISP____ENDP.html">endp</a> (<a href="COMMON-LISP____CDR.html">cdr</a> fn-results))
                   (<a href="COMMON-LISP____CAR.html">car</a> fn-results)
                   (<a href="COMMON-LISP____CONS.html">cons</a> 'mv fn-results)))
    (final-compst (<a href="C____ATC-GEN-CFUN-FINAL-COMPUSTATE.html">atc-gen-cfun-final-compustate</a>
                       affect pointer-subst compst-var))
    (concl
     (<a href="COMMON-LISP____CONS.html">cons</a>
      'equal
      (<a href="COMMON-LISP____CONS.html">cons</a>
       (<a href="COMMON-LISP____CONS.html">cons</a>
         'exec-fun
         (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'ident
                     (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____SYMBOL-NAME.html">symbol-name</a> fn) 'nil))
               (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'list exec-fun-args)
                     (<a href="COMMON-LISP____CONS.html">cons</a> compst-var
                           (<a href="COMMON-LISP____CONS.html">cons</a> fenv-var (<a href="COMMON-LISP____CONS.html">cons</a> limit-var 'nil))))))
       (<a href="COMMON-LISP____CONS.html">cons</a>
        (<a href="COMMON-LISP____CONS.html">cons</a>
         'b*
         (<a href="COMMON-LISP____CONS.html">cons</a>
             (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> fn-binder (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> fn formals) 'nil))
                   'nil)
             (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'mv
                         (<a href="COMMON-LISP____CONS.html">cons</a> result-var (<a href="COMMON-LISP____CONS.html">cons</a> final-compst 'nil)))
                   'nil)))
        'nil))))
    (<a href="ACL2____FORMULA.html">formula</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'b*
                   (<a href="COMMON-LISP____CONS.html">cons</a> formals-bindings
                         (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'implies
                                     (<a href="COMMON-LISP____CONS.html">cons</a> hyps (<a href="COMMON-LISP____CONS.html">cons</a> concl 'nil)))
                               'nil))))
    (called-fns (<a href="ACL2____ALL-FNNAMES.html">all-fnnames</a> (<a href="ACL2____UBODY_B2.html">ubody+</a> fn wrld)))
    (result-thms
       (<a href="C____ATC-SYMBOL-FNINFO-ALIST-TO-RESULT-THMS.html">atc-symbol-fninfo-alist-to-result-thms</a> prec-fns called-fns))
    (correct-thms
      (<a href="C____ATC-SYMBOL-FNINFO-ALIST-TO-CORRECT-THMS.html">atc-symbol-fninfo-alist-to-correct-thms</a> prec-fns called-fns))
    (measure-thms (<a href="C____ATC-SYMBOL-FNINFO-ALIST-TO-MEASURE-NAT-THMS.html">atc-symbol-fninfo-alist-to-measure-nat-thms</a>
                       prec-fns called-fns))
    (type-prescriptions
         (<a href="ACL2____LOOP_42.html">loop$</a> for called in (<a href="ACL2____STRIP-CARS.html">strip-cars</a> prec-fns)
                collect (<a href="COMMON-LISP____CONS.html">cons</a> ':t (<a href="COMMON-LISP____CONS.html">cons</a> called 'nil))))
    (hints
     (<a href="COMMON-LISP____CONS.html">cons</a>
      (<a href="COMMON-LISP____CONS.html">cons</a>
       '"Goal"
       (<a href="COMMON-LISP____CONS.html">cons</a>
        ':in-theory
        (<a href="COMMON-LISP____CONS.html">cons</a>
         (<a href="COMMON-LISP____CONS.html">cons</a>
          'union-theories
          (<a href="COMMON-LISP____CONS.html">cons</a>
           (<a href="COMMON-LISP____CONS.html">cons</a> 'theory
                 (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'quote (<a href="COMMON-LISP____CONS.html">cons</a> 'atc-all-rules 'nil))
                       'nil))
           (<a href="COMMON-LISP____CONS.html">cons</a>
            (<a href="COMMON-LISP____CONS.html">cons</a>
             'quote
             (<a href="COMMON-LISP____CONS.html">cons</a>
              (<a href="COMMON-LISP____CONS.html">cons</a>
               'not
               (<a href="COMMON-LISP____CONS.html">cons</a>
                fn
                (<a href="COMMON-LISP____APPEND.html">append</a>
                 type-prescriptions
                 (<a href="COMMON-LISP____APPEND.html">append</a>
                    result-thms
                    (<a href="COMMON-LISP____APPEND.html">append</a> correct-thms
                            (<a href="COMMON-LISP____APPEND.html">append</a> measure-thms
                                    (<a href="COMMON-LISP____CONS.html">cons</a> fn-fun-env-thm 'nil)))))))
              'nil))
            'nil)))
         (<a href="COMMON-LISP____CONS.html">cons</a>
             ':use
             (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> ':instance
                         (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> ':guard-theorem (<a href="COMMON-LISP____CONS.html">cons</a> fn 'nil))
                               (<a href="COMMON-LISP____CONS.html">cons</a> ':extra-bindings-ok
                                     instantiation)))
                   (<a href="COMMON-LISP____CONS.html">cons</a> ':expand
                         (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> ':lambdas 'nil) 'nil)))))))
      'nil))
    ((<a href="ACL2____MV.html">mv</a> local-event exported-event)
     (<a href="ACL2____EVMAC-GENERATE-DEFTHM.html">evmac-generate-defthm</a> name
                            :formula formula
                            :hints hints
                            :enable nil)))
   (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP____LIST.html">list</a> local-event)
       (<a href="COMMON-LISP____LIST.html">list</a> exported-event)
       name))))</pre> 

</body>
</html>
