<html>
<head>
<meta charset="UTF-8">
<title>Context-message-pair</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____CONTEXT-MESSAGE-PAIR">Click for Context-message-pair in the Full Manual</a></h3>

<p>A common ACL2 programming idiom: <a href="ACL2____ERROR-TRIPLE.html">error-triple</a>s without <a href="ACL2____STATE.html">state</a></p><p><i>Context-message pairs</i> are of the form <span class="v">(<a href="ACL2____MV.html">mv</a> erp val)</span>, 
 where there are the following two cases: the first indicates a successful 
 computation and the second indicates an error.</p> 
 
 <ul> 
 
 <li>
<b>Normal case</b>: <span class="v">erp</span> is <span class="v">nil</span> and <span class="v">val</span> is what we call the 
 ``value'' of that context-message pair.</li> 
 
 <li>
<b>Error case</b>: <span class="v">erp</span> is not <span class="v">nil</span>.  <span class="v">Val</span> may be <span class="v">nil</span>; 
 otherwise <span class="v">val</span> is a message (see <a href="ACL2____MSGP.html">msgp</a>) suitable for printing with 
 <span class="tt"><a href="ACL2____FMT.html">fmt</a></span> and related functions using the <span class="v">~@</span> directive, and <span class="v">erp</span> is 
 a context suitable for error messages (see <a href="ACL2____CTX.html">ctx</a>).  A convention 
 generally observed (for example, by ACL2 system function 
 <span class="v">cmp-to-error-triple</span>, which converts a context-message pair to an <a href="ACL2____ERROR-TRIPLE.html">error-triple</a> that may be printed in the error case) is when <span class="v">erp</span> and 
 <span class="v">val</span> are both non-<span class="v">nil</span>, then <span class="v">erp</span> is not <span class="v">t</span>.</li> 
 
 </ul> 
 
 <p>To see how this works let us consider the ACL2 source function, 
 <span class="v">translate-cmp</span>, whose input is a user-level (``untranslated'') term as 
 input and returns a context-message pair.  In the non-error case, the value 
 returned is the internal (``translated'') form of that input; see <a href="ACL2____TERM.html">term</a>. 
 The log below first shows a successful translation, returning multiple values 
 <span class="v">(<a href="ACL2____MV.html">mv</a> nil (<a href="ACL2____BINARY-_B2.html">binary-+</a> x '3))</span>, thus illustrating the ``Normal case'' above, 
 where the first value returned (the error indicator) is <span class="v">nil</span> and the 
 second is the value of the pair.  The second example in the log shows an error 
 case returning a context and a message.  Don't worry about the various 
 arguments of <span class="v">translate-cmp</span>; the examples are merely to illustrate 
 programming with context-message pairs, not to explain <span class="v">translate-cmp</span>!</p> 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____TRANSLATE-CMP.html">translate-cmp</a> '(<a href="COMMON-LISP_____B2.html">+</a> x 3)
                      t t t 'top (<a href="ACL2____W.html">w</a> state)
                      (<a href="ACL2____DEFAULT-STATE-VARS.html">default-state-vars</a> state))
(NIL (<a href="ACL2____BINARY-_B2.html">BINARY-+</a> X '3))
ACL2 !&gt;(<a href="ACL2____TRANSLATE-CMP.html">translate-cmp</a> '(<a href="COMMON-LISP____QUOTE.html">quote</a> 3 4)
                      t t t 'top (<a href="ACL2____W.html">w</a> state)
                      (<a href="ACL2____DEFAULT-STATE-VARS.html">default-state-vars</a> state))
(<a href="ACL2____TOP.html">TOP</a> ("The proper form of a quoted constant is (<a href="COMMON-LISP____QUOTE.html">quote</a> x), but ~
                     ~x0 is not of this form."
          (#0 QUOTE 3 4)))
ACL2 !&gt;</pre> 
 
 <p>The following macros are useful when programming with context-message 
 pairs.</p> 
 
 <ul> 
 
 <li>
<span class="v">(<a href="ACL2____VALUE-CMP.html">value-cmp</a> x)</span>: same as <span class="v">(<a href="ACL2____MV.html">mv</a> nil x)</span>.  Example: 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____VALUE-CMP.html">value-cmp</a> (<a href="COMMON-LISP_____A2.html">*</a> 3 4))
(NIL 12)
ACL2 !&gt;</pre>
</li> 
 
 <li>
<span class="v">(<a href="ACL2____ER-CMP.html">er-cmp</a> ctx str &amp;rest args)</span>: Return <span class="v">(<a href="ACL2____MV.html">mv</a> ctx msg)</span> where <span class="v">msg</span> 
 is formed from <span class="v">str</span> and <span class="v">args</span>.  Example: 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____ER-CMP.html">er-cmp</a> 'example
               "I don't like 3-element lists like ~x0.~|"
               (<a href="COMMON-LISP____MAKE-LIST.html">make-list</a> 3))
(EXAMPLE ("I don't like 3-element lists like ~x0.~|" (#0 NIL NIL NIL)))
ACL2 !&gt;(<a href="ACL2____MV-LET.html">mv-let</a> (<a href="ACL2____CTX.html">ctx</a> msg)
         (<a href="ACL2____ER-CMP.html">er-cmp</a> 'example
                 "I don't like 3-element lists like ~x0.~|"
                 (<a href="COMMON-LISP____MAKE-LIST.html">make-list</a> 3))
         (<a href="ACL2____FMX.html">fmx</a> "Error in ~x0: ~@1" ctx msg))
Error in EXAMPLE: I don't like 3-element lists like (NIL NIL NIL).
(0 &lt;state&gt;)
ACL2 !&gt;</pre>
</li> 
 
 <li>
<span class="v">(<a href="ACL2____ER-LET_A2-CMP.html">er-let*-cmp</a> alist body)</span>: Analogue of <span class="tt"><a href="ACL2____ER-LET_A2.html">er-let*</a></span> for 
 context-message pairs.  So, it evaluates the bindings in <span class="v">alist</span> much as 
 <span class="tt"><a href="COMMON-LISP____LET_A2.html">let*</a></span>-bindings would be evaluated, but where each expression should 
 return a context-message pair and so should <span class="v">body</span>.  If any of those 
 expression evaluations returns a pair with a non-nil first value, then that 
 pair is returned.  Otherwise, <span class="v">body</span> — which should return a 
 context-message pair — is evaluated with respect to the resulting 
 bindings.  Examples (refer to previous examples that use <span class="v">translate-cmp</span>): 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____ER-LET_A2-CMP.html">er-let*-cmp</a> ((x (<a href="ACL2____VALUE-CMP.html">value-cmp</a> '(<a href="COMMON-LISP_____B2.html">+</a> x 3)))
                     (val (<a href="ACL2____TRANSLATE-CMP.html">translate-cmp</a> x
                                         t t t 'top (<a href="ACL2____W.html">w</a> state)
                                         (<a href="ACL2____DEFAULT-STATE-VARS.html">default-state-vars</a> state)))
                     (y (<a href="ACL2____VALUE-CMP.html">value-cmp</a> (<a href="COMMON-LISP____LIST.html">list</a> :term val))))
                    (<a href="ACL2____VALUE-CMP.html">value-cmp</a> (<a href="COMMON-LISP____LIST.html">list</a> :result y)))
(NIL (:RESULT (:TERM (<a href="ACL2____BINARY-_B2.html">BINARY-+</a> X '3))))
ACL2 !&gt;(<a href="ACL2____ER-LET_A2-CMP.html">er-let*-cmp</a> ((x (<a href="ACL2____VALUE-CMP.html">value-cmp</a> '(<a href="COMMON-LISP____QUOTE.html">quote</a> 3 4)))
                     (val (<a href="ACL2____TRANSLATE-CMP.html">translate-cmp</a> x
                                         t t t 'top (<a href="ACL2____W.html">w</a> state)
                                         (<a href="ACL2____DEFAULT-STATE-VARS.html">default-state-vars</a> state)))
                     (y (<a href="ACL2____VALUE-CMP.html">value-cmp</a> (<a href="COMMON-LISP____LIST.html">list</a> :term val))))
                    (<a href="ACL2____VALUE-CMP.html">value-cmp</a> (<a href="COMMON-LISP____LIST.html">list</a> :result y)))
(<a href="ACL2____TOP.html">TOP</a> ("The proper form of a quoted constant is (<a href="COMMON-LISP____QUOTE.html">quote</a> x), but ~
                     ~x0 is not of this form."
          (#0 QUOTE 3 4)))
ACL2 !&gt;</pre>
</li> 
 
 <li>
<span class="v">(<a href="ACL2____ER-PROGN-CMP.html">er-progn-cmp</a> form1 ... formk)</span>: Each <span class="v">formi</span> should evaluate to a 
 context-message pair.  If any of these evaluations produces a pair with a 
 non-<span class="v">nil</span> first component (thus indicating an error), return that pair. 
 Otherwise return the context-message pair produced by evaluating <span class="v">formk</span>. 
 Examples: 
 
 <pre class="code">ACL2 !&gt;(<a href="ACL2____ER-PROGN-CMP.html">er-progn-cmp</a> (<a href="ACL2____VALUE-CMP.html">value-cmp</a> (<a href="COMMON-LISP_____B2.html">+</a> 2 8))
                     (<a href="ACL2____ER-CMP.html">er-cmp</a> 'top "Ouch")
                     (<a href="ACL2____VALUE-CMP.html">value-cmp</a> (<a href="COMMON-LISP_____A2.html">*</a> 3 4)))
(<a href="ACL2____TOP.html">TOP</a> ("Ouch"))
ACL2 !&gt;(<a href="ACL2____ER-PROGN-CMP.html">er-progn-cmp</a> (<a href="ACL2____VALUE-CMP.html">value-cmp</a> (<a href="COMMON-LISP_____B2.html">+</a> 2 8))
                     (<a href="ACL2____VALUE-CMP.html">value-cmp</a> (<a href="COMMON-LISP_____A2.html">*</a> 3 4)))
(NIL 12)
ACL2 !&gt;</pre>
</li> 
 
 </ul>
</body>
</html>
