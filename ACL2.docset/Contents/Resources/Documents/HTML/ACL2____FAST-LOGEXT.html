<html>
<head>
<meta charset="UTF-8">
<title>Fast-logext</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ACL2____FAST-LOGEXT">Click for Fast-logext in the Full Manual</a></h3>

<p><span class="tt">(fast-logext n x)</span> interprets the least significant <span class="v">n</span> bits of 
the integer <span class="v">x</span> as a signed number of width <span class="v">n</span>.</p><p>This is logically identical to <a href="ACL2____LOGEXT.html">logext</a>.  But, for better 
performance we adopt a method from Sean Anderson's <a href="http://graphics.stanford.edu/~seander/bithacks.html" target="_blank"><nobr>bit twiddling 
hacks<img src="../Icon_External_Link.png" title="External link to http://graphics.stanford.edu/~seander/bithacks.html"></nobr></a> page, viz:</p> 
 
<pre class="code">unsigned n;                  // number of bits representing the number in x
int x;                       // sign extend this n-bit number to r
int r;                       // resulting sign-extended number
int const m = 1U &lt;&lt; (n - 1); // mask can be pre-computed if n is fixed
x = x &amp; ((1U &lt;&lt; n) - 1);     // (Skip this if bits in x above position n are already zero.)
r = (x ^ m) - m;</pre> 
 
<p><span class="v">fast-logext</span> is actually a macro.  Generally it expands into a call of 
<span class="v">fast-logext-fn</span>, which carries out the above computation.  But in the 
common cases where <span class="v">n</span> is explicitly 8, 16, 32, or 64, it instead expands 
into a call of a specialized, inlined function.</p> 
 
<p><b>Macro: </b>fast-logext</p><pre class="code">(<a href="COMMON-LISP____DEFMACRO.html">defmacro</a> fast-logext (n x)
          (<a href="COMMON-LISP____COND.html">cond</a> ((<a href="COMMON-LISP____EQL.html">eql</a> n 8)
                 (<a href="COMMON-LISP____CONS.html">cons</a> 'fast-logext8 (<a href="COMMON-LISP____CONS.html">cons</a> x 'nil)))
                ((<a href="COMMON-LISP____EQL.html">eql</a> n 16)
                 (<a href="COMMON-LISP____CONS.html">cons</a> 'fast-logext16 (<a href="COMMON-LISP____CONS.html">cons</a> x 'nil)))
                ((<a href="COMMON-LISP____EQL.html">eql</a> n 32)
                 (<a href="COMMON-LISP____CONS.html">cons</a> 'fast-logext32 (<a href="COMMON-LISP____CONS.html">cons</a> x 'nil)))
                ((<a href="COMMON-LISP____EQL.html">eql</a> n 64)
                 (<a href="COMMON-LISP____CONS.html">cons</a> 'fast-logext64 (<a href="COMMON-LISP____CONS.html">cons</a> x 'nil)))
                (t (<a href="COMMON-LISP____CONS.html">cons</a> 'fast-logext-fn
                         (<a href="COMMON-LISP____CONS.html">cons</a> n (<a href="COMMON-LISP____CONS.html">cons</a> x 'nil))))))</pre> 
 

</body>
</html>
