<html>
<head>
<meta charset="UTF-8">
<title>Def-parse-gen-code-for-alternation</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=ABNF____DEF-PARSE-GEN-CODE-FOR-ALTERNATION">Click for Def-parse-gen-code-for-alternation in the Full Manual</a></h3>

<p>Generate code to parse an instance of an ABNF alternation.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(def-parse-gen-code-for-alternation 
     alt order fn-name 
     group-fns option-fns repetition-fns) 
 
  → 
code</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">alt</span> — <font color="#606060">Guard <span class="v">(<a href="ABNF____ALTERNATIONP.html">alternationp</a> alt)</span>.</font>
</dd> 
  <dd>
<span class="tt">order</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____POS-LISTP.html">pos-listp</a> order)</span>.</font>
</dd> 
  <dd>
<span class="tt">fn-name</span> — <font color="#606060">Guard <span class="v">(<a href="COMMON-LISP____SYMBOLP.html">common-lisp::symbolp</a> fn-name)</span>.</font>
</dd> 
  <dd>
<span class="tt">group-fns</span> — <font color="#606060">Guard <span class="v">(<a href="ABNF____ALTERNATION-SYMBOL-ALISTP.html">alternation-symbol-alistp</a> group-fns)</span>.</font>
</dd> 
  <dd>
<span class="tt">option-fns</span> — <font color="#606060">Guard <span class="v">(<a href="ABNF____ALTERNATION-SYMBOL-ALISTP.html">alternation-symbol-alistp</a> option-fns)</span>.</font>
</dd> 
  <dd>
<span class="tt">repetition-fns</span> — <font color="#606060">Guard <span class="v">(<a href="ABNF____REPETITION-SYMBOL-ALISTP.html">repetition-symbol-alistp</a> repetition-fns)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">code</span> — <font color="#606060">Type <span class="v">(<a href="ACL2____TRUE-LISTP.html">true-listp</a> code)</span>.</font>
</dd> 
 
</dl></div> 
<p>After possibly reordering the alternatives, 
     we generate code that tries every alternative. 
     We use variables <span class="v">treess&lt;index&gt;</span> to store 
     either the resulting list of lists of trees or an error. 
     For each alternative, we generate code for the concatenation 
     and bind the result to <span class="v">treess&lt;index&gt;</span>, 
     returning as soon as we get a non-error. 
     If all the alternatives give an error, 
     we return an error that includes all the errors for the alternatives: 
     this is the reason for using and incremnting indices, 
     i.e. so that we can combine them in case of error, 
     not because we want to combine them in case of success.</p><p>Note that for each attempt to parse an alternative 
     we bind the variable <span class="v">input1</span> to the remaining input, 
     not the variable <span class="v">input</span>. 
     This is because we need to backtrack in case of failure, 
     discarding <span class="v">input1</span> and going back to the previous input.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>def-parse-gen-code-for-alternation-aux</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 def-parse-gen-code-for-alternation-aux
 (alt index fn-name
      group-fns option-fns repetition-fns)
 (<a href="COMMON-LISP____DECLARE.html">declare</a>
     (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="ABNF____ALTERNATIONP.html">alternationp</a> alt)
                        (<a href="ACL2____NATP.html">natp</a> index)
                        (<a href="COMMON-LISP____SYMBOLP.html">common-lisp::symbolp</a> fn-name)
                        (<a href="ABNF____ALTERNATION-SYMBOL-ALISTP.html">alternation-symbol-alistp</a> group-fns)
                        (<a href="ABNF____ALTERNATION-SYMBOL-ALISTP.html">alternation-symbol-alistp</a> option-fns)
                        (<a href="ABNF____REPETITION-SYMBOL-ALISTP.html">repetition-symbol-alistp</a> repetition-fns))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'def-parse-gen-code-for-alternation-aux))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   (((when (<a href="COMMON-LISP____ENDP.html">endp</a> alt)) (<a href="ACL2____MV.html">mv</a> nil nil))
    (treess-index (<a href="ACL2____ADD-SUFFIX.html">add-suffix</a> 'treess
                              (<a href="STR____NAT-TO-DEC-STRING.html">str::nat-to-dec-string</a> index)))
    (code
     (<a href="COMMON-LISP____CONS.html">cons</a>
      (<a href="COMMON-LISP____CONS.html">cons</a>
         (<a href="COMMON-LISP____CONS.html">cons</a> 'mv (<a href="COMMON-LISP____CONS.html">cons</a> treess-index '(input1)))
         (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'b*
                     (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="ABNF____DEF-PARSE-GEN-CODE-FOR-CONCATENATION.html">def-parse-gen-code-for-concatenation</a>
                                (<a href="COMMON-LISP____CAR.html">car</a> alt)
                                fn-name
                                group-fns option-fns repetition-fns)
                           '((<a href="ACL2____MV.html">mv</a> treess input))))
               'nil))
      (<a href="COMMON-LISP____CONS.html">cons</a>
       (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'when
                   (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'not
                               (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'resulterrp
                                           (<a href="COMMON-LISP____CONS.html">cons</a> treess-index 'nil))
                                     'nil))
                         'nil))
             (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'mv (<a href="COMMON-LISP____CONS.html">cons</a> treess-index '(input1)))
                   'nil))
       'nil)))
    ((<a href="ACL2____MV.html">mv</a> more-code vars)
     (def-parse-gen-code-for-alternation-aux
          (<a href="COMMON-LISP____CDR.html">cdr</a> alt)
          (<a href="COMMON-LISP____1_B2.html">1+</a> index)
          fn-name
          group-fns option-fns repetition-fns)))
   (<a href="ACL2____MV.html">mv</a> (<a href="COMMON-LISP____APPEND.html">append</a> code more-code)
       (<a href="COMMON-LISP____CONS.html">cons</a> treess-index vars)))))</pre> 
<p><b>Theorem: </b>true-listp-of-def-parse-gen-code-for-alternation-aux.code</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> true-listp-of-def-parse-gen-code-for-alternation-aux.code
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?code ?vars)
              (def-parse-gen-code-for-alternation-aux
                   alt index fn-name
                   group-fns option-fns repetition-fns)))
            (<a href="ACL2____TRUE-LISTP.html">true-listp</a> code))
        :rule-classes :rewrite)</pre> 
<p><b>Theorem: </b>symbol-listp-of-def-parse-gen-code-for-alternation-aux.vars</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> symbol-listp-of-def-parse-gen-code-for-alternation-aux.vars
        (<a href="ACL2____B_A2.html">b*</a> (((<a href="ACL2____MV.html">mv</a> ?code ?vars)
              (def-parse-gen-code-for-alternation-aux
                   alt index fn-name
                   group-fns option-fns repetition-fns)))
            (<a href="ACL2____SYMBOL-LISTP.html">symbol-listp</a> vars))
        :rule-classes :rewrite)</pre> 
<p><b>Function: </b>def-parse-gen-code-for-alternation</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 def-parse-gen-code-for-alternation
 (alt order fn-name
      group-fns option-fns repetition-fns)
 (<a href="COMMON-LISP____DECLARE.html">declare</a>
     (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="ABNF____ALTERNATIONP.html">alternationp</a> alt)
                        (<a href="ACL2____POS-LISTP.html">pos-listp</a> order)
                        (<a href="COMMON-LISP____SYMBOLP.html">common-lisp::symbolp</a> fn-name)
                        (<a href="ABNF____ALTERNATION-SYMBOL-ALISTP.html">alternation-symbol-alistp</a> group-fns)
                        (<a href="ABNF____ALTERNATION-SYMBOL-ALISTP.html">alternation-symbol-alistp</a> option-fns)
                        (<a href="ABNF____REPETITION-SYMBOL-ALISTP.html">repetition-symbol-alistp</a> repetition-fns))))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'def-parse-gen-code-for-alternation))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   (((when (<a href="COMMON-LISP____ENDP.html">endp</a> alt))
     (<a href="ACL2____RAISE.html">raise</a> "Empty alternation."))
    ((unless (<a href="COMMON-LISP____AND.html">and</a> (<a href="COMMON-LISP_____D3.html">=</a> (<a href="ACL2____LEN.html">len</a> order) (<a href="ACL2____LEN.html">len</a> alt))
                  (<a href="ABNF____DEF-PARSE-ORDER-PERMUTATIONP.html">def-parse-order-permutationp</a> order)))
     (<a href="ACL2____RAISE.html">raise</a> "Bad permutation ~x0." order))
    (alt (<a href="ABNF____DEF-PARSE-REORDER-ALTERNATION.html">def-parse-reorder-alternation</a> alt order))
    ((<a href="ACL2____MV.html">mv</a> code vars)
     (def-parse-gen-code-for-alternation-aux
          alt 1 fn-name
          group-fns option-fns repetition-fns)))
   (<a href="COMMON-LISP____CONS.html">cons</a>
    'b*
    (<a href="COMMON-LISP____CONS.html">cons</a>
     code
     (<a href="COMMON-LISP____CONS.html">cons</a>
      (<a href="COMMON-LISP____CONS.html">cons</a>
       'mv
       (<a href="COMMON-LISP____CONS.html">cons</a>
        (<a href="COMMON-LISP____CONS.html">cons</a>
         'err
         (<a href="COMMON-LISP____CONS.html">cons</a>
          (<a href="COMMON-LISP____CONS.html">cons</a>
               'list
               (<a href="COMMON-LISP____CONS.html">cons</a> ':found
                     (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'list vars)
                           (<a href="COMMON-LISP____CONS.html">cons</a> ':required
                                 (<a href="COMMON-LISP____CONS.html">cons</a> (<a href="COMMON-LISP____CONS.html">cons</a> 'quote (<a href="COMMON-LISP____CONS.html">cons</a> alt 'nil))
                                       'nil)))))
          'nil))
        '(input)))
      'nil))))))</pre> 
<p><b>Theorem: </b>true-listp-of-def-parse-gen-code-for-alternation</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> true-listp-of-def-parse-gen-code-for-alternation
        (<a href="ACL2____B_A2.html">b*</a> ((code (<a href="ABNF____DEF-PARSE-GEN-CODE-FOR-ALTERNATION.html">def-parse-gen-code-for-alternation</a>
                        alt order fn-name
                        group-fns option-fns repetition-fns)))
            (<a href="ACL2____TRUE-LISTP.html">true-listp</a> code))
        :rule-classes :rewrite)</pre> 

</body>
</html>
