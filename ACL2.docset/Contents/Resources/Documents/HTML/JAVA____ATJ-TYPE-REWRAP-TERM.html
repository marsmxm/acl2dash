<html>
<head>
<meta charset="UTF-8">
<title>Atj-type-rewrap-term</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=JAVA____ATJ-TYPE-REWRAP-TERM">Click for Atj-type-rewrap-term in the Full Manual</a></h3>

<p>Re-wrap an ACL2 term with a type conversion function.</p><div class="box"><dl> 
  <dt>Signature</dt>
<dt><pre class="code">(atj-type-rewrap-term term dst-types) → rewrapped-term</pre></dt>  <dt>Arguments</dt>  <dd>
<span class="tt">term</span> — <font color="#606060">Guard <span class="v">(<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> term)</span>.</font>
</dd> 
  <dd>
<span class="tt">dst-types</span> — <font color="#606060">Guard <span class="v">(<a href="JAVA____ATJ-TYPE-LISTP.html">atj-type-listp</a> dst-types)</span>.</font>
</dd> 
<dt>Returns</dt>
<dd>
<span class="tt">rewrapped-term</span> — <font color="#606060">Type <span class="v">(<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> rewrapped-term)</span>.</font>
</dd> 
 
</dl></div> 
<p>This is used when a term is 
     preliminarily wrapped with a type conversion function, 
     but its wrapping is then finalized with a different conversion function. 
     So here we replace the wrapper.</p><p>We only change the destination types of the conversion function. 
     The source types are unchanged.</p><p>We also check that the new conversion is allowed. 
     We stop with an error if that is not the case; 
     as in <span class="tt"><a href="JAVA____ATJ-TYPE-WRAP-TERM.html">atj-type-wrap-term</a></span>, 
     this is a ``deep'' input validation error.</p><p>If the term is a call of <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span>, 
     we recursively re-wrap its branches, 
     which therefore will return the same types. 
     Then we wrap the <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span> call 
     with the identity conversion. 
     The reason for descending into the <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span> branches 
     is that (the least upper bound of) the types of the <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span> branches 
     are used, in the translation to Java, 
     to determine the types of the Java local variables 
     that store the result of (one or the other) branch. 
     In order to allow the mapping of ATJ subtypes to Java non-subtypes, 
     we need to push the conversions into the <span class="tt"><a href="COMMON-LISP____IF.html">if</a></span> branches.</p> 
 
<h3>Definitions and Theorems</h3><p><b>Function: </b>atj-type-rewrap-term</p><pre class="code">(<a href="COMMON-LISP____DEFUN.html">defun</a>
 atj-type-rewrap-term (term dst-types)
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____AND.html">and</a> (<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> term)
                             (<a href="JAVA____ATJ-TYPE-LISTP.html">atj-type-listp</a> dst-types))))
 (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="ACL2____XARGS.html">xargs</a> :guard (<a href="COMMON-LISP____CONSP.html">consp</a> dst-types)))
 (<a href="COMMON-LISP____LET.html">let</a>
  ((__function__ 'atj-type-rewrap-term))
  (<a href="COMMON-LISP____DECLARE.html">declare</a> (<a href="COMMON-LISP____IGNORABLE.html">ignorable</a> __function__))
  (<a href="ACL2____B_A2.html">b*</a>
   (((<a href="ACL2____MV.html">mv</a> term src-types &amp;)
     (<a href="JAVA____ATJ-TYPE-UNWRAP-TERM.html">atj-type-unwrap-term</a> term))
    ((when (<a href="COMMON-LISP____NULL.html">null</a> term))
     (<a href="ACL2____RAISE.html">raise</a> "Internal error: unwrapped null term ~x0."
            term))
    ((when (<a href="COMMON-LISP____NOT.html">not</a> (<a href="JAVA____ATJ-TYPES-CONV-ALLOWED-P.html">atj-types-conv-allowed-p</a> src-types dst-types)))
     (<a href="ACL2____RAISE.html">raise</a>
      "Type annotation failure: ~
                cannot convert from ~x0 to ~x1."
      src-types dst-types))
    ((<a href="ACL2____MV.html">mv</a> ifp test then else)
     (<a href="ACL2____CHECK-IF-CALL.html">check-if-call</a> term)))
   (<a href="COMMON-LISP____IF.html">if</a> ifp
       (<a href="JAVA____ATJ-TYPE-WRAP-TERM.html">atj-type-wrap-term</a>
            (<a href="ACL2____FCONS-TERM_A2.html">fcons-term*</a> 'if
                         test
                         (<a href="JAVA____ATJ-TYPE-REWRAP-TERM.html">atj-type-rewrap-term</a> then dst-types)
                         (<a href="JAVA____ATJ-TYPE-REWRAP-TERM.html">atj-type-rewrap-term</a> else dst-types))
            dst-types dst-types)
       (<a href="JAVA____ATJ-TYPE-WRAP-TERM.html">atj-type-wrap-term</a> term src-types dst-types)))))</pre> 
<p><b>Theorem: </b>pseudo-termp-of-atj-type-rewrap-term</p><pre class="code">(<a href="ACL2____DEFTHM.html">defthm</a> pseudo-termp-of-atj-type-rewrap-term
        (<a href="ACL2____B_A2.html">b*</a> ((rewrapped-term (<a href="JAVA____ATJ-TYPE-REWRAP-TERM.html">atj-type-rewrap-term</a> term dst-types)))
            (<a href="ACL2____PSEUDO-TERMP.html">pseudo-termp</a> rewrapped-term))
        :rule-classes :rewrite)</pre> 

</body>
</html>
