<html>
<head>
<meta charset="UTF-8">
<title>Z3-installation</title>
<link rel="stylesheet" type="text/css" href="../style.css"/>
</head>
<body>

<h3><a href="../index.html?topic=SMT____Z3-INSTALLATION">Click for Z3-installation in the Full Manual</a></h3>

<p>How to install Z3</p><h3>How I installed Z3</h3> 
<p>In case you find the Z3 README page confusing, here's how I installed Z3. 
  One can adjust the process to one's own needs.  The version of Z3 I used is 
  <span class="v">Z3 version 4.5.0 - 64 bit</span>, and the version of Python I used is <span class="v">Python
  2.7.15</span>.</p> 
<ul> 
<li>Download the current stable release from Z3 <a href="https://github.com/Z3Prover/z3/releases" target="_blank"><nobr>releases<img src="../Icon_External_Link.png" title="External link to https://github.com/Z3Prover/z3/releases"></nobr></a> 
 
<p>We want to download the source code and compile it by ourselves. It might be 
  doable to use the binary releases by setting up <span class="v">PYTHONPATH</span> and 
  <span class="v">DYLD_LIBRARY_PATH</span> (on macos), but I haven't tried it and there's no 
  instruction in Z3 telling us if that's the way to use it.</p> 
</li> 
<li>Assume we are in the release directory, do: 
<pre class="code">python scripts/mk_make.py --prefix=$HOME/usr --python --pypkgdir=$HOME/usr/lib/python-2.7/site-packages</pre> 
<p>I want to install it in my <span class="v">$HOME/usr</span> directory prefix, but you can 
  replace that part of the path with your conventional path. Note that Z3 
  restricts <span class="v">--prefix</span> to be the prefix of <span class="v">--pypkgdir</span>. Also, 
  <span class="v">$HOME/usr</span> does not need to exist in order to follow these steps; that 
  directory and subdirectories will be created as necessary.</p> 
</li> 
<li>Now make the C/C++ libraries, do: 
<pre class="code">cd build; make</pre> 
</li> 
<li>Now do the installation in places specified in <span class="v">--prefix</span>: 
<pre class="code">make install</pre> 
<p>Now if one takes a look at <span class="v">$HOME/usr</span>, one will see in <span class="v">$HOME/usr/bin</span>, 
we have the <span class="v">z3</span> executable, in <span class="v">$HOME/usr/include</span> we have all the z3 
C++ header files, in <span class="v">$HOME/usr/lib</span> we have <span class="v">libz3.dylib</span> and in 
<span class="v">$HOME/usr/lib/python-2.7/site-packages</span> we have all the z3 Python API 
files.</p> 
<p>Because we are using a user specified prefix, the command line produces the 
message:</p> 
<pre class="code">Z3Py was installed at /.../usr/lib/python-2.7/site-packages, make sure
this directory is in your PYTHONPATH environment variable. @echo Z3 was
successfully installed.</pre> 
</li> 
<li>So the last step is to add this path to PYTHONPATH. Adding this path to 
  existing PYTHONPATH: 
<pre class="code">export PYTHONPATH=$HOME/usr/lib/python-2.7/site-packages:$PYTHONPATH</pre> 
If PYTHONPATH is undefined, do: 
<pre class="code">export PYTHONPATH=$HOME/usr/lib/python-2.7/site-packages
@</pre> 
</li> 
<li>Now one should be able to import z3 into Python. 
Run Python, which will put you in an interactive loop. 
<pre class="code">from z3 import *
x = Real('x')
y = Real('y')
s = Solver()
s.add(x + y &gt; 5, x &gt; 1, y &gt; 1)
print(s.check())
print(s.model())
quit()</pre> 
<p>One should expect some results like:</p> 
<pre class="code">&gt;&gt;&gt; print(s.check())
sat
&gt;&gt;&gt; print(s.model())
[y = 4, x = 2]</pre> 
<p>This example asks for a satisfying assignment to the problem: 
x + y &gt; 5, x &gt; 1 and y &gt; 1. It should be easy to check the 
result.</p> 
</li> 
</ul> 
 
<h3>Additional Notes</h3> 
<p> 
The instructions above explain how to install Z3 in the user's home directory. 
</p> 
<p> 
Another option is to install Z3 in a machine-wide location. 
The following instructions worked on at least two Mac machines: 
</p> 
<ol> 
<li> 
Download the latest stable release of Z3 as explained in the instructions above. 
Unzip it: let <span class="v">&lt;dir&gt;</span> be the name of the resulting directory. 
</li> 
<li> 
Move the directory to a machine-wide location, e.g.: 
<pre class="code">sudo mv &lt;dir&gt; /usr/local/</pre> 
The <span class="v">sudo</span> is needed because <span class="v">/usr/local</span> is typically owned by <span class="v">root</span>, 
and it is not good practice to change the ownership of <span class="v">/usr/local</span> 
to a non-<span class="v">root</span> user. 
There is no need to change the ownership of <span class="v">/usr/local/&lt;dir&gt;</span> to <span class="v">root</span>. 
</li> 
<li> 
Prepare to build Z3 with the Python bindings: 
<pre class="code">cd /usr/local/&lt;dir&gt;
python scripts/mk_make.py --python</pre> 
Note that no <span class="v">--prefix</span> or <span class="v">--pypkgdir</span> options are used here, 
unlike the instructions given above. 
This may give a warning related to Z3's restriction, 
mentioned in the instructions above, 
that <span class="v">--prefix</span> must be a prefix of <span class="v">--pypkgdir</span>; 
despite this warning, things worked on at least two Mac machines. 
On Mac, ensuring that this restriction is satisfied is tricky because 
Python packages are normally installed in places like 
<span class="v">/Library/Frameworks/Python.framework/Versions/3.6/...</span> or 
<span class="v">/System/Library/Frameworks/Python.framework/Versions/2.7/...</span>, 
but prefixes of these locations normally do not hold 
the <span class="v">bin</span>, <span class="v">lib</span>, and <span class="v">include</span> directories 
that the Z3 installation creates (see below). 
</li> 
<li> 
Build Z3: 
<pre class="code">cd build
make</pre> 
This may take a while to complete. 
</li> 
<li> 
Install Z3: 
<pre class="code">sudo make install</pre> 
The <span class="v">sudo</span> is needed because this will write into 
<span class="v">/usr/local/bin</span>, <span class="v">/usr/local/lib</span>, and <span class="v">/usr/local/include</span>, 
which are typically owned by <span class="v">root</span> (see comments above about this). 
</li> 
<li> 
Run the Z3 example in Python described in the instructions above, 
to confirm that the installation was successful. 
</li> 
</ol> 
 
<h3>Allow the Build System to Find Z3</h3> 
<p>To make sure ACL2's build system can find Z3, Z3 should be installed in 
one's path.  There are two ways to achieve this:</p> 
<ul> 
<li> 
Add the path to where Z3 is installed into one's path.  For example, 
<pre class="code">export PATH=/path to z3 executable/:$PATH</pre> 
</li> 
<li> 
Another way of achieving this purpose is to create the following bash script 
called ``z3'' and put it in one's path: 
<pre class="code">#!/bin/bash
/path to z3 executable/z3 "$@"</pre> 
In some systems, after creating that script, one needs to run ``rehash'' in the 
shell. 
</li> 
</ul> 

</body>
</html>
